# Fix V3PRO_UPGRADE_PLAN_Version2.md - Chapter 1 format issues
$filePath = "c:\Users\1\2468\3579\docs\V3PRO_UPGRADE_PLAN_Version2.md"
$content = Get-Content $filePath -Raw -Encoding UTF8

# New Chapter 1 content (fixed format)
$newChapter1 = @'
## 1. æ‰§è¡ŒåŸåˆ™

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ğŸ”´ [REVIEW-NOTE] ç¬¬1ç« å®¡æŸ¥
     â”œâ”€ æ£€æŸ¥ï¼šå‘ç° 1.1/1.2/1.3 ä¸‰ä¸ªè¡¨æ ¼æ ¼å¼ä¸¥é‡æŸå
     â”œâ”€ é£é™©ï¼šè¡¨æ ¼è§£æå¤±è´¥å¯¼è‡´å†›è§„ä¸å¯è¯»ï¼Œæ‰§è¡Œæ—¶äº§ç”Ÿæ­§ä¹‰
     â”œâ”€ ä¿®æ”¹ï¼šå®Œå…¨é‡å†™ä¸‰ä¸ªè¡¨æ ¼ï¼Œæ¢å¤æ­£ç¡® Markdown æ ¼å¼
     â””â”€ æ€»ç»“ï¼šæœ¬ç« ä¸ºæ‰§è¡Œæ ¸å¿ƒï¼Œæ ¼å¼å¿…é¡»é›¶å®¹é”™
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

### 1.1 ä¸å¯è¿èƒŒçš„å†›è§„

<!-- ğŸ”§ [FIX] åŸè¡¨æ ¼ M1/M3 è¡Œæ ¼å¼æ–­è£‚ï¼Œå·²ä¿®å¤ä¸ºæ ‡å‡† Markdown è¡¨æ ¼ -->

| ç¼–å· | åŸåˆ™ | è¯´æ˜ | è¿ååæœ |
|------|------|------|----------|
| M1 | **é˜¶æ®µé—¨ç¦** | æ¯ä¸ªé˜¶æ®µå¿…é¡»é€šè¿‡å…¨éƒ¨é—¨ç¦æ‰èƒ½è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µ | ä»»åŠ¡å¤±è´¥ï¼Œå›æ»š |
| M2 | **åœºæ™¯é©±åŠ¨** | å…ˆå†™ required scenarioï¼Œå†å†™å®ç° | PR æ‹’ç» |
| M3 | **æœ€å°å®ç°** | ä»…å®ç°ã€Œèƒ½é€šè¿‡å¿…é€‰åœºæ™¯çš„æœ€å°é—­ç¯ã€ | ä»£ç åˆ é™¤ |
| M4 | **åŒè½¨åˆ†ç¦»** | A-Platform ä¸ B-Models ä¸æ·· PR | PR æ‹’ç» |
| M5 | **é”šç‚¹è¿½æº¯** | æ¯æ¬¡äº¤ä»˜å¿…é¡»æ›´æ–° context.md é”šç‚¹ | PR æ‹’ç» |
| M6 | **å•ä¸€çœŸç›¸** | è®¢å•çŠ¶æ€ç”± FSM å”¯ä¸€ç»´æŠ¤ï¼ŒæŒä»“ç”± PositionTracker å”¯ä¸€ç»´æŠ¤ | æ¶æ„è¿è§„ |
| M7 | **ç¦æ­¢ç©ºå£³** | æ–°æ¨¡å—å¿…é¡»æœ‰ required scenario é©±åŠ¨ | ä»£ç åˆ é™¤ |
| M8 | **å®¡è®¡å®Œæ•´** | æ‰€æœ‰è‡ªåŠ¨åŠ¨ä½œå¿…é¡»å†™å…¥ audit JSONL | åŠŸèƒ½æ‹’æ”¶ |

<!-- ğŸ†• [UPGRADE] å»ºè®®æ–°å¢å†›è§„ M9-M11 -->

| ç¼–å· | åŸåˆ™ | è¯´æ˜ | è¿ååæœ |
|------|------|------|----------|
| M9 | **å›æ»šå°±ç»ª** | æ¯ä¸ª Phase å¿…é¡»æœ‰æ˜ç¡®å›æ»šå‘½ä»¤ | æ— æ³•ç´§æ€¥æ¢å¤ |
| M10 | **è„šæœ¬éªŒè¯** | å¼•ç”¨è„šæœ¬å¿…é¡»åœ¨ CI å‰ç¡®è®¤å­˜åœ¨ | é—¨ç¦å¤±è´¥ |
| M11 | **é…ç½®é›†ä¸­** | æ‰€æœ‰é…ç½®é¡¹å¿…é¡»åœ¨ config.py æ³¨å†Œ | é…ç½®æ··ä¹± |

### 1.2 é—¨ç¦å®šä¹‰

<!-- ğŸ”§ [FIX] åŸè¡¨æ ¼æ ¼å¼å®Œå…¨æŸåï¼Œå·²ä¿®å¤ä¸ºæ ‡å‡† Markdown è¡¨æ ¼ -->
<!-- âš ï¸ [RISK] å‘ç° sim_gate.py è„šæœ¬ä¸å­˜åœ¨ï¼Œéœ€åœ¨ç¬¬23ç« æ ‡æ³¨å¾…åˆ›å»º -->

| åºå· | å‘½ä»¤ | è¯´æ˜ | å¤±è´¥é€€å‡ºç  |
|------|------|------|-----------|
| 1 | `.\scripts\make.ps1 ci-json` | CI é—¨ç¦ï¼ˆlint + type + testï¼‰ | 2/3/4 |
| 2 | `python .\scripts\coverage_gate.py` | è¦†ç›–ç‡é—¨ç¦ï¼ˆæ ¸å¿ƒ=100%ï¼Œæ€»ä½“â‰¥85%ï¼‰ | 5 |
| 3 | `python .\scripts\validate_policy.py --all --strict-scenarios` | åœºæ™¯ç­–ç•¥é—¨ç¦ | 12 |
| 4 | `.\scripts\make.ps1 replay-json` | å›æ”¾é—¨ç¦ | 8 |
| 5 | `python .\scripts\validate_policy.py --strict-scenarios` | å›æ”¾ç­–ç•¥é—¨ç¦ | 12 |
| 6 | `.\scripts\make.ps1 sim-json` | æ¨¡æ‹Ÿé—¨ç¦ | 9 |
| 7 | `python .\scripts\sim_gate.py --strict` | æ¨¡æ‹Ÿç­–ç•¥é—¨ç¦ | 12 |

<!-- ğŸ”´ [CRITICAL] sim_gate.py ä¸å­˜åœ¨ï¼éœ€åœ¨ Phase 5 å‰åˆ›å»ºï¼Œè¯¦è§ç¬¬23ç«  -->

### 1.3 é€€å‡ºç è¯­ä¹‰

<!-- ğŸ”§ [FIX] åŸè¡¨æ ¼æ ¼å¼æŸåï¼ˆç¼ºå°‘ | åˆ†éš”ç¬¦ï¼‰ï¼Œå·²ä¿®å¤ -->

| é€€å‡ºç  | å«ä¹‰ | åŠ¨ä½œ |
|--------|------|------|
| 0 | æˆåŠŸ | ç»§ç»­ |
| 2 | æ ¼å¼/è¯­æ³•æ£€æŸ¥å¤±è´¥ | ä¿®å¤ä»£ç é£æ ¼ |
| 3 | ç±»å‹æ£€æŸ¥å¤±è´¥ | ä¿®å¤ç±»å‹æ ‡æ³¨ |
| 4 | æµ‹è¯•å¤±è´¥ | ä¿®å¤æµ‹è¯• |
| 5 | è¦†ç›–ç‡ä¸è¶³ | è¡¥å……æµ‹è¯• |
| 8 | å›æ”¾å¤±è´¥ | ä¿®å¤å›æ”¾é€»è¾‘ |
| 9 | ä»¿çœŸå¤±è´¥ | ä¿®å¤ä»¿çœŸé€»è¾‘ |
| 12 | ç­–ç•¥è¿è§„ | ä¿®å¤åœºæ™¯/æ¨¡å¼ |
| 14 | ANCHOR_DRIFT | æ›´æ–°é”šç‚¹ |

---

'@

# Find chapter boundaries
$ch1Start = $content.IndexOf("## 1. æ‰§è¡ŒåŸåˆ™")
$ch2Start = $content.IndexOf("## 2. å½“å‰çŠ¶æ€ä¸é”šç‚¹")

if ($ch1Start -ge 0 -and $ch2Start -gt $ch1Start) {
    $before = $content.Substring(0, $ch1Start)
    $after = $content.Substring($ch2Start)
    $newContent = $before + $newChapter1 + $after
    Set-Content -Path $filePath -Value $newContent -Encoding UTF8 -NoNewline
    Write-Host "SUCCESS: Chapter 1 fixed!"
    Write-Host "Before length: $($content.Length)"
    Write-Host "After length: $($newContent.Length)"
} else {
    Write-Host "ERROR: Could not find chapter boundaries"
    Write-Host "Ch1 at: $ch1Start, Ch2 at: $ch2Start"
}
