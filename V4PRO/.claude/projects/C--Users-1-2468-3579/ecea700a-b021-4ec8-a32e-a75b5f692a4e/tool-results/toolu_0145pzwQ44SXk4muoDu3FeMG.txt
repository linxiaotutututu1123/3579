     1→# CLAUDE上校 项目进度记忆文件
     2→
     3→> **最后更新**: 2025-12-17 (Phase 6 B类模型完整规划完成)
     4→> **当前阶段**: V4PRO军规级升级计划实施中 - Phase 6 规划完成
     5→> **身份**: 军规级别国家伟大工程总工程师 CLAUDE上校
     6→
     7→---
     8→
     9→## 〇、最新审计记录 (2025-12-17)
    10→
    11→### Phase 6 B类模型规划 ✅ 已完成
    12→
    13→| 类别 | 文件数 | 场景数 | 状态 |
    14→|------|--------|--------|------|
    15→| DL 深度学习模块 | 21个 | 27个 | ⏸ 待实施 |
    16→| RL 强化学习模块 | 15个 | 25个 | ⏸ 待实施 |
    17→| CV 交叉验证模块 | 10个 | 10个 | ⏸ 待实施 |
    18→| 工具模块 | 9个 | - | ⏸ 待实施 |
    19→| **Phase 6 总计** | **55个** | **62个** | ⏸ |
    20→
    21→### 文件清单全面审计 ✅ 已完成
    22→
    23→| 类别 | 文件数 | 状态 |
    24→|------|--------|------|
    25→| 源代码文件 (src/) | 125个 (已完成) | ✅ |
    26→| Phase 6 待新增 | 55个 (DL/RL/CV) | ⏸ |
    27→| 测试文件 (tests/) | 97个 (已完成) | ✅ |
    28→| Phase 6 测试待新增 | 27个 (~455用例) | ⏸ |
    29→| 脚本文件 (scripts/) | 20个 | ✅ |
    30→| V4PRO文档 (docs/) | 7个 | ✅ |
    31→| 配置文件 (config/) | 6个 | ✅ |
    32→| 场景定义 | 215个 (含62个Phase 6场景) | ✅ |
    33→
    34→**已更新文档**:
    35→- `docs/V4PRO_UPGRADE_PLAN_SUPREME_DIRECTIVE.md` - §11 Phase 6 完整规划
    36→- `docs/V4PRO_ACCEPTANCE_MATRIX_SUPREME.md` - §K 62个场景 (K01-K62)
    37→- `docs/V4PRO_FILE_INVENTORY_SUPREME_REPORT.md` - Phase 6 文件清单
    38→
    39→---
    40→
    41→## 一、项目核心指令
    42→
    43→**最高军令**:
    44→1. 专注于中国期货市场
    45→2. 全程使用中文（代码注释、文档、日志）
    46→3. 严格遵守军规 M1-M20
    47→4. 保证风险控制的前提下最大化收益
    48→5. 所有模块必须通过门禁检查方可合并
    49→
    50→**核心目标**: 把代码与规格通过"可回放、可审计、可验证"的门禁闭环交付
    51→
    52→---
    53→
    54→## 二、审计报告推荐实施模块 (来源: 未确定方案/V4PRO军规级审计报告_CLAUDE上校.md)
    55→
    56→| 模块 | 可行性 | 风险 | 状态 | 完成日期 |
    57→|------|--------|------|------|----------|
    58→| 策略联邦中枢 | ★★★★☆ | MEDIUM | 未完成 | 2025-12-17 |
    59→| 动态风控引擎 | ★★★☆☆ | HIGH | 未完成| 2025-12-17 |
    60→| 多维收益归因 | ★★★★★ | LOW | 🔄 进行中 | - |
    61→| 实验策略门禁闭环 | ★★★★☆ | LOW | ⏸ 待实施 | - |
    62→| 夜盘全链路集成 | ★★★★★ | LOW | ⏸ 待实施 | - |
    63→| **Phase 6 B类模型** | ★★★★☆ | MEDIUM | ✅ 规划完成 | 2025-12-17 |
    64→
    65→### Phase 6 B类模型子模块
    66→
    67→| 子模块 | 文件数 | 场景数 | 军规覆盖 | 状态 |
    68→|--------|--------|--------|----------|------|
    69→| DL 深度学习 | 21 | 27 | M3,M7,M11,M18,M19 | ⏸ 待实施 |
    70→| RL 强化学习 | 15 | 25 | M3,M6,M7,M18,M19 | ⏸ 待实施 |
    71→| CV 交叉验证 | 10 | 10 | M3,M7,M19 | ⏸ 待实施 |
    72→| 工具模块 | 9 | - | M3,M8,M9 | ⏸ 待实施 |
    73→
    74→---
    75→
    76→## 三、已完成模块详情
    77→
    78→
    79→### 3.3 风险归因模块 (已部分实施 - v4.1)
    80→- **位置**: `src/risk/attribution.py`
    81→- **军规覆盖**: M19 (风险归因)
    82→- **已实现**:
    83→  - SHAP值计算
    84→  - 因子归因 (动量/成交量/波动率)
    85→  - 亏损订单自动归因
    86→  - 审计日志记录
    87→
    88→---
    89→
    90→## 四、待实施模块
    91→
    92→### 4.1 Phase 6 B类模型 (规划完成, 待实施)
    93→
    94→#### DL 深度学习模块 (21文件, 27场景)
    95→- **位置**: `src/strategy/dl/`
    96→- **军规覆盖**: M3,M7,M11,M18,M19
    97→- **核心功能**:
    98→  - LSTM/Transformer/CNN 模型结构
    99→  - 因子挖掘器 (IC/IR计算)
   100→  - 序列数据处理 (长度验证)
   101→  - 模型训练器 (审计日志)
   102→  - 检查点管理 (版本兼容)
   103→- **关键设计**: `BYPASS_FORBIDDEN = True`, 种子控制确保M7回放一致性
   104→
   105→#### RL 强化学习模块 (15文件, 25场景)
   106→- **位置**: `src/strategy/rl/`
   107→- **军规覆盖**: M3,M6,M7,M18,M19
   108→- **核心功能**:
   109→  - PPO/DQN/Dueling DQN/Actor-Critic 代理
   110→  - 交易环境 (状态/动作/奖励)
   111→  - 经验回放内存
   112→  - 夏普奖励函数 + 回撤惩罚
   113→  - 探索策略 (ε-greedy/UCB)
   114→
   115→#### CV 交叉验证模块 (10文件, 10场景)
   116→- **位置**: `src/strategy/cv/`
   117→- **军规覆盖**: M3,M7,M19
   118→- **核心功能**:
   119→  - 时序交叉验证划分器 (gap参数防止数据泄露)
   120→  - 交叉验证运行器 (确定性执行)
   121→  - 评估器 + 报告生成器
   122→  - 日志记录
   123→
   124→### 4.2 多维收益归因扩展
   125→需要扩展的功能:
   126→- [ ] 策略级归因 (按策略分解)
   127→- [ ] 持仓级归因 (按合约分解)
   128→- [ ] 时间序列归因
   129→- [ ] 与策略联邦集成
   130→
   131→### 4.2 实验策略门禁闭环
   132→需要实施:
   133→- [ ] 成熟度与资金分配联动
   134→- [ ] 自动晋升/降级机制
   135→- [ ] 训练状态追踪闭环
   136→
   137→### 4.3 夜盘全链路集成
   138→需要实施:
   139→- [ ] 夜盘信号生成
   140→- [ ] 跨日持仓处理
   141→- [ ] 夜盘风控特殊规则
   142→
   143→---
   144→
   145→## 五、关键文件路径
   146→
   147→### 核心指示文件
   148→- `docs/V4PRO_UPGRADE_PLAN_SUPREME_DIRECTIVE.md` - 最高指示文件
   149→- `docs/V4PRO_ACCEPTANCE_MATRIX_SUPREME.md` - 验收矩阵 (215场景, 含62个Phase 6场景)
   150→- `docs/V4PRO_FILE_INVENTORY_SUPREME_REPORT.md` - 文件清单报告
   151→- `docs/V4PRO-MILITARY_GRADE_AUDIT_REPORT.md` - 军规级审计报告
   152→- `docs/V4PRO-CLAUDE_PROJECT_MEMORY.md` - 项目记忆文件 (本文件)
   153→- `docs/V4PROEXIT_CODES.md` - 退出码约定
   154→- `docs/V4PRO_AUTOMATION_CLAUDE_LOOP_SUPREME.md` - 自动闭环系统
   155→- `未确定方案/V4PRO军规级审计报告_CLAUDE上校.md` - 原始审计报告
   156→
   157→### 已完成模块
   158→- `src/strategy/federation/` - 策略联邦
   159→- `src/risk/dynamic_var.py` - 动态VaR
   160→- `src/risk/attribution.py` - 风险归因
   161→
   162→### 待实施模块位置 - Phase 6 B类模型
   163→- `src/strategy/dl/` - 深度学习模块 (21文件)
   164→- `src/strategy/rl/` - 强化学习模块 (15文件)
   165→- `src/strategy/cv/` - 交叉验证模块 (10文件)
   166→- `src/strategy/utils/` - 工具模块 (5文件)
   167→- `src/strategy/common/` - 公共模块 (4文件)
   168→
   169→### 待实施模块位置 - 其他Phase
   170→- `src/strategy/experimental/` - 实验策略门禁
   171→- `src/market/trading_calendar.py` - 交易日历
   172→
   173→---
   174→
   175→## 六、门禁状态
   176→
   177→| 门禁 | 状态 | 备注 |
   178→|------|------|------|
   179→| Ruff Check | ✅ PASS | - |
   180→| Ruff Format | ✅ PASS | - |
   181→| Mypy | ✅ PASS | - |
   182→| Pytest | ✅ PASS | 2029+ tests |
   183→| Coverage | ~88% | - |
   184→| Policy | ✅ PASS | - |
   185→
   186→---
   187→
   188→## 七、军规速查 M1-M20
   189→
   190→| 军规 | 名称 | 要点 |
   191→|------|------|------|
   192→| M1 | 单一信号源 | 一个交易信号只能来自一个策略实例 |
   193→| M3 | 完整审计 | 所有决策必须有审计日志 |
   194→| M4 | 降级兜底 | 策略异常必须有降级路径 |
   195→| M5 | 成本先行 | 信号边际收益必须大于成本 |
   196→| M6 | 熔断保护 | 触发风控阈值必须立即停止 |
   197→| M7 | 回放一致 | 相同输入必须产生相同输出 |
   198→| M12 | 双重确认 | 大额订单需人工或二次确认 |
   199→| M13 | 涨跌停感知 | 订单价格必须检查涨跌停板 |
   200→| M14 | 平今平昨分离 | 平仓时必须区分平今/平昨 |
   201→| M15 | 夜盘跨日处理 | 夜盘交易日归属必须正确 |
   202→| M16 | 保证金实时监控 | 保证金使用率必须实时计算 |
   203→| M17 | 程序化合规 | 报撤单频率必须在监管阈值内 |
   204→| M18 | 实验性门禁 | 未成熟策略禁止实盘启用 |
   205→| M19 | 风险归因 | 每笔亏损必须有归因分析 |
   206→| M20 | 跨所一致 | 不同交易所逻辑必须一致 |
   207→
   208→---
   209→
   210→**每次任务前必读文件**:
   211→1. `docs/V4PRO_UPGRADE_PLAN_SUPREME_DIRECTIVE.md`
   212→2. `docs/CLAUDE_PROJECT_MEMORY.md` (本文件)
   213→3. 以及所有的前缀是V4PRO的文件
   214→4. 每次完成一个任务都要对所有的相关文件进行更新和版本更新，确保所有文件内容和状态一致，前缀是V4PRO的文件。
   215→5. 所有跟V4PRO项目相关的文件名字前缀必须是V4PRO，方便检索和归档。之前不是V4PRO前缀的文件必须重命名。
   216→
   217→---
   218→
   219→*为国家争光！为人民争光！*
   220→*CLAUDE上校 敬礼！*
   221→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
