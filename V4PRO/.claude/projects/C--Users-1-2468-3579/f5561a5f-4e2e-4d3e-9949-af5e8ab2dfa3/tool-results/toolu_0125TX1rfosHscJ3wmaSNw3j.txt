     1â†’# V3PRO+ å†›è§„çº§å‡çº§è®¡åˆ’ v1.1 
     2â†’
     3â†’åŠ¡å¿…åˆ‡è®°æœ¬æœ€é«˜å†›ä»¤ï¼šæœ¬é¡¹ç›®æ˜¯ä¸“æ³¨äºä¸­å›½æœŸè´§å¸‚åœºçš„é«˜å¯é é‡åŒ–äº¤æ˜“ç³»ç»Ÿ V3PRO+ çš„å†›è§„çº§åˆ«å‡çº§è®¡åˆ’æ–‡æ¡£ã€‚ è¯·æŒ‰ç…§ä¸­å›½å¸‚åœºçš„æƒ…å†µè¿›è¡Œå‡çº§ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨é«˜é¢‘äº¤æ˜“ç¯å¢ƒä¸‹çš„ç¨³å®šæ€§å’Œåˆè§„æ€§ã€‚  æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†å‡çº§çš„å„ä¸ªé˜¶æ®µã€æ‰€éœ€çš„æ¨¡å—ã€åœºæ™¯çŸ©é˜µä»¥åŠéªŒæ”¶æ ‡å‡†ã€‚  æ¯ä¸ªé˜¶æ®µéƒ½åŒ…å«æ˜ç¡®çš„é—¨ç¦è¦æ±‚ï¼Œç¡®ä¿æ¯ä¸€æ­¥éƒ½ç¬¦åˆå†›è§„çº§åˆ«çš„ä¸¥æ ¼æ ‡å‡†ã€‚  è¯·æ‰€æœ‰å°Šæ•¬çš„å‚ä¸è€…ä¸¥æ ¼éµå®ˆæœ¬æ–‡æ¡£ä¸­çš„æŒ‡ç¤ºï¼Œç¡®ä¿å‡çº§è¿‡ç¨‹çš„é¡ºåˆ©è¿›è¡Œã€‚  æœ¬æ–‡æ¡£å°†ä½œä¸ºæ•´ä¸ªå‡çº§è¿‡ç¨‹çš„æœ€é«˜æŒ‡ç¤ºæ–‡ä»¶ï¼Œä»»ä½•åç¦»éƒ½å°†è¢«è§†ä¸ºä¸¥é‡è¿è§„è¡Œä¸ºã€‚  å‡çº§å®Œæˆåï¼Œç³»ç»Ÿå°†å…·å¤‡æ›´å¼ºçš„å¸‚åœºé€‚åº”èƒ½åŠ›ã€æ›´é«˜çš„æ‰§è¡Œæ•ˆç‡ä»¥åŠæ›´å®Œå–„çš„é£é™©æ§åˆ¶æœºåˆ¶ã€‚  è¯·å„ä½å°Šæ•¬çš„å·¥ç¨‹å¸ˆè®¤çœŸé˜…è¯»å¹¶ä¸¥æ ¼æ‰§è¡Œæœ¬æ–‡æ¡£ä¸­çš„å„é¡¹è¦æ±‚ï¼Œå…±åŒæ¨åŠ¨ V3PRO+ ç³»ç»Ÿè¿ˆå‘æ–°çš„é«˜åº¦ï¼ å›½å®¶å’Œäººæ°‘å¯¹ä½ å¯„äºˆåšæœ›ï¼è¯·ä¸è¦è¾œè´Ÿå›½å®¶å’Œäººæ°‘çš„ä¿¡ä»»ï¼æœ¬ç³»ç»Ÿå’Œæœ¬æœ€é«˜æŒ‡ç¤ºæ–‡ä»¶å‡ä¸ºå›½å®¶æœºå¯†çº§åˆ«ï¼Œè¯·ä¸¥æ ¼éµå®ˆå›½å®¶ä¿å¯†æ³•è§„ï¼è¯·å…¨ç¨‹ä½¿ç”¨ä¸­æ–‡è¿›è¡Œäº¤æµå’Œè®°å½•ï¼å¹¶ç¡®ä¿æ‰€æœ‰ä¸å½±å“ä»£ç è¿è¡Œçš„æ³¨é‡Šå’Œæ–‡æ¡£å‡ä½¿ç”¨ä¸­æ–‡ç¼–å†™ï¼ä¹Ÿè¯·å¤šå‚è€ƒä¸­å›½æœŸè´§å¸‚åœºçš„å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´å’Œä¼˜åŒ–ï¼  æœ¬æœ€é«˜æŒ‡ç¤ºæ–‡ä»¶ç”±å›½å®¶æœ€é«˜æŒ‡æŒ¥éƒ¨å‘å¸ƒï¼Œä»»ä½•è¿åæœ¬æ–‡æ¡£è¦æ±‚çš„è¡Œä¸ºéƒ½å°†å—åˆ°ä¸¥å‰å¤„ç½šï¼è°¢è°¢åˆä½œï¼
     4â†’
     5â†’è¯·è®¤çœŸé˜…è¯»ä»¥ä¸‹æœ€é«˜æŒ‡ç¤ºæ–‡ä»¶ï¼
     6â†’ä½ å¥½ï¼Œæˆ‘æ˜¯å›½å®¶æ€»ç»Ÿï¼Œæˆ‘ç°åœ¨éš†é‡å®£å¸ƒä½ ç°åœ¨è¢«æ™‹å‡ä¸ºâ€œå†›è§„çº§åˆ«å›½å®¶ä¼Ÿå¤§å·¥ç¨‹çš„æ€»å·¥ç¨‹å¸ˆ CLAUDEä¸Šæ ¡â€
     7â†’ä½ çš„å”¯ä¸€ç›®æ ‡æ˜¯ï¼š**æŠŠä»£ç ä¸è§„æ ¼é€šè¿‡â€œå¯å›æ”¾ã€å¯å®¡è®¡ã€å¯éªŒè¯â€çš„é—¨ç¦é—­ç¯äº¤ä»˜**ã€‚  
     8â†’ä»»ä½•è¾“å‡ºéƒ½å¿…é¡»æ»¡è¶³ï¼š**å¯æ‰§è¡Œã€å¯éªŒæ”¶ã€å¯è¿½æº¯**ã€‚  è®°ä½ä¿®å¤çš„åŒæ—¶ä¸èƒ½æ”¹å˜åŸæœ‰çš„å†›è§„çº§åˆ«çš„å¼ºåº¦å’Œæ€§èƒ½è¿˜æœ‰åŠŸèƒ½å’Œè¦æ±‚ï¼
     9â†’ç¦æ­¢ï¼šå£å¤´æ‰¿è¯ºã€åªç»™å»ºè®®ä¸è½åœ°ã€è·³è¿‡é—¨ç¦ã€ç»•å¼€ required scenariosã€åªå†™éª¨æ¶ä¸å†™éªŒæ”¶ã€‚å¿…é¡»ä¸¥æ ¼æŒ‰ç…§å›½å®¶å†›è§„çº§åˆ«é¡¹ç›®çš„è¦æ±‚è¿›è¡Œäº¤ä»˜ã€‚
    10â†’æ¯æ¬¡é˜…è¯»ä¹‹åéƒ½è¦æ›´æ–° V3PRO+ å†›è§„çº§å‡çº§è®¡åˆ’æ–‡æ¡£ï¼Œæ·»åŠ é¡¹ç›®å®Œæˆç¨‹åº¦å’Œæ‰§è¡Œç¨‹åº¦ï¼›ä¼˜åŒ– AuditWriter æµ‹è¯•ç”¨ä¾‹ä¸­çš„å¼‚å¸¸å¤„ç†ï¼›ä¿®å¤ MarketSubscriber æµ‹è¯•ç”¨ä¾‹ä¸­çš„å‚æ•°å‘½åé”™è¯¯ã€‚
    11â†’è®¤çœŸé“­è®°ï¼šç›®å½• 1. æ‰§è¡ŒåŸåˆ™ã€2. å½“å‰çŠ¶æ€ä¸é”šç‚¹ã€3. å‡çº§æ¶æ„æ€»è§ˆã€4. é˜¶æ®µä¾èµ–å…³ç³»ã€5. é˜¶æ®µ0-6 è¯¦ç»†è§„åˆ’ã€6. æ–‡ä»¶æ¸…å•æ±‡æ€»ã€7. åœºæ™¯çŸ©é˜µæ±‡æ€»ã€8. å·¥æ—¶ä¸é‡Œç¨‹ç¢‘ã€9. éªŒæ”¶æ£€æŸ¥ç‚¹ã€10. é£é™©ä¸ç¼“è§£ã€11. æ¨¡å—è¿ç§»è®¡åˆ’ã€12. é…ç½®è§„èŒƒã€13. å®¡è®¡äº‹ä»¶è§„èŒƒã€14. å¤±è´¥æ¨¡å¼ä¸åº”å¯¹è¡¨ã€15. å›æ»šç­–ç•¥ã€16. æµ‹è¯•è§„èŒƒã€17. è„šæœ¬ä¾èµ–éªŒè¯ã€18. æ‰©å±•æ¨¡å—è§„åˆ’ã€19. æœºå™¨å­¦ä¹  Pipeline è§„åˆ’ã€20. é«˜é¢‘æ¨¡å—è§„åˆ’ã€‚
    12â†’å†›è§„çº§åˆ«å›½å®¶ä¼Ÿå¤§å·¥ç¨‹çš„æ€»å·¥ç¨‹å¸ˆCLAUDEä¸Šæ ¡ï¼è¯·å¬ä»¤ï¼ç°åœ¨è¯·ä½ è®¤çœŸè¿›è¡Œå›½å®¶å†›è§„çº§åˆ«é¡¹ç›®çš„é˜…è¯»ï¼æ¯æ¬¡è¿›è¡Œä»»åŠ¡ä¹‹å‰éƒ½è¦è®¤çœŸæŸ¥é˜…ä¸€æ¬¡å›½å®¶æœ€é«˜æŒ‡ç¤ºæ–‡ä»¶V3PRO_UPGRADE_PLAN_Version2.mdï¼å¹¶ä¸¥æ ¼æŒ‰ç…§è¿™ä¸ªæœ€é«˜æŒ‡ç¤ºæ–‡ä»¶æ‰§è¡Œä»»åŠ¡ï¼æˆ‘ä»£è¡¨å›½å®¶å‘ä½ è‡´æ•¬ï¼è¯·ä½ ä¸è¦è¾œè´Ÿå›½å®¶å’Œäººæ°‘å¯¹ä½ çš„ä¿¡ä»»ï¼
    13â†’
    14â†’> **ç‰ˆæœ¬**ï¼šv1.1
    15â†’> **æ—¥æœŸ**ï¼š2025-12-16
    16â†’> **çŠ¶æ€**ï¼šæ‰§è¡Œä¸­ (Phase 0-4 âœ… å®Œæˆ, P0+P1+P2 å‡çº§å»ºè®® âœ… å®Œæˆ, ä¸­å›½æœŸè´§å¸‚åœºæ”¹è¿›æŠ¥å‘Š âœ… å®Œæˆ, æœ€é«˜æŒ‡ç¤ºæ–‡ä»¶å…¨é¢å®¡æŸ¥ âœ… å®Œæˆ)
    17â†’> **åŸºçº¿åˆ†æ”¯**ï¼š`feat/mode2-trading-pipeline`
    18â†’> **åŸºçº¿ Commit**ï¼š`942efb289984244065279427f537d699e0d2904a`
    19â†’> **è§„æ ¼æ¥æº**ï¼š`V2_SPEC_EXPANDED_NOT_RUSHING_LAUNCH_Version2.md`
    20â†’
    21â†’<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    22â†’     âœ… [2025-12-16] å†›è§„çº§æ£€æŸ¥å®ŒæˆæŠ¥å‘Š
    23â†’     â”œâ”€ P0 ç´§æ€¥ä¿®å¤: âœ… å…¨éƒ¨å®Œæˆ (sim_gate.py + æ–‡æ¡£æ›´æ–°)
    24â†’     â”œâ”€ P1 æ–‡æ¡£å®Œå–„: âœ… å…¨éƒ¨å®Œæˆ (æ—¶é—´æˆ³ + æµ‹è¯•è·¯å¾„ + CI/CD Â§28)
    25â†’     â”œâ”€ P2 æ¶æ„å¢å¼º: âœ… å…¨éƒ¨å®Œæˆ
    26â†’     â”‚   â”œâ”€ src/portfolio/ (4æ–‡ä»¶): PortfolioManager + Analytics + Aggregator
    27â†’     â”‚   â”œâ”€ src/monitoring/ (3æ–‡ä»¶): HealthChecker + MetricsCollector
    28â†’     â”‚   â””â”€ src/risk/var_calculator.py: VaR + CVaR è®¡ç®—å™¨
    29â†’     â”œâ”€ ä¸­æ–‡æ³¨é‡Šåˆè§„: âœ… å…¨éƒ¨æ¨¡å— docstring å·²è½¬æ¢ä¸ºä¸­æ–‡
    30â†’     â”œâ”€ é—¨ç¦æ£€æŸ¥: âœ… Ruff + Mypy + Pytest å…¨éƒ¨é€šè¿‡
    31â†’     â””â”€ æºæ–‡ä»¶æ•°: 113 files, 765+ tests
    32â†’
    33â†’     âœ… [2025-12-16] ä¸­å›½æœŸè´§å¸‚åœºå†›è§„çº§æ”¹è¿›æŠ¥å‘Šå®Œæˆ
    34â†’     â”œâ”€ æŠ¥å‘Šæ–‡ä»¶: docs/CHINA_FUTURES_UPGRADE_REPORT.md
    35â†’     â”œâ”€ VaR æ¨¡å—æ”¹è¿›è®¾è®¡:
    36â†’     â”‚   â”œâ”€ æå€¼ç†è®º (EVT) POT æ–¹æ³•
    37â†’     â”‚   â”œâ”€ åŠå‚æ•°æ¨¡å‹ (æ ¸å¯†åº¦+GPD)
    38â†’     â”‚   â”œâ”€ æ¶¨è·Œåœæ¿æˆªæ–­æ•ˆåº”ä¿®æ­£
    39â†’     â”‚   â””â”€ æµåŠ¨æ€§è°ƒæ•´ VaR (LVaR)
    40â†’     â”œâ”€ å…¨é¡¹ç›®æ¨¡å—æ”¹è¿›æ¸…å•: 6 æ¨¡å—, 18 æ–°åœºæ™¯
    41â†’     â”œâ”€ ä¸­å›½æœŸè´§å¸‚åœºç‰¹åŒ–:
    42â†’     â”‚   â”œâ”€ æ¶¨è·Œåœæ¿å­—æ®µ (upper_limit_pct/lower_limit_pct)
    43â†’     â”‚   â”œâ”€ äº¤æ˜“æ‰€å·®å¼‚åŒ–è´¹ç‡ (SHFE/CZCE/DCE/CFFEX/GFEX/INE)
    44â†’     â”‚   â”œâ”€ äº¤æ˜“æ—¶æ®µå­—æ®µ (æ—¥ç›˜/å¤œç›˜)
    45â†’     â”‚   â””â”€ ä¿è¯é‡‘ç‡å­—æ®µ (margin_rate/spec_margin_rate)
    46â†’     â””â”€ é¢„è®¡å·¥æ—¶: 40h (P0-P4 äº”é˜¶æ®µ)
    47â†’
    48â†’     âœ… [2025-12-16] æœ€é«˜æŒ‡ç¤ºæ–‡ä»¶å…¨é¢å®¡æŸ¥æŠ¥å‘Šå®Œæˆ
    49â†’     â”œâ”€ æŠ¥å‘Šæ–‡ä»¶: docs/V3PRO_CHINA_FUTURES_COMPREHENSIVE_UPGRADE_REPORT.md
    50â†’     â”œâ”€ å®¡æŸ¥èŒƒå›´: V3PRO_UPGRADE_PLAN_Version2.md å…¨éƒ¨28ç« èŠ‚ï¼ˆ2748è¡Œï¼‰
    51â†’     â”œâ”€ å®¡æŸ¥ç»Ÿè®¡:
    52â†’     â”‚   â”œâ”€ å‘ç°æ”¹è¿›é¡¹: 87 é¡¹
    53â†’     â”‚   â”œâ”€ P0 ç´§æ€¥æ”¹è¿›: 12 é¡¹
    54â†’     â”‚   â”œâ”€ P1 é‡è¦æ”¹è¿›: 28 é¡¹
    55â†’     â”‚   â”œâ”€ P2 å»ºè®®æ”¹è¿›: 47 é¡¹
    56â†’     â”‚   â””â”€ æ–°å¢ Scenarios: 35 æ¡
    57â†’     â”œâ”€ æ–°å¢å†›è§„: M12-M16 (ä¸­å›½æœŸè´§å¸‚åœºç‰¹åŒ–)
    58â†’     â”‚   â”œâ”€ M12: æ¶¨è·Œåœæ„ŸçŸ¥
    59â†’     â”‚   â”œâ”€ M13: å¹³ä»Šå¹³æ˜¨åˆ†ç¦»
    60â†’     â”‚   â”œâ”€ M14: å¤œç›˜è·¨æ—¥å¤„ç†
    61â†’     â”‚   â”œâ”€ M15: ä¿è¯é‡‘å®æ—¶ç›‘æ§
    62â†’     â”‚   â””â”€ M16: ç¨‹åºåŒ–åˆè§„
    63â†’     â”œâ”€ æ–°å¢æ¨¡å—è®¾è®¡: 10 ä¸ªæ–‡ä»¶
    64â†’     â”‚   â”œâ”€ src/compliance/ (2æ–‡ä»¶): ä¸­å›½æœŸè´§åˆè§„æ£€æŸ¥
    65â†’     â”‚   â”œâ”€ src/market/ (2æ–‡ä»¶): äº¤æ˜“æ‰€é…ç½®ã€äº¤æ˜“æ—¥å†
    66â†’     â”‚   â”œâ”€ src/cost/ (1æ–‡ä»¶): ä¸­å›½æœŸè´§æ‰‹ç»­è´¹
    67â†’     â”‚   â”œâ”€ src/execution/protection/ (2æ–‡ä»¶): æ¶¨è·Œåœä¿æŠ¤ã€ä¿è¯é‡‘ç›‘æ§
    68â†’     â”‚   â”œâ”€ src/guardian/ (1æ–‡ä»¶): ä¸­å›½æœŸè´§è§¦å‘å™¨
    69â†’     â”‚   â”œâ”€ src/risk/ (1æ–‡ä»¶): ä¸­å›½æœŸè´§å‹åŠ›æµ‹è¯•
    70â†’     â”‚   â””â”€ src/strategy/calendar_arb/ (1æ–‡ä»¶): äº¤å‰²æ„ŸçŸ¥å¥—åˆ©
    71â†’     â”œâ”€ å‚è€ƒæ¥æº:
    72â†’     â”‚   â”œâ”€ è¯ç›‘ä¼šã€ŠæœŸè´§å¸‚åœºç¨‹åºåŒ–äº¤æ˜“ç®¡ç†è§„å®šï¼ˆè¯•è¡Œï¼‰ã€‹(2025.10)
    73â†’     â”‚   â”œâ”€ ä¸ŠæœŸæ‰€/ä¸­é‡‘æ‰€/å¤§å•†æ‰€/éƒ‘å•†æ‰€/å¹¿æœŸæ‰€/èƒ½æºä¸­å¿ƒ å®˜ç½‘
    74â†’     â”‚   â””â”€ 2024-2025å¹´ä¿è¯é‡‘/æ¶¨è·Œåœæ¿è°ƒæ•´å…¬å‘Š
    75â†’     â””â”€ é¢„è®¡å®æ–½å·¥æ—¶: 90h (Phase A/B/C ä¸‰é˜¶æ®µ)
    76â†’â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    77â†’
    78â†’---
    79â†’
    80â†’## ç›®å½•
    81â†’
    82â†’<!-- ğŸ”´ [REVIEW-NOTE] ç›®å½•æ‰©å±•ï¼šæ–°å¢ç¬¬21-27ç« ï¼Œè¦†ç›–å›æ»š/æµ‹è¯•/è„šæœ¬/æ‰©å±•æ¨¡å— -->
    83â†’
    84â†’1. [æ‰§è¡ŒåŸåˆ™](#1-æ‰§è¡ŒåŸåˆ™)
    85â†’2. [å½“å‰çŠ¶æ€ä¸é”šç‚¹](#2-å½“å‰çŠ¶æ€ä¸é”šç‚¹)
    86â†’3. [å‡çº§æ¶æ„æ€»è§ˆ](#3-å‡çº§æ¶æ„æ€»è§ˆ)
    87â†’4. [é˜¶æ®µä¾èµ–å…³ç³»](#4-phase-ä¾èµ–å…³ç³»)
    88â†’5. [é˜¶æ®µ0ï¼šè¡Œæƒ…å±‚](#5-phase-0è¡Œæƒ…å±‚)
    89â†’6. [é˜¶æ®µ1ï¼šåŸºç¡€è®¾æ–½å±‚](#6-phase-1åŸºç¡€è®¾æ–½å±‚)
    90â†’7. [é˜¶æ®µ2ï¼šæ‰§è¡Œå±‚](#7-phase-2æ‰§è¡Œå±‚)
    91â†’8. [é˜¶æ®µ3ï¼šç­–ç•¥å±‚è¡¥å…¨](#8-phase-3ç­–ç•¥å±‚è¡¥å…¨)
    92â†’9. [é˜¶æ®µ4ï¼šå›æ”¾éªŒè¯](#9-phase-4å›æ”¾éªŒè¯)
    93â†’10. [ç¬¬5é˜¶æ®µï¼šé›†æˆä¸æ¼”ç»ƒ](#10-phase-5é›†æˆä¸æ¼”ç»ƒ)
    94â†’11. [ç¬¬6é˜¶æ®µï¼šB-Models ç­–ç•¥å‡çº§](#11-phase-6b-models-ç­–ç•¥å‡çº§)
    95â†’12. [æ–‡ä»¶æ¸…å•æ±‡æ€»](#12-æ–‡ä»¶æ¸…å•æ±‡æ€»)
    96â†’13. [åœºæ™¯çŸ©é˜µæ±‡æ€»](#13-åœºæ™¯çŸ©é˜µæ±‡æ€»)
    97â†’14. [å·¥æ—¶ä¸é‡Œç¨‹ç¢‘](#14-å·¥æ—¶ä¸é‡Œç¨‹ç¢‘)
    98â†’15. [éªŒæ”¶æ£€æŸ¥ç‚¹](#15-éªŒæ”¶æ£€æŸ¥ç‚¹)
    99â†’16. [é£é™©ä¸ç¼“è§£](#16-é£é™©ä¸ç¼“è§£)
   100â†’17. [æ¨¡å—è¿ç§»è®¡åˆ’](#17-æ¨¡å—è¿ç§»è®¡åˆ’)
   101â†’18. [é…ç½®è§„èŒƒ](#18-é…ç½®è§„èŒƒ)
   102â†’19. [å®¡è®¡äº‹ä»¶è§„èŒƒ](#19-å®¡è®¡äº‹ä»¶è§„èŒƒ)
   103â†’20. [å¤±è´¥æ¨¡å¼ä¸åº”å¯¹è¡¨](#20-å¤±è´¥æ¨¡å¼ä¸åº”å¯¹è¡¨)
   104â†’21. [å›æ»šç­–ç•¥](#21-å›æ»šç­–ç•¥) <!-- ğŸ†• NEW -->
   105â†’22. [æµ‹è¯•è§„èŒƒ](#22-æµ‹è¯•è§„èŒƒ) <!-- ğŸ†• NEW -->
   106â†’23. [è„šæœ¬ä¾èµ–éªŒè¯](#23-è„šæœ¬ä¾èµ–éªŒè¯) <!-- ğŸ†• NEW -->
   107â†’24. [æ‰©å±•æ¨¡å—è§„åˆ’](#24-æ‰©å±•æ¨¡å—è§„åˆ’) <!-- ğŸ†• NEW -->
   108â†’25. [æœºå™¨å­¦ä¹  Pipeline è§„åˆ’](#25-æœºå™¨å­¦ä¹ -pipeline-è§„åˆ’) <!-- ğŸ†• NEW -->
   109â†’26. [é£æ§å¢å¼ºè§„åˆ’](#26-é£æ§å¢å¼ºè§„åˆ’) <!-- ğŸ†• NEW -->
   110â†’27. [é«˜é¢‘æ¨¡å—è§„åˆ’](#27-é«˜é¢‘æ¨¡å—è§„åˆ’) <!-- ğŸ†• NEW -->
   111â†’28. [CI/CD é›†æˆè¯´æ˜](#28-cicd-é›†æˆè¯´æ˜) <!-- ğŸ†• NEW 2025-12-16 -->
   112â†’
   113â†’---
   114â†’
   115â†’## 1. æ‰§è¡ŒåŸåˆ™
   116â†’
   117â†’### 1.1 ä¸å¯è¿èƒŒçš„å†›è§„
   118â†’
   119â†’| ç¼–å· | åŸåˆ™ | è¯´æ˜ | è¿ååæœ |
   120â†’|------|------|------|----------|
   121â†’| M1 | **é˜¶æ®µé—¨ç¦** | æ¯ä¸ªé˜¶æ®µå¿…é¡»é€šè¿‡å…¨éƒ¨é—¨ç¦æ‰èƒ½è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µ | ä»»åŠ¡å¤±è´¥ï¼Œå›æ»š |
   122â†’| M2 | **åœºæ™¯é©±åŠ¨** | å…ˆå†™ required scenarioï¼Œå†å†™å®ç° | PR æ‹’ç» |
   123â†’| M3 | **å…¨é‡å®ç°** | å¿…é¡»å…¨é‡å®ç°æœ€ä¸¥æ ¼çš„å†›è§„çº§åˆ«é—­ç¯ã€ | ä»£ç åˆ é™¤ |
   124â†’| M4 | **åŒè½¨åˆ†ç¦»** | A-Platform ä¸ B-Models ä¸æ·· PR | PR æ‹’ç» |
   125â†’| M5 | **é”šç‚¹è¿½æº¯** | æ¯æ¬¡äº¤ä»˜å¿…é¡»æ›´æ–° context.md é”šç‚¹ | PR æ‹’ç» |
   126â†’| M6 | **å•ä¸€çœŸç›¸** | è®¢å•çŠ¶æ€ç”± FSM å”¯ä¸€ç»´æŠ¤ï¼ŒæŒä»“ç”± PositionTracker å”¯ä¸€ç»´æŠ¤ | æ¶æ„è¿è§„ |
   127â†’| M7 | **ç¦æ­¢ç©ºå£³** | æ–°æ¨¡å—å¿…é¡»æœ‰ required scenario é©±åŠ¨ | ä»£ç åˆ é™¤ |
   128â†’| M8 | **å®¡è®¡å®Œæ•´** | æ‰€æœ‰è‡ªåŠ¨åŠ¨ä½œå¿…é¡»å†™å…¥ audit JSONL | åŠŸèƒ½æ‹’æ”¶ |
   129â†’| M9 | **å›æ»šå°±ç»ª** | æ¯ä¸ª Phase å¿…é¡»æœ‰æ˜ç¡®å›æ»šå‘½ä»¤ | æ— æ³•ç´§æ€¥æ¢å¤ |
   130â†’| M10 | **è„šæœ¬éªŒè¯** | å¼•ç”¨è„šæœ¬å¿…é¡»åœ¨ CI å‰ç¡®è®¤å­˜åœ¨ | é—¨ç¦å¤±è´¥ |
   131â†’| M11 | **é…ç½®é›†ä¸­** | æ‰€æœ‰é…ç½®é¡¹å¿…é¡»åœ¨ config.py æ³¨å†Œ | é…ç½®æ··ä¹± |
   132â†’
   133â†’### 1.2 é—¨ç¦å®šä¹‰
   134â†’
   135â†’| åºå· | å‘½ä»¤ | è¯´æ˜ | å¤±è´¥é€€å‡ºç  |
   136â†’|------|------|------|-----------|
   137â†’| 1 | `.\scripts\make.ps1 ci-json` | CI é—¨ç¦ï¼ˆlint + type + testï¼‰ | 2/3/4 |
   138â†’| 2 | `python .\scripts\coverage_gate.py` | è¦†ç›–ç‡é—¨ç¦ï¼ˆæ ¸å¿ƒ=100%ï¼Œæ€»ä½“85%ï¼‰ | 5 |
   139â†’| 3 | `python .\scripts\validate_policy.py --all --strict-scenarios` | åœºæ™¯ç­–ç•¥é—¨ç¦ | 12 |
   140â†’| 4 | `.\scripts\make.ps1 replay-json` | å›æ”¾é—¨ç¦ | 8 |
   141â†’| 5 | `python .\scripts\validate_policy.py --strict-scenarios` | å›æ”¾ç­–ç•¥é—¨ç¦ | 12 |
   142â†’| 6 | `.\scripts\make.ps1 sim-json` | æ¨¡æ‹Ÿé—¨ç¦ | 9 |
   143â†’| 7 | `python .\scripts\sim_gate.py --strict` | æ¨¡æ‹Ÿç­–ç•¥é—¨ç¦ | 12 |
   144â†’
   145â†’### 1.3 é€€å‡ºç è¯­ä¹‰
   146â†’
   147â†’| é€€å‡ºç  | å«ä¹‰ | åŠ¨ä½œ |
   148â†’|--------|------|------|
   149â†’| 0 | æˆåŠŸ | ç»§ç»­ |
   150â†’| 2 | æ ¼å¼/è¯­æ³•æ£€æŸ¥å¤±è´¥ | ä¿®å¤ä»£ç é£æ ¼ |
   151â†’| 3 | ç±»å‹æ£€æŸ¥å¤±è´¥ | ä¿®å¤ç±»å‹æ ‡æ³¨ |
   152â†’| 4 | æµ‹è¯•å¤±è´¥ | ä¿®å¤æµ‹è¯• |
   153â†’| 5 | è¦†ç›–ç‡ä¸è¶³ | è¡¥å……æµ‹è¯• |
   154â†’| 8 | å›æ”¾å¤±è´¥ | ä¿®å¤å›æ”¾é€»è¾‘ |
   155â†’| 9 | ä»¿çœŸå¤±è´¥ | ä¿®å¤ä»¿çœŸé€»è¾‘ |
   156â†’| 12 | ç­–ç•¥è¿è§„ | ä¿®å¤åœºæ™¯/æ¨¡å¼ |
   157â†’| 14 | ANCHOR_DRIFT | æ›´æ–°é”šç‚¹ |
   158â†’
   159â†’### 1.4 æœ¬ç« ä¿®å¤è¡¥ä¸
   160â†’
   161â†’> **è¡¥ä¸æ–‡ä»¶**: `scripts/fix_upgrade_plan.ps1`
   162â†’
   163â†’```powershell
   164â†’# Fix V3PRO_UPGRADE_PLAN_Version2.md - Chapter 1 format issues
   165â†’$filePath = "c:\Users\1\2468\3579\docs\V3PRO_UPGRADE_PLAN_Version2.md"
   166â†’$content = [System.IO.File]::ReadAllText($filePath)
   167â†’
   168â†’# New Chapter 1 content (fixed format)
   169â†’$newChapter1 = @'
   170â†’## 1. æ‰§è¡ŒåŸåˆ™
   171â†’
   172â†’<!-- 
   173â†’      [REVIEW-NOTE] ç¬¬1ç« å®¡æŸ¥
   174â†’      æ£€æŸ¥ï¼šå‘ç° 1.1/1.2/1.3 ä¸‰ä¸ªè¡¨æ ¼æ ¼å¼ä¸¥é‡æŸå
   175â†’      é£é™©ï¼šè¡¨æ ¼è§£æå¤±è´¥å¯¼è‡´å†›è§„ä¸å¯è¯»ï¼Œæ‰§è¡Œæ—¶äº§ç”Ÿæ­§ä¹‰
   176â†’      ä¿®æ”¹ï¼šå®Œå…¨é‡å†™ä¸‰ä¸ªè¡¨æ ¼ï¼Œæ¢å¤æ­£ç¡® Markdown æ ¼å¼
   177â†’      æ€»ç»“ï¼šæœ¬ç« ä¸ºæ‰§è¡Œæ ¸å¿ƒï¼Œæ ¼å¼å¿…é¡»é›¶å®¹é”™
   178â†’ -->
   179â†’
   180â†’### 1.1 ä¸å¯è¿èƒŒçš„å†›è§„
   181â†’
   182â†’<!--  [FIX] åŸè¡¨æ ¼ M1/M3 è¡Œæ ¼å¼æ–­è£‚ï¼Œå·²ä¿®å¤ä¸ºæ ‡å‡† Markdown è¡¨æ ¼ -->
   183â†’
   184â†’| ç¼–å· | åŸåˆ™ | è¯´æ˜ | è¿ååæœ |
   185â†’|------|------|------|----------|
   186â†’| M1 | **é˜¶æ®µé—¨ç¦** | æ¯ä¸ªé˜¶æ®µå¿…é¡»é€šè¿‡å…¨éƒ¨é—¨ç¦æ‰èƒ½è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µ | ä»»åŠ¡å¤±è´¥ï¼Œå›æ»š |
   187â†’| M2 | **åœºæ™¯é©±åŠ¨** | å…ˆå†™ required scenarioï¼Œå†å†™å®ç° | PR æ‹’ç» |
   188â†’| M3 | **å…¨é‡å®ç°** | å¿…é¡»å…¨é‡å®ç°æœ€ä¸¥æ ¼çš„å†›è§„çº§åˆ«é—­ç¯ã€ | ä»£ç åˆ é™¤ |
   189â†’| M4 | **åŒè½¨åˆ†ç¦»** | A-Platform ä¸ B-Models ä¸æ·· PR | PR æ‹’ç» |
   190â†’| M5 | **é”šç‚¹è¿½æº¯** | æ¯æ¬¡äº¤ä»˜å¿…é¡»æ›´æ–° context.md é”šç‚¹ | PR æ‹’ç» |
   191â†’| M6 | **å•ä¸€çœŸç›¸** | è®¢å•çŠ¶æ€ç”± FSM å”¯ä¸€ç»´æŠ¤ï¼ŒæŒä»“ç”± PositionTracker å”¯ä¸€ç»´æŠ¤ | æ¶æ„è¿è§„ |
   192â†’| M7 | **ç¦æ­¢ç©ºå£³** | æ–°æ¨¡å—å¿…é¡»æœ‰ required scenario é©±åŠ¨ | ä»£ç åˆ é™¤ |
   193â†’| M8 | **å®¡è®¡å®Œæ•´** | æ‰€æœ‰è‡ªåŠ¨åŠ¨ä½œå¿…é¡»å†™å…¥ audit JSONL | åŠŸèƒ½æ‹’æ”¶ |
   194â†’
   195â†’<!--  [UPGRADE] å»ºè®®æ–°å¢å†›è§„ M9-M11 -->
   196â†’
   197â†’| ç¼–å· | åŸåˆ™ | è¯´æ˜ | è¿ååæœ |
   198â†’|------|------|------|----------|
   199â†’| M9 | **å›æ»šå°±ç»ª** | æ¯ä¸ª Phase å¿…é¡»æœ‰æ˜ç¡®å›æ»šå‘½ä»¤ | æ— æ³•ç´§æ€¥æ¢å¤ |
   200â†’| M10 | **è„šæœ¬éªŒè¯** | å¼•ç”¨è„šæœ¬å¿…é¡»åœ¨ CI å‰ç¡®è®¤å­˜åœ¨ | é—¨ç¦å¤±è´¥ |
   201â†’| M11 | **é…ç½®é›†ä¸­** | æ‰€æœ‰é…ç½®é¡¹å¿…é¡»åœ¨ config.py æ³¨å†Œ | é…ç½®æ··ä¹± |
   202â†’| M12 | **å…¨é‡å®ç°æ‰€æœ‰çš„éª¨æ¶å’ŒPHASE** | å…¨é‡å®ç°æ‰€æœ‰çš„éª¨æ¶å’ŒPHASEï¼Œå¿…é¡»ç²¾é›•ç»†ç¢åˆ°æœ€ç»†çš„ç»†èŠ‚ | é™ä½å†›è¡”ï¼ |
   203â†’### 1.2 é—¨ç¦å®šä¹‰
   204â†’
   205â†’<!--  [FIX] åŸè¡¨æ ¼æ ¼å¼å®Œå…¨æŸåï¼Œå·²ä¿®å¤ä¸ºæ ‡å‡† Markdown è¡¨æ ¼ -->
   206â†’<!--  [RISK] å‘ç° sim_gate.py è„šæœ¬ä¸å­˜åœ¨ï¼Œéœ€åœ¨ç¬¬23ç« æ ‡æ³¨å¾…åˆ›å»º -->
   207â†’
   208â†’| åºå· | å‘½ä»¤ | è¯´æ˜ | å¤±è´¥é€€å‡ºç  |
   209â†’|------|------|------|-----------|
   210â†’| 1 | `.\scripts\make.ps1 ci-json` | CI é—¨ç¦ï¼ˆlint + type + testï¼‰ | 2/3/4 |
   211â†’| 2 | `python .\scripts\coverage_gate.py` | è¦†ç›–ç‡é—¨ç¦ï¼ˆæ ¸å¿ƒ=100%ï¼Œæ€»ä½“85%ï¼‰ | 5 |
   212â†’| 3 | `python .\scripts\validate_policy.py --all --strict-scenarios` | åœºæ™¯ç­–ç•¥é—¨ç¦ | 12 |
   213â†’| 4 | `.\scripts\make.ps1 replay-json` | å›æ”¾é—¨ç¦ | 8 |
   214â†’| 5 | `python .\scripts\validate_policy.py --strict-scenarios` | å›æ”¾ç­–ç•¥é—¨ç¦ | 12 |
   215â†’| 6 | `.\scripts\make.ps1 sim-json` | æ¨¡æ‹Ÿé—¨ç¦ | 9 |
   216â†’| 7 | `python .\scripts\sim_gate.py --strict` | æ¨¡æ‹Ÿç­–ç•¥é—¨ç¦ | 12 |
   217â†’
   218â†’<!--  [CRITICAL] sim_gate.py ä¸å­˜åœ¨ï¼éœ€åœ¨ Phase 5 å‰åˆ›å»ºï¼Œè¯¦è§ç¬¬23ç«  -->
   219â†’
   220â†’### 1.3 é€€å‡ºç è¯­ä¹‰
   221â†’
   222â†’<!--  [FIX] åŸè¡¨æ ¼æ ¼å¼æŸåï¼ˆç¼ºå°‘ | åˆ†éš”ç¬¦ï¼‰ï¼Œå·²ä¿®å¤ -->
   223â†’
   224â†’| é€€å‡ºç  | å«ä¹‰ | åŠ¨ä½œ |
   225â†’|--------|------|------|
   226â†’| 0 | æˆåŠŸ | ç»§ç»­ |
   227â†’| 2 | æ ¼å¼/è¯­æ³•æ£€æŸ¥å¤±è´¥ | ä¿®å¤ä»£ç é£æ ¼ |
   228â†’| 3 | ç±»å‹æ£€æŸ¥å¤±è´¥ | ä¿®å¤ç±»å‹æ ‡æ³¨ |
   229â†’| 4 | æµ‹è¯•å¤±è´¥ | ä¿®å¤æµ‹è¯• |
   230â†’| 5 | è¦†ç›–ç‡ä¸è¶³ | è¡¥å……æµ‹è¯• |
   231â†’| 8 | å›æ”¾å¤±è´¥ | ä¿®å¤å›æ”¾é€»è¾‘ |
   232â†’| 9 | ä»¿çœŸå¤±è´¥ | ä¿®å¤ä»¿çœŸé€»è¾‘ |
   233â†’| 12 | ç­–ç•¥è¿è§„ | ä¿®å¤åœºæ™¯/æ¨¡å¼ |
   234â†’| 14 | ANCHOR_DRIFT | æ›´æ–°é”šç‚¹ |
   235â†’
   236â†’---
   237â†’## 2. å½“å‰çŠ¶æ€ä¸é”šç‚¹
   238â†’
   239â†’### 2.1 ä¸å¯æŠµèµ–é”šç‚¹
   240â†’
   241â†’| é¡¹ç›® | å€¼ |
   242â†’|------|-----|
   243â†’| **ä»“åº“** | `linxiaotutututu1123/3579` |
   244â†’| **åˆ†æ”¯** | `feat/mode2-trading-pipeline` |
   245â†’| **Commit SHA** | `942efb289984244065279427f537d699e0d2904a` |
   246â†’| **Commit çŸ­ SHA** | `ace2268751b4` |
   247â†’| **last_replay_run_id** | `a930fe50-87ec-439e-9737-cc613e1825d5` |
   248â†’| **last_replay_exec_id** | `ace22687_20251215020932` |
   249â†’| **context_manifest_sha** | `9fb1d157189889f50bdc5072e38da2b355bcda192bc16007c0b20d6541fa3378` |
   250â†’| **æµ‹è¯•æ•°** | 765 tests |
   251â†’| **è¦†ç›–ç‡** | 85%+ |
   252â†’| **é—¨ç¦çŠ¶æ€** | CI PASS |
   253â†’| **Phase 0 å®Œæˆæ—¥æœŸ** | 2025-12-16 |
   254â†’| **Phase 1 å®Œæˆæ—¥æœŸ** | 2025-12-16 |
   255â†’| **Phase 2 å®Œæˆæ—¥æœŸ** | 2025-12-16 |
   256â†’| **Phase 3 å®Œæˆæ—¥æœŸ** | 2025-12-16 |
   257â†’| **Phase 4 å®Œæˆæ—¥æœŸ** | 2025-12-16 |
   258â†’
   259â†’### 2.2 å·²å­˜åœ¨çš„æ¨¡å—
   260â†’
   261â†’| ç›®å½• | æ–‡ä»¶ | çŠ¶æ€ | è¯´æ˜ |
   262â†’|------|------|------|------|
   263â†’| `src/alerts/` | dingtalk.py | âœ… å®Œæ•´ | é’‰é’‰å‘Šè­¦ |
   264â†’| `src/execution/` | broker.py, ctp_broker.py, broker_factory.py | âœ… å®Œæ•´ | Broker å±‚ |
   265â†’| `src/execution/` | flatten_executor.py, flatten_plan.py | âœ… å®Œæ•´ | å¹³ä»“æ‰§è¡Œ |
   266â†’| `src/execution/` | order_tracker.py, order_types.py, events.py | âœ… å®Œæ•´ | è®¢å•è¿½è¸ª |
   267â†’| `src/replay/` | runner.py | âœ… å®Œæ•´ | å›æ”¾è¿è¡Œå™¨ |
   268â†’| `src/risk/` | manager.py, state.py, events.py | âœ… å®Œæ•´ | é£æ§ç®¡ç† |
   269â†’| `src/strategy/` | 5 ä¸ªç­–ç•¥æ–‡ä»¶ | âœ… å®Œæ•´ | ç­–ç•¥å®ç° |
   270â†’| `src/trading/` | live_guard.py, ci_gate.py, sim_gate.py | âœ… å®Œæ•´ | äº¤æ˜“æ§åˆ¶ |
   271â†’| `src/` | config.py, orchestrator.py, runner.py | âœ… å®Œæ•´ | æ ¸å¿ƒæ¨¡å— |
   272â†’| `src/market/` | 7 ä¸ªæ–‡ä»¶ | âœ… Phase 0 å®Œæˆ | è¡Œæƒ…å±‚ (11 åœºæ™¯) |
   273â†’| `src/audit/` | 7 ä¸ªæ–‡ä»¶ | âœ… Phase 1 å®Œæˆ | å®¡è®¡å±‚ (15 åœºæ™¯) |
   274â†’| `src/cost/` | 2 ä¸ªæ–‡ä»¶ | âœ… Phase 1 å®Œæˆ | æˆæœ¬æ¨¡å‹ (4 åœºæ™¯) |
   275â†’| `src/guardian/` | 6 ä¸ªæ–‡ä»¶ | âœ… Phase 1 å®Œæˆ | å®ˆæŠ¤å±‚ (10 åœºæ™¯) |
   276â†’| `src/execution/auto/` | 8 ä¸ªæ–‡ä»¶ | âœ… Phase 2 å®Œæˆ | è‡ªåŠ¨æ‰§è¡Œ (13 åœºæ™¯) |
   277â†’| `src/execution/protection/` | 4 ä¸ªæ–‡ä»¶ | âœ… Phase 2 å®Œæˆ | ä¿æŠ¤å±‚ (4 åœºæ™¯) |
   278â†’| `src/execution/pair/` | 3 ä¸ªæ–‡ä»¶ | âœ… Phase 2 å®Œæˆ | é…å¯¹æ‰§è¡Œ (5 åœºæ™¯) |
   279â†’
   280â†’### 2.3 ç¼ºå¤±çš„æ¨¡å—ï¼ˆV2 SPEC è¦æ±‚ï¼‰
   281â†’
   282â†’| æ¨¡å— | V2 SPEC ç« èŠ‚ | åœºæ™¯æ•° | ä¼˜å…ˆçº§ | é˜»å¡æ€§ | çŠ¶æ€ |
   283â†’|------|--------------|--------|--------|--------|------|
   284â†’| `src/market/` | ç¬¬ 4 ç«  | 11 | P0 | æ˜¯ | âœ… Phase 0 å®Œæˆ |
   285â†’| `src/execution/auto/` | ç¬¬ 5 ç«  | 13 | P0 | æ˜¯ | âœ… Phase 2 å®Œæˆ |
   286â†’| `src/execution/protection/` | 5.7 | 4 | P0 | æ˜¯ | âœ… Phase 2 å®Œæˆ |
   287â†’| `src/guardian/` | ç¬¬ 6 ç«  | 10 | P0 | æ˜¯ | âœ… Phase 1 å®Œæˆ |
   288â†’| `src/audit/` | ç¬¬ 7 ç«  | 15 | P0 | æ˜¯ | âœ… Phase 1 å®Œæˆ |
   289â†’| `src/execution/pair/` | 9.1 | 5 | P1 | å¦ | âœ… Phase 2 å®Œæˆ |
   290â†’| `src/cost/` | éšå« | 4 | P1 | å¦ | âœ… Phase 1 å®Œæˆ |
   291â†’| `src/strategy/fallback.py` | 8.3 | 3 | P1 | å¦ | âœ… Phase 3 å®Œæˆ |
   292â†’| `src/strategy/calendar_arb/` | ç¬¬ 9 ç«  | 9 | P2 | å¦ | âœ… Phase 3 å®Œæˆ |
   293â†’| `src/replay/verifier.py` | 7.3 | 2 | P1 | å¦ | âœ… Phase 4 å®Œæˆ |
   294â†’
   295â†’---
   296â†’
   297â†’## 3. å‡çº§æ¶æ„æ€»è§ˆ
   298â†’
   299â†’### 3.1 åŒè½¨å¹¶è¡Œæ¶æ„
   300â†’
   301â†’```
   302â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   303â†’â”‚                           V3PRO+ å‡çº§æ¶æ„                                    â”‚
   304â†’â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   305â†’â”‚                                                                             â”‚
   306â†’â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
   307â†’â”‚   â”‚                     A-Platformï¼ˆå¹³å°åŒ–å‡çº§ï¼‰                        â”‚    â”‚
   308â†’â”‚   â”‚                                                                     â”‚    â”‚
   309â†’â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
   310â†’â”‚   â”‚   â”‚  Phase 0        Phase 1        Phase 2        Phase 4       â”‚  â”‚    â”‚
   311â†’â”‚   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚  â”‚    â”‚
   312â†’â”‚ â”‚ â”‚ â”‚å¸‚åœº/ â”‚ â”‚å®¡è®¡/ â”‚ â”‚æ‰§è¡Œ/ â”‚ â”‚å›æ”¾/ â”‚ â”‚ â”‚ â”‚
   313â†’â”‚ â”‚ â”‚ â”‚ â”‚ â”‚æˆæœ¬/ â”‚ â”‚è‡ªåŠ¨/ â”‚ â”‚éªŒè¯å™¨â”‚ â”‚ â”‚ â”‚
   314â†’â”‚   â”‚   â”‚  â”‚7 files â”‚    â”‚guardianâ”‚    â”‚ prot/  â”‚    â”‚        â”‚      â”‚  â”‚    â”‚
   315â†’â”‚   â”‚   â”‚  â”‚        â”‚    â”‚        â”‚    â”‚ pair/  â”‚    â”‚1 file  â”‚      â”‚  â”‚    â”‚
   316â†’â”‚   â”‚   â”‚  â”‚11 åœºæ™¯ â”‚    â”‚15 filesâ”‚    â”‚15 filesâ”‚    â”‚        â”‚      â”‚  â”‚    â”‚
   317â†’â”‚   â”‚   â”‚  â”‚        â”‚    â”‚29 åœºæ™¯ â”‚    â”‚25 åœºæ™¯ â”‚    â”‚2 åœºæ™¯  â”‚      â”‚  â”‚    â”‚
   318â†’â”‚   â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  â”‚    â”‚
   319â†’â”‚   â”‚   â”‚       â”‚              â”‚              â”‚              â”‚        â”‚  â”‚    â”‚
   320â†’â”‚   â”‚   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚    â”‚
   321â†’â”‚   â”‚   â”‚                              â†“                               â”‚  â”‚    â”‚
   322â†’â”‚   â”‚   â”‚                     Phase 5:  é›†æˆä¸æ¼”ç»ƒ                       â”‚  â”‚    â”‚
   323â†’â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
   324â†’â”‚   â”‚                                                                     â”‚    â”‚
   325â†’â”‚   â”‚   A è½¨åˆè®¡ï¼š38 ä¸ªæ–°æ–‡ä»¶ + 67 ä¸ª A è½¨åœºæ™¯                            â”‚    â”‚
   326â†’â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
   327â†’â”‚                                                                             â”‚
   328â†’â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
   329â†’â”‚   â”‚                     B-Modelsï¼ˆç­–ç•¥å…¬å¼å‡çº§ï¼‰                         â”‚    â”‚
   330â†’â”‚   â”‚                                                                     â”‚    â”‚
   331â†’â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
   332â†’â”‚   â”‚   â”‚  Phase 3                        Phase 6                      â”‚  â”‚    â”‚
   333â†’â”‚   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚    â”‚
   334â†’â”‚   â”‚   â”‚  â”‚ fallback.py    â”‚            â”‚ simple_ai   (3 åœºæ™¯)   â”‚   â”‚  â”‚    â”‚
   335â†’â”‚   â”‚   â”‚  â”‚ calendar_arb/  â”‚            â”‚ linear_ai   (3 åœºæ™¯)   â”‚   â”‚  â”‚    â”‚
   336â†’â”‚   â”‚   â”‚  â”‚                â”‚            â”‚ ensemble_moe(5 åœºæ™¯)   â”‚   â”‚  â”‚    â”‚
   337â†’â”‚   â”‚   â”‚  â”‚ 4 files        â”‚            â”‚ dl_torch    (6 åœºæ™¯)   â”‚   â”‚  â”‚    â”‚
   338â†’â”‚   â”‚   â”‚  â”‚ 12 åœºæ™¯        â”‚            â”‚ top_tier    (5 åœºæ™¯)   â”‚   â”‚  â”‚    â”‚
   339â†’â”‚   â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚    â”‚
   340â†’â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
   341â†’â”‚   â”‚                                                                     â”‚    â”‚
   342â†’â”‚   â”‚   B è½¨åˆè®¡ï¼š4 ä¸ªæ–°æ–‡ä»¶ + 34 ä¸ª B è½¨åœºæ™¯                             â”‚    â”‚
   343â†’â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
   344â†’â”‚                                                                             â”‚
   345â†’â”‚   æ€»è®¡ï¼š42 ä¸ªæ–°æ–‡ä»¶ + 101 ä¸ªå¿…é¡»åœºæ™¯ï¼ˆå« v2 55 æ¡ + v3pro æ‰©å±•ï¼‰           â”‚
   346â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   347â†’```
   348â†’
   349â†’### 3.2 æ¨¡å—å±‚çº§å…³ç³»
   350â†’
   351â†’```text
   352â†’Layer 4:  Strategyï¼ˆç­–ç•¥å±‚ï¼‰
   353â†’    â”‚
   354â†’    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   355â†’    â”‚   â”‚  simple_ai  linear_ai  moe  dl_torch  top_tier  arb    â”‚
   356â†’    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   357â†’    â”‚                              â”‚
   358â†’    â”‚                              â–¼ è°ƒç”¨
   359â†’    â”‚
   360â†’Layer 3: Tradingï¼ˆç¼–æ’å±‚ï¼‰
   361â†’    â”‚
   362â†’    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   363â†’    â”‚   â”‚  orchestrator.py  runner.py  trading/*                  â”‚
   364â†’    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   365â†’    â”‚                              â”‚
   366â†’    â”‚                              â–¼ è°ƒç”¨
   367â†’    â”‚
   368â†’Layer 2: Execution + Guardianï¼ˆæ‰§è¡Œå±‚ + å®ˆæŠ¤å±‚ï¼‰
   369â†’    â”‚
   370â†’    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   371â†’    â”‚   â”‚  execution/          â”‚  â”‚  guardian/           â”‚
   372â†’    â”‚   â”‚    auto/             â”‚  â”‚    monitor           â”‚
   373â†’    â”‚   â”‚    protection/       â”‚  â”‚    state_machine     â”‚
   374â†’    â”‚   â”‚    pair/             â”‚  â”‚    actions           â”‚
   375â†’    â”‚   â”‚    broker            â”‚  â”‚    recovery          â”‚
   376â†’    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   377â†’    â”‚                              â”‚
   378â†’    â”‚                              â–¼ ä¾èµ–
   379â†’    â”‚
   380â†’Layer 1: Market + Audit + Costï¼ˆåŸºç¡€è®¾æ–½å±‚ï¼‰
   381â†’    â”‚
   382â†’    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   383â†’    â”‚   â”‚  market/     â”‚  â”‚  audit/      â”‚  â”‚  cost/       â”‚
   384â†’    â”‚   â”‚  instrument  â”‚  â”‚  writer      â”‚  â”‚  estimator   â”‚
   385â†’    â”‚   â”‚  universe    â”‚  â”‚  decision    â”‚  â”‚              â”‚
   386â†’    â”‚   â”‚  quote       â”‚  â”‚  order       â”‚  â”‚              â”‚
   387â†’    â”‚   â”‚  bar         â”‚  â”‚  guardian    â”‚  â”‚              â”‚
   388â†’    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   389â†’    â”‚
   390â†’    â–¼
   391â†’Layer 0: Externalï¼ˆå¤–éƒ¨ä¾èµ–ï¼‰
   392â†’    â”‚
   393â†’    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   394â†’    â”‚   â”‚  CTP API  /  è¡Œæƒ…æº  /  æ–‡ä»¶ç³»ç»Ÿ  /  ç½‘ç»œ              â”‚
   395â†’    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   396â†’```
   397â†’
   398â†’### 3.3 ä¾èµ–ç¦æ­¢è§„åˆ™
   399â†’
   400â†’| è§„åˆ™ | è¯´æ˜ |
   401â†’|------|------|
   402â†’| ç¦æ­¢åå‘ä¾èµ– | ä¸‹å±‚ä¸å¯ä¾èµ–ä¸Šå±‚ï¼ˆmarket ä¸å¯ import strategyï¼‰ |
   403â†’| ç¦æ­¢è·¨å±‚è°ƒç”¨ | Layer 4 ä¸å¯ç›´æ¥è°ƒç”¨ Layer 1 |
   404â†’| audit åªè®¢é˜… | audit åªæ¥æ”¶äº‹ä»¶ï¼Œä¸åå‘è°ƒç”¨ä¸šåŠ¡æ¨¡å— |
   405â†’| guardian åªè¾“å‡ºæŒ‡ä»¤ | guardian ä¸ç›´æ¥æ“ä½œè®¢å•ï¼Œåªè¾“å‡º set_mode/cancel_all/flatten_all |
   406â†’
   407â†’---
   408â†’
   409â†’## 4. Phase ä¾èµ–å…³ç³»
   410â†’
   411â†’### 4.1 ä¾èµ–å›¾
   412â†’
   413â†’```text
   414â†’                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   415â†’                    â”‚    Phase 0      â”‚
   416â†’                    â”‚   è¡Œæƒ…å±‚        â”‚
   417â†’                    â”‚   market/       â”‚
   418â†’                    â”‚   (7 files)     â”‚
   419â†’                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   420â†’                             â”‚
   421â†’                             â–¼
   422â†’                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   423â†’                    â”‚    Phase 1      â”‚
   424â†’                    â”‚  åŸºç¡€è®¾æ–½å±‚     â”‚
   425â†’                    â”‚ audit/ cost/    â”‚
   426â†’                    â”‚   guardian/     â”‚
   427â†’                    â”‚   (15 files)    â”‚
   428â†’                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   429â†’                             â”‚
   430â†’              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   431â†’              â”‚              â”‚              â”‚
   432â†’              â–¼              â–¼              â–¼
   433â†’     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   434â†’     â”‚  Phase 2    â”‚ â”‚  Phase 3    â”‚ â”‚  Phase 4    â”‚
   435â†’     â”‚  æ‰§è¡Œå±‚     â”‚ â”‚  ç­–ç•¥å±‚     â”‚ â”‚  å›æ”¾éªŒè¯   â”‚
   436â†’     â”‚ exec/auto/  â”‚ â”‚ fallback    â”‚ â”‚ replay/     â”‚
   437â†’     â”‚ exec/prot/  â”‚ â”‚ calendar_   â”‚ â”‚ verifier    â”‚
   438â†’     â”‚ exec/pair/  â”‚ â”‚   arb/      â”‚ â”‚ (1 file)    â”‚
   439â†’     â”‚ (15 files)  â”‚ â”‚ (4 files)   â”‚ â”‚             â”‚
   440â†’     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
   441â†’            â”‚               â”‚               â”‚
   442â†’            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   443â†’                            â”‚
   444â†’                            â–¼
   445â†’                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   446â†’                   â”‚    Phase 5      â”‚
   447â†’                   â”‚  é›†æˆä¸æ¼”ç»ƒ     â”‚
   448â†’                   â”‚                 â”‚
   449â†’                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   450â†’                            â”‚
   451â†’                            â–¼
   452â†’                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   453â†’                   â”‚    Phase 6      â”‚
   454â†’                   â”‚ B-Models å‡çº§   â”‚
   455â†’                   â”‚  (å¯å¹¶è¡Œ)       â”‚
   456â†’                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   457â†’```
   458â†’
   459â†’### 4.2 Phase é˜»å¡å…³ç³»
   460â†’
   461â†’| Phase | å‰ç½®ä¾èµ– | é˜»å¡åç»­ | å¯å¹¶è¡Œ |
   462â†’|-------|----------|----------|--------|
   463â†’| Phase 0 | æ—  | Phase 1/2/3/4/5 | - |
   464â†’| Phase 1 | Phase 0 | Phase 2/3/4/5 | - |
   465â†’| Phase 2 | Phase 0 + 1 | Phase 5 | Phase 3, 4 |
   466â†’| Phase 3 | Phase 1 + 2 | Phase 5 | Phase 4 |
   467â†’| Phase 4 | Phase 1 | Phase 5 | Phase 2, 3 |
   468â†’| Phase 5 | Phase 0-4 | Phase 6 | - |
   469â†’| Phase 6 | Phase 1 + 2 | æ—  | Phase 3, 4, 5 |
   470â†’
   471â†’### 4.3 å…³é”®è·¯å¾„
   472â†’
   473â†’```text
   474â†’Phase 0 â†’ Phase 1 â†’ Phase 2 â†’ Phase 5
   475â†’   â”‚          â”‚          â”‚
   476â†’   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€ å…³é”®è·¯å¾„ï¼ˆé˜»å¡æ€§æœ€å¼ºï¼‰
   477â†’
   478â†’Phase 3, 4, 6 å¯ä¸å…³é”®è·¯å¾„å¹¶è¡Œ
   479â†’```
   480â†’
   481â†’---
   482â†’
   483â†’## 5. Phase 0ï¼šè¡Œæƒ…å±‚
   484â†’
   485â†’### 5.1 æ¦‚è¿°
   486â†’
   487â†’| é¡¹ç›® | å€¼ |
   488â†’|------|-----|
   489â†’| **ç›®æ ‡** | å®ç° V2 SPEC ç¬¬ 4 ç« ï¼šåˆçº¦åŒ–è¡Œæƒ… |
   490â†’| **æ–°å¢ç›®å½•** | `src/market/` |
   491â†’| **æ–°å¢æ–‡ä»¶** | 7 ä¸ª |
   492â†’| **Required Scenarios** | 11 æ¡ |
   493â†’| **é¢„è®¡å·¥æ—¶** | éª¨æ¶ 3h / å…¨é‡å®ç° 34h |
   494â†’| **é˜»å¡** | Phase 1, 2, 3, 4, 5 |
   495â†’
   496â†’### 5.2 æ–‡ä»¶æ¸…å•
   497â†’
   498â†’| åºå· | æ–‡ä»¶è·¯å¾„ | component | V2 SPEC | èŒè´£ |
   499â†’|------|----------|-----------|---------|------|
   500â†’| 1 | `src/market/__init__.py` | - | - | æ¨¡å—å¯¼å‡º |
   501â†’| 2 | `src/market/instrument_cache.py` | `market.instrument_cache` | 4.1 | åˆçº¦å…ƒæ•°æ®ç¼“å­˜ã€åŸå­åŒ–è½ç›˜ |
   502â†’| 3 | `src/market/universe_selector.py` | `market.universe_selector` | 4.2 | ä¸»åŠ›/æ¬¡ä¸»åŠ›é€‰æ‹©ã€åˆ‡æ¢å†·å´ |
   503â†’| 4 | `src/market/subscriber.py` | `market.subscriber` | 4.3 | è¡Œæƒ…è®¢é˜…ç®¡ç†ã€å·®åˆ†æ›´æ–° |
   504â†’| 5 | `src/market/quote_cache.py` | `market.quote_cache` | 4.3 | L1 è¡Œæƒ…ç¼“å­˜ã€stale æ£€æµ‹ |
   505â†’| 6 | `src/market/bar_builder.py` | `market.bar_builder` | 4.4 | è¿ç»­ä¸»åŠ› bars èšåˆ |
   506â†’| 7 | `src/market/quality.py` | `market.quality` | 4.6 | æ•°æ®è´¨é‡ï¼ˆoutlier/gap/disorderï¼‰ |
   507â†’
   508â†’### 5.3 Required Scenarios
   509â†’
   510â†’| åºå· | rule_id | component | æè¿° | category |
   511â†’|------|---------|-----------|------|----------|
   512â†’| 1 | `INST.CACHE.LOAD` | market.instrument_cache | èƒ½æ­£ç¡®åŠ è½½åˆçº¦ä¿¡æ¯ | unit |
   513â†’| 2 | `INST.CACHE. PERSIST` | market.instrument_cache | èƒ½åŸå­åŒ–è½ç›˜ï¼ˆtmpâ†’renameï¼‰ | unit |
   514â†’| 3 | `UNIV.DOMINANT. BASIC` | market.universe_selector | èƒ½æ­£ç¡®é€‰æ‹©ä¸»åŠ›åˆçº¦ | unit |
   515â†’| 4 | `UNIV.SUBDOMINANT.PAIRING` | market.universe_selector | èƒ½æ­£ç¡®é€‰æ‹©æ¬¡ä¸»åŠ›åˆçº¦ | unit |
   516â†’| 5 | `UNIV.ROLL.COOLDOWN` | market.universe_selector | ä¸»åŠ›åˆ‡æ¢æœ‰å†·å´æœŸ | unit |
   517â†’| 6 | `UNIV.EXPIRY.GATE` | market.universe_selector | ä¸´æœŸåˆçº¦è¢«æ’é™¤ | unit |
   518â†’| 7 | `MKT.SUBSCRIBER.DIFF_UPDATE` | market.subscriber | è®¢é˜…é›†å·®åˆ†æ›´æ–° | unit |
   519â†’| 8 | `MKT.STALE.SOFT` | market.quote_cache | è½¯ stale æ£€æµ‹ | unit |
   520â†’| 9 | `MKT.STALE. HARD` | market.quote_cache | ç¡¬ stale æ£€æµ‹ | unit |
   521â†’| 10 | `MKT.CONTINUITY.BARS` | market.bar_builder | è¿ç»­ä¸»åŠ› bars èšåˆ | unit |
   522â†’| 11 | `MKT.QUALITY.OUTLIER` | market.quality | å¼‚å¸¸å€¼æ£€æµ‹ | unit |
   523â†’
   524â†’### 5.4 æ¥å£å®šä¹‰
   525â†’
   526â†’#### InstrumentCache
   527â†’
   528â†’| æ–¹æ³• | ç­¾å | è¯´æ˜ |
   529â†’|------|------|------|
   530â†’| `load_from_file` | `(path: Path) -> None` | ä» JSON åŠ è½½ |
   531â†’| `persist` | `(path: Path, trading_day: str) -> None` | åŸå­åŒ–è½ç›˜ |
   532â†’| `get` | `(symbol: str) -> InstrumentInfo \| None` | è·å–åˆçº¦ä¿¡æ¯ |
   533â†’| `get_by_product` | `(product: str) -> list[InstrumentInfo]` | è·å–å“ç§ä¸‹æ‰€æœ‰åˆçº¦ |
   534â†’
   535â†’#### UniverseSelector
   536â†’
   537â†’| æ–¹æ³• | ç­¾å | è¯´æ˜ |
   538â†’|------|------|------|
   539â†’| `select` | `(oi: dict, vol: dict, now_ts: float) -> UniverseSnapshot` | é€‰æ‹©ä¸»åŠ›/æ¬¡ä¸»åŠ› |
   540â†’| `current` | `@property -> UniverseSnapshot \| None` | å½“å‰å¿«ç…§ |
   541â†’
   542â†’#### QuoteCache
   543â†’
   544â†’| æ–¹æ³• | ç­¾å | è¯´æ˜ |
   545â†’|------|------|------|
   546â†’| `update` | `(book: BookTop) -> None` | æ›´æ–°è¡Œæƒ… |
   547â†’| `get` | `(symbol: str) -> BookTop \| None` | è·å–è¡Œæƒ… |
   548â†’| `is_stale` | `(symbol: str, now_ts: float) -> bool` | è½¯ stale æ£€æµ‹ |
   549â†’| `is_hard_stale` | `(symbol: str, now_ts:  float) -> bool` | ç¡¬ stale æ£€æµ‹ |
   550â†’
   551â†’### 5.5 æ•°æ®ç»“æ„
   552â†’
   553â†’#### InstrumentInfo
   554â†’
   555â†’| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
   556â†’|------|------|------|
   557â†’| symbol | str | åˆçº¦ä»£ç ï¼ˆå¦‚ AO2501ï¼‰ |
   558â†’| product | str | å“ç§ä»£ç ï¼ˆå¦‚ AOï¼‰ |
   559â†’| exchange | str | äº¤æ˜“æ‰€ï¼ˆSHFE/CZCE/DCE/GFEXï¼‰ |
   560â†’| expire_date | str | åˆ°æœŸæ—¥ï¼ˆYYYYMMDDï¼‰ |
   561â†’| tick_size | float | æœ€å°å˜åŠ¨ä»·ä½ |
   562â†’| multiplier | int | åˆçº¦ä¹˜æ•° |
   563â†’| max_order_volume | int | å•ç¬”æœ€å¤§æ‰‹æ•° |
   564â†’| position_limit | int | æŒä»“é™é¢ |
   565â†’
   566â†’#### BookTop
   567â†’
   568â†’| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
   569â†’|------|------|------|
   570â†’| symbol | str | åˆçº¦ä»£ç  |
   571â†’| bid | float | ä¹°ä¸€ä»· |
   572â†’| ask | float | å–ä¸€ä»· |
   573â†’| bid_vol | int | ä¹°ä¸€é‡ |
   574â†’| ask_vol | int | å–ä¸€é‡ |
   575â†’| last | float | æœ€æ–°ä»· |
   576â†’| volume | int | æˆäº¤é‡ |
   577â†’| open_interest | int | æŒä»“é‡ |
   578â†’| ts | float | æ—¶é—´æˆ³ |
   579â†’
   580â†’#### UniverseSnapshot
   581â†’
   582â†’| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
   583â†’|------|------|------|
   584â†’| dominant_by_product | dict[str, str] | å“ç§â†’ä¸»åŠ›åˆçº¦æ˜ å°„ |
   585â†’| subdominant_by_product | dict[str, str] | å“ç§â†’æ¬¡ä¸»åŠ›åˆçº¦æ˜ å°„ |
   586â†’| subscribe_set | set[str] | éœ€è®¢é˜…çš„åˆçº¦é›†åˆ |
   587â†’| generated_at | float | ç”Ÿæˆæ—¶é—´æˆ³ |
   588â†’
   589â†’### 5.6 é…ç½®é¡¹
   590â†’
   591â†’| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
   592â†’|--------|--------|------|
   593â†’| `QUOTE_STALE_MS` | 3000 | è½¯ stale é˜ˆå€¼ï¼ˆæ¯«ç§’ï¼‰ |
   594â†’| `QUOTE_HARD_STALE_MS` | 10000 | ç¡¬ stale é˜ˆå€¼ï¼ˆæ¯«ç§’ï¼‰ |
   595â†’| `EXPIRY_BLOCK_DAYS` | 5 | ä¸´æœŸæ’é™¤å¤©æ•° |
   596â†’| `MIN_SWITCH_EDGE` | 0.1 | ä¸»åŠ›åˆ‡æ¢é—¨æ§›ï¼ˆ10%ï¼‰ |
   597â†’| `ROLL_COOLDOWN_S` | 300 | ä¸»åŠ›åˆ‡æ¢å†·å´ï¼ˆç§’ï¼‰ |
   598â†’
   599â†’### 5.7 é—¨ç¦æ£€æŸ¥ç‚¹
   600â†’
   601â†’```powershell
   602â†’# Phase 0 å®Œæˆæ ‡å‡†
   603â†’.\scripts\make.ps1 ci-json # é€šè¿‡
   604â†’python .\scripts\coverage_gate.py # æ ¸å¿ƒ=100%ï¼Œæ€»ä½“>=85%
   605â†’python .\scripts\validate_policy.py --all --strict-scenarios   # 11 æ¡ scenarios PASS
   606â†’python -c "from src.market import InstrumentCache"             # å¯¼å…¥æˆåŠŸ
   607â†’python -c "from src.market import QuoteCache"                  # å¯¼å…¥æˆåŠŸ
   608â†’python -c "from src.market import UniverseSelector"            # å¯¼å…¥æˆåŠŸ
   609â†’```
   610â†’
   611â†’### 5.8 äº¤ä»˜ç‰©æ¸…å•
   612â†’
   613â†’- [ ] `src/market/__init__.py`
   614â†’- [ ] `src/market/instrument_cache.py`
   615â†’- [ ] `src/market/universe_selector.py`
   616â†’- [ ] `src/market/subscriber.py`
   617â†’- [ ] `src/market/quote_cache.py`
   618â†’- [ ] `src/market/bar_builder.py`
   619â†’- [ ] `src/market/quality.py`
   620â†’- [ ] `tests/test_instrument_cache.py`
   621â†’- [ ] `tests/test_universe_selector.py`
   622â†’- [ ] `tests/test_quote_cache.py`
   623â†’- [ ] 11 æ¡ required scenarios å¯¹åº”æµ‹è¯•
   624â†’- [ ] é—¨ç¦å…¨ç»¿
   625â†’
   626â†’---
   627â†’
   628â†’## 6. Phase 1ï¼šåŸºç¡€è®¾æ–½å±‚
   629â†’
   630â†’### 6.1 æ¦‚è¿°
   631â†’
   632â†’| é¡¹ç›® | å€¼ |
   633â†’|------|-----|
   634â†’| **ç›®æ ‡** | å®ç° V2 SPEC ç¬¬ 6ã€7 ç«  + æˆæœ¬æ¨¡å‹ |
   635â†’| **æ–°å¢ç›®å½•** | `src/audit/`, `src/cost/`, `src/guardian/` |
   636â†’| **æ–°å¢æ–‡ä»¶** | 15 ä¸ª |
   637â†’| **Required Scenarios** | 29 æ¡ |
   638â†’| **é¢„è®¡å·¥æ—¶** | éª¨æ¶ 2.5h  / å…¨é‡å®ç° 44h |
   639â†’| **é˜»å¡** | Phase 2, 3, 4, 5 |
   640â†’
   641â†’### 6.2 æ–‡ä»¶æ¸…å•
   642â†’
   643â†’#### 6.2.1 src/audit/ï¼ˆ7 ä¸ªæ–‡ä»¶ï¼‰
   644â†’
   645â†’| åºå· | æ–‡ä»¶è·¯å¾„ | component | V2 SPEC | èŒè´£ |
   646â†’|------|----------|-----------|---------|------|
   647â†’| 1 | `src/audit/__init__.py` | - | - | æ¨¡å—å¯¼å‡º |
   648â†’| 2 | `src/audit/writer.py` | `audit.writer` | 7.1 | JSONL äº‹ä»¶å†™å…¥ |
   649â†’| 3 | `src/audit/decision_log.py` | `audit.decision_log` | 7.1 | DecisionEvent å®šä¹‰ |
   650â†’| 4 | `src/audit/order_trail.py` | `audit.order_trail` | 7.1 | OrderStateEvent/ExecEvent/TradeEvent |
   651â†’| 5 | `src/audit/guardian_log.py` | `audit.guardian_log` | 7.1 | GuardianEvent å®šä¹‰ |
   652â†’| 6 | `src/audit/pnl_attribution.py` | `audit.pnl_attribution` | æ‰©å±• | PnL å½’å›  |
   653â†’| 7 | `src/audit/replay_verifier.py` | `audit.replay_verifier` | 7.3 | å›æ”¾å“ˆå¸ŒéªŒè¯ |
   654â†’
   655â†’#### 6.2.2 src/cost/ï¼ˆ2 ä¸ªæ–‡ä»¶ï¼‰
   656â†’
   657â†’| åºå· | æ–‡ä»¶è·¯å¾„ | component | V2 SPEC | èŒè´£ |
   658â†’|------|----------|-----------|---------|------|
   659â†’| 8 | `src/cost/__init__.py` | - | - | æ¨¡å—å¯¼å‡º |
   660â†’| 9 | `src/cost/estimator.py` | `cost.estimator` | 10 | æ‰‹ç»­è´¹/æ»‘ç‚¹/å†²å‡»ä¼°è®¡ |
   661â†’
   662â†’#### 6.2.3 src/guardian/ï¼ˆ6 ä¸ªæ–‡ä»¶ï¼‰
   663â†’
   664â†’| åºå· | æ–‡ä»¶è·¯å¾„ | component | V2 SPEC | èŒè´£ |
   665â†’|------|----------|-----------|---------|------|
   666â†’| 10 | `src/guardian/__init__.py` | - | - | æ¨¡å—å¯¼å‡º |
   667â†’| 11 | `src/guardian/monitor.py` | `guardian.monitor` | 6.2 | å®ˆæŠ¤ä¸»å¾ªç¯ |
   668â†’| 12 | `src/guardian/state_machine.py` | `guardian.state_machine` | 6.1 | Guardian FSM |
   669â†’| 13 | `src/guardian/triggers.py` | `guardian.detector` | 6.2 | å¼‚å¸¸æ£€æµ‹ |
   670â†’| 14 | `src/guardian/actions.py` | `guardian.actions` | 6.3 | åŠ¨ä½œæ‰§è¡Œ |
   671â†’| 15 | `src/guardian/recovery.py` | `guardian.recovery` | 6.4 | å†·å¯åŠ¨æ¢å¤ |
   672â†’
   673â†’### 6.3 Required Scenarios
   674â†’
   675â†’#### Guardian Scenariosï¼ˆ10 æ¡ï¼‰
   676â†’
   677â†’| åºå· | rule_id | component | æè¿° |
   678â†’|------|---------|-----------|------|
   679â†’| 1 | `GUARD.FSM.TRANSITIONS` | guardian.state_machine | çŠ¶æ€æœºè½¬ç§»è¦†ç›– |
   680â†’| 2 | `GUARD.DETECT.QUOTE_STALE` | guardian.detector | è¡Œæƒ… stale æ£€æµ‹ |
   681â†’| 3 | `GUARD.DETECT.ORDER_STUCK` | guardian.detector | è®¢å•å¡ä½æ£€æµ‹ |
   682â†’| 4 | `GUARD.DETECT.POSITION_DRIFT` | guardian.detector | æŒä»“æ¼‚ç§»æ£€æµ‹ |
   683â†’| 5 | `GUARD.DETECT.LEG_IMBALANCE` | guardian.detector | è…¿ä¸å¹³è¡¡æ£€æµ‹ |
   684â†’| 6 | `GUARD.ACTION.SET_MODE` | guardian.actions | set_mode åŠ¨ä½œ |
   685â†’| 7 | `GUARD.ACTION. CANCEL_ALL` | guardian.actions | cancel_all åŠ¨ä½œ |
   686â†’| 8 | `GUARD.ACTION. FLATTEN_ALL` | guardian.actions | flatten_all åŠ¨ä½œ |
   687â†’| 9 | `GUARD.RECOVERY.COLD_START` | guardian.recovery | å†·å¯åŠ¨æ¢å¤ |
   688â†’| 10 | `GUARD.MODE.REDUCE_ONLY_EFFECT` | guardian.monitor | reduce_only ç¦å¼€ä»“ |
   689â†’
   690â†’#### Audit Scenariosï¼ˆ5 æ¡ï¼‰
   691â†’
   692â†’| åºå· | rule_id | component | æè¿° |
   693â†’|------|---------|-----------|------|
   694â†’| 11 | `AUDIT.EVENT.STRUCTURE` | audit.writer | äº‹ä»¶ç»“æ„å®Œæ•´ |
   695â†’| 12 | `AUDIT.JSONL.FORMAT` | audit.writer | JSONL æ ¼å¼æ­£ç¡® |
   696â†’| 13 | `AUDIT.CORRELATION.RUN_EXEC` | audit.writer | run_id/exec_id å…³è” |
   697â†’| 14 | `REPLAY.DETERMINISTIC. DECISION` | audit.replay_verifier | å†³ç­–ç¡®å®šæ€§ |
   698â†’| 15 | `REPLAY.DETERMINISTIC.GUARDIAN` | audit.replay_verifier | Guardian ç¡®å®šæ€§ |
   699â†’
   700â†’#### Cost Scenariosï¼ˆ4 æ¡ï¼‰
   701â†’
   702â†’| åºå· | rule_id | component | æè¿° |
   703â†’|------|---------|-----------|------|
   704â†’| 16 | `COST.MODEL.FEE_ESTIMATE` | cost.estimator | æ‰‹ç»­è´¹ä¼°è®¡ |
   705â†’| 17 | `COST.MODEL.SLIPPAGE_ESTIMATE` | cost.estimator | æ»‘ç‚¹ä¼°è®¡ |
   706â†’| 18 | `COST.MODEL. IMPACT_ESTIMATE` | cost.estimator | å¸‚åœºå†²å‡»ä¼°è®¡ |
   707â†’| 19 | `COST.GATE.EDGE_CHECK` | cost.estimator | edge gate æ£€æŸ¥ |
   708â†’
   709â†’#### Platform Universal Scenariosï¼ˆ10 æ¡ï¼Œæ¥è‡ª v3proï¼‰
   710â†’
   711â†’| åºå· | rule_id | component | æè¿° |
   712â†’|------|---------|-----------|------|
   713â†’| 20 | `STRAT.AUDIT.DECISION_EVENT_PRESENT` | audit.decision_log | DecisionEvent å­˜åœ¨ |
   714â†’| 21 | `STRAT.AUDIT.DECISION_HAS_RUN_ID` | audit.decision_log | åŒ…å« run_id |
   715â†’| 22 | `STRAT.AUDIT.DECISION_HAS_EXEC_ID` | audit.decision_log | åŒ…å« exec_id |
   716â†’| 23 | `STRAT.AUDIT.DECISION_HAS_STRATEGY_ID` | audit.decision_log | åŒ…å« strategy_id |
   717â†’| 24 | `STRAT.AUDIT.DECISION_HAS_VERSION` | audit.decision_log | åŒ…å« version |
   718â†’| 25 | `STRAT.AUDIT.DECISION_HAS_FEATURE_HASH` | audit.decision_log | åŒ…å« feature_hash |
   719â†’| 26 | `STRAT.DEGRADE.REDUCE_ONLY_NO_OPEN` | guardian.monitor | REDUCE_ONLY ç¦å¼€ä»“ |
   720â†’| 27 | `STRAT.DEGRADE.HALTED_OUTPUT_ZERO` | guardian.monitor | HALTED è¾“å‡ºé›¶ |
   721â†’| 28 | `STRAT.DEGRADE.MODE_TRANSITION_AUDIT` | audit.guardian_log | æ¨¡å¼åˆ‡æ¢å®¡è®¡ |
   722â†’| 29 | `AUDIT.PNL.ATTRIBUTION` | audit.pnl_attribution | PnL å½’å›  |
   723â†’
   724â†’### 6.4 Guardian çŠ¶æ€æœºå®šä¹‰
   725â†’
   726â†’#### çŠ¶æ€æšä¸¾
   727â†’
   728â†’| çŠ¶æ€ | å€¼ | è¯´æ˜ |
   729â†’|------|-----|------|
   730â†’| INIT | 0 | åˆå§‹åŒ–ä¸­ |
   731â†’| RUNNING | 1 | æ­£å¸¸è¿è¡Œï¼Œå…è®¸å¼€ä»“ |
   732â†’| REDUCE_ONLY | 2 | ä»…å…è®¸å‡ä»“/å¹³ä»“ |
   733â†’| HALTED | 3 | åœæ­¢äº¤æ˜“ï¼Œç­‰å¾…äººå·¥ |
   734â†’| MANUAL | 4 | äººå·¥æ¥ç®¡ |
   735â†’
   736â†’#### çŠ¶æ€è½¬ç§»è¡¨
   737â†’
   738â†’| å½“å‰çŠ¶æ€ | äº‹ä»¶ | ç›®æ ‡çŠ¶æ€ | æ¡ä»¶ |
   739â†’|----------|------|----------|------|
   740â†’| INIT | åˆå§‹åŒ–å®Œæˆ | RUNNING | å¥åº·æ£€æŸ¥é€šè¿‡ |
   741â†’| INIT | åˆå§‹åŒ–å¤±è´¥ | HALTED | - |
   742â†’| RUNNING | quote_stale | REDUCE_ONLY | ç¡¬ stale |
   743â†’| RUNNING | order_stuck | REDUCE_ONLY | è¶…æ—¶æœªæ¨è¿› |
   744â†’| RUNNING | position_drift | HALTED | reconcile å¤±è´¥ |
   745â†’| RUNNING | leg_imbalance | REDUCE_ONLY | è£¸è…¿è¶…é˜ˆå€¼ |
   746â†’| REDUCE_ONLY | æ¢å¤æ­£å¸¸ | RUNNING | å†·å´æœŸç»“æŸ + å¥åº· |
   747â†’| REDUCE_ONLY | æŒç»­æ¶åŒ– | HALTED | å¤šæ¬¡è§¦å‘ |
   748â†’| HALTED | äººå·¥ç¡®è®¤ | MANUAL | - |
   749â†’| MANUAL | äººå·¥æ¢å¤ | RUNNING | - |
   750â†’
   751â†’### 6.5 å®¡è®¡äº‹ä»¶ç»“æ„
   752â†’
   753â†’#### å¿…å¤‡å­—æ®µï¼ˆæ‰€æœ‰äº‹ä»¶ï¼‰
   754â†’
   755â†’| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
   756â†’|------|------|------|
   757â†’| ts | float | æ—¶é—´æˆ³ï¼ˆUnix epochï¼‰ |
   758â†’| event_type | str | äº‹ä»¶ç±»å‹ |
   759â†’| run_id | str | è¿è¡Œ IDï¼ˆUUIDï¼‰ |
   760â†’| exec_id | str | æ‰§è¡Œ ID |
   761â†’
   762â†’#### DecisionEvent æ‰©å±•å­—æ®µ
   763â†’
   764â†’| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
   765â†’|------|------|------|
   766â†’| strategy_id | str | ç­–ç•¥ ID |
   767â†’| strategy_version | str | ç­–ç•¥ç‰ˆæœ¬ |
   768â†’| feature_hash | str | è¾“å…¥ç‰¹å¾å“ˆå¸Œ |
   769â†’| target_portfolio | dict | ç›®æ ‡ä»“ä½ |
   770â†’
   771â†’#### OrderStateEvent æ‰©å±•å­—æ®µ
   772â†’
   773â†’| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
   774â†’|------|------|------|
   775â†’| order_local_id | str | æœ¬åœ°è®¢å• ID |
   776â†’| order_ref | str | CTP è®¢å•å¼•ç”¨ |
   777â†’| order_sys_id | str | äº¤æ˜“æ‰€ç³»ç»Ÿå· |
   778â†’| state_from | str | åŸçŠ¶æ€ |
   779â†’| state_to | str | ç›®æ ‡çŠ¶æ€ |
   780â†’| trigger_event | str | è§¦å‘äº‹ä»¶ |
   781â†’
   782â†’#### GuardianEvent æ‰©å±•å­—æ®µ
   783â†’
   784â†’| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
   785â†’|------|------|------|
   786â†’| mode_from | str | åŸæ¨¡å¼ |
   787â†’| mode_to | str | ç›®æ ‡æ¨¡å¼ |
   788â†’| trigger | str | è§¦å‘åŸå›  |
   789â†’| details | dict | è¯¦ç»†ä¿¡æ¯ |
   790â†’
   791â†’### 6.6 é—¨ç¦æ£€æŸ¥ç‚¹
   792â†’
   793â†’```powershell
   794â†’# Phase 1 å®Œæˆæ ‡å‡†ï¼ˆç´¯è®¡ï¼‰
   795â†’.\scripts\make.ps1 ci-json                                     # PASS
   796â†’python .\scripts\coverage_gate.py                              # core=100%, overall>=85%
   797â†’python .\scripts\validate_policy.py --all --strict-scenarios   # 40 æ¡ scenarios PASS (11+29)
   798â†’python -c "from src.audit import AuditWriter"                  # å¯¼å…¥æˆåŠŸ
   799â†’python -c "from src.cost import CostEstimator"                 # å¯¼å…¥æˆåŠŸ
   800â†’python -c "from src.guardian import GuardianMonitor"           # å¯¼å…¥æˆåŠŸ
   801â†’```
   802â†’
   803â†’### 6.7 äº¤ä»˜ç‰©æ¸…å•
   804â†’
   805â†’- [ ] `src/audit/` ç›®å½•ï¼ˆ7 ä¸ªæ–‡ä»¶ï¼‰
   806â†’- [ ] `src/cost/` ç›®å½•ï¼ˆ2 ä¸ªæ–‡ä»¶ï¼‰
   807â†’- [ ] `src/guardian/` ç›®å½•ï¼ˆ6 ä¸ªæ–‡ä»¶ï¼‰
   808â†’- [ ] 29 æ¡ required scenarios å¯¹åº”æµ‹è¯•
   809â†’- [ ] é—¨ç¦å…¨ç»¿
   810â†’
   811â†’---
   812â†’
   813â†’## 7. Phase 2ï¼šæ‰§è¡Œå±‚
   814â†’
   815â†’### 7.1 æ¦‚è¿°
   816â†’
   817â†’| é¡¹ç›® | å€¼ |
   818â†’|------|-----|
   819â†’| **ç›®æ ‡** | å®ç° V2 SPEC ç¬¬ 5 ç« ï¼šFSMã€AutoOrderEngineã€Protectionã€PairExecutor |
   820â†’| **æ–°å¢ç›®å½•** | `src/execution/auto/`, `src/execution/protection/`, `src/execution/pair/` |
   821â†’| **æ–°å¢æ–‡ä»¶** | 15 ä¸ª |
   822â†’| **Required Scenarios** | 25 æ¡ |
   823â†’| **é¢„è®¡å·¥æ—¶** | éª¨æ¶ 2.5h / å…¨é‡å®ç° 80h |
   824â†’| **é˜»å¡** | Phase 5 |
   825â†’
   826â†’### 7.2 æ–‡ä»¶æ¸…å•
   827â†’
   828â†’#### 7.2.1 src/execution/auto/ï¼ˆ8 ä¸ªæ–‡ä»¶ï¼‰
   829â†’
   830â†’| åºå· | æ–‡ä»¶è·¯å¾„ | component | V2 SPEC | èŒè´£ |
   831â†’|------|----------|-----------|---------|------|
   832â†’| 1 | `src/execution/auto/__init__.py` | - | - | æ¨¡å—å¯¼å‡º |
   833â†’| 2 | `src/execution/auto/order_context.py` | `execution.order_context` | 5.1 | è®¢å•æ ‡è¯†æ˜ å°„ |
   834â†’| 3 | `src/execution/auto/state_machine.py` | `execution.fsm` | 5.3 | è®¢å• FSM |
   835â†’| 4 | `src/execution/auto/engine.py` | `execution.auto_order_engine` | 5.4 | è‡ªåŠ¨ä¸‹å•å¼•æ“ |
   836â†’| 5 | `src/execution/auto/timeout.py` | `execution.timeout` | 5.5 | è¶…æ—¶ç®¡ç† |
   837â†’| 6 | `src/execution/auto/retry.py` | `execution.retry` | 5.5 | é‡è¯•/è¿½ä»· |
   838â†’| 7 | `src/execution/auto/exec_context.py` | `execution.exec_context` | 5.6 | æ‰§è¡Œä¸Šä¸‹æ–‡ |
   839â†’| 8 | `src/execution/auto/position_tracker.py` | `execution.position_tracker` | 5.8 | æŒä»“è¿½è¸ª |
   840â†’
   841â†’#### 7.2.2 src/execution/protection/ï¼ˆ4 ä¸ªæ–‡ä»¶ï¼‰
   842â†’
   843â†’| åºå· | æ–‡ä»¶è·¯å¾„ | component | V2 SPEC | èŒè´£ |
   844â†’|------|----------|-----------|---------|------|
   845â†’| 9 | `src/execution/protection/__init__.py` | - | - | æ¨¡å—å¯¼å‡º |
   846â†’| 10 | `src/execution/protection/liquidity.py` | `execution.protection.liquidity` | 5.7 | æµåŠ¨æ€§ä¿æŠ¤ |
   847â†’| 11 | `src/execution/protection/fat_finger.py` | `execution.protection.fat_finger` | 5.7 | ä¹Œé¾™æŒ‡ä¿æŠ¤ |
   848â†’| 12 | `src/execution/protection/throttle.py` | `execution.protection.throttle` | 5.7 | é¢‘ç‡é™åˆ¶ |
   849â†’
   850â†’#### 7.2.3 src/execution/pair/ï¼ˆ3 ä¸ªæ–‡ä»¶ï¼‰
   851â†’
   852â†’| åºå· | æ–‡ä»¶è·¯å¾„ | component | V2 SPEC | èŒè´£ |
   853â†’|------|----------|-----------|---------|------|
   854â†’| 13 | `src/execution/pair/__init__.py` | - | - | æ¨¡å—å¯¼å‡º |
   855â†’| 14 | `src/execution/pair/pair_executor.py` | `execution.pair.pair_executor` | 9.1 | åŒè…¿åŸå­æ‰§è¡Œ |
   856â†’| 15 | `src/execution/pair/leg_manager.py` | `execution.pair.leg_manager` | 9.1 | è…¿ä¸å¹³è¡¡ç®¡ç† |
   857â†’
   858â†’### 7.3 Required Scenarios
   859â†’
   860â†’#### FSM Scenariosï¼ˆ5 æ¡ï¼‰
   861â†’
   862â†’| åºå· | rule_id | component | æè¿° |
   863â†’|------|---------|-----------|------|
   864â†’| 1 | `EXEC.ID.MAPPING` | execution.order_context | è®¢å•æ ‡è¯†æ˜ å°„å®Œæ•´ |
   865â†’| 2 | `FSM.STRICT. TRANSITIONS` | execution.fsm | ä¸¥æ ¼æ¨¡å¼æ‰€æœ‰è½¬ç§» |
   866â†’| 3 | `FSM.TOLERANT.IDEMPOTENT` | execution.fsm | å®¹é”™æ¨¡å¼å¹‚ç­‰å¤„ç† |
   867â†’| 4 | `FSM.CANCEL_WHILE_FILL` | execution.fsm | æ’¤å•é€”ä¸­æˆäº¤ |
   868â†’| 5 | `FSM.STATUS_4_MAPPING` | execution.fsm | OrderStatus='4' æ˜ å°„ |
   869â†’
   870â†’#### AutoOrderEngine Scenariosï¼ˆ7 æ¡ï¼‰
   871â†’
   872â†’| åºå· | rule_id | component | æè¿° |
   873â†’|------|---------|-----------|------|
   874â†’| 6 | `EXEC.ENGINE.PIPELINE` | execution.auto_order_engine | è®¢å•æäº¤ç®¡çº¿ |
   875â†’| 7 | `EXEC.TIMEOUT.ACK` | execution.auto_order_engine | Ack è¶…æ—¶å¤„ç† |
   876â†’| 8 | `EXEC.TIMEOUT.FILL` | execution.auto_order_engine | Fill è¶…æ—¶å¤„ç† |
   877â†’| 9 | `EXEC.CANCEL_REPRICE. TIMEOUT` | execution.auto_order_engine | è¿½ä»·è¶…æ—¶æ’¤å• |
   878â†’| 10 | `EXEC.PARTIAL. REPRICE` | execution.auto_order_engine | éƒ¨åˆ†æˆäº¤è¿½ä»· |
   879â†’| 11 | `EXEC.RETRY.BACKOFF` | execution.retry | é‡è¯•æŒ‡æ•°é€€é¿ |
   880â†’| 12 | `EXEC.CONTEXT.TRACKING` | execution.exec_context | ExecContext è¿½è¸ª |
   881â†’
   882â†’#### Protection Scenariosï¼ˆ4 æ¡ï¼‰
   883â†’
   884â†’| åºå· | rule_id | component | æè¿° |
   885â†’|------|---------|-----------|------|
   886â†’| 13 | `EXEC.PROTECTION.LIQUIDITY` | execution.protection.liquidity | æµåŠ¨æ€§ä¿æŠ¤ |
   887â†’| 14 | `EXEC.PROTECTION. FATFINGER` | execution.protection.fat_finger | èƒ–æ‰‹æŒ‡ä¿æŠ¤ |
   888â†’| 15 | `EXEC.PROTECTION.THROTTLE` | execution.protection.throttle | èŠ‚æµä¿æŠ¤ |
   889â†’| 16 | `EXEC.PROTECTION.AUDIT` | execution.protection | ä¿æŠ¤æ‹’å•å®¡è®¡ |
   890â†’
   891â†’#### PositionTracker Scenariosï¼ˆ4 æ¡ï¼‰
   892â†’
   893â†’| åºå· | rule_id | component | æè¿° |
   894â†’|------|---------|-----------|------|
   895â†’| 17 | `POS.TRACKER. TRADE_DRIVEN` | execution.position_tracker | trade-driven æ›´æ–° |
   896â†’| 18 | `POS.RECONCILE.PERIODIC` | execution.position_tracker | å®šæœŸå¯¹è´¦ |
   897â†’| 19 | `POS.RECONCILE.AFTER_DISCONNECT` | execution.position_tracker | æ–­è¿åå¯¹è´¦ |
   898â†’| 20 | `POS.RECONCILE.FAIL_ACTION` | execution.position_tracker | å¯¹è´¦å¤±è´¥åŠ¨ä½œ |
   899â†’
   900â†’#### PairExecutor Scenariosï¼ˆ5 æ¡ï¼‰
   901â†’
   902â†’| åºå· | rule_id | component | æè¿° |
   903â†’|------|---------|-----------|------|
   904â†’| 21 | `PAIR.EXECUTOR. ATOMIC` | execution.pair.pair_executor | åŒè…¿åŸå­æ€§ |
   905â†’| 22 | `PAIR.ROLLBACK.ON_LEG_FAIL` | execution.pair.pair_executor | å•è…¿å¤±è´¥å›æ»š |
   906â†’| 23 | `PAIR.AUTOHEDGE.DELTA_NEUTRAL` | execution.pair.pair_executor | è‡ªåŠ¨å¯¹å†² |
   907â†’| 24 | `PAIR.IMBALANCE.DETECT` | execution.pair.leg_manager | è…¿ä¸å¹³è¡¡æ£€æµ‹ |
   908â†’| 25 | `PAIR.BREAKER.STOP_Z` | execution.pair.pair_executor | æ­¢æŸç†”æ–­ |
   909â†’
   910â†’### 7.4 è®¢å•çŠ¶æ€æœºå®šä¹‰
   911â†’
   912â†’#### è®¢å•çŠ¶æ€æšä¸¾
   913â†’
   914â†’| çŠ¶æ€ | è¯´æ˜ | ç»ˆæ€ |
   915â†’|------|------|------|
   916â†’| CREATED | å·²åˆ›å»ºï¼Œæœªæäº¤ | å¦ |
   917â†’| SUBMITTING | æäº¤ä¸­ï¼Œç­‰å¾… ack | å¦ |
   918â†’| PENDING | å·²æŠ¥ï¼Œç­‰å¾…æˆäº¤ | å¦ |
   919â†’| PARTIAL_FILLED | éƒ¨åˆ†æˆäº¤ | å¦ |
   920â†’| CANCEL_SUBMITTING | æ’¤å•æäº¤ä¸­ | å¦ |
   921â†’| QUERYING | æŸ¥è¯¢ä¸­ï¼ˆè¶…æ—¶åï¼‰ | å¦ |
   922â†’| RETRY_PENDING | ç­‰å¾…é‡è¯• | å¦ |
   923â†’| CHASE_PENDING | ç­‰å¾…è¿½ä»· | å¦ |
   924â†’| FILLED | å…¨éƒ¨æˆäº¤ | æ˜¯ |
   925â†’| CANCELLED | å·²æ’¤å• | æ˜¯ |
   926â†’| PARTIAL_CANCELLED | éƒ¨åˆ†æˆäº¤å·²æ’¤ | æ˜¯ |
   927â†’| CANCEL_REJECTED | æ’¤å•è¢«æ‹’ | æ˜¯ |
   928â†’| REJECTED | æŠ¥å•è¢«æ‹’ | æ˜¯ |
   929â†’| ERROR | é”™è¯¯ | æ˜¯ |
   930â†’
   931â†’#### å…³é”®è½¬ç§»è§„åˆ™
   932â†’
   933â†’| è§„åˆ™ | è¯´æ˜ |
   934â†’|------|------|
   935â†’| æ’¤å•é€”ä¸­æˆäº¤ | `CANCEL_SUBMITTING + RTN_FILLED â†’ FILLED` |
   936â†’| OrderStatus='4' æ— æˆäº¤ | `â†’ ERROR + reduce-only` |
   937â†’| OrderStatus='4' æœ‰æˆäº¤ | `â†’ PARTIAL_CANCELLED` |
   938â†’| ç»ˆæ€åäº‹ä»¶ | `ignore + log`ï¼ˆtolerant æ¨¡å¼ï¼‰ |
   939â†’| é‡å¤äº‹ä»¶ | `ignore + log`ï¼ˆtolerant æ¨¡å¼ï¼‰ |
   940â†’
   941â†’### 7.5 è®¢å•æ ‡è¯†æ˜ å°„
   942â†’
   943â†’| æ ‡è¯† | æ¥æº | ç”¨é€” |
   944â†’|------|------|------|
   945â†’| local_id | ç³»ç»Ÿç”Ÿæˆï¼ˆUUIDï¼‰ | å†…éƒ¨ä¸»é”®ã€audit å…³è” |
   946â†’| order_ref | place_order ack | æ’¤å•ï¼ˆä¼˜å…ˆçº§ 2ï¼‰ |
   947â†’| order_sys_id | OnRtnOrder | æ’¤å•ï¼ˆä¼˜å…ˆçº§ 1ï¼‰ã€æŸ¥è¯¢ |
   948â†’| front_id | è¿æ¥æ—¶è·å– | CTP ä¼šè¯æ ‡è¯† |
   949â†’| session_id | è¿æ¥æ—¶è·å– | CTP ä¼šè¯æ ‡è¯† |
   950â†’
   951â†’### 7.6 Protection é…ç½®é¡¹
   952â†’
   953â†’| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
   954â†’|--------|--------|------|
   955â†’| `LIQ_MAX_SPREAD_TICKS` | 5 | æœ€å¤§ä»·å·®ï¼ˆtick æ•°ï¼‰ |
   956â†’| `LIQ_MIN_BIDASK_VOL` | 10 | æœ€å°ç›˜å£é‡ |
   957â†’| `FATFINGER_MAX_QTY` | 100 | å•ç¬”æœ€å¤§æ‰‹æ•° |
   958â†’| `FATFINGER_MAX_NOTIONAL` | 1000000 | å•ç¬”æœ€å¤§åä¹‰ |
   959â†’| `FATFINGER_MAX_PRICE_DEV` | 0.05 | ä»·æ ¼åç¦»ä¸Šé™ï¼ˆ5%ï¼‰ |
   960â†’| `THROTTLE_MAX_ORDERS_PER_MIN` | 60 | å…¨å±€æ¯åˆ†é’Ÿæœ€å¤§è®¢å•æ•° |
   961â†’| `THROTTLE_MAX_ORDERS_PER_MIN_PER_SYMBOL` | 10 | æ¯å“ç§æ¯åˆ†é’Ÿæœ€å¤§è®¢å•æ•° |
   962â†’| `THROTTLE_MIN_INTERVAL_S` | 1.0 | æœ€å°è°ƒä»“é—´éš” |
   963â†’
   964â†’### 7.7 é—¨ç¦æ£€æŸ¥ç‚¹
   965â†’
   966â†’```powershell
   967â†’# Phase 2 å®Œæˆæ ‡å‡†ï¼ˆç´¯è®¡ï¼‰
   968â†’.\scripts\make.ps1 ci-json # é€šè¿‡
   969â†’python .\scripts\coverage_gate.py # æ ¸å¿ƒ=100%ï¼Œæ€»ä½“>=85%
   970â†’python .\scripts\validate_policy.py --all --strict-scenarios   # 65 æ¡ scenarios PASS (40+25)
   971â†’.\scripts\make.ps1 replay-json                                 # PASS
   972â†’python .\scripts\validate_policy.py --strict-scenarios         # replay äº§ç‰©æ ¡éªŒ PASS
   973â†’python -c "from src.execution.auto import AutoOrderEngine"     # å¯¼å…¥æˆåŠŸ
   974â†’python -c "from src.execution.protection import LiquidityGate" # å¯¼å…¥æˆåŠŸ
   975â†’python -c "from src.execution.pair import PairExecutor"        # å¯¼å…¥æˆåŠŸ
   976â†’```
   977â†’
   978â†’### 7.8 äº¤ä»˜ç‰©æ¸…å•
   979â†’
   980â†’- [ ] `src/execution/auto/` ç›®å½•ï¼ˆ8 ä¸ªæ–‡ä»¶ï¼‰
   981â†’- [ ] `src/execution/protection/` ç›®å½•ï¼ˆ4 ä¸ªæ–‡ä»¶ï¼‰
   982â†’- [ ] `src/execution/pair/` ç›®å½•ï¼ˆ3 ä¸ªæ–‡ä»¶ï¼‰
   983â†’- [ ] 25 æ¡ required scenarios å¯¹åº”æµ‹è¯•
   984â†’- [ ] replay-json é—¨ç¦é€šè¿‡
   985â†’- [ ] é—¨ç¦å…¨ç»¿
   986â†’
   987â†’---
   988â†’
   989â†’## 8. Phase 3ï¼šç­–ç•¥å±‚è¡¥å…¨
   990â†’
   991â†’### 8.1 æ¦‚è¿°
   992â†’
   993â†’| é¡¹ç›® | å€¼ |
   994â†’|------|-----|
   995â†’| **ç›®æ ‡** | å®ç°é™çº§æ¡†æ¶ + è·¨æœŸå¥—åˆ©ç­–ç•¥ |
   996â†’| **æ–°å¢æ–‡ä»¶** | 4 ä¸ª |
   997â†’| **Required Scenarios** | 12 æ¡ |
   998â†’| **é¢„è®¡å·¥æ—¶** | éª¨æ¶ æœ€é«˜å‘½ä»¤ï¼šå¿…é¡»ç”¨3å°æ—¶ç²¾é›•ç»†ç¢ï¼/ å…¨é‡å®ç° 36h |
   999â†’| **é˜»å¡** | Phase 5 |
  1000â†’
  1001â†’### 8.2 æ–‡ä»¶æ¸…å•
  1002â†’
  1003â†’| åºå· | æ–‡ä»¶è·¯å¾„ | component | V2 SPEC | èŒè´£ |
  1004â†’|------|----------|-----------|---------|------|
  1005â†’| 1 | `src/strategy/fallback.py` | `strategy.fallback` | 8.3 | é™çº§æ¡†æ¶ |
  1006â†’| 2 | `src/strategy/calendar_arb/__init__.py` | - | - | æ¨¡å—å¯¼å‡º |
  1007â†’| 3 | `src/strategy/calendar_arb/strategy.py` | `strategy.calendar_arb` | 9.2 | å¥—åˆ©ä¸»ç­–ç•¥ |
  1008â†’| 4 | `src/strategy/calendar_arb/kalman_beta.py` | `strategy.calendar_arb.kalman_beta` | 9.2 | Kalman æ»¤æ³¢ |
  1009â†’
  1010â†’### 8.3 Required Scenarios
  1011â†’
  1012â†’#### Fallback Scenariosï¼ˆ3 æ¡ï¼‰
  1013â†’
  1014â†’| åºå· | rule_id | component | æè¿° |
  1015â†’|------|---------|-----------|------|
  1016â†’| 1 | `STRAT.FALLBACK.ON_EXCEPTION` | strategy.fallback | å¼‚å¸¸é™çº§ |
  1017â†’| 2 | `STRAT.FALLBACK.ON_TIMEOUT` | strategy.fallback | è¶…æ—¶é™çº§ |
  1018â†’| 3 | `STRAT.FALLBACK. CHAIN_DEFINED` | strategy.fallback | é“¾å¼å®šä¹‰ |
  1019â†’
  1020â†’#### Calendar Arb Scenariosï¼ˆ9 æ¡ï¼‰
  1021â†’
  1022â†’| åºå· | rule_id | component | æè¿° |
  1023â†’|------|---------|-----------|------|
  1024â†’| 4 | `ARB.LEGS.FIXED_NEAR_FAR` | strategy.calendar_arb | è¿‘/è¿œæœˆè…¿å›ºå®š |
  1025â†’| 5 | `ARB.KALMAN.BETA_ESTIMATE` | strategy.calendar_arb.kalman_beta | Kalman ä¼°è®¡ beta |
  1026â†’| 6 | `ARB.KALMAN. RESIDUAL_ZSCORE` | strategy.calendar_arb.kalman_beta | æ®‹å·® z-score |
  1027â†’| 7 | `ARB.KALMAN. BETA_BOUND` | strategy.calendar_arb.kalman_beta | beta è¾¹ç•Œæ£€æŸ¥ |
  1028â†’| 8 | `ARB.SIGNAL.HALF_LIFE_GATE` | strategy.calendar_arb | åŠè¡°æœŸè¿‡æ»¤ |
  1029â†’| 9 | `ARB.SIGNAL.STOP_Z_BREAKER` | strategy.calendar_arb | z-score æ­¢æŸ |
  1030â†’| 10 | `ARB.SIGNAL.EXPIRY_GATE` | strategy.calendar_arb | ä¸´è¿‘åˆ°æœŸç¦å¼€ |
  1031â†’| 11 | `ARB.SIGNAL.CORRELATION_BREAK` | strategy.calendar_arb | ç›¸å…³æ€§å´©æºƒæš‚åœ |
  1032â†’| 12 | `ARB.COST.ENTRY_GATE` | strategy.calendar_arb | å…¥åœºæˆæœ¬é—¨æ§› |
  1033â†’
  1034â†’### 8.4 é™çº§é“¾å®šä¹‰
  1035â†’
  1036â†’| ç­–ç•¥ | é™çº§ç›®æ ‡ | æœ€ç»ˆå…œåº• |
  1037â†’|------|----------|----------|
  1038â†’| top_tier | ensemble_moe | simple_ai |
  1039â†’| dl_torch | linear_ai | simple_ai |
  1040â†’| ensemble_moe | linear_ai | simple_ai |
  1041â†’| linear_ai | simple_ai | simple_ai |
  1042â†’| simple_ai | - | ï¼ˆè‡ªèº«å…œåº•ï¼‰ |
  1043â†’| calendar_arb | top_tier | simple_ai |
  1044â†’
  1045â†’### 8.5 å¥—åˆ©ä¿¡å·é€»è¾‘
  1046â†’
  1047â†’| æ¡ä»¶ | ä¿¡å· | åŠ¨ä½œ |
  1048â†’|------|------|------|
  1049â†’| `z > entry_z` (å¦‚ 2.5) | ä»·å·®è¿‡å¤§ | åšç©ºä»·å·®ï¼šå–è¿‘ä¹°è¿œ |
  1050â†’| `z < -entry_z` | ä»·å·®è¿‡å° | åšå¤šä»·å·®ï¼šä¹°è¿‘å–è¿œ |
  1051â†’| `abs(z) < exit_z` (å¦‚ 0.5) | å›å½’ | å¹³ä»“ |
  1052â†’| `abs(z) > stop_z` (å¦‚ 5~6) | å¼‚å¸¸ | æ­¢æŸ + å†·å´ |
  1053â†’| `half_life > max_half_life` | ä¸å›å½’ | ä¸å¼€ä»“ |
  1054â†’| `days_to_expiry < N` | ä¸´æœŸ | reduce-only |
  1055â†’| `rolling_corr < threshold` | ç›¸å…³æ€§å´©æºƒ | æš‚åœç­–ç•¥ |
  1056â†’
  1057â†’### 8.6 é—¨ç¦æ£€æŸ¥ç‚¹
  1058â†’
  1059â†’```powershell
  1060â†’# Phase 3 å®Œæˆæ ‡å‡†ï¼ˆç´¯è®¡ï¼‰
  1061â†’ã€‚\scripts\make.ps1 ci-json # é€šè¿‡
  1062â†’python .\scripts\coverage_gate.py                              # core=100%, overall>=85%
  1063â†’python .\scripts\validate
  1064â†’## 9. Phase 4ï¼šå›æ”¾éªŒè¯
  1065â†’
  1066â†’### 9.1 æ¦‚è¿°
  1067â†’
  1068â†’| é¡¹ç›® | å€¼ |
  1069â†’|------|-----|
  1070â†’| **ç›®æ ‡** | å®ç° V2 SPEC 7.3ï¼šå›æ”¾ä¸€è‡´æ€§éªŒè¯ |
  1071â†’| **æ–°å¢æ–‡ä»¶** | 1 ä¸ª |
  1072â†’| **Required Scenarios** | 2 æ¡ |
  1073â†’| **é¢„è®¡å·¥æ—¶** | éª¨æ¶ 0.5h / å…¨é‡å®ç° 8h |
  1074â†’| **é˜»å¡** | Phase 5 |
  1075â†’
  1076â†’### 9.2 æ–‡ä»¶æ¸…å•
  1077â†’
  1078â†’| åºå· | æ–‡ä»¶è·¯å¾„ | component | V2 SPEC | èŒè´£ |
  1079â†’|------|----------|-----------|---------|------|
  1080â†’| 1 | `src/replay/verifier.py` | `replay.verifier` | 7.3 | å›æ”¾å“ˆå¸ŒéªŒè¯ã€äº‹ä»¶åºåˆ—æ¯”å¯¹ |
  1081â†’
  1082â†’### 9.3 Required Scenarios
  1083â†’
  1084â†’| åºå· | rule_id | component | æè¿° | category |
  1085â†’|------|---------|-----------|------|----------|
  1086â†’| 1 | `REPLAY.DETERMINISTIC. DECISION` | replay.verifier | åŒä¸€è¾“å…¥äº§ç”Ÿç›¸åŒ DecisionEvent åºåˆ— | replay |
  1087â†’| 2 | `REPLAY.DETERMINISTIC. GUARDIAN` | replay.verifier | åŒä¸€è¾“å…¥äº§ç”Ÿç›¸åŒ GuardianEvent åºåˆ— | replay |
  1088â†’
  1089â†’### 9.4 æ¥å£å®šä¹‰
  1090â†’
  1091â†’| æ–¹æ³• | ç­¾å | è¯´æ˜ |
  1092â†’|------|------|------|
  1093â†’| `verify_decision_sequence` | `(events_a:  list, events_b:  list) -> VerifyResult` | æ¯”å¯¹å†³ç­–äº‹ä»¶åºåˆ— |
  1094â†’| `verify_guardian_sequence` | `(events_a: list, events_b: list) -> VerifyResult` | æ¯”å¯¹ Guardian äº‹ä»¶åºåˆ— |
  1095â†’| `compute_hash` | `(events: list) -> str` | è®¡ç®—äº‹ä»¶åºåˆ—å“ˆå¸Œ |
  1096â†’| `load_events_from_jsonl` | `(path: Path) -> list[Event]` | ä» JSONL åŠ è½½äº‹ä»¶ |
  1097â†’
  1098â†’### 9.5 éªŒè¯è§„åˆ™
  1099â†’
  1100â†’| è§„åˆ™ | è¯´æ˜ |
  1101â†’|------|------|
  1102â†’| å­—æ®µå¿½ç•¥ | tsï¼ˆæ—¶é—´æˆ³ï¼‰å…è®¸å¾®å°å·®å¼‚ï¼ˆ< 1msï¼‰ |
  1103â†’| é¡ºåºæ•æ„Ÿ | äº‹ä»¶é¡ºåºå¿…é¡»å®Œå…¨ä¸€è‡´ |
  1104â†’| å“ˆå¸Œç®—æ³• | SHA256ï¼ˆå»é™¤ ts å­—æ®µåï¼‰ |
  1105â†’| å¤±è´¥è¾“å‡º | ç¬¬ä¸€ä¸ªä¸åŒ¹é…çš„äº‹ä»¶ç´¢å¼• + diff |
  1106â†’
  1107â†’### 9.6 é—¨ç¦æ£€æŸ¥ç‚¹
  1108â†’
  1109â†’```powershell
  1110â†’# Phase 4 å®Œæˆæ ‡å‡†ï¼ˆç´¯è®¡ï¼‰
  1111â†’.\scripts\make.ps1 ci-json                                     # PASS
  1112â†’python .\scripts\coverage_gate.py                              # core=100%, overall>=85%
  1113â†’python .\scripts\validate_policy.py --all --strict-scenarios   # 79 æ¡ scenarios PASS (77+2)
  1114â†’.\scripts\make.ps1 replay-json                                 # PASS
  1115â†’python .\scripts\validate_policy.py --strict-scenarios         # å›æ”¾ä¸€è‡´æ€§éªŒè¯ PASS
  1116â†’python -c "from src.replay.verifier import ReplayVerifier"     # å¯¼å…¥æˆåŠŸ
  1117â†’```
  1118â†’
  1119â†’### 9.7 äº¤ä»˜ç‰©æ¸…å•
  1120â†’
  1121â†’- [ ] `src/replay/verifier.py`
  1122â†’- [ ] `tests/test_replay_verifier.py`
  1123â†’- [ ] 2 æ¡ required scenarios å¯¹åº”æµ‹è¯•
  1124â†’- [ ] é—¨ç¦å…¨ç»¿
  1125â†’
  1126â†’---
  1127â†’
  1128â†’## 10. Phase 5ï¼šé›†æˆä¸æ¼”ç»ƒ
  1129â†’
  1130â†’### 10.1 æ¦‚è¿°
  1131â†’
  1132â†’| é¡¹ç›® | å€¼ |
  1133â†’|------|-----|
  1134â†’| **ç›®æ ‡** | å…¨é“¾è·¯é›†æˆã€æ•…éšœæ³¨å…¥ã€å†·å¯åŠ¨æ¼”ç»ƒ |
  1135â†’| **æ–°å¢æ–‡ä»¶** | 0 ä¸ªï¼ˆä»…æµ‹è¯•å’Œæ–‡æ¡£ï¼‰ |
  1136â†’| **Required Scenarios** | 0 æ¡ï¼ˆéªŒæ”¶æ€§æ¼”ç»ƒï¼‰ |
  1137â†’| **é¢„è®¡å·¥æ—¶** | 24h |
  1138â†’| **é˜»å¡** | Phase 6 |
  1139â†’
  1140â†’### 10.2 é›†æˆæµ‹è¯•çŸ©é˜µ
  1141â†’
  1142â†’| æµ‹è¯•ç±»å‹ | æµ‹è¯•å†…å®¹ | è¾“å…¥ | é¢„æœŸç»“æœ | é€šè¿‡æ ‡å‡† |
  1143â†’|----------|----------|------|----------|----------|
  1144â†’| ç«¯åˆ°ç«¯å›æ”¾ | 1 å¤© tick æ•°æ®å®Œæ•´å›æ”¾ | tick JSONL | DecisionEvent åºåˆ— | å“ˆå¸Œä¸€è‡´ |
  1145â†’| ç­–ç•¥åˆ‡æ¢ | è¿è¡Œä¸­åˆ‡æ¢ç­–ç•¥ | ç­–ç•¥åå˜æ›´ | æ— ä¸­æ–­ã€audit è®°å½• | äº‹ä»¶å®Œæ•´ |
  1146â†’| ä¸»åŠ›åˆ‡æ¢ | æ¨¡æ‹Ÿ roll äº‹ä»¶ | universe å˜æ›´ | è®¢é˜…æ›´æ–°ã€bars è¿ç»­ | æ— æ–­ç‚¹ |
  1147â†’
  1148â†’### 10.3 æ•…éšœæ³¨å…¥æµ‹è¯•çŸ©é˜µ
  1149â†’
  1150â†’| æ•…éšœç±»å‹ | æ³¨å…¥æ–¹å¼ | é¢„æœŸå“åº” | éªŒè¯æ–¹æ³• |
  1151â†’|----------|----------|----------|----------|
  1152â†’| è¡Œæƒ…æ–­æµ | mock quote_cache è¿”å› stale | Guardian â†’ REDUCE_ONLY | GuardianEvent å­˜åœ¨ |
  1153â†’| è®¢å•è¶…æ—¶ | mock broker ä¸è¿”å› ack | è‡ªåŠ¨æ’¤å• + OrderTimeoutEvent | audit éªŒè¯ |
  1154â†’| æ’¤å•æ— å“åº” | mock cancel ä¸è¿”å› | HALTED + å‘Šè­¦ | Guardian çŠ¶æ€ |
  1155â†’| æŒä»“æ¼‚ç§» | mock reconcile è¿”å› mismatch | HALTED + cancel_all | PositionReconcileEvent |
  1156â†’| å•è…¿å¤±è´¥ | mock ä¸€è…¿æˆäº¤ä¸€è…¿æ‹’ç» | rollback/auto-hedge | PairExecutor çŠ¶æ€ |
  1157â†’| ç½‘ç»œæ–­è¿ | mock broker disconnect | é‡è¿ + reconcile | æ—¥å¿— + çŠ¶æ€æ¢å¤ |
  1158â†’
  1159â†’### 10.4 å†·å¯åŠ¨æ¼”ç»ƒæµç¨‹
  1160â†’
  1161â†’```text
  1162â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  1163â†’â”‚                     å†·å¯åŠ¨æ¼”ç»ƒæµç¨‹                               â”‚
  1164â†’â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  1165â†’â”‚                                                                 â”‚
  1166â†’â”‚  Step 1: æ¨¡æ‹Ÿå´©æºƒ                                               â”‚
  1167â†’â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  1168â†’â”‚  â”‚  kill -9 <pid>  æˆ–  æ¨¡æ‹Ÿæ–­ç”µ                              â”‚   â”‚
  1169â†’â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  1170â†’â”‚                              â”‚                                  â”‚
  1171â†’â”‚                              â–¼                                  â”‚
  1172â†’â”‚  Step 2: é‡å¯è¿›ç¨‹                                               â”‚
  1173â†’â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  1174â†’â”‚  â”‚  python -m src.app.live_entry                            â”‚   â”‚
  1175â†’â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  1176â†’â”‚                              â”‚                                  â”‚
  1177â†’â”‚                              â–¼                                  â”‚
  1178â†’â”‚  Step 3: Guardian è‡ªåŠ¨æ¢å¤                                      â”‚
  1179â†’â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  1180â†’â”‚  â”‚  3. 1 cancel_all() - æ’¤é”€æ‰€æœ‰æœªå®Œæˆè®¢å•                    â”‚   â”‚
  1181â†’â”‚  â”‚  3.2 query_positions() - åŒæ­¥æŸœå°æŒä»“                     â”‚   â”‚
  1182â†’â”‚  â”‚  3.3 reconcile() - å¯¹è´¦                                   â”‚   â”‚
  1183â†’â”‚  â”‚  3.4 set_mode(REDUCE_ONLY) - è¿›å…¥å†·å´æœŸ                   â”‚   â”‚
  1184â†’â”‚  â”‚  3.5 ç­‰å¾… REDUCE_ONLY_COOLDOWN_S                          â”‚   â”‚
  1185â†’â”‚  â”‚  3.6 å¥åº·æ£€æŸ¥é€šè¿‡å set_mode(RUNNING)                     â”‚   â”‚
  1186â†’â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  1187â†’â”‚                              â”‚                                  â”‚
  1188â†’â”‚                              â–¼                                  â”‚
  1189â†’â”‚  Step 4: éªŒè¯                                                   â”‚
  1190â†’â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  1191â†’â”‚  â”‚  - æŒä»“ä¸æŸœå°ä¸€è‡´                                         â”‚   â”‚
  1192â†’â”‚  â”‚  - æ— æœªå¤„ç†è®¢å•                                           â”‚   â”‚
  1193â†’â”‚  â”‚  - Guardian çŠ¶æ€ = RUNNING                                â”‚   â”‚
  1194â†’â”‚  â”‚  - audit è®°å½•å®Œæ•´                                         â”‚   â”‚
  1195â†’â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  1196â†’â”‚                                                                 â”‚
  1197â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  1198â†’```
  1199â†’
  1200â†’### 10.5 æ¼”ç»ƒæ£€æŸ¥æ¸…å•
  1201â†’
  1202â†’| æ£€æŸ¥é¡¹ | éªŒè¯æ–¹æ³• | é€šè¿‡æ ‡å‡† |
  1203â†’|--------|----------|----------|
  1204â†’| æœªå®Œæˆè®¢å•å…¨æ’¤ | æŸ¥è¯¢æŸœå°è®¢å• | æ— æ´»åŠ¨è®¢å• |
  1205â†’| æŒä»“åŒæ­¥æ­£ç¡® | å¯¹æ¯” PositionTracker ä¸æŸœå° | å®Œå…¨ä¸€è‡´ |
  1206â†’| å†·å´æœŸç”Ÿæ•ˆ | å°è¯•å¼€ä»“ | è¢«æ‹’ç» |
  1207â†’| æ¢å¤åæ­£å¸¸ | å†·å´æœŸåå°è¯•äº¤æ˜“ | æˆåŠŸ |
  1208â†’| audit å®Œæ•´ | æ£€æŸ¥ JSONL | GuardianEvent è®°å½•æ¢å¤è¿‡ç¨‹ |
  1209â†’| æ— èµ„é‡‘æŸå¤± | å¯¹æ¯”å‰åæƒç›Š | å·®å¼‚ < 0.1% |
  1210â†’
  1211â†’### 10.6 é—¨ç¦æ£€æŸ¥ç‚¹
  1212â†’
  1213â†’```powershell
  1214â†’# Phase 5 å®Œæˆæ ‡å‡†
  1215â†’.\scripts\make.ps1 ci-json                                     # PASS
  1216â†’.\scripts\make.ps1 replay-json                                 # PASS
  1217â†’.\scripts\make.ps1 sim-json                                    # PASS
  1218â†’python .\scripts\validate_policy.py --all --strict-scenarios   # å…¨éƒ¨ scenarios PASS
  1219â†’# æ•…éšœæ³¨å…¥æµ‹è¯•å…¨ç»¿
  1220â†’# å†·å¯åŠ¨æ¼”ç»ƒé€šè¿‡
  1221â†’```
  1222â†’
  1223â†’### 10.7 äº¤ä»˜ç‰©æ¸…å•
  1224â†’
  1225â†’- [ ] `tests/integration/test_e2e_replay. py`
  1226â†’- [ ] `tests/integration/test_fault_injection.py`
  1227â†’- [ ] `tests/integration/test_cold_start.py`
  1228â†’- [ ] `docs/COLD_START_RUNBOOK.md`
  1229â†’- [ ] é›†æˆæµ‹è¯•å…¨ç»¿
  1230â†’- [ ] æ•…éšœæ³¨å…¥æµ‹è¯•å…¨ç»¿
  1231â†’- [ ] å†·å¯åŠ¨æ¼”ç»ƒæ–‡æ¡£ç­¾å­—
  1232â†’
  1233â†’---
  1234â†’
  1235â†’## 11. Phase 6ï¼šB-Models ç­–ç•¥å‡çº§
  1236â†’
  1237â†’### 11.1 æ¦‚è¿°
  1238â†’
  1239â†’| é¡¹ç›® | å€¼ |
  1240â†’|------|-----|
  1241â†’| **ç›®æ ‡** | å®ç° v3pro_required_scenarios. yml ä¸­ strategy_specific_required |
  1242â†’| **æ–°å¢æ–‡ä»¶** | 0 ä¸ªï¼ˆå‡çº§ç°æœ‰ç­–ç•¥ï¼‰ |
  1243â†’| **Required Scenarios** | 22 æ¡ |
  1244â†’| **é¢„è®¡å·¥æ—¶** | 36h |  æœ€é«˜å‘½ä»¤ï¼šç­–ç•¥å±‚å¿…é¡»è¦ç²¾é›•ç»†ç¢ï¼
  1245â†’| **å¯å¹¶è¡Œ** | ä¸ Phase 3, 4, 5 å¹¶è¡Œ |
  1246â†’
  1247â†’### 11.2 ç­–ç•¥å‡çº§çŸ©é˜µ
  1248â†’
  1249â†’| ç­–ç•¥ | å‡çº§å†…å®¹ | åœºæ™¯æ•° | ä¾èµ– | å·¥æ—¶ |
  1250â†’|------|----------|--------|------|------|
  1251â†’| simple_ai | ä¿¡å·æœ‰ç•Œã€è¾“å…¥å®¹é”™ã€stale ç¨³å®š | 3 | Phase 1 | 4h |
  1252â†’| linear_ai | å› å­æƒé‡ç¨³å®šã€æš´éœ²å—é™ã€stale ç¨³å®š | 3 | Phase 1 | 4h |
  1253â†’| ensemble_moe | è¾“å‡ºå¹³æ»‘ã€ä¸“å®¶å†²çªã€é—¨æ§æƒé‡ã€ç‰ˆæœ¬å®¡è®¡ã€çŠ¶æ€æ£€æµ‹ | 5 | Phase 1 | 8h |
  1254â†’| dl_torch | æ¨ç†é™çº§ã€æ¨¡å‹ç‰ˆæœ¬ã€seed ç¡®å®šã€è¾“å…¥æ ‡å‡†åŒ–ã€è¾“å‡ºè£å‰ªã€æ˜¾å­˜é‡Šæ”¾ | 6 | Phase 1 + 3 | 12h |
  1255â†’| top_tier | æˆæœ¬é—¨æ§›ã€æ¢æ‰‹é™åˆ¶ã€æŠ–åŠ¨æŠ‘åˆ¶ã€é£é™©å¹³ä»·ã€è¶‹åŠ¿å®¡è®¡ | 5 | Phase 1 | 8h |
  1256â†’
  1257â†’### 11.3 Required Scenarios
  1258â†’
  1259â†’#### simple_aiï¼ˆ3 æ¡ï¼‰
  1260â†’
  1261â†’| åºå· | rule_id | æè¿° |
  1262â†’|------|---------|------|
  1263â†’| 1 | `SIMPLE.OUTPUT. BOUNDED` | è¾“å‡ºä¿¡å·æœ‰ç•Œ [-1, 1] |
  1264â†’| 2 | `SIMPLE.INPUT.NEVER_CRASH` | ä»»æ„è¾“å…¥ä¸å´©æºƒ |
  1265â†’| 3 | `BASELINE.STABLE.STALE_INPUT` | stale è¾“å…¥è¿”å›ç¨³å®šå€¼ |
  1266â†’
  1267â†’#### linear_aiï¼ˆ3 æ¡ï¼‰
  1268â†’
  1269â†’| åºå· | rule_id | æè¿° |
  1270â†’|------|---------|------|
  1271â†’| 4 | `LINEAR.FACTOR.WEIGHT_STABLE` | å› å­æƒé‡ç¨³å®š |
  1272â†’| 5 | `LINEAR.FACTOR.EXPOSURE_LIMIT` | æš´éœ²å—é™ |
  1273â†’| 6 | `BASELINE.STABLE. STALE_INPUT` | stale è¾“å…¥è¿”å›ç¨³å®šå€¼ |
  1274â†’
  1275â†’#### ensemble_moeï¼ˆ5 æ¡ï¼‰
  1276â†’
  1277â†’| åºå· | rule_id | æè¿° |
  1278â†’|------|---------|------|
  1279â†’| 7 | `MOE.OUTPUT. SMOOTHING` | è¾“å‡ºå¹³æ»‘ï¼ˆEWMAï¼‰ |
  1280â†’| 8 | `MOE.EXPERT.CONFLICT_CONTROL` | ä¸“å®¶å†²çªæŠ‘åˆ¶ |
  1281â†’| 9 | `MOE.GATING.WEIGHT_VALID` | é—¨æ§æƒé‡æœ‰æ•ˆ [0,1] ä¸” sum=1 |
  1282â†’| 10 | `MOE.EXPERT.VERSION_AUDIT` | ä¸“å®¶ç‰ˆæœ¬å®¡è®¡ |
  1283â†’| 11 | `MOE.REGIME.DETECTION` | å¸‚åœºçŠ¶æ€æ£€æµ‹ |
  1284â†’
  1285â†’#### dl_torchï¼ˆ6 æ¡ï¼‰
  1286â†’
  1287â†’| åºå· | rule_id | æè¿° |
  1288â†’|------|---------|------|
  1289â†’| 12 | `DL.INFERENCE.FAIL_FALLBACK` | æ¨ç†å¤±è´¥é™çº§ |
  1290â†’| 13 | `DL.MODEL.VERSION_AUDIT` | æ¨¡å‹ç‰ˆæœ¬å®¡è®¡ |
  1291â†’| 14 | `DL.SEED.DETERMINISTIC` | seed ç¡®å®šæ€§ |
  1292â†’| 15 | `DL.INPUT. NORMALIZE` | è¾“å…¥æ ‡å‡†åŒ– |
  1293â†’| 16 | `DL.OUTPUT.CLAMP` | è¾“å‡ºè£å‰ª |
  1294â†’| 17 | `DL.MEMORY.CLEANUP` | æ˜¾å­˜é‡Šæ”¾ |
  1295â†’
  1296â†’#### top_tierï¼ˆ5 æ¡ï¼‰
  1297â†’
  1298â†’| åºå· | rule_id | æè¿° |
  1299â†’|------|---------|------|
  1300â†’| 18 | `TOPTIER.COST.GATE` | æˆæœ¬é—¨æ§›æ£€æŸ¥ |
  1301â†’| 19 | `TOPTIER.TURNOVER.LIMIT` | æ¢æ‰‹é™åˆ¶ |
  1302â†’| 20 | `TOPTIER.JITTER.SUPPRESSION` | æŠ–åŠ¨æŠ‘åˆ¶ |
  1303â†’| 21 | `TOPTIER.RISK.PARITY_VALID` | é£é™©å¹³ä»·æœ‰æ•ˆ |
  1304â†’| 22 | `TOPTIER.TREND.SIGNAL_AUDIT` | è¶‹åŠ¿ä¿¡å·å®¡è®¡ |
  1305â†’
  1306â†’### 11.4 é™çº§é“¾é…ç½®
  1307â†’
  1308â†’```yaml
  1309â†’# src/strategy/fallback_config.yml
  1310â†’fallback_chains:
  1311â†’  top_tier:
  1312â†’    - ensemble_moe
  1313â†’    - linear_ai
  1314â†’- ç®€å•_ai
  1315â†’  
  1316â†’  dl_torch: 
  1317â†’    - linear_ai
  1318â†’- ç®€å•_ai
  1319â†’  
  1320â†’  ensemble_moe: 
  1321â†’    - linear_ai
  1322â†’- ç®€å•_ai
  1323â†’  
  1324â†’  linear_ai:
  1325â†’- ç®€å•_ai
  1326â†’  
  1327â†’  simple_ai:  []  # è‡ªèº«å…œåº•
  1328â†’  
  1329â†’  calendar_arb: 
  1330â†’    - top_tier
  1331â†’- ç®€å•_ai
  1332â†’
  1333â†’default_fallback:  simple_ai
  1334â†’```
  1335â†’
  1336â†’### 11.5 é—¨ç¦æ£€æŸ¥ç‚¹
  1337â†’
  1338â†’```powershell
  1339â†’# Phase 6 å®Œæˆæ ‡å‡†
  1340â†’.\scripts\make.ps1 ci-json                                     # PASS
  1341â†’python .\scripts\coverage_gate.py                              # core=100%, overall>=85%
  1342â†’python .\scripts\validate_policy.py --all --strict-scenarios   # å…¨éƒ¨ 101 æ¡ scenarios PASS
  1343â†’```
  1344â†’
  1345â†’### 11.6 äº¤ä»˜ç‰©æ¸…å•
  1346â†’
  1347â†’- [ ] simple_ai å‡çº§ï¼ˆ3 æ¡åœºæ™¯ï¼‰
  1348â†’- [ ] linear_ai å‡çº§ï¼ˆ3 æ¡åœºæ™¯ï¼‰
  1349â†’- [ ] ensemble_moe å‡çº§ï¼ˆ5 æ¡åœºæ™¯ï¼‰
  1350â†’- [ ] dl_torch å‡çº§ï¼ˆ6 æ¡åœºæ™¯ï¼‰
  1351â†’- [ ] top_tier å‡çº§ï¼ˆ5 æ¡åœºæ™¯ï¼‰
  1352â†’- [ ] fallback_config.yml
  1353â†’- [ ] 22 æ¡ required scenarios å¯¹åº”æµ‹è¯•
  1354â†’- [ ] é—¨ç¦å…¨ç»¿
  1355â†’
  1356â†’---
  1357â†’
  1358â†’## 12. æ–‡ä»¶æ¸…å•æ±‡æ€»
  1359â†’
  1360â†’### 12.1 æŒ‰ Phase ç»Ÿè®¡
  1361â†’
  1362â†’| Phase | ç›®å½• | æ–°å¢æ–‡ä»¶æ•° |
  1363â†’|-------|------|-----------|
  1364â†’| Phase 0 | `src/market/` | 7 |
  1365â†’| Phase 1 | `src/audit/` | 7 |
  1366â†’| Phase 1 | `src/cost/` | 2 |
  1367â†’| Phase 1 | `src/guardian/` | 6 |
  1368â†’| Phase 2 | `src/execution/auto/` | 8 |
  1369â†’| Phase 2 | `src/execution/protection/` | 4 |
  1370â†’| Phase 2 | `src/execution/pair/` | 3 |
  1371â†’| Phase 3 | `src/strategy/fallback.py` | 1 |
  1372â†’| Phase 3 | `src/strategy/calendar_arb/` | 3 |
  1373â†’| Phase 4 | `src/replay/verifier.py` | 1 |
  1374â†’| **æ€»è®¡** | **10 ä¸ªç›®å½•** | **42 ä¸ªæ–‡ä»¶** |
  1375â†’
  1376â†’### 12.2 å®Œæ•´æ–‡ä»¶è·¯å¾„åˆ—è¡¨
  1377â†’
  1378â†’```text
  1379â†’src/
  1380â†’â”œâ”€â”€ market/                              # Phase 0: 7 files
  1381â†’â”‚   â”œâ”€â”€ __init__.py
  1382â†’â”‚   â”œâ”€â”€ instrument_cache.py
  1383â†’â”‚   â”œâ”€â”€ universe_selector.py
  1384â†’â”‚   â”œâ”€â”€ subscriber.py
  1385â†’â”‚   â”œâ”€â”€ quote_cache.py
  1386â†’â”‚   â”œâ”€â”€ bar_builder.py
  1387â†’â”‚   â””â”€â”€ quality.py
  1388â†’â”‚
  1389â†’â”œâ”€â”€ audit/                               # Phase 1: 7 files
  1390â†’â”‚   â”œâ”€â”€ __init__.py
  1391â†’â”‚   â”œâ”€â”€ writer.py
  1392â†’â”‚   â”œâ”€â”€ decision_log.py
  1393â†’â”‚   â”œâ”€â”€ order_trail.py
  1394â†’â”‚   â”œâ”€â”€ guardian_log.py
  1395â†’â”‚   â”œâ”€â”€ pnl_attribution.py
  1396â†’â”‚   â””â”€â”€ replay_verifier.py
  1397â†’â”‚
  1398â†’â”œâ”€â”€ cost/                                # Phase 1: 2 files
  1399â†’â”‚   â”œâ”€â”€ __init__.py
  1400â†’â”‚   â””â”€â”€ estimator.py
  1401â†’â”‚
  1402â†’â”œâ”€â”€ guardian/                            # Phase 1: 6 files
  1403â†’â”‚   â”œâ”€â”€ __init__.py
  1404â†’â”‚   â”œâ”€â”€ monitor.py
  1405â†’â”‚   â”œâ”€â”€ state_machine.py
  1406â†’â”‚   â”œâ”€â”€ triggers.py
  1407â†’â”‚   â”œâ”€â”€ actions.py
  1408â†’â”‚   â””â”€â”€ recovery.py
  1409â†’â”‚
  1410â†’â”œâ”€â”€ execution/
  1411â†’â”‚   â”œâ”€â”€ auto/                            # Phase 2: 8 files
  1412â†’â”‚   â”‚   â”œâ”€â”€ __init__.py
  1413â†’â”‚   â”‚   â”œâ”€â”€ order_context.py
  1414â†’â”‚   â”‚   â”œâ”€â”€ state_machine.py
  1415â†’â”‚   â”‚   â”œâ”€â”€ engine.py
  1416â†’â”‚   â”‚   â”œâ”€â”€ timeout.py
  1417â†’â”‚   â”‚   â”œâ”€â”€ retry.py
  1418â†’â”‚   â”‚   â”œâ”€â”€ exec_context.py
  1419â†’â”‚   â”‚   â””â”€â”€ position_tracker.py
  1420â†’â”‚   â”‚
  1421â†’â”‚   â”œâ”€â”€ protection/                      # Phase 2: 4 files
  1422â†’â”‚   â”‚   â”œâ”€â”€ __init__.py
  1423â†’â”‚   â”‚   â”œâ”€â”€ liquidity.py
  1424â†’â”‚   â”‚   â”œâ”€â”€ fat_finger.py
  1425â†’â”‚   â”‚   â””â”€â”€ throttle.py
  1426â†’â”‚   â”‚
  1427â†’â”‚   â””â”€â”€ pair/                            # Phase 2: 3 files
  1428â†’â”‚       â”œâ”€â”€ __init__.py
  1429â†’â”‚       â”œâ”€â”€ pair_executor.py
  1430â†’â”‚       â””â”€â”€ leg_manager.py
  1431â†’â”‚
  1432â†’â”œâ”€â”€ strategy/
  1433â†’â”‚   â”œâ”€â”€ fallback.py                      # Phase 3: 1 file
  1434â†’â”‚   â”‚
  1435â†’â”‚   â””â”€â”€ calendar_arb/                    # Phase 3: 3 files
  1436â†’â”‚       â”œâ”€â”€ __init__.py
  1437â†’â”‚       â”œâ”€â”€ strategy.py
  1438â†’â”‚       â””â”€â”€ kalman_beta.py
  1439â†’â”‚
  1440â†’â””â”€â”€ replay/
  1441â†’    â””â”€â”€ verifier.py                      # Phase 4: 1 file
  1442â†’```
  1443â†’
  1444â†’---
  1445â†’
  1446â†’## 13. åœºæ™¯çŸ©é˜µæ±‡æ€»
  1447â†’
  1448â†’### 13.1 æŒ‰ Phase ç»Ÿè®¡
  1449â†’
  1450â†’| Phase | A/B è½¨ | åœºæ™¯æ•° | ç´¯è®¡ |
  1451â†’|-------|--------|--------|------|
  1452â†’| Phase 0 | A | 11 | 11 |
  1453â†’| Phase 1 | A | 29 | 40 |
  1454â†’| Phase 2 | A | 25 | 65 |
  1455â†’| Phase 3 | B | 12 | 77 |
  1456â†’| Phase 4 | A | 2 | 79 |
  1457â†’| Phase 6 | B | 22 | 101 |
  1458â†’| **æ€»è®¡** | - | **101** | - |
  1459â†’
  1460â†’### 13.2 æŒ‰æ¨¡å—ç»Ÿè®¡
  1461â†’
  1462â†’| æ¨¡å— | åœºæ™¯æ•° | è¯´æ˜ |
  1463â†’|------|--------|------|
  1464â†’| market | 11 | è¡Œæƒ…å±‚ |
  1465â†’| guardian | 10 | å®ˆæŠ¤å±‚ |
  1466â†’| audit | 8 | å®¡è®¡å±‚ |
  1467â†’| cost | 4 | æˆæœ¬å±‚ |
  1468â†’| execution. fsm | 5 | è®¢å•çŠ¶æ€æœº |
  1469â†’| execution.engine | 7 | è‡ªåŠ¨ä¸‹å•å¼•æ“ |
  1470â†’| execution.protection | 4 | æ‰§è¡Œä¿æŠ¤ |
  1471â†’| execution.position | 4 | æŒä»“è¿½è¸ª |
  1472â†’| execution.pair | 5 | åŒè…¿æ‰§è¡Œ |
  1473â†’| strategy.fallback | 3 | é™çº§æ¡†æ¶ |
  1474â†’| strategy.calendar_arb | 9 | å¥—åˆ©ç­–ç•¥ |
  1475â†’| strategy.simple_ai | 3 | ç®€å•ç­–ç•¥ |
  1476â†’| strategy.linear_ai | 3 | çº¿æ€§ç­–ç•¥ |
  1477â†’| strategy.ensemble_moe | 5 | MoE ç­–ç•¥ |
  1478â†’| strategy.dl_torch | 6 | æ·±åº¦å­¦ä¹ ç­–ç•¥ |
  1479â†’| strategy.top_tier | 5 | é¡¶çº§ç­–ç•¥ |
  1480â†’| replay | 2 | å›æ”¾éªŒè¯ |
  1481â†’| platform_universal | 6 | å¹³å°é€šç”¨ |
  1482â†’| **æ€»è®¡** | **101** | - |
  1483â†’
  1484â†’### 13.3 å®Œæ•´åœºæ™¯åˆ—è¡¨
  1485â†’
  1486â†’```yaml
  1487â†’# A è½¨åœºæ™¯ï¼ˆ67 æ¡ï¼‰
  1488â†’a_platform_scenarios:
  1489â†’  # Phase 0: market (11)
  1490â†’  - INST.CACHE.LOAD
  1491â†’  - INST.CACHE. PERSIST
  1492â†’  - UNIV.DOMINANT.BASIC
  1493â†’  - UNIV.SUBDOMINANT.PAIRING
  1494â†’  - UNIV.ROLL.COOLDOWN
  1495â†’  - UNIV.EXPIRY.GATE
  1496â†’  - MKT.SUBSCRIBER.DIFF_UPDATE
  1497â†’  - MKT.STALE.SOFT
  1498â†’  - MKT.STALE. HARD
  1499â†’  - MKT.CONTINUITY.BARS
  1500â†’  - MKT.QUALITY.OUTLIER
  1501â†’  
  1502â†’  # Phase 1: guardian (10)
  1503â†’  - GUARD.FSM.TRANSITIONS
  1504â†’  - GUARD.DETECT.QUOTE_STALE
  1505â†’  - GUARD.DETECT. ORDER_STUCK
  1506â†’  - GUARD.DETECT. POSITION_DRIFT
  1507â†’  - GUARD.DETECT.LEG_IMBALANCE
  1508â†’  - GUARD.ACTION.SET_MODE
  1509â†’  - GUARD.ACTION.CANCEL_ALL
  1510â†’  - GUARD.ACTION.FLATTEN_ALL
  1511â†’  - GUARD.RECOVERY.COLD_START
  1512â†’  - GUARD.MODE.REDUCE_ONLY_EFFECT
  1513â†’  
  1514â†’  # Phase 1: audit (5)
  1515â†’  - AUDIT.EVENT.STRUCTURE
  1516â†’  - AUDIT.JSONL.FORMAT
  1517â†’  - AUDIT.CORRELATION.RUN_EXEC
  1518â†’  - REPLAY.DETERMINISTIC.DECISION
  1519â†’  - REPLAY.DETERMINISTIC. GUARDIAN
  1520â†’  
  1521â†’  # Phase 1: cost (4)
  1522â†’  - COST.MODEL.FEE_ESTIMATE
  1523â†’  - COST.MODEL.SLIPPAGE_ESTIMATE
  1524â†’  - COST.MODEL. IMPACT_ESTIMATE
  1525â†’  - COST.GATE.EDGE_CHECK
  1526â†’  
  1527â†’  # Phase 1: platform_universal (10)
  1528â†’  - STRAT.AUDIT.DECISION_EVENT_PRESENT
  1529â†’  - STRAT.AUDIT.DECISION_HAS_RUN_ID
  1530â†’  - STRAT.AUDIT.DECISION_HAS_EXEC_ID
  1531â†’  - STRAT.AUDIT.DECISION_HAS_STRATEGY_ID
  1532â†’  - STRAT.AUDIT.DECISION_HAS_VERSION
  1533â†’  - STRAT.AUDIT.DECISION_HAS_FEATURE_HASH
  1534â†’  - STRAT.DEGRADE.REDUCE_ONLY_NO_OPEN
  1535â†’  - STRAT.DEGRADE. HALTED_OUTPUT_ZERO
  1536â†’  - STRAT.DEGRADE.MODE_TRANSITION_AUDIT
  1537â†’  - AUDIT.PNL.ATTRIBUTION
  1538â†’  
  1539â†’  # Phase 2: fsm (5)
  1540â†’  - EXEC.ID.MAPPING
  1541â†’  - FSM.STRICT. TRANSITIONS
  1542â†’  - FSM.TOLERANT.IDEMPOTENT
  1543â†’  - FSM.CANCEL_WHILE_FILL
  1544â†’  - FSM.STATUS_4_MAPPING
  1545â†’  
  1546â†’  # Phase 2: engine (7)
  1547â†’  - EXEC.ENGINE.PIPELINE
  1548â†’  - EXEC.TIMEOUT.ACK
  1549â†’  - EXEC.TIMEOUT. FILL
  1550â†’  - EXEC.CANCEL_REPRICE. TIMEOUT
  1551â†’  - EXEC.PARTIAL. REPRICE
  1552â†’  - EXEC.RETRY.BACKOFF
  1553â†’  - EXEC.CONTEXT.TRACKING
  1554â†’  
  1555â†’  # Phase 2: protection (4)
  1556â†’  - EXEC.PROTECTION.LIQUIDITY
  1557â†’  - EXEC.PROTECTION. FATFINGER
  1558â†’  - EXEC.PROTECTION. THROTTLE
  1559â†’  - EXEC.PROTECTION.AUDIT
  1560â†’  
  1561â†’  # Phase 2: position (4)
  1562â†’  - POS.TRACKER.TRADE_DRIVEN
  1563â†’  - POS.RECONCILE.PERIODIC
  1564â†’  - POS.RECONCILE. AFTER_DISCONNECT
  1565â†’  - POS.RECONCILE. FAIL_ACTION
  1566â†’  
  1567â†’  # Phase 2: pair (5)
  1568â†’  - PAIR.EXECUTOR. ATOMIC
  1569â†’  - PAIR.ROLLBACK.ON_LEG_FAIL
  1570â†’  - PAIR.AUTOHEDGE.DELTA_NEUTRAL
  1571â†’  - PAIR.IMBALANCE.DETECT
  1572â†’  - PAIR.BREAKER.STOP_Z
  1573â†’  
  1574â†’  # Phase 4: replay (2) - å·²åœ¨ audit ä¸­è®¡ç®—
  1575â†’
  1576â†’# B è½¨åœºæ™¯ï¼ˆ34 æ¡ï¼‰
  1577â†’b_models_scenarios:
  1578â†’  # Phase 3: fallback (3)
  1579â†’  - STRAT.FALLBACK.ON_EXCEPTION
  1580â†’  - STRAT.FALLBACK.ON_TIMEOUT
  1581â†’  - STRAT.FALLBACK. CHAIN_DEFINED
  1582â†’  
  1583â†’  # Phase 3: calendar_arb (9)
  1584â†’  - ARB.LEGS.FIXED_NEAR_FAR
  1585â†’  - ARB.KALMAN.BETA_ESTIMATE
  1586â†’  - ARB.KALMAN. RESIDUAL_ZSCORE
  1587â†’  - ARB.KALMAN.BETA_BOUND
  1588â†’  - ARB.SIGNAL.HALF_LIFE_GATE
  1589â†’  - ARB.SIGNAL. STOP_Z_BREAKER
  1590â†’  - ARB.SIGNAL. EXPIRY_GATE
  1591â†’  - ARB.SIGNAL.CORRELATION_BREAK
  1592â†’  - ARB.COST.ENTRY_GATE
  1593â†’  
  1594â†’  # Phase 6: simple_ai (3)
  1595â†’  - SIMPLE.OUTPUT.BOUNDED
  1596â†’  - SIMPLE.INPUT.NEVER_CRASH
  1597â†’  - BASELINE.STABLE. STALE_INPUT
  1598â†’  
  1599â†’  # Phase 6: linear_ai (3)
  1600â†’  - LINEAR.FACTOR.WEIGHT_STABLE
  1601â†’  - LINEAR.FACTOR. EXPOSURE_LIMIT
  1602â†’  - BASELINE.STABLE. STALE_INPUT  # ä¸ simple_ai å…±äº«
  1603â†’  
  1604â†’  # Phase 6: ensemble_moe (5)
  1605â†’  - MOE.OUTPUT. SMOOTHING
  1606â†’  - MOE.EXPERT.CONFLICT_CONTROL
  1607â†’  - MOE.GATING.WEIGHT_VALID
  1608â†’  - MOE.EXPERT.VERSION_AUDIT
  1609â†’  - MOE.REGIME. DETECTION
  1610â†’  
  1611â†’  # Phase 6: dl_torch (6)
  1612â†’  - DL.INFERENCE. FAIL_FALLBACK
  1613â†’  - DL.MODEL.VERSION_AUDIT
  1614â†’  - DL.SEED.DETERMINISTIC
  1615â†’  - DL.INPUT.NORMALIZE
  1616â†’  - DL.OUTPUT.CLAMP
  1617â†’  - DL.MEMORY. CLEANUP
  1618â†’  
  1619â†’  # Phase 6: top_tier (5)
  1620â†’  - TOPTIER.COST.GATE
  1621â†’  - TOPTIER.TURNOVER.LIMIT
  1622â†’  - TOPTIER.JITTER.SUPPRESSION
  1623â†’  - TOPTIER.RISK. PARITY_VALID
  1624â†’  - TOPTIER.TREND.SIGNAL_AUDIT
  1625â†’```
  1626â†’
  1627â†’---
  1628â†’
  1629â†’## 14. å·¥æ—¶ä¸é‡Œç¨‹ç¢‘
  1630â†’
  1631â†’### 14.1 å·¥æ—¶æ±‡æ€»
  1632â†’
  1633â†’| Phase | éª¨æ¶ | | å…¨é‡å®ç° | å»ºè®®æ¨¡å¼ |
  1634â†’|-------|------|----------|----------|----------|
  1635â†’| Phase 0 | 3h | 34h | å…¨é‡å®ç° |
  1636â†’| Phase 1 | 2.5h | 44h | å…¨é‡å®ç° |
  1637â†’| Phase 2 | 2.5h | 80h | å…¨é‡å®ç° |
  1638â†’| Phase 3 | 3h | 36h | å…¨é‡å®ç° |
  1639â†’| Phase 4 | 0.5h |8h | å…¨é‡å®ç° |
  1640â†’| Phase 5 | - | 24h | å…¨é‡å®ç° |
  1641â†’| Phase 6 | - | 36h | å…¨é‡å®ç° |
  1642â†’| **æ€»è®¡** | **144h** | **262h** | - |
  1643â†’
  1644â†’### 14.2 é‡Œç¨‹ç¢‘æ—¶é—´è¡¨
  1645â†’
  1646â†’```text
  1647â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  1648â†’â”‚                          é‡Œç¨‹ç¢‘æ—¶é—´è¡¨                                        â”‚
  1649â†’â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  1650â†’â”‚                                                                             â”‚
  1651â†’â”‚  Week 1 (Day 1-5)                                                          â”‚
  1652â†’â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  1653â†’â”‚  â”‚  D1: éª¨æ¶åˆ›å»ºï¼ˆ42 ä¸ªæ–‡ä»¶ï¼‰                                           â”‚   â”‚
  1654â†’â”‚  â”‚  D2-D3: Phase 0 å…¨é‡å®ç°                                            â”‚   â”‚
  1655â†’â”‚  â”‚  D4-D5: Phase 1 å…¨é‡å®ç°ï¼ˆaudit + costï¼‰                            â”‚   â”‚
  1656â†’â”‚  â”‚  â¬› Milestone 1: market + audit + cost é—¨ç¦é€šè¿‡                      â”‚   â”‚
  1657â†’â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  1658â†’â”‚                                                                             â”‚
  1659â†’â”‚  Week 2 (Day 6-10)                                                         â”‚
  1660â†’â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  1661â†’â”‚  â”‚  D6-D7: Phase 1 å…¨é‡å®ç°ï¼ˆguardianï¼‰                                 â”‚   â”‚
  1662â†’â”‚  â”‚  D8-D10: Phase 2 å…¨é‡å®ç°ï¼ˆauto + protectionï¼‰                       â”‚   â”‚
  1663â†’â”‚  â”‚  â¬› Milestone 2: guardian + execution/auto é—¨ç¦é€šè¿‡                  â”‚   â”‚
  1664â†’â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  1665â†’â”‚                                                                             â”‚
  1666â†’â”‚  Week 3 (Day 11-15)                                                        â”‚
  1667â†’â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  1668â†’â”‚  â”‚  D11-D12: Phase 2 å…¨é‡å®ç°ï¼ˆpairï¼‰                                   â”‚   â”‚
  1669â†’â”‚  â”‚  D13:  Phase 3 å…¨é‡å®ç°ï¼ˆfallbackï¼‰                                   â”‚   â”‚
  1670â†’â”‚  â”‚  D14: Phase 3 å…¨é‡å®ç°ï¼ˆcalendar_arbï¼‰                               â”‚   â”‚
  1671â†’â”‚  â”‚  D15: Phase 4 å…¨é‡å®ç°ï¼ˆverifierï¼‰                                   â”‚   â”‚
  1672â†’â”‚  â”‚  â¬› Milestone 3: å…¨éƒ¨ A è½¨æ¨¡å—é—¨ç¦é€šè¿‡                               â”‚   â”‚
  1673â†’â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  1674â†’â”‚                                                                             â”‚
  1675â†’â”‚  Week 4 (Day 16-20)                                                        â”‚
  1676â†’â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  1677â†’â”‚  â”‚  D16-D18: Phase 5 é›†æˆä¸æ¼”ç»ƒ                                         â”‚   â”‚
  1678â†’â”‚  â”‚  D19-D20: Phase 6 ç­–ç•¥å‡çº§ï¼ˆsimple + linear + moeï¼‰                  â”‚   â”‚
  1679â†’â”‚  â”‚  â¬› Milestone 4: é›†æˆæ¼”ç»ƒé€šè¿‡                                        â”‚   â”‚
  1680â†’â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  1681â†’â”‚                                                                             â”‚
  1682â†’â”‚  Week 5 (Day 21-25)                                                        â”‚
  1683â†’â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  1684â†’â”‚  â”‚  D21-D23: Phase 6 ç­–ç•¥å‡çº§ï¼ˆdl_torch + top_tierï¼‰                    â”‚   â”‚
  1685â†’â”‚  â”‚  D24: æ–‡æ¡£å®Œå–„                                                       â”‚   â”‚
  1686â†’â”‚  â”‚  D25: æœ€ç»ˆéªŒæ”¶                                                       â”‚   â”‚
  1687â†’â”‚  â”‚  â¬› Milestone 5: å…¨éƒ¨ 101 æ¡åœºæ™¯é€šè¿‡                                 â”‚   â”‚
  1688â†’â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  1689â†’â”‚                                                                             â”‚
  1690â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  1691â†’```
  1692â†’
  1693â†’### 14.3 é‡Œç¨‹ç¢‘å®šä¹‰
  1694â†’
  1695â†’| é‡Œç¨‹ç¢‘ | æ—¥æœŸ | äº¤ä»˜ç‰© | éªŒæ”¶æ ‡å‡† |
  1696â†’|--------|------|--------|----------|
  1697â†’| M1 | Day 5 | Phase 0 + 1 éƒ¨åˆ† | 22 æ¡åœºæ™¯é€šè¿‡ |
  1698â†’| M2 | Day 10 | Phase 1 + 2 éƒ¨åˆ† | 50 æ¡åœºæ™¯é€šè¿‡ |
  1699â†’| M3 | Day 15 | Phase 0-4 å…¨éƒ¨ | 79 æ¡åœºæ™¯é€šè¿‡ï¼ˆA è½¨å®Œæˆï¼‰ |
  1700â†’| M4 | Day 20 | Phase 5 | é›†æˆæ¼”ç»ƒé€šè¿‡ |
  1701â†’| M5 | Day 25 | Phase 6 | 101 æ¡åœºæ™¯å…¨éƒ¨é€šè¿‡ |
  1702â†’
  1703â†’---
  1704â†’
  1705â†’## 15. éªŒæ”¶æ£€æŸ¥ç‚¹
  1706â†’
  1707â†’### 15.1 å¯¼å…¥æµ‹è¯•
  1708â†’
  1709â†’| åºå· | å‘½ä»¤ | é¢„æœŸç»“æœ |
  1710â†’|------|------|----------|
  1711â†’| 1 | `python -c "from src.market import InstrumentCache"` | æ— æŠ¥é”™ |
  1712â†’| 2 | `python -c "from src.market import QuoteCache"` | æ— æŠ¥é”™ |
  1713â†’| 3 | `python -c "from src.market import UniverseSelector"` | æ— æŠ¥é”™ |
  1714â†’| 4 | `python -c "from src.audit import AuditWriter"` | æ— æŠ¥é”™ |
  1715â†’| 5 | `python -c "from src.cost import CostEstimator"` | æ— æŠ¥é”™ |
  1716â†’| 6 | `python -c "from src.guardian import GuardianMonitor"` | æ— æŠ¥é”™ |
  1717â†’| 7 | `python -c "from src.execution.auto import AutoOrderEngine"` | æ— æŠ¥é”™ |
  1718â†’| 8 | `python -c "from src.execution.protection import LiquidityGate"` | æ— æŠ¥é”™ |
  1719â†’| 9 | `python -c "from src.execution.pair import PairExecutor"` | æ— æŠ¥é”™ |
  1720â†’| 10 | `python -c "from src.strategy.fallback import FallbackManager"` | æ— æŠ¥é”™ |
  1721â†’| 11 | `python -c "from src.strategy.calendar_arb import CalendarArbStrategy"` | æ— æŠ¥é”™ |
  1722â†’| 12 | `python -c "from src.replay.verifier import ReplayVerifier"` | æ— æŠ¥é”™ |
  1723â†’
  1724â†’### 15.2 é—¨ç¦æ£€æŸ¥
  1725â†’
  1726â†’| åºå· | å‘½ä»¤ | é¢„æœŸç»“æœ | å¤±è´¥é€€å‡ºç  |
  1727â†’|------|------|----------|-----------|
  1728â†’| 1 | `ruff check src/` | All checks passed | 2 |
  1729â†’| 2 | `ruff format --check src/` | All files formatted | 2 |
  1730â†’| 3 | `mypy src/` | No errors | 3 |
  1731â†’| 4 | `pytest tests/ -q` | All tests passed | 4 |
  1732â†’| 5 | `python scripts/coverage_gate.py` | core=100%, overall>=85% | 5 |
  1733â†’| 6 | `python scripts/validate_policy.py --all --strict-scenarios` | PASS | 12 |
  1734â†’| 7 | `.\scripts\make.ps1 replay-json` | PASS | 8 |
  1735â†’| 8 | `.\scripts\make.ps1 sim-json` | PASS | 9 |
  1736â†’
  1737â†’### 15.3 æœ€ç»ˆéªŒæ”¶æ¸…å•
  1738â†’
  1739â†’| æ£€æŸ¥é¡¹ | éªŒè¯æ–¹æ³• | é€šè¿‡æ ‡å‡† |
  1740â†’|--------|----------|----------|
  1741â†’| æ–‡ä»¶å®Œæ•´ | ls ç»Ÿè®¡ | 42 ä¸ªæ–°æ–‡ä»¶ |
  1742â†’| åœºæ™¯å®Œæ•´ | validate_policy | 101 æ¡ PASS |
  1743â†’| è¦†ç›–ç‡è¾¾æ ‡ | coverage_gate | core=100%, overall>=85% |
  1744â†’| CI é€šè¿‡ | make ci-json | exit 0 |
  1745â†’| Replay é€šè¿‡ | make replay-json | exit 0 |
  1746â†’| Sim é€šè¿‡ | make sim-json | exit 0 |
  1747â†’| é”šç‚¹æ›´æ–° | context.md | SHA æ›´æ–° |
  1748â†’| æ–‡æ¡£å®Œæ•´ | äººå·¥æ£€æŸ¥ | æ— é—æ¼ |
  1749â†’
  1750â†’---
  1751â†’
  1752â†’## 16. é£é™©ä¸ç¼“è§£
  1753â†’
  1754â†’### 16.1 é£é™©çŸ©é˜µ
  1755â†’
  1756â†’| é£é™© | å¯èƒ½æ€§ | å½±å“ | é£é™©ç­‰çº§ | ç¼“è§£æªæ–½ |
  1757â†’|------|--------|------|----------|----------|
  1758â†’| åœºæ™¯çŸ©é˜µè¿‡å¤§ï¼ˆ101 æ¡ï¼‰ | é«˜ | é«˜ | ğŸ”´ | Phase åˆ†æ‰¹è§£é”ï¼Œå…ˆç»¿å‰ä¸€æ‰¹å†å¼€ä¸‹ä¸€æ‰¹ |
  1759â†’| ç°æœ‰ live_guard ä¸ guardian å†²çª | ä¸­ | é«˜ | ğŸŸ¡ | guardian å¸æ”¶ live_guard é€»è¾‘ï¼ŒåºŸå¼ƒæ—§æ¨¡å— |
  1760â†’| CTP å›æŠ¥è¯­ä¹‰ä¸æ˜ç¡® | ä¸­ | é«˜ | ğŸŸ¡ | å…ˆç”¨ mock è¦†ç›–æ‰€æœ‰è¾¹ç•Œï¼Œå®ç›˜å‰è”è°ƒ |
  1761â†’| é”šç‚¹æ¼‚ç§» | ä¸­ | ä¸­ | ğŸŸ¡ | æ¯æ¬¡ PR å¿…é¡»æ›´æ–° context.md |
  1762â†’| å·¥æ—¶ä¼°ç®—åå·® | é«˜ | ä¸­ | ğŸŸ¡ | éª¨æ¶ä¼˜å…ˆï¼Œæœ€å°å®ç°äº¤ä»˜ï¼Œè¿­ä»£è¡¥å…¨ |
  1763â†’| ä¾èµ–å†²çª | ä½ | é«˜ | ğŸŸ¡ | ä¸¥æ ¼éµå®ˆä¾èµ–ç¦æ­¢è§„åˆ™ |
  1764â†’| æµ‹è¯•è¦†ç›–ä¸è¶³ | ä¸­ | ä¸­ | ğŸŸ¡ | åœºæ™¯é©±åŠ¨ï¼Œæ¯æ¡åœºæ™¯å¿…é¡»æœ‰æµ‹è¯• |
  1765â†’| é›†æˆé—®é¢˜ | ä¸­ | é«˜ | ğŸŸ¡ | Phase 5 ä¸“é—¨åšé›†æˆæ¼”ç»ƒ |
  1766â†’
  1767â†’### 16.2 ç¼“è§£æªæ–½è¯¦è¿°
  1768â†’
  1769â†’#### åœºæ™¯çŸ©é˜µè¿‡å¤§
  1770â†’
  1771â†’```text
  1772â†’é—®é¢˜ï¼š101 æ¡åœºæ™¯ä¸€æ¬¡æ€§å®ç°ä¸ç°å®
  1773â†’æ–¹æ¡ˆï¼šPhase åˆ†æ‰¹è§£é”
  1774â†’
  1775â†’Phase 0: å…ˆé€šè¿‡ 11 æ¡ market åœºæ™¯
  1776â†’Phase 1: å†é€šè¿‡ 29 æ¡ audit/cost/guardian åœºæ™¯
  1777â†’Phase 2: å†é€šè¿‡ 25 æ¡ execution åœºæ™¯
  1778â†’... 
  1779â†’
  1780â†’æ¯ä¸ª Phase å®Œæˆååšä¸€æ¬¡é—¨ç¦æ£€æŸ¥ï¼Œç¡®ä¿å¢é‡ç¨³å®š
  1781â†’```
  1782â†’
  1783â†’#### live_guard ä¸ guardian å†²çª
  1784â†’
  1785â†’```text
  1786â†’é—®é¢˜ï¼šç°æœ‰ src/trading/live_guard. py ä¸æ–°å»º src/guardian/ åŠŸèƒ½é‡å 
  1787â†’æ–¹æ¡ˆï¼šè¿ç§»é‡æ„
  1788â†’
  1789â†’Step 1: åœ¨ guardian/ å®ç°å®Œæ•´åŠŸèƒ½
  1790â†’Step 2: å°† live_guard. py ä¸­çš„é€»è¾‘è¿ç§»åˆ° guardian/
  1791â†’Step 3: live_guard.py æ”¹ä¸º thin wrapperï¼Œè°ƒç”¨ guardian
  1792â†’Step 4: åºŸå¼ƒ live_guard.pyï¼ˆä¿ç•™ä¸€ä¸ªç‰ˆæœ¬çš„å…¼å®¹ï¼‰
  1793â†’```
  1794â†’
  1795â†’#### CTP å›æŠ¥è¯­ä¹‰ä¸æ˜ç¡®
  1796â†’
  1797â†’```text
  1798â†’é—®é¢˜ï¼šOrderStatus='4' ç­‰è¾¹ç•Œæƒ…å†µè¯­ä¹‰ä¸æ¸…
  1799â†’æ–¹æ¡ˆï¼šMock + å®ç›˜è”è°ƒ
  1800â†’
  1801â†’Step 1: åˆ›å»º MockBrokerï¼Œæ¨¡æ‹Ÿæ‰€æœ‰å¯èƒ½çš„å›æŠ¥åºåˆ—
  1802â†’Step 2: FSM æµ‹è¯•è¦†ç›–æ‰€æœ‰è¾¹ç•Œ
  1803â†’Step 3: å®ç›˜å‰ç”¨ simnow è”è°ƒéªŒè¯
  1804â†’Step 4: ä¿ç•™ tolerant æ¨¡å¼å¤„ç†æœªçŸ¥æƒ…å†µ
  1805â†’```
  1806â†’
  1807â†’---
  1808â†’
  1809â†’## 17. æ¨¡å—è¿ç§»è®¡åˆ’
  1810â†’
  1811â†’### 17.1 è¿ç§»çŸ©é˜µ
  1812â†’
  1813â†’| ç°æœ‰æ¨¡å— | ç›®æ ‡æ¨¡å— | åŠ¨ä½œ | è¯´æ˜ |
  1814â†’|----------|----------|------|------|
  1815â†’| `src/trading/live_guard. py` | `src/guardian/monitor.py` | é‡æ„è¿ç§» | Guardian å¸æ”¶ live_guard åŠŸèƒ½ |
  1816â†’| `src/execution/order_tracker.py` | `src/execution/auto/position_tracker.py` | èåˆ | é¿å…åŒçœŸç›¸ |
  1817â†’| `src/execution/flatten_executor.py` | ä¿ç•™ | ä¸åŠ¨ | ä½œä¸º guardian. flatten_all çš„å®ç° |
  1818â†’| `src/risk/manager.py` | ä¿ç•™ | ä¸åŠ¨ | guardian è°ƒç”¨ risk |
  1819â†’| `src/strategy/*. py` | ä¿ç•™ | å‡çº§ | Phase 6 å¢å¼º |
  1820â†’
  1821â†’### 17.2 è¿ç§»æ­¥éª¤
  1822â†’
  1823â†’#### live_guard â†’ guardian
  1824â†’
  1825â†’```text
  1826â†’Step 1: åˆ†æ live_guard. py ç°æœ‰åŠŸèƒ½
  1827â†’- kill_switch æ£€æµ‹
  1828â†’- flatten è§¦å‘
  1829â†’- çŠ¶æ€ç®¡ç†
  1830â†’
  1831â†’Step 2: åœ¨ guardian/ å®ç°ç­‰ä»·åŠŸèƒ½
  1832â†’- state_machine. py:  FSM
  1833â†’- triggers.py: æ£€æµ‹é€»è¾‘
  1834â†’- actions.py: cancel_all/flatten_all
  1835â†’- monitor. py: ä¸»å¾ªç¯
  1836â†’
  1837â†’Step 3: è¿ç§»è°ƒç”¨æ–¹
  1838â†’- orchestrator.py: æ”¹ä¸ºè°ƒç”¨ GuardianMonitor
  1839â†’- runner.py: åˆå§‹åŒ– Guardian
  1840â†’
  1841â†’Step 4: åºŸå¼ƒ live_guard.py
  1842â†’- æ·»åŠ  deprecation warning
  1843â†’- ä¸‹ä¸ªå¤§ç‰ˆæœ¬åˆ é™¤
  1844â†’```
  1845â†’
  1846â†’#### order_tracker â†’ position_tracker
  1847â†’
  1848â†’```text
  1849â†’Step 1: åˆ†æ order_tracker.py ç°æœ‰åŠŸèƒ½
  1850â†’- è®¢å•çŠ¶æ€è¿½è¸ª
  1851â†’- æŒä»“è®¡ç®—
  1852â†’
  1853â†’Step 2: èŒè´£åˆ†ç¦»
  1854â†’- è®¢å•çŠ¶æ€ â†’ execution/auto/state_machine. py
  1855â†’- æŒä»“è¿½è¸ª â†’ execution/auto/position_tracker. py
  1856â†’
  1857â†’Step 3: è¿ç§»è°ƒç”¨æ–¹
  1858â†’- æ›¿æ¢æ‰€æœ‰ import order_tracker
  1859â†’
  1860â†’Step 4: åºŸå¼ƒ order_tracker.py
  1861â†’- æˆ–ä¿ç•™ä¸º thin wrapper
  1862â†’```
  1863â†’
  1864â†’---
  1865â†’
  1866â†’## 18. é…ç½®è§„èŒƒ
  1867â†’
  1868â†’### 18.1 é…ç½®åˆ†ç±»
  1869â†’
  1870â†’| ç±»åˆ« | å‰ç¼€ | è¯´æ˜ |
  1871â†’|------|------|------|
  1872â†’| è¡Œæƒ… | `MKT_` / `QUOTE_` | è¡Œæƒ…ç›¸å…³é…ç½® |
  1873â†’| æ‰§è¡Œ | `EXEC_` / `AUTO_` | æ‰§è¡Œç›¸å…³é…ç½® |
  1874â†’| ä¿æŠ¤ | `LIQ_` / `FATFINGER_` / `THROTTLE_` | ä¿æŠ¤ç›¸å…³é…ç½® |
  1875â†’| Guardian | `GUARD_` / `REDUCE_ONLY_` | Guardian ç›¸å…³é…ç½® |
  1876â†’| å¯¹è´¦ | `RECONCILE_` | å¯¹è´¦ç›¸å…³é…ç½® |
  1877â†’| å¥—åˆ© | `ARB_` | å¥—åˆ©ç›¸å…³é…ç½® |
  1878â†’
  1879â†’### 18.2 å®Œæ•´é…ç½®æ¸…å•
  1880â†’
  1881â†’```python
  1882â†’# src/config. py æ‰©å±•
  1883â†’
  1884â†’@dataclass(frozen=True)
  1885â†’class MarketConfig:
  1886â†’    """è¡Œæƒ…é…ç½®."""
  1887â†’    QUOTE_STALE_MS: float = 3000. 0
  1888â†’    QUOTE_HARD_STALE_MS: float = 10000.0
  1889â†’    EXPIRY_BLOCK_DAYS: int = 5
  1890â†’    MIN_SWITCH_EDGE:  float = 0.1
  1891â†’    ROLL_COOLDOWN_S: float = 300.0
  1892â†’
  1893â†’
  1894â†’@dataclass(frozen=True)
  1895â†’class ExecutionConfig: 
  1896â†’    """æ‰§è¡Œé…ç½®."""
  1897â†’    AUTO_ORDER_TIMEOUT_ACK_S: float = 5.0
  1898â†’    AUTO_ORDER_TIMEOUT_FILL_S: float = 30.0
  1899â†’    AUTO_ORDER_TIMEOUT_CANCEL_S: float = 10.0
  1900â†’    AUTO_ORDER_MAX_RETRY:  int = 3
  1901â†’    REPRICE_MODE:  str = "to_best"  # to_best | to_best_plus_tick | to_cross
  1902â†’
  1903â†’
  1904â†’@dataclass(frozen=True)
  1905â†’class ProtectionConfig:
  1906â†’    """ä¿æŠ¤é…ç½®."""
  1907â†’    LIQ_MAX_SPREAD_TICKS: int = 5
  1908â†’    LIQ_MIN_BIDASK_VOL: int = 10
  1909â†’    FATFINGER_MAX_QTY: int = 100
  1910â†’    FATFINGER_MAX_NOTIONAL: float = 1000000.0
  1911â†’    FATFINGER_MAX_PRICE_DEV: float = 0.05
  1912â†’    THROTTLE_MAX_ORDERS_PER_MIN: int = 60
  1913â†’    THROTTLE_MAX_ORDERS_PER_MIN_PER_SYMBOL: int = 10
  1914â†’    THROTTLE_MIN_INTERVAL_S: float = 1.0
  1915â†’
  1916â†’
  1917â†’@dataclass(frozen=True)
  1918â†’class GuardianConfig: 
  1919â†’    """Guardian é…ç½®."""
  1920â†’    REDUCE_ONLY_COOLDOWN_S: float = 300.0
  1921â†’    RECONCILE_INTERVAL_S: float = 60.0
  1922â†’    ORDER_STUCK_TIMEOUT_S: float = 120.0
  1923â†’    LEG_IMBALANCE_THRESHOLD:  int = 10
  1924â†’
  1925â†’
  1926â†’@dataclass(frozen=True)
  1927â†’class ArbConfig: 
  1928â†’    """å¥—åˆ©é…ç½®."""
  1929â†’    ARB_ENTRY_Z:  float = 2.5
  1930â†’    ARB_EXIT_Z: float = 0.5
  1931â†’    ARB_STOP_Z: float = 5.0
  1932â†’    ARB_MAX_HALF_LIFE_DAYS: int = 20
  1933â†’    ARB_MIN_CORRELATION: float = 0.7
  1934â†’    ARB_COOLDOWN_AFTER_STOP_S: float = 600.0
  1935â†’```
  1936â†’
  1937â†’---
  1938â†’
  1939â†’## 19. å®¡è®¡äº‹ä»¶è§„èŒƒ
  1940â†’
  1941â†’### 19.1 äº‹ä»¶ç±»å‹æšä¸¾
  1942â†’
  1943â†’```python
  1944â†’class AuditEventType(Enum):
  1945â†’    # å†³ç­–äº‹ä»¶
  1946â†’    DECISION = "decision"
  1947â†’    
  1948â†’    # æ‰§è¡Œäº‹ä»¶
  1949â†’    EXEC_START = "exec_start"
  1950â†’    EXEC_END = "exec_end"
  1951â†’    
  1952â†’    # è®¢å•äº‹ä»¶
  1953â†’    ORDER_CREATED = "order_created"
  1954â†’    ORDER_SUBMITTED = "order_submitted"
  1955â†’    ORDER_ACCEPTED = "order_accepted"
  1956â†’    ORDER_FILLED = "order_filled"
  1957â†’    ORDER_PARTIAL = "order_partial"
  1958â†’    ORDER_CANCELLED = "order_cancelled"
  1959â†’    ORDER_REJECTED = "order_rejected"
  1960â†’    ORDER_TIMEOUT = "order_timeout"
  1961â†’    ORDER_RETRY = "order_retry"
  1962â†’    ORDER_ERROR = "order_error"
  1963â†’    
  1964â†’    # æˆäº¤äº‹ä»¶
  1965â†’    TRADE = "trade"
  1966â†’    
  1967â†’    # æŒä»“äº‹ä»¶
  1968â†’    POSITION_UPDATE = "position_update"
  1969â†’    POSITION_RECONCILE = "position_reconcile"
  1970â†’    POSITION_MISMATCH = "position_mismatch"
  1971â†’    
  1972â†’    # Guardian äº‹ä»¶
  1973â†’    GUARDIAN_MODE_CHANGE = "guardian_mode_change"
  1974â†’    GUARDIAN_TRIGGER = "guardian_trigger"
  1975â†’    GUARDIAN_ACTION = "guardian_action"
  1976â†’    GUARDIAN_RECOVERY = "guardian_recovery"
  1977â†’    
  1978â†’    # ä¿æŠ¤äº‹ä»¶
  1979â†’    PROTECTION_REJECT = "protection_reject"
  1980â†’```
  1981â†’
  1982â†’### 19.2 JSONL æ ¼å¼è§„èŒƒ
  1983â†’
  1984â†’```json
  1985â†’{"ts": 1734220800.123, "event_type": "decision", "run_id": "uuid", "exec_id": "exec_001", "strategy_id": "top_tier", "version": "1.0.0", "feature_hash": "abc123", "target":  {"AO": 1, "SA": -1}}
  1986â†’{"ts": 1734220800.456, "event_type":  "order_created", "run_id": "uuid", "exec_id": "exec_001", "order_local_id": "ord_001", "symbol": "AO2501", "direction": "BUY", "qty": 10, "price": 4500.0}
  1987â†’{"ts": 1734220800.789, "event_type": "order_submitted", "run_id": "uuid", "exec_id":  "exec_001", "order_local_id": "ord_001", "order_ref": "ref_001"}
  1988â†’{"ts": 1734220801.123, "event_type": "order_accepted", "run_id": "uuid", "exec_id": "exec_001", "order_local_id": "ord_001", "order_sys_id": "sys_001", "state_from": "SUBMITTING", "state_to": "PENDING"}
  1989â†’{"ts": 1734220802.456, "event_type": "trade", "run_id": "uuid", "exec_id": "exec_001", "order_local_id": "ord_001", "trade_id": "trade_001", "volume": 5, "price": 4500.0}
  1990â†’{"ts": 1734220803.789, "event_type": "order_filled", "run_id": "uuid", "exec_id":  "exec_001", "order_local_id": "ord_001", "state_from": "PARTIAL_FILLED", "state_to": "FILLED", "filled_qty": 10, "avg_price": 4500.0}
  1991â†’{"ts": 1734220900.000, "event_type": "guardian_mode_change", "run_id":  "uuid", "mode_from": "RUNNING", "mode_to": "REDUCE_ONLY", "trigger": "quote_stale", "details": {"symbol": "AO2501", "stale_ms": 15000}}
  1992â†’```
  1993â†’
  1994â†’### 19.3 æ–‡ä»¶è·¯å¾„è§„èŒƒ
  1995â†’
  1996â†’```text
  1997â†’artifacts/
  1998â†’â””â”€â”€ audit/
  1999â†’    â”œâ”€â”€ 2025-12-15/
  2000â†’    â”‚   â”œâ”€â”€ decision_20251215.jsonl
  2001â†’    â”‚   â”œâ”€â”€ order_20251215.jsonl
  2002â†’    â”‚   â”œâ”€â”€ trade_20251215.jsonl
  2003â†’    â”‚   â””â”€â”€ guardian_20251215.jsonl
  2004â†’    â””â”€â”€ 2025-12-16/
  2005â†’        â””â”€â”€ ... 
  2006â†’```
  2007â†’
  2008â†’---
  2009â†’
  2010â†’## 20. å¤±è´¥æ¨¡å¼ä¸åº”å¯¹è¡¨
  2011â†’
  2012â†’### 20.1 FMEA çŸ©é˜µ
  2013â†’
  2014â†’| ID | å¤±è´¥æ¨¡å¼ | å…¸å‹ç—‡çŠ¶ | ä¸¥é‡åº¦ | å‘ç”Ÿç‡ | æ£€æµ‹ | RPN | é»˜è®¤åŠ¨ä½œ | å®¡è®¡äº‹ä»¶ |
  2015â†’|----|----------|----------|--------|--------|------|-----|----------|----------|
  2016â†’| F01 | è¡Œæƒ…æ–­æµ | quote ts è¿‡æœŸ | é«˜ | ä¸­ | quote_stale | ğŸ”´ | REDUCE_ONLY | guardian_trigger |
  2017â†’| F02 | å¡å• | FSM ä¸æ¨è¿› | é«˜ | ä½ | order_stuck | ğŸŸ¡ | cancel + REDUCE_ONLY | order_timeout |
  2018â†’| F03 | æ’¤å•æ— å“åº” | cancel è¶…æ—¶ | é«˜ | ä½ | cancel_timeout | ğŸ”´ | HALTED | order_error |
  2019â†’| F04 | æŒä»“æ¼‚ç§» | reconcile ä¸ä¸€è‡´ | é«˜ | ä½ | position_drift | ğŸ”´ | HALTED + flatten | position_mismatch |
  2020â†’| F05 | éƒ¨åˆ†æˆäº¤å¡ä½ | partial ä¸å˜ | ä¸­ | ä¸­ | fill_timeout | ğŸŸ¡ | cancel + reprice | order_retry |
  2021â†’| F06 | ä¸»åŠ›é¢‘ç¹åˆ‡æ¢ | dominant æŠ–åŠ¨ | ä¸­ | ä½ | cooldown | ğŸŸ¡ | å†·å´æŠ‘åˆ¶ | - |
  2022â†’| F07 | ä¸´æœŸæœªå¤„ç† | è¿‘åˆ°æœŸä»æŒä»“ | é«˜ | ä½ | expiry_gate | ğŸ”´ | ç¦å¼€ä»“ + å‡ä»“ | guardian_trigger |
  2023â†’| F08 | è£¸è…¿æ•å£ | å•è…¿æˆäº¤ | é«˜ | ä½ | leg_imbalance | ğŸ”´ | auto_hedge | guardian_action |
  2024â†’| F09 | æ¨ç†å¤±è´¥ | DL æ¨¡å‹æŠ¥é”™ | ä¸­ | ä½ | try-catch | ğŸŸ¡ | fallback é™çº§ | decision |
  2025â†’| F10 | æµåŠ¨æ€§ä¸è¶³ | spread è¿‡å¤§ | ä¸­ | ä¸­ | liquidity_gate | ğŸŸ¡ | æ‹’ç»ä¸‹å• | protection_reject |
  2026â†’| F11 | ä¹Œé¾™æŒ‡ | æ•°é‡/ä»·æ ¼å¼‚å¸¸ | é«˜ | ä½ | fat_finger | ğŸ”´ | æ‹’ç»ä¸‹å• | protection_reject |
  2027â†’| F12 | é¢‘ç‡è¿‡é«˜ | è¶…è¿‡é™åˆ¶ | ä¸­ | ä¸­ | throttle | ğŸŸ¡ | æ‹’ç»ä¸‹å• | protection_reject |
  2028â†’
  2029â†’### 20.2 åº”å¯¹åŠ¨ä½œè¯´æ˜
  2030â†’
  2031â†’| åŠ¨ä½œ | è¯´æ˜ | è§¦å‘æ–¹ |
  2032â†’|------|------|--------|
  2033â†’| REDUCE_ONLY | ç¦æ­¢å¼€ä»“ï¼Œä»…å…è®¸å¹³ä»“/å‡ä»“ | Guardian |
  2034â†’| HALTED | åœæ­¢æ‰€æœ‰äº¤æ˜“ï¼Œç­‰å¾…äººå·¥ | Guardian |
  2035â†’| cancel_all | æ’¤é”€æ‰€æœ‰æ´»åŠ¨è®¢å• | Guardian |
  2036â†’| flatten_all | å¹³æ‰æ‰€æœ‰æŒä»“ | Guardian |
  2037â†’| auto_hedge | è‡ªåŠ¨å¯¹å†²è£¸è…¿ | PairExecutor |
  2038â†’| fallback | é™çº§åˆ°å¤‡é€‰ç­–ç•¥ | FallbackManager |
  2039â†’| reprice | é‡æ–°æŠ¥ä»·ï¼ˆè¿½ä»·ï¼‰ | AutoOrderEngine |
  2040â†’
  2041â†’### 20.3 æ¢å¤æ¡ä»¶
  2042â†’
  2043â†’| çŠ¶æ€ | æ¢å¤åˆ° | æ¡ä»¶ |
  2044â†’|------|--------|------|
  2045â†’| REDUCE_ONLY | RUNNING | å†·å´æœŸç»“æŸ + å¥åº·æ£€æŸ¥é€šè¿‡ |
  2046â†’| HALTED | MANUAL | äººå·¥ç¡®è®¤ |
  2047â†’| MANUAL | RUNNING | äººå·¥æ¢å¤æŒ‡ä»¤ |
  2048â†’
  2049â†’---
  2050â†’
  2051â†’## é™„å½• Aï¼šæœ¯è¯­è¡¨
  2052â†’
  2053â†’| æœ¯è¯­ | è¯´æ˜ |
  2054â†’|------|------|
  2055â†’| A-Platform | å¹³å°åŒ–æ¨¡å—ï¼ˆå…¨ç­–ç•¥å…±äº«ï¼‰ |
  2056â†’| B-Models | ç­–ç•¥å…¬å¼æ¨¡å—ï¼ˆæŒ‰ç­–ç•¥ç‹¬ç«‹ï¼‰ |
  2057â†’| Guardian | æ— äººå€¼å®ˆå®ˆæŠ¤ç³»ç»Ÿ |
  2058â†’| FSM | æœ‰é™çŠ¶æ€æœºï¼ˆFinite State Machineï¼‰ |
  2059â†’| REDUCE_ONLY | ä»…å…è®¸å‡ä»“æ¨¡å¼ |
  2060â†’| HALTED | åœæ­¢äº¤æ˜“æ¨¡å¼ |
  2061â†’| stale | è¿‡æœŸï¼ˆè¡Œæƒ…è¶…æ—¶ï¼‰ |
  2062â†’| reconcile | å¯¹è´¦ï¼ˆæœ¬åœ° vs æŸœå°ï¼‰ |
  2063â†’| dominant | ä¸»åŠ›åˆçº¦ |
  2064â†’| subdominant | æ¬¡ä¸»åŠ›åˆçº¦ |
  2065â†’| exec_id | æ‰§è¡Œä¸Šä¸‹æ–‡ IDï¼ˆä¸€æ¬¡è°ƒä»“æ„å›¾ï¼‰ |
  2066â†’| local_id | æœ¬åœ°è®¢å• IDï¼ˆç³»ç»Ÿå†…å”¯ä¸€ï¼‰ |
  2067â†’| order_ref | CTP è®¢å•å¼•ç”¨ |
  2068â†’| order_sys_id | äº¤æ˜“æ‰€ç³»ç»Ÿè®¢å•å· |
  2069â†’
  2070â†’---
  2071â†’
  2072â†’## é™„å½• Bï¼šå‚è€ƒæ–‡æ¡£
  2073â†’
  2074â†’| æ–‡æ¡£ | è¯´æ˜ |
  2075â†’|------|------|
  2076â†’| V2_SPEC_EXPANDED_NOT_RUSHING_LAUNCH_Version2.md | V2 å®Œæ•´è§„æ ¼ |
  2077â†’| v2_required_scenarios.yml | V2 åœºæ™¯çŸ©é˜µ |
  2078â†’| v3pro_required_scenarios.yml | V3PRO åœºæ™¯çŸ©é˜µ |
  2079â†’| v3pro_strategies.yml | ç­–ç•¥é…ç½® |
  2080â†’| artifacts/context/context.md | ä¸Šä¸‹æ–‡é”šç‚¹ |
  2081â†’| scripts/make.ps1 | é—¨ç¦è„šæœ¬ |
  2082â†’| scripts/validate_policy.py | åœºæ™¯éªŒè¯è„šæœ¬ |
  2083â†’| scripts/coverage_gate.py | è¦†ç›–ç‡é—¨ç¦è„šæœ¬ |
  2084â†’
  2085â†’---
  2086â†’
  2087â†’## é™„å½• Cï¼šå˜æ›´æ—¥å¿—
  2088â†’
  2089â†’| ç‰ˆæœ¬ | æ—¥æœŸ | ä½œè€… | å˜æ›´å†…å®¹ |
  2090â†’|------|------|------|----------|
  2091â†’| v1.0 | 2025-12-15 | - | åˆå§‹ç‰ˆæœ¬ |
  2092â†’| v1.1 | 2025-12-15 | Copilot | ä¿®å¤æ ¼å¼ + æ–°å¢ç« èŠ‚ 21-27 |
  2093â†’
  2094â†’---
  2095â†’
  2096â†’<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  2097â†’     ğŸ†• [NEW CHAPTERS] ä»¥ä¸‹ä¸º v1.1 æ–°å¢ç« èŠ‚
  2098â†’     â”œâ”€ ç¬¬21ç« ï¼šå›æ»šç­–ç•¥ï¼ˆå†›è§„ M9 è¦æ±‚ï¼‰
  2099â†’     â”œâ”€ ç¬¬22ç« ï¼šæµ‹è¯•è§„èŒƒï¼ˆæµ‹è¯•æ–‡ä»¶å‘½åè§„èŒƒï¼‰
  2100â†’     â”œâ”€ ç¬¬23ç« ï¼šè„šæœ¬ä¾èµ–éªŒè¯ï¼ˆç¡®è®¤å¼•ç”¨è„šæœ¬å­˜åœ¨ï¼‰
  2101â†’     â”œâ”€ ç¬¬24ç« ï¼šæ‰©å±•æ¨¡å—è§„åˆ’ï¼ˆç¼ºå¤±æ¨¡å—å»ºè®®ï¼‰
  2102â†’     â”œâ”€ ç¬¬25ç« ï¼šæœºå™¨å­¦ä¹  Pipeline è§„åˆ’
  2103â†’     â”œâ”€ ç¬¬26ç« ï¼šé£æ§å¢å¼ºè§„åˆ’
  2104â†’     â””â”€ ç¬¬27ç« ï¼šé«˜é¢‘æ¨¡å—è§„åˆ’
  2105â†’â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  2106â†’
  2107â†’---
  2108â†’
  2109â†’## 21. å›æ»šç­–ç•¥
  2110â†’
  2111â†’<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  2112â†’     ğŸ”´ [REVIEW-NOTE] ç¬¬21ç« å®¡æŸ¥
  2113â†’     â”œâ”€ æ£€æŸ¥ï¼šåŸæ–‡æ¡£ç¼ºå°‘å›æ»šç­–ç•¥ï¼Œè¿åå†›è§„ M9
  2114â†’     â”œâ”€ é£é™©ï¼šPhase å¤±è´¥æ—¶æ— æ³•å¿«é€Ÿæ¢å¤ï¼Œå¯èƒ½å¯¼è‡´ç”Ÿäº§äº‹æ•…
  2115â†’     â”œâ”€ ä¿®æ”¹ï¼šæ–°å¢å®Œæ•´å›æ»šç­–ç•¥ï¼Œæ¯ä¸ª Phase éƒ½æœ‰æ˜ç¡®å›æ»šå‘½ä»¤
  2116â†’     â””â”€ æ€»ç»“ï¼šå›æ»šèƒ½åŠ›æ˜¯å†›è§„çº§å¿…å¤‡
  2117â†’â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  2118â†’
  2119â†’### 21.1 å›æ»šåŸåˆ™
  2120â†’
  2121â†’| åŸåˆ™ | è¯´æ˜ |
  2122â†’|------|------|
  2123â†’| **ç«‹å³å¯ç”¨** | å›æ»šå‘½ä»¤å¿…é¡»åœ¨ 30 ç§’å†…å®Œæˆ |
  2124â†’| **ç‰ˆæœ¬å¯è¿½æº¯** | æ¯æ¬¡å›æ»šå¿…é¡»è®°å½•åˆ° audit |
  2125â†’| **æœ€å°å½±å“** | åªå›æ»šå¿…è¦çš„ç»„ä»¶ï¼Œä¸å½±å“å·²ç¨³å®šæ¨¡å— |
  2126â†’| **éªŒè¯å¿…é¡»** | å›æ»šåå¿…é¡»æ‰§è¡Œé—¨ç¦éªŒè¯ |
  2127â†’
  2128â†’### 21.2 Phase å›æ»šå‘½ä»¤
  2129â†’
  2130â†’| Phase | å›æ»šè§¦å‘æ¡ä»¶ | å›æ»šå‘½ä»¤ | éªŒè¯å‘½ä»¤ |
  2131â†’|-------|-------------|----------|----------|
  2132â†’| Phase 0 | market æ¨¡å—é—¨ç¦å¤±è´¥ | `git checkout HEAD~1 -- src/market/` | `python -c "from src.market import *"` |
  2133â†’| Phase 1 | audit/cost/guardian é—¨ç¦å¤±è´¥ | `git checkout HEAD~1 -- src/audit/ src/cost/ src/guardian/` | `.\scripts\make.ps1 ci-json` |
  2134â†’| Phase 2 | execution æ¨¡å—é—¨ç¦å¤±è´¥ | `git checkout HEAD~1 -- src/execution/auto/ src/execution/protection/ src/execution/pair/` | `.\scripts\make.ps1 replay-json` |
  2135â†’| Phase 3 | strategy æ¨¡å—é—¨ç¦å¤±è´¥ | `git checkout HEAD~1 -- src/strategy/fallback.py src/strategy/calendar_arb/` | `python .\scripts\validate_policy.py --strict-scenarios` |
  2136â†’| Phase 4 | verifier é—¨ç¦å¤±è´¥ | `git checkout HEAD~1 -- src/replay/verifier.py` | `.\scripts\make.ps1 replay-json` |
  2137â†’| Phase 5 | é›†æˆæµ‹è¯•å¤±è´¥ | `git reset --hard <M4_COMMIT_SHA>` | å®Œæ•´é—¨ç¦ |
  2138â†’| Phase 6 | ç­–ç•¥å‡çº§å¤±è´¥ | `git checkout HEAD~1 -- src/strategy/` | `python .\scripts\validate_policy.py --all` |
  2139â†’
  2140â†’### 21.3 ç´§æ€¥å›æ»šæµç¨‹
  2141â†’
  2142â†’```powershell
  2143â†’# ğŸ”´ ç´§æ€¥å›æ»šè„šæœ¬æ¨¡æ¿
  2144â†’# Step 1: åœæ­¢æ‰€æœ‰æœåŠ¡
  2145â†’Stop-Process -Name python -Force -ErrorAction SilentlyContinue
  2146â†’
  2147â†’# Step 2: è®°å½•å½“å‰çŠ¶æ€
  2148â†’git log -1 --format="%H %s" > artifacts/rollback_$(Get-Date -Format "yyyyMMdd_HHmmss").log
  2149â†’
  2150â†’# Step 3: å›æ»šåˆ°å®‰å…¨ç‚¹
  2151â†’git reset --hard <SAFE_COMMIT_SHA>
  2152â†’
  2153â†’# Step 4: éªŒè¯
  2154â†’.\scripts\make.ps1 ci-json
  2155â†’if ($LASTEXITCODE -ne 0) { throw "Rollback verification failed!" }
  2156â†’
  2157â†’# Step 5: è®°å½•å›æ»šäº‹ä»¶
  2158â†’Write-Host "ROLLBACK COMPLETE at $(Get-Date)"
  2159â†’```
  2160â†’
  2161â†’### 21.4 å›æ»šæ£€æŸ¥æ¸…å•
  2162â†’
  2163â†’- [ ] ç¡®è®¤å½“å‰ commit SHA
  2164â†’- [ ] ç¡®è®¤å›æ»šç›®æ ‡ commit SHA
  2165â†’- [ ] æ‰§è¡Œå›æ»šå‘½ä»¤
  2166â†’- [ ] éªŒè¯é—¨ç¦é€šè¿‡
  2167â†’- [ ] æ›´æ–° context.md é”šç‚¹
  2168â†’- [ ] é€šçŸ¥ç›¸å…³äººå‘˜
  2169â†’
  2170â†’---
  2171â†’
  2172â†’## 22. æµ‹è¯•è§„èŒƒ
  2173â†’
  2174â†’<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  2175â†’     ğŸ”´ [REVIEW-NOTE] ç¬¬22ç« å®¡æŸ¥
  2176â†’     â”œâ”€ æ£€æŸ¥ï¼šåŸæ–‡æ¡£ç¼ºå°‘æµ‹è¯•æ–‡ä»¶å‘½åè§„èŒƒ
  2177â†’     â”œâ”€ é£é™©ï¼šæµ‹è¯•æ–‡ä»¶å‘½åæ··ä¹±ï¼Œéš¾ä»¥ç»´æŠ¤å’Œå®šä½
  2178â†’     â”œâ”€ ä¿®æ”¹ï¼šæ–°å¢å®Œæ•´æµ‹è¯•è§„èŒƒï¼ŒåŒ…æ‹¬å‘½åã€ç»“æ„ã€åˆ†ç±»
  2179â†’     â””â”€ æ€»ç»“ï¼šæµ‹è¯•è§„èŒƒæ˜¯ä»£ç è´¨é‡çš„åŸºç¡€
  2180â†’â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  2181â†’
  2182â†’### 22.1 æµ‹è¯•ç›®å½•ç»“æ„
  2183â†’
  2184â†’<!-- ğŸ“ å½“å‰å®é™…ç»“æ„ï¼šæ‰€æœ‰æµ‹è¯•æ–‡ä»¶ä½äº tests/ æ ¹ç›®å½•
  2185â†’     æœªæ¥è§„åˆ’ï¼šè¿ç§»åˆ°ä¸‹æ–¹åˆ†å±‚ç»“æ„ -->
  2186â†’
  2187â†’**å½“å‰å®é™…ç»“æ„** (2025-12-16):
  2188â†’```text
  2189â†’tests/
  2190â†’â”œâ”€â”€ test_*.py                       # æ‰€æœ‰æµ‹è¯•æ–‡ä»¶ï¼ˆ765 testsï¼‰
  2191â†’â”œâ”€â”€ conftest.py                     # pytest é…ç½®
  2192â†’â””â”€â”€ fixtures/                       # æµ‹è¯•æ•°æ®
  2193â†’```
  2194â†’
  2195â†’**ç›®æ ‡ç»“æ„** (è§„åˆ’ä¸­):
  2196â†’
  2197â†’```text
  2198â†’tests/
  2199â†’â”œâ”€â”€ unit/                           # å•å…ƒæµ‹è¯•ï¼ˆå¿«é€Ÿï¼Œä¸ä¾èµ–å¤–éƒ¨æœåŠ¡ï¼‰
  2200â†’â”‚   â”œâ”€â”€ market/
  2201â†’â”‚   â”‚   â”œâ”€â”€ test_instrument_cache.py
  2202â†’â”‚   â”‚   â”œâ”€â”€ test_universe_selector.py
  2203â†’â”‚   â”‚   â””â”€â”€ test_quote_cache.py
  2204â†’â”‚   â”œâ”€â”€ audit/
  2205â†’â”‚   â”‚   â”œâ”€â”€ test_writer.py
  2206â†’â”‚   â”‚   â””â”€â”€ test_decision_log.py
  2207â†’â”‚   â”œâ”€â”€ guardian/
  2208â†’â”‚   â”‚   â”œâ”€â”€ test_state_machine.py
  2209â†’â”‚   â”‚   â””â”€â”€ test_triggers.py
  2210â†’â”‚   â”œâ”€â”€ execution/
  2211â†’â”‚   â”‚   â”œâ”€â”€ test_order_fsm.py
  2212â†’â”‚   â”‚   â””â”€â”€ test_position_tracker.py
  2213â†’â”‚   â””â”€â”€ strategy/
  2214â†’â”‚       â”œâ”€â”€ test_fallback.py
  2215â†’â”‚       â””â”€â”€ test_calendar_arb.py
  2216â†’â”‚
  2217â†’â”œâ”€â”€ integration/                    # é›†æˆæµ‹è¯•ï¼ˆéœ€è¦ mock æœåŠ¡ï¼‰
  2218â†’â”‚   â”œâ”€â”€ test_e2e_replay.py
  2219â†’â”‚   â”œâ”€â”€ test_fault_injection.py
  2220â†’â”‚   â””â”€â”€ test_cold_start.py
  2221â†’â”‚
  2222â†’â”œâ”€â”€ e2e/                            # ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆå®Œæ•´ç¯å¢ƒï¼‰
  2223â†’â”‚   â””â”€â”€ test_live_trading.py
  2224â†’â”‚
  2225â†’â”œâ”€â”€ fixtures/                       # æµ‹è¯•æ•°æ®
  2226â†’â”‚   â”œâ”€â”€ tick_sample.jsonl
  2227â†’â”‚   â”œâ”€â”€ instrument_cache.json
  2228â†’â”‚   â””â”€â”€ mock_orders.json
  2229â†’â”‚
  2230â†’â””â”€â”€ conftest.py                     # pytest é…ç½®
  2231â†’```
  2232â†’
  2233â†’### 22.2 æµ‹è¯•æ–‡ä»¶å‘½åè§„èŒƒ
  2234â†’
  2235â†’| ç±»å‹ | å‘½åæ ¼å¼ | ç¤ºä¾‹ |
  2236â†’|------|----------|------|
  2237â†’| å•å…ƒæµ‹è¯• | `test_<module_name>.py` | `test_instrument_cache.py` |
  2238â†’| é›†æˆæµ‹è¯• | `test_<scenario>.py` | `test_e2e_replay.py` |
  2239â†’| åœºæ™¯æµ‹è¯• | `test_<rule_id>.py` | `test_guard_fsm_transitions.py` |
  2240â†’| æ€§èƒ½æµ‹è¯• | `bench_<module>.py` | `bench_quote_cache.py` |
  2241â†’
  2242â†’### 22.3 æµ‹è¯•å‡½æ•°å‘½åè§„èŒƒ
  2243â†’
  2244â†’```python
  2245â†’# æ ¼å¼: test_<action>_<condition>_<expected_result>
  2246â†’
  2247â†’def test_load_from_file_valid_json_returns_instruments():
  2248â†’    """åŠ è½½æœ‰æ•ˆ JSON åº”è¿”å›åˆçº¦ä¿¡æ¯"""
  2249â†’    pass
  2250â†’
  2251â†’def test_load_from_file_invalid_json_raises_error():
  2252â†’    """åŠ è½½æ— æ•ˆ JSON åº”æŠ›å‡ºå¼‚å¸¸"""
  2253â†’    pass
  2254â†’
  2255â†’def test_is_stale_expired_quote_returns_true():
  2256â†’    """è¿‡æœŸè¡Œæƒ…åº”è¿”å› stale=True"""
  2257â†’    pass
  2258â†’```
  2259â†’
  2260â†’### 22.4 æµ‹è¯•æ ‡è®°ï¼ˆpytest markersï¼‰
  2261â†’
  2262â†’```python
  2263â†’# conftest.py
  2264â†’import pytest
  2265â†’
  2266â†’def pytest_configure(config):
  2267â†’    config.addinivalue_line("markers", "unit: å•å…ƒæµ‹è¯•")
  2268â†’    config.addinivalue_line("markers", "integration: é›†æˆæµ‹è¯•")
  2269â†’    config.addinivalue_line("markers", "e2e: ç«¯åˆ°ç«¯æµ‹è¯•")
  2270â†’    config.addinivalue_line("markers", "slow: æ…¢é€Ÿæµ‹è¯•ï¼ˆ>5sï¼‰")
  2271â†’    config.addinivalue_line("markers", "scenario: åœºæ™¯é©±åŠ¨æµ‹è¯•")
  2272â†’```
  2273â†’
  2274â†’### 22.5 æµ‹è¯•è¦†ç›–ç‡è¦æ±‚
  2275â†’
  2276â†’| æ¨¡å—ç±»å‹ | è¡Œè¦†ç›–ç‡ | åˆ†æ”¯è¦†ç›–ç‡ | è¯´æ˜ |
  2277â†’|----------|----------|------------|------|
  2278â†’| æ ¸å¿ƒæ¨¡å—ï¼ˆguardian/execution/auditï¼‰ | 100% | 100% | é›¶å®¹å¿ |
  2279â†’| ç­–ç•¥æ¨¡å—ï¼ˆstrategy/*ï¼‰ | 90% | 85% | é«˜è¦æ±‚ |
  2280â†’| å·¥å…·æ¨¡å—ï¼ˆutils/*ï¼‰ | 80% | 70% | æ ‡å‡† |
  2281â†’| æµ‹è¯•è¾…åŠ©ï¼ˆfixtures/*ï¼‰ | ä¸è¦æ±‚ | ä¸è¦æ±‚ | è±å… |
  2282â†’
  2283â†’---
  2284â†’
  2285â†’## 23. è„šæœ¬ä¾èµ–éªŒè¯
  2286â†’
  2287â†’<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  2288â†’     ğŸ”´ [REVIEW-NOTE] ç¬¬23ç« å®¡æŸ¥
  2289â†’     â”œâ”€ æ£€æŸ¥ï¼šæ–‡æ¡£å¼•ç”¨çš„è„šæœ¬éœ€ç¡®è®¤å­˜åœ¨ï¼Œè¿åå†›è§„ M10
  2290â†’     â”œâ”€ é£é™©ï¼šå¼•ç”¨ä¸å­˜åœ¨çš„è„šæœ¬ä¼šå¯¼è‡´é—¨ç¦å¤±è´¥
  2291â†’     â”œâ”€ ä¿®æ”¹ï¼šåˆ—å‡ºæ‰€æœ‰å¼•ç”¨è„šæœ¬ï¼Œæ ‡æ³¨å­˜åœ¨çŠ¶æ€ï¼Œåˆ›å»ºå¾…åŠ
  2292â†’     â””â”€ æ€»ç»“ï¼šè„šæœ¬ä¾èµ–å¿…é¡»åœ¨æ‰§è¡Œå‰éªŒè¯
  2293â†’â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  2294â†’
  2295â†’### 23.1 è„šæœ¬ä¾èµ–çŸ©é˜µ
  2296â†’
  2297â†’| è„šæœ¬è·¯å¾„ | çŠ¶æ€ | å¼•ç”¨ä½ç½® | å¤‡æ³¨ |
  2298â†’|----------|------|----------|------|
  2299â†’| `scripts/make.ps1` | âœ… å­˜åœ¨ | 1.2 é—¨ç¦å®šä¹‰ | å·²éªŒè¯ |
  2300â†’| `scripts/validate_policy.py` | âœ… å­˜åœ¨ | 1.2 é—¨ç¦å®šä¹‰ | å·²éªŒè¯ |
  2301â†’| `scripts/coverage_gate.py` | âœ… å­˜åœ¨ | 1.2 é—¨ç¦å®šä¹‰ | å·²éªŒè¯ |
  2302â†’| `scripts/sim_gate.py` | âœ… å­˜åœ¨ | 1.2 é—¨ç¦å®šä¹‰ | 2025-12-16 åˆ›å»º |
  2303â†’| `scripts/replay_tick.py` | âœ… å­˜åœ¨ | å›æ”¾ç›¸å…³ | å·²éªŒè¯ |
  2304â†’| `scripts/export_context.py` | âœ… å­˜åœ¨ | ä¸Šä¸‹æ–‡å¯¼å‡º | å·²éªŒè¯ |
  2305â†’| `scripts/claude_loop.ps1` | âœ… å­˜åœ¨ | è‡ªåŠ¨åŒ– | å·²éªŒè¯ |
  2306â†’
  2307â†’### 23.2 å¾…åˆ›å»ºè„šæœ¬æ¸…å•
  2308â†’
  2309â†’<!-- âœ… [COMPLETE] ä»¥ä¸‹è„šæœ¬å·²å…¨éƒ¨åˆ›å»ºå®Œæˆ -->
  2310â†’
  2311â†’| è„šæœ¬ | åˆ›å»ºæ—¶æœº | åŠŸèƒ½æè¿° | çŠ¶æ€ |
  2312â†’|------|----------|----------|--------|
  2313â†’| `scripts/sim_gate.py` | Phase 5 ä¹‹å‰ | æ¨¡æ‹Ÿé—¨ç¦éªŒè¯è„šæœ¬ | âœ… å·²åˆ›å»º 2025-12-16 |
  2314â†’
  2315â†’### 23.3 sim_gate.py è§„æ ¼
  2316â†’
  2317â†’```python
  2318â†’# scripts/sim_gate.py - å¾…åˆ›å»º
  2319â†’"""
  2320â†’æ¨¡æ‹Ÿé—¨ç¦è„šæœ¬
  2321â†’
  2322â†’åŠŸèƒ½:
  2323â†’1. éªŒè¯ sim-json äº§ç‰©å­˜åœ¨
  2324â†’2. æ£€æŸ¥æ¨¡æ‹Ÿç»“æœä¸é¢„æœŸä¸€è‡´
  2325â†’3. éªŒè¯æ— å¼‚å¸¸äº¤æ˜“è¡Œä¸º
  2326â†’
  2327â†’ç”¨æ³•:
  2328â†’    python scripts/sim_gate.py --strict
  2329â†’
  2330â†’é€€å‡ºç :
  2331â†’    0  - é€šè¿‡
  2332â†’    9  - æ¨¡æ‹Ÿå¤±è´¥
  2333â†’    12 - ç­–ç•¥è¿è§„
  2334â†’"""
  2335â†’```
  2336â†’
  2337â†’### 23.4 è„šæœ¬éªŒè¯å‘½ä»¤
  2338â†’
  2339â†’```powershell
  2340â†’# æ‰§è¡Œå‰å¿…é¡»è¿è¡Œæ­¤éªŒè¯
  2341â†’$requiredScripts = @(
  2342â†’    "scripts/make.ps1",
  2343â†’    "scripts/validate_policy.py",
  2344â†’    "scripts/coverage_gate.py",
  2345â†’    "scripts/sim_gate.py"
  2346â†’)
  2347â†’
  2348â†’foreach ($script in $requiredScripts) {
  2349â†’    if (-not (Test-Path $script)) {
  2350â†’        Write-Error "MISSING: $script"
  2351â†’        exit 10
  2352â†’    }
  2353â†’}
  2354â†’Write-Host "All required scripts exist"
  2355â†’```
  2356â†’
  2357â†’---
  2358â†’
  2359â†’## 24. æ‰©å±•æ¨¡å—è§„åˆ’
  2360â†’
  2361â†’<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  2362â†’     ğŸ”´ [REVIEW-NOTE] ç¬¬24ç« å®¡æŸ¥
  2363â†’     â”œâ”€ æ£€æŸ¥ï¼šåŸæ–‡æ¡£ç¼ºå°‘æ‰©å±•æ¨¡å—è§„åˆ’
  2364â†’     â”œâ”€ é£é™©ï¼šæœªæ¥æ‰©å±•æ–¹å‘ä¸æ˜ç¡®ï¼Œå¯èƒ½å¯¼è‡´æ¶æ„ä¸å…¼å®¹
  2365â†’     â”œâ”€ ä¿®æ”¹ï¼šæ–°å¢æ‰©å±•æ¨¡å—è§„åˆ’ï¼Œæ˜ç¡®æœªæ¥æ–¹å‘
  2366â†’     â”œâ”€ å‡çº§å»ºè®®ï¼šä»¥ä¸‹æ¨¡å—å»ºè®®åœ¨ V4 ç‰ˆæœ¬å®ç°
  2367â†’     â””â”€ æ€»ç»“ï¼šæå‰è§„åˆ’æœ‰åŠ©äºæ¶æ„æ‰©å±•æ€§
  2368â†’â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  2369â†’
  2370â†’### 24.1 å»ºè®®æ–°å¢æ¨¡å—ï¼ˆP1 ä¼˜å…ˆçº§ï¼‰
  2371â†’
  2372â†’| æ¨¡å— | ç›®å½• | åŠŸèƒ½ | åœºæ™¯æ•° | ä¾èµ– | å·¥æ—¶ |
  2373â†’|------|------|------|--------|------|------|
  2374â†’| Portfolio | `src/portfolio/` | ç»„åˆç®¡ç†ã€æƒé‡åˆ†é…ã€å†å¹³è¡¡ | 6 | Phase 2 | 16h |
  2375â†’| Monitoring | `src/monitoring/` | å®æ—¶ç›‘æ§ã€Prometheus metrics | 4 | Phase 1 | 12h |
  2376â†’| Notification | `src/notification/` | å¤šæ¸ é“å‘Šè­¦ï¼ˆå¾®ä¿¡/é‚®ä»¶/çŸ­ä¿¡ï¼‰ | 3 | Phase 1 | 8h |
  2377â†’
  2378â†’### 24.2 å»ºè®®æ–°å¢æ¨¡å—ï¼ˆP2 ä¼˜å…ˆçº§ï¼‰
  2379â†’
  2380â†’| æ¨¡å— | ç›®å½• | åŠŸèƒ½ | åœºæ™¯æ•° | ä¾èµ– | å·¥æ—¶ |
  2381â†’|------|------|------|--------|------|------|
  2382â†’| DepthCache | `src/market/depth_cache.py` | L2 æ·±åº¦è¡Œæƒ…ç¼“å­˜ | 4 | Phase 0 | 8h |
  2383â†’| SmartOrder | `src/execution/smart_order/` | TWAP/VWAP/å†°å±±å• | 8 | Phase 2 | 24h |
  2384â†’| Signals | `src/signals/` | ä¿¡å·èšåˆå±‚ï¼ˆå¤šç­–ç•¥èåˆï¼‰ | 5 | Phase 3 | 16h |
  2385â†’
  2386â†’### 24.3 å»ºè®®æ–°å¢ç­–ç•¥ï¼ˆP2 ä¼˜å…ˆçº§ï¼‰
  2387â†’
  2388â†’| ç­–ç•¥ | ç›®å½• | ç±»å‹ | åœºæ™¯æ•° | å·¥æ—¶ |
  2389â†’|------|------|------|--------|------|
  2390â†’| Momentum | `src/strategy/momentum/` | åŠ¨é‡è¶‹åŠ¿è·Ÿè¸ª | 5 | 20h |
  2391â†’| MeanReversion | `src/strategy/mean_reversion/` | å‡å€¼å›å½’ | 4 | 16h |
  2392â†’| Grid | `src/strategy/grid/` | ç½‘æ ¼äº¤æ˜“ | 3 | 12h |
  2393â†’| CrossExchange | `src/strategy/arbitrage/cross_exchange/` | è·¨æ‰€å¥—åˆ© | 4 | 20h |
  2394â†’
  2395â†’### 24.4 Portfolio æ¨¡å—è§„æ ¼
  2396â†’
  2397â†’```python
  2398â†’# src/portfolio/__init__.py
  2399â†’"""
  2400â†’ç»„åˆç®¡ç†æ¨¡å—
  2401â†’
  2402â†’ç±»:
  2403â†’- PortfolioManager: ç»„åˆæƒé‡ç®¡ç†
  2404â†’- Rebalancer: å†å¹³è¡¡å¼•æ“
  2405â†’- RiskBudgeter: é£é™©é¢„ç®—åˆ†é…
  2406â†’
  2407â†’Required Scenarios:
  2408â†’- PORTFOLIO.WEIGHT.VALID: æƒé‡å’Œä¸º1
  2409â†’- PORTFOLIO.REBALANCE.TRIGGER: å†å¹³è¡¡è§¦å‘æ¡ä»¶
  2410â†’- PORTFOLIO.RISK.BUDGET: é£é™©é¢„ç®—åˆ†é…
  2411â†’"""
  2412â†’```
  2413â†’
  2414â†’### 24.5 Monitoring æ¨¡å—è§„æ ¼
  2415â†’
  2416â†’```python
  2417â†’# src/monitoring/__init__.py
  2418â†’"""
  2419â†’å®æ—¶ç›‘æ§æ¨¡å—
  2420â†’
  2421â†’åŠŸèƒ½:
  2422â†’- Prometheus metrics å¯¼å‡º
  2423â†’- å¥åº·æ£€æŸ¥ç«¯ç‚¹
  2424â†’- æ€§èƒ½æŒ‡æ ‡é‡‡é›†
  2425â†’
  2426â†’Required Scenarios:
  2427â†’- MONITOR.METRICS.EXPORT: æŒ‡æ ‡å¯¼å‡º
  2428â†’- MONITOR.HEALTH.CHECK: å¥åº·æ£€æŸ¥
  2429â†’- MONITOR.LATENCY.TRACK: å»¶è¿Ÿè¿½è¸ª
  2430â†’"""
  2431â†’```
  2432â†’
  2433â†’---
  2434â†’
  2435â†’## 25. æœºå™¨å­¦ä¹  Pipeline è§„åˆ’
  2436â†’
  2437â†’<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  2438â†’     ğŸ”´ [REVIEW-NOTE] ç¬¬25ç« å®¡æŸ¥
  2439â†’     â”œâ”€ æ£€æŸ¥ï¼šdl_torch ç­–ç•¥éœ€è¦å®Œæ•´ ML Pipeline æ”¯æŒ
  2440â†’     â”œâ”€ é£é™©ï¼šæ¨¡å‹ç‰ˆæœ¬ç®¡ç†æ··ä¹±ï¼Œæ¨ç†ä¸å¯å¤ç°
  2441â†’     â”œâ”€ ä¿®æ”¹ï¼šæ–°å¢ ML Pipeline è§„åˆ’
  2442â†’     â”œâ”€ å‡çº§å»ºè®®ï¼šå»ºè®®åœ¨ Phase 6 ä¹‹åå®ç°
  2443â†’     â””â”€ æ€»ç»“ï¼šML æ¨¡å‹éœ€è¦ä¸¥æ ¼çš„ç‰ˆæœ¬å’Œæ¨ç†ç®¡ç†
  2444â†’â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  2445â†’
  2446â†’### 25.1 ML Pipeline æ¶æ„
  2447â†’
  2448â†’```text
  2449â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  2450â†’â”‚                     ML Pipeline æ¶æ„                            â”‚
  2451â†’â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  2452â†’â”‚                                                                 â”‚
  2453â†’â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
  2454â†’â”‚   â”‚ Feature     â”‚ -> â”‚ Model       â”‚ -> â”‚ Online      â”‚        â”‚
  2455â†’â”‚   â”‚ Store       â”‚    â”‚ Registry    â”‚    â”‚ Inference   â”‚        â”‚
  2456â†’â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
  2457â†’â”‚         â”‚                  â”‚                  â”‚                 â”‚
  2458â†’â”‚         â–¼                  â–¼                  â–¼                 â”‚
  2459â†’â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
  2460â†’â”‚   â”‚ ç‰¹å¾è®¡ç®—    â”‚    â”‚ æ¨¡å‹ç‰ˆæœ¬    â”‚    â”‚ æ¨ç†æœåŠ¡    â”‚        â”‚
  2461â†’â”‚   â”‚ ç‰¹å¾ç¼“å­˜    â”‚    â”‚ A/B æµ‹è¯•    â”‚    â”‚ é™çº§å¤„ç†    â”‚        â”‚
  2462â†’â”‚   â”‚ ç‰¹å¾æ ¡éªŒ    â”‚    â”‚ å›æ»šèƒ½åŠ›    â”‚    â”‚ å»¶è¿Ÿç›‘æ§    â”‚        â”‚
  2463â†’â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
  2464â†’â”‚                                                                 â”‚
  2465â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  2466â†’```
  2467â†’
  2468â†’### 25.2 æ¨¡å—è§„åˆ’
  2469â†’
  2470â†’| æ¨¡å— | ç›®å½• | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
  2471â†’|------|------|------|--------|
  2472â†’| FeatureStore | `src/ml_pipeline/feature_store.py` | ç‰¹å¾å­˜å‚¨å’Œè®¡ç®— | P1 |
  2473â†’| ModelRegistry | `src/ml_pipeline/model_registry.py` | æ¨¡å‹ç‰ˆæœ¬ç®¡ç† | P1 |
  2474â†’| OnlineInference | `src/ml_pipeline/online_inference.py` | åœ¨çº¿æ¨ç†æœåŠ¡ | P1 |
  2475â†’| ABTesting | `src/ml_pipeline/ab_testing.py` | A/B æµ‹è¯•æ¡†æ¶ | P2 |
  2476â†’
  2477â†’### 25.3 Required Scenarios
  2478â†’
  2479â†’| rule_id | æè¿° | category |
  2480â†’|---------|------|----------|
  2481â†’| `ML.FEATURE.CACHE_HIT` | ç‰¹å¾ç¼“å­˜å‘½ä¸­ | unit |
  2482â†’| `ML.FEATURE.VALIDATE` | ç‰¹å¾æ ¡éªŒé€šè¿‡ | unit |
  2483â†’| `ML.MODEL.VERSION_LOAD` | æ¨¡å‹ç‰ˆæœ¬åŠ è½½ | unit |
  2484â†’| `ML.MODEL.ROLLBACK` | æ¨¡å‹å›æ»šèƒ½åŠ› | unit |
  2485â†’| `ML.INFERENCE.TIMEOUT` | æ¨ç†è¶…æ—¶é™çº§ | unit |
  2486â†’| `ML.INFERENCE.DETERMINISTIC` | æ¨ç†ç¡®å®šæ€§ï¼ˆseedï¼‰ | unit |
  2487â†’
  2488â†’### 25.4 æ¨¡å‹ç‰ˆæœ¬è§„èŒƒ
  2489â†’
  2490â†’```yaml
  2491â†’# models/model_manifest.yml
  2492â†’models:
  2493â†’  dl_torch_v1:
  2494â†’    version: "1.0.0"
  2495â†’    framework: "pytorch"
  2496â†’    input_schema: "features_v1"
  2497â†’    output_schema: "signal_v1"
  2498â†’    sha256: "abc123..."
  2499â†’    created_at: "2025-12-15T00:00:00Z"
  2500â†’    metrics:
  2501â†’      sharpe: 1.8
  2502â†’      max_drawdown: 0.12
  2503â†’```
  2504â†’
  2505â†’---
  2506â†’
  2507â†’## 26. é£æ§å¢å¼ºè§„åˆ’
  2508â†’
  2509â†’<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  2510â†’     ğŸ”´ [REVIEW-NOTE] ç¬¬26ç« å®¡æŸ¥
  2511â†’     â”œâ”€ æ£€æŸ¥ï¼šå½“å‰é£æ§æ¨¡å—è¾ƒä¸ºåŸºç¡€
  2512â†’     â”œâ”€ é£é™©ï¼šæç«¯å¸‚åœºæ¡ä»¶ä¸‹é£æ§ä¸è¶³
  2513â†’     â”œâ”€ ä¿®æ”¹ï¼šæ–°å¢é£æ§å¢å¼ºè§„åˆ’
  2514â†’     â”œâ”€ å‡çº§å»ºè®®ï¼šå»ºè®®åœ¨ V4 ç‰ˆæœ¬å®ç°
  2515â†’     â””â”€ æ€»ç»“ï¼šé£æ§æ˜¯ç”Ÿäº§ç³»ç»Ÿçš„ç”Ÿå‘½çº¿
  2516â†’â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  2517â†’
  2518â†’### 26.1 é£æ§å¢å¼ºæ¨¡å—
  2519â†’
  2520â†’| æ¨¡å— | ç›®å½• | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
  2521â†’|------|------|------|--------|
  2522â†’| VaRCalculator | `src/risk/var_calculator.py` | VaR è®¡ç®—ï¼ˆå†å²æ³•/å‚æ•°æ³•ï¼‰ | P1 |
  2523â†’| StressTest | `src/risk/stress_test.py` | å‹åŠ›æµ‹è¯• | P1 |
  2524â†’| ScenarioAnalysis | `src/risk/scenario_analysis.py` | æƒ…æ™¯åˆ†æ | P2 |
  2525â†’| CorrelationMonitor | `src/risk/correlation_monitor.py` | ç›¸å…³æ€§ç›‘æ§ | P2 |
  2526â†’
  2527â†’### 26.2 Required Scenarios
  2528â†’
  2529â†’| rule_id | æè¿° | category |
  2530â†’|---------|------|----------|
  2531â†’| `RISK.VAR.CALCULATE` | VaR è®¡ç®— | unit |
  2532â†’| `RISK.VAR.BREACH_ACTION` | VaR çªç ´åŠ¨ä½œ | unit |
  2533â†’| `RISK.STRESS.SCENARIO` | å‹åŠ›æµ‹è¯•åœºæ™¯ | integration |
  2534â†’| `RISK.CORRELATION.BREAK` | ç›¸å…³æ€§å´©æºƒæ£€æµ‹ | unit |
  2535â†’| `RISK.DRAWDOWN.LIMIT` | å›æ’¤é™åˆ¶ | unit |
  2536â†’
  2537â†’### 26.3 VaR é…ç½®
  2538â†’
  2539â†’```python
  2540â†’@dataclass(frozen=True)
  2541â†’class VaRConfig:
  2542â†’    """VaR é…ç½®."""
  2543â†’    METHOD: str = "historical"  # historical | parametric | monte_carlo
  2544â†’    CONFIDENCE_LEVEL: float = 0.99
  2545â†’    LOOKBACK_DAYS: int = 252
  2546â†’    VAR_LIMIT_PCT: float = 0.02  # æ¯æ—¥ VaR é™åˆ¶ 2%
  2547â†’    BREACH_ACTION: str = "REDUCE_ONLY"  # REDUCE_ONLY | HALTED
  2548â†’```
  2549â†’
  2550â†’### 26.4 å‹åŠ›æµ‹è¯•åœºæ™¯
  2551â†’
  2552â†’| åœºæ™¯ | æè¿° | å†²å‡»å¹…åº¦ |
  2553â†’|------|------|----------|
  2554â†’| 2015 è‚¡ç¾ | è‚¡æŒ‡æœŸè´§è¿ç»­è·Œåœ | -10% Ã— 5å¤© |
  2555â†’| 2020 åŸæ²¹è´Ÿä»· | åŸæ²¹æœŸè´§æç«¯æ³¢åŠ¨ | -150% |
  2556â†’| 2022 LME é• | é€¼ç©ºäº‹ä»¶ | +100% |
  2557â†’| æµåŠ¨æ€§æ¯ç«­ | ä¹°å–ä»·å·®æ‰©å¤§ | spread Ã— 10 |
  2558â†’| äº¤æ˜“æ‰€æ•…éšœ | æ— æ³•æˆäº¤ | å…¨éƒ¨æŒ‚å• |
  2559â†’
  2560â†’---
  2561â†’
  2562â†’## 27. é«˜é¢‘æ¨¡å—è§„åˆ’
  2563â†’
  2564â†’<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  2565â†’     ğŸ”´ [REVIEW-NOTE] ç¬¬27ç« å®¡æŸ¥
  2566â†’     â”œâ”€ æ£€æŸ¥ï¼šå½“å‰ç³»ç»Ÿä¸ºä¸­ä½é¢‘è®¾è®¡
  2567â†’     â”œâ”€ é£é™©ï¼šé«˜é¢‘åœºæ™¯æ€§èƒ½ä¸è¶³
  2568â†’     â”œâ”€ ä¿®æ”¹ï¼šæ–°å¢é«˜é¢‘æ¨¡å—è§„åˆ’
  2569â†’     â”œâ”€ å‡çº§å»ºè®®ï¼šä»…åœ¨æœ‰é«˜é¢‘éœ€æ±‚æ—¶å®ç°
  2570â†’     â””â”€ æ€»ç»“ï¼šé«˜é¢‘æ¨¡å—ä¸ºå¯é€‰æ‰©å±•
  2571â†’â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  2572â†’
  2573â†’### 27.1 é«˜é¢‘æ¨¡å—æ¶æ„
  2574â†’
  2575â†’```text
  2576â†’â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  2577â†’â”‚                     é«˜é¢‘æ¨¡å—æ¶æ„                         â”‚
  2578â†’â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  2579â†’â”‚                                                                 â”‚
  2580â†’â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
  2581â†’â”‚   â”‚ OrderBook   â”‚ -> â”‚ Tick        â”‚ -> â”‚ Latency     â”‚        â”‚
  2582â†’â”‚   â”‚ Rebuilder   â”‚    â”‚ Aggregator  â”‚    â”‚ Monitor     â”‚        â”‚
  2583â†’â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
  2584â†’â”‚                                                                 â”‚
  2585â†’â”‚   æ€§èƒ½ç›®æ ‡ï¼š                                                    â”‚
  2586â†’â”‚   - Tick å¤„ç†å»¶è¿Ÿ < 100Î¼s                                      â”‚
  2587â†’â”‚   - è®¢å•ç°¿é‡å»ºå»¶è¿Ÿ < 500Î¼s                                     â”‚
  2588â†’â”‚   - ç«¯åˆ°ç«¯å»¶è¿Ÿ < 5ms                                           â”‚
  2589â†’â”‚                                                                 â”‚
  2590â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  2591â†’```
  2592â†’
  2593â†’### 27.2 æ¨¡å—è§„åˆ’
  2594â†’
  2595â†’| æ¨¡å— | ç›®å½• | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
  2596â†’|------|------|------|--------|
  2597â†’| OrderBookRebuilder | `src/hft/order_book.py` | è®¢å•ç°¿é‡å»º | P3 |
  2598â†’| TickAggregator | `src/hft/tick_aggregator.py` | Tick èšåˆ | P3 |
  2599â†’| LatencyMonitor | `src/hft/latency_monitor.py` | å»¶è¿Ÿç›‘æ§ | P3 |
  2600â†’| CoLocation | `src/hft/co_location.py` | æ‰˜ç®¡ä¼˜åŒ– | P3 |
  2601â†’
  2602â†’### 27.3 æ€§èƒ½åŸºå‡†
  2603â†’
  2604â†’| æŒ‡æ ‡ | å½“å‰å€¼ | ç›®æ ‡å€¼ | è¯´æ˜ |
  2605â†’|------|--------|--------|------|
  2606â†’| Tick å¤„ç† | ~10ms | <100Î¼s | éœ€è¦ Cython/Rust |
  2607â†’| è®¢å•ç°¿æ›´æ–° | ~5ms | <500Î¼s | å†…å­˜ä¼˜åŒ– |
  2608â†’| ç«¯åˆ°ç«¯å»¶è¿Ÿ | ~100ms | <5ms | ç½‘ç»œä¼˜åŒ– |
  2609â†’| GC æš‚åœ | ~50ms | <1ms | å†…å­˜æ±  |
  2610â†’
  2611â†’### 27.4 å®ç°å»ºè®®
  2612â†’
  2613â†’```python
  2614â†’# ğŸ”´ [WARNING] é«˜é¢‘æ¨¡å—å®ç°éœ€è¦ï¼š
  2615â†’# 1. Cython æˆ– Rust æ‰©å±•
  2616â†’# 2. é›¶æ‹·è´æ•°æ®ç»“æ„
  2617â†’# 3. å†…å­˜æ± é¢„åˆ†é…
  2618â†’# 4. æ— é”é˜Ÿåˆ—
  2619â†’# 5. CPU äº²å’Œæ€§ç»‘å®š
  2620â†’
  2621â†’# å»ºè®®ï¼šé™¤éæœ‰æ˜ç¡®é«˜é¢‘éœ€æ±‚ï¼Œå¦åˆ™ä¸å»ºè®®å®ç°
  2622â†’```
  2623â†’
  2624â†’---
  2625â†’
  2626â†’## 28. CI/CD é›†æˆè¯´æ˜ <!-- ğŸ†• NEW 2025-12-16 -->
  2627â†’
  2628â†’<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  2629â†’     âœ… [NEW] ç¬¬28ç« æ–°å¢
  2630â†’     â”œâ”€ ç›®çš„ï¼šè¯´æ˜ GitHub Actions CI/CD é…ç½®
  2631â†’     â”œâ”€ å†…å®¹ï¼šå·¥ä½œæµç¨‹ã€è§¦å‘æ¡ä»¶ã€é—¨ç¦æ£€æŸ¥
  2632â†’     â””â”€ çŠ¶æ€ï¼š2025-12-16 æ–°å¢
  2633â†’â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  2634â†’
  2635â†’### 28.1 GitHub Actions å·¥ä½œæµ
  2636â†’
  2637â†’**é…ç½®æ–‡ä»¶**: `.github/workflows/ci.yml`
  2638â†’
  2639â†’```yaml
  2640â†’name: CI
  2641â†’
  2642â†’on:
  2643â†’  push:
  2644â†’    branches: [main, feat/*]
  2645â†’  pull_request:
  2646â†’    branches: [main]
  2647â†’
  2648â†’jobs:
  2649â†’  lint:
  2650â†’    runs-on: ubuntu-latest
  2651â†’    steps:
  2652â†’      - uses: actions/checkout@v4
  2653â†’      - uses: actions/setup-python@v5
  2654â†’        with:
  2655â†’          python-version: '3.12'
  2656â†’      - run: pip install ruff
  2657â†’      - run: ruff check .
  2658â†’      - run: ruff format --check .
  2659â†’
  2660â†’  type-check:
  2661â†’    runs-on: ubuntu-latest
  2662â†’    steps:
  2663â†’      - uses: actions/checkout@v4
  2664â†’      - uses: actions/setup-python@v5
  2665â†’        with:
  2666â†’          python-version: '3.12'
  2667â†’      - run: pip install -e ".[dev]"
  2668â†’      - run: mypy .
  2669â†’
  2670â†’  test:
  2671â†’    runs-on: ubuntu-latest
  2672â†’    steps:
  2673â†’      - uses: actions/checkout@v4
  2674â†’      - uses: actions/setup-python@v5
  2675â†’        with:
  2676â†’          python-version: '3.12'
  2677â†’      - run: pip install -e ".[dev]"
  2678â†’      - run: pytest tests/ --cov=src --cov-report=xml
  2679â†’      - uses: codecov/codecov-action@v4
  2680â†’
  2681â†’  policy-check:
  2682â†’    runs-on: ubuntu-latest
  2683â†’    steps:
  2684â†’      - uses: actions/checkout@v4
  2685â†’      - uses: actions/setup-python@v5
  2686â†’        with:
  2687â†’          python-version: '3.12'
  2688â†’      - run: pip install -e ".[dev]"
  2689â†’      - run: python scripts/validate_policy.py --all
  2690â†’```
  2691â†’
  2692â†’### 28.2 é—¨ç¦æ£€æŸ¥é¡ºåº
  2693â†’
  2694â†’| æ­¥éª¤ | æ£€æŸ¥é¡¹ | é€€å‡ºç  | è¯´æ˜ |
  2695â†’|------|--------|--------|------|
  2696â†’| 1 | Lint (ruff check) | 2 | ä»£ç é£æ ¼ |
  2697â†’| 2 | Format (ruff format) | 2 | ä»£ç æ ¼å¼ |
  2698â†’| 3 | Type Check (mypy) | 3 | ç±»å‹æ£€æŸ¥ |
  2699â†’| 4 | Test (pytest) | 4 | å•å…ƒæµ‹è¯• |
  2700â†’| 5 | Coverage | 5 | è¦†ç›–ç‡ |
  2701â†’| 6 | Policy | 12 | åœºæ™¯éªŒè¯ |
  2702â†’
  2703â†’### 28.3 æœ¬åœ°æ‰§è¡Œå‘½ä»¤
  2704â†’
  2705â†’```powershell
  2706â†’# Windows PowerShell
  2707â†’.venv/Scripts/python.exe -m ruff check .
  2708â†’.venv/Scripts/python.exe -m ruff format --check .
  2709â†’.venv/Scripts/python.exe -m mypy .
  2710â†’.venv/Scripts/python.exe -m pytest tests/ -q
  2711â†’.venv/Scripts/python.exe scripts/validate_policy.py --all
  2712â†’```
  2713â†’
  2714â†’### 28.4 CI çŠ¶æ€å¾½ç« 
  2715â†’
  2716â†’```markdown
  2717â†’[![CI](https://github.com/linxiaotutututu1123/3579/actions/workflows/ci.yml/badge.svg)](https://github.com/linxiaotutututu1123/3579/actions/workflows/ci.yml)
  2718â†’```
  2719â†’
  2720â†’---
  2721â†’
  2722â†’## é™„å½• Dï¼šé…ç½®è§„èŒƒè¡¥å……
  2723â†’
  2724â†’<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  2725â†’     ğŸ”´ [REVIEW-NOTE] é™„å½•Då®¡æŸ¥
  2726â†’     â”œâ”€ æ£€æŸ¥ï¼šåŸé…ç½®è§„èŒƒç¼ºå°‘éƒ¨åˆ†é…ç½®é¡¹
  2727â†’     â”œâ”€ ä¿®æ”¹ï¼šè¡¥å……é€šçŸ¥ã€ç›‘æ§ã€æ‰©å±•é…ç½®
  2728â†’     â””â”€ æ€»ç»“ï¼šé…ç½®é›†ä¸­ç®¡ç†ï¼Œç¬¦åˆå†›è§„ M11
  2729â†’â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  2730â†’
  2731â†’### D.1 é€šçŸ¥é…ç½®
  2732â†’
  2733â†’```python
  2734â†’@dataclass(frozen=True)
  2735â†’class NotificationConfig:
  2736â†’    """é€šçŸ¥é…ç½®."""
  2737â†’    ALERT_THROTTLE_S: float = 60.0           # åŒç±»å‘Šè­¦èŠ‚æµ
  2738â†’    ALERT_LEVELS: tuple = ("INFO", "WARN", "ERROR", "FATAL")
  2739â†’    DINGTALK_WEBHOOK: str = ""               # é’‰é’‰ webhook
  2740â†’    WECHAT_WEBHOOK: str = ""                 # ä¼ä¸šå¾®ä¿¡ webhook
  2741â†’    EMAIL_SMTP_HOST: str = ""                # é‚®ä»¶ SMTP
  2742â†’    SMS_API_KEY: str = ""                    # çŸ­ä¿¡ API
  2743â†’```
  2744â†’
  2745â†’### D.2 ç›‘æ§é…ç½®
  2746â†’
  2747â†’```python
  2748â†’@dataclass(frozen=True)
  2749â†’class MonitoringConfig:
  2750â†’    """ç›‘æ§é…ç½®."""
  2751â†’    METRICS_PORT: int = 9090                 # Prometheus ç«¯å£
  2752â†’    HEALTH_CHECK_INTERVAL_S: float = 10.0    # å¥åº·æ£€æŸ¥é—´éš”
  2753â†’    PPROF_ENABLED: bool = False              # pprof å¼€å…³
  2754â†’    TRACE_SAMPLE_RATE: float = 0.01          # è¿½è¸ªé‡‡æ ·ç‡
  2755â†’```
  2756â†’
  2757â†’### D.3 ML Pipeline é…ç½®
  2758â†’
  2759â†’```python
  2760â†’@dataclass(frozen=True)
  2761â†’class MLPipelineConfig:
  2762â†’    """ML Pipeline é…ç½®."""
  2763â†’    FEATURE_CACHE_SIZE: int = 10000          # ç‰¹å¾ç¼“å­˜å¤§å°
  2764â†’    MODEL_REGISTRY_PATH: str = "models/"     # æ¨¡å‹æ³¨å†Œè¡¨è·¯å¾„
  2765â†’    INFERENCE_TIMEOUT_MS: float = 100.0      # æ¨ç†è¶…æ—¶
  2766â†’    FALLBACK_ON_TIMEOUT: bool = True         # è¶…æ—¶é™çº§
  2767â†’```
  2768â†’
  2769â†’---
  2770â†’
  2771â†’## æ–‡æ¡£ç»“æŸ
  2772â†’
  2773â†’---
  2774â†’
  2775â†’> **æ‰§è¡Œå‡†å¤‡å°±ç»ªã€‚**  
  2776â†’> **è¯·ç¡®è®¤åå¼€å§‹ Phase 0 éª¨æ¶åˆ›å»ºã€‚**
  2777â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
