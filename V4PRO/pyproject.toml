# =============================================================================
#                    ğŸ† å†›è§„çº§ Python é¡¹ç›®é…ç½® - ç»ˆæç‰ˆ
#                    cn-futures-auto-trader
# =============================================================================
# 
# âš ï¸  è­¦å‘Šï¼šæ­¤é…ç½®é‡‡ç”¨æè‡´ä¸¥æ ¼æ¨¡å¼
# âš ï¸  ä»»ä½•ä»£ç è´¨é‡é—®é¢˜éƒ½å°†å¯¼è‡´æ„å»ºå¤±è´¥
# âš ï¸  ä¸å…è®¸ä»»ä½•ä¾‹å¤–ï¼Œé™¤éæœ‰å……åˆ†ç†ç”±å¹¶ç»è¿‡å®¡æ‰¹
#
# =============================================================================

[project]
name = "cn-futures-auto-trader"
version = "0.4.0"
requires-python = ">=3.11"
description = "ä¸­å›½æœŸè´§è‡ªåŠ¨äº¤æ˜“ç³»ç»Ÿ - å†›è§„çº§ä»£ç è´¨é‡"
readme = "README.md"
license = { text = "MIT" }
keywords = ["futures", "trading", "quant", "ctp", "china"]
classifiers = [
    "Development Status :: 4 - Beta",
    "Intended Audience :: Financial and Insurance Industry",
    "License :: OSI Approved :: MIT License",
    "Operating System :: OS Independent",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Topic :: Office/Business :: Financial :: Investment",
    "Typing :: Typed",
]

# =============================================================================
# ğŸ”¥ Ruff - æè‡´ä¸¥æ ¼é™æ€åˆ†æé…ç½®
# =============================================================================
[tool.ruff]
# åŸºç¡€é…ç½®
line-length = 120  # 120æ›´ç¬¦åˆç°ä»£æ˜¾ç¤ºå™¨ï¼Œ300å¤ªå®½
target-version = "py311"
respect-gitignore = true
force-exclude = true

# è‡ªåŠ¨ä¿®å¤
fix = true
unsafe-fixes = false  # ç¦æ­¢ä¸å®‰å…¨çš„è‡ªåŠ¨ä¿®å¤
show-fixes = true
show-source = true

# ç¼“å­˜
cache-dir = ".cache/ruff"

# è¾“å‡ºæ ¼å¼
output-format = "grouped"

# æ’é™¤ç›®å½•
extend-exclude = [
    ".git",
    ".venv",
    "__pycache__",
    "*.egg-info",
    ".mypy_cache",
    ".pytest_cache",
    ".ruff_cache",
    "build",
    "dist",
    "node_modules",
    ".tox",
]

[tool.ruff.lint]
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# å†›è§„çº§è§„åˆ™é›† - æè‡´å…¨è¦†ç›–
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
select = [
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # æ ¸å¿ƒè§„åˆ™ï¼ˆå¿…é€‰ï¼‰
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "F",        # Pyflakes - åŸºç¡€é”™è¯¯æ£€æµ‹
    "E",        # pycodestyle errors - ä»£ç é£æ ¼é”™è¯¯
    "W",        # pycodestyle warnings - ä»£ç é£æ ¼è­¦å‘Š
    "C90",      # mccabe - åœˆå¤æ‚åº¦æ£€æŸ¥
    "I",        # isort - å¯¼å…¥æ’åº
    "N",        # pep8-naming - å‘½åè§„èŒƒ
    "D",        # pydocstyle - æ–‡æ¡£å­—ç¬¦ä¸²è§„èŒƒ
    "UP",       # pyupgrade - å‡çº§åˆ°ç°ä»£Pythonè¯­æ³•
    "YTT",      # flake8-2020 - Pythonç‰ˆæœ¬æ£€æŸ¥
    "ANN",      # flake8-annotations - ç±»å‹æ³¨è§£æ£€æŸ¥
    "ASYNC",    # flake8-async - å¼‚æ­¥ä»£ç æ£€æŸ¥
    "S",        # flake8-bandit - å®‰å…¨æ£€æŸ¥
    "BLE",      # flake8-blind-except - ç¦æ­¢ç›²ç›®except
    "FBT",      # flake8-boolean-trap - å¸ƒå°”é™·é˜±
    "B",        # flake8-bugbear - å¸¸è§bugæ£€æµ‹
    "A",        # flake8-builtins - å†…ç½®åç§°è¦†ç›–
    "COM",      # flake8-commas - é€—å·ä½¿ç”¨
    "CPY",      # flake8-copyright - ç‰ˆæƒæ£€æŸ¥
    "C4",       # flake8-comprehensions - æ¨å¯¼å¼ä¼˜åŒ–
    "DTZ",      # flake8-datetimez - æ—¶åŒºå®‰å…¨
    "T10",      # flake8-debugger - ç¦æ­¢debugger
    "DJ",       # flake8-django - Djangoæ£€æŸ¥ï¼ˆå¦‚é€‚ç”¨ï¼‰
    "EM",       # flake8-errmsg - é”™è¯¯æ¶ˆæ¯è§„èŒƒ
    "EXE",      # flake8-executable - å¯æ‰§è¡Œæ–‡ä»¶æ£€æŸ¥
    "FA",       # flake8-future-annotations - æœªæ¥æ³¨è§£
    "ISC",      # flake8-implicit-str-concat - éšå¼å­—ç¬¦ä¸²æ‹¼æ¥
    "ICN",      # flake8-import-conventions - å¯¼å…¥çº¦å®š
    "LOG",      # flake8-logging - æ—¥å¿—è§„èŒƒ
    "G",        # flake8-logging-format - æ—¥å¿—æ ¼å¼
    "INP",      # flake8-no-pep420 - ç¦æ­¢éšå¼å‘½åç©ºé—´åŒ…
    "PIE",      # flake8-pie - æ‚é¡¹æ”¹è¿›
    "T20",      # flake8-print - ç¦æ­¢print
    "PYI",      # flake8-pyi - ç±»å‹å­˜æ ¹æ£€æŸ¥
    "PT",       # flake8-pytest-style - pytestè§„èŒƒ
    "Q",        # flake8-quotes - å¼•å·è§„èŒƒ
    "RSE",      # flake8-raise - å¼‚å¸¸è§„èŒƒ
    "RET",      # flake8-return - è¿”å›å€¼è§„èŒƒ
    "SLF",      # flake8-self - ç§æœ‰æˆå‘˜è®¿é—®
    "SLOT",     # flake8-slots - __slots__æ£€æŸ¥
    "SIM",      # flake8-simplify - ä»£ç ç®€åŒ–
    "TID",      # flake8-tidy-imports - å¯¼å…¥æ•´æ´
    "TCH",      # flake8-type-checking - ç±»å‹æ£€æŸ¥å¯¼å…¥
    "INT",      # flake8-gettext - å›½é™…åŒ–
    "ARG",      # flake8-unused-arguments - æœªä½¿ç”¨å‚æ•°
    "PTH",      # flake8-use-pathlib - ä½¿ç”¨pathlib
    "TD",       # flake8-todos - TODOè§„èŒƒ
    "FIX",      # flake8-fixme - FIXMEæ£€æŸ¥
    "ERA",      # eradicate - åˆ é™¤æ³¨é‡Šä»£ç 
    "PD",       # pandas-vet - pandasè§„èŒƒ
    "PGH",      # pygrep-hooks - grepé’©å­
    "PL",       # Pylint - å®Œæ•´Pylintè§„åˆ™
    "TRY",      # tryceratops - å¼‚å¸¸å¤„ç†è§„èŒƒ
    "FLY",      # flynt - f-stringæ¨è
    "NPY",      # NumPy-specific - NumPyè§„èŒƒ
    "PERF",     # Perflint - æ€§èƒ½æ£€æŸ¥
    "FURB",     # refurb - ç°ä»£åŒ–é‡æ„
    "RUF",      # Ruffä¸“æœ‰è§„åˆ™
]

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# å¿½ç•¥è§„åˆ™ - å¿…é¡»æœ‰å……åˆ†ç†ç”±ï¼Œç»è¿‡å®¡æ‰¹
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ignore = [
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # äº¤æ˜“ç³»ç»Ÿæ ¸å¿ƒä¸šåŠ¡è±å…ï¼ˆå¿…é¡»ä¿ç•™ï¼‰
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "PLR0913",  # å…è®¸>5ä¸ªå‚æ•° | ç†ç”±ï¼šCTP APIæ¥å£è§„èŒƒè¦æ±‚
    "PLR2004",  # å…è®¸é­”æ³•æ•°å­— | ç†ç”±ï¼šäº¤æ˜“å¸¸é‡(tick size/æ—¶é—´é˜ˆå€¼)
    "DTZ005",   # å…è®¸datetime.now()æ— tz | ç†ç”±ï¼šä¸­å›½æœŸè´§ä½¿ç”¨æœ¬åœ°æ—¶é—´
    "TRY003",   # å…è®¸é•¿å¼‚å¸¸æ¶ˆæ¯ | ç†ç”±ï¼šä¸­æ–‡é”™è¯¯éœ€è¯¦ç»†æè¿°
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # æ¡†æ¶å…¼å®¹æ€§è±å…ï¼ˆå¿…é¡»ä¿ç•™ï¼‰
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "B008",     # å…è®¸é»˜è®¤å‚æ•°è°ƒç”¨ | ç†ç”±ï¼šFastAPI Dependsæ¨¡å¼
    "ANN101",   # å…è®¸selfæ— æ³¨è§£ | ç†ç”±ï¼šPythonæƒ¯ä¾‹
    "ANN102",   # å…è®¸clsæ— æ³¨è§£ | ç†ç”±ï¼šPythonæƒ¯ä¾‹
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ä¸­æ–‡æ”¯æŒè±å…ï¼ˆå¿…é¡»ä¿ç•™ï¼‰
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "RUF001",   # å…è®¸Unicode | ç†ç”±ï¼šä¸­æ–‡å­—ç¬¦ä¸²
    "RUF002",   # å…è®¸ä¸­æ–‡æ ‡ç‚¹ | ç†ç”±ï¼šä¸­æ–‡æ³¨é‡Š/æ–‡æ¡£
    "RUF003",   # å…è®¸ä¸­æ–‡æ ‡ç‚¹ | ç†ç”±ï¼šä¸­æ–‡æ³¨é‡Š/æ–‡æ¡£
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # æ–‡æ¡£è§„èŒƒè°ƒæ•´ï¼ˆå¯é€‰ï¼‰
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "D100",     # å…è®¸æ¨¡å—æ— docstring | ç†ç”±ï¼š__init__.pyç­‰
    "D104",     # å…è®¸åŒ…æ— docstring | ç†ç”±ï¼š__init__.py
    "D107",     # å…è®¸__init__æ— docstring | ç†ç”±ï¼šç±»docstringå·²è¯´æ˜
]

# ç¦æ­¢æ·»åŠ æ›´å¤šå¿½ç•¥è§„åˆ™çš„å®ˆæŠ¤æ³¨é‡Š
# âš ï¸ æ·»åŠ ä»»ä½•æ–°çš„ignoreè§„åˆ™å¿…é¡»ï¼š
# 1. æäº¤PRå¹¶è¯´æ˜ç†ç”±
# 2. ç»è¿‡ä»£ç å®¡æŸ¥æ‰¹å‡†
# 3. åœ¨æ­¤å¤„æ·»åŠ è¯¦ç»†æ³¨é‡Š

# å…è®¸è‡ªåŠ¨ä¿®å¤çš„è§„åˆ™
fixable = ["ALL"]

# ç¦æ­¢è‡ªåŠ¨ä¿®å¤çš„è§„åˆ™ï¼ˆéœ€è¦äººå·¥å®¡æŸ¥ï¼‰
unfixable = [
    "ERA",      # åˆ é™¤æ³¨é‡Šä»£ç éœ€äººå·¥ç¡®è®¤
    "F401",     # æœªä½¿ç”¨å¯¼å…¥éœ€äººå·¥ç¡®è®¤
    "F841",     # æœªä½¿ç”¨å˜é‡éœ€äººå·¥ç¡®è®¤
]

# å…è®¸çš„æ··æ·†å­—ç¬¦
allowed-confusables = ["ï¼Œ", "ã€‚", "ï¼š", "ï¼›", "ï¼", "ï¼Ÿ", "ï¼ˆ", "ï¼‰"]

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# å„æ¨¡å—ä¸“å±é…ç½®
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[tool.ruff.lint.per-file-ignores]
# æµ‹è¯•æ–‡ä»¶
"tests/**/*.py" = [
    "S101",     # å…è®¸assert
    "PLR0124",  # å…è®¸NaNæ£€æŸ¥
    "D",        # æµ‹è¯•ä¸å¼ºåˆ¶docstring
    "ANN",      # æµ‹è¯•ä¸å¼ºåˆ¶ç±»å‹æ³¨è§£
    "ARG",      # å…è®¸æœªä½¿ç”¨å‚æ•°ï¼ˆfixturesï¼‰
    "PT004",    # å…è®¸fixtureä¸è¿”å›å€¼
    "PT018",    # å…è®¸å¤åˆæ–­è¨€
    "SLF001",   # å…è®¸è®¿é—®ç§æœ‰æˆå‘˜
]

# è„šæœ¬æ–‡ä»¶
"scripts/**/*.py" = [
    "T201",     # å…è®¸print
    "INP001",   # å…è®¸æ— __init__.py
    "D",        # è„šæœ¬ä¸å¼ºåˆ¶docstring
]

# CLIå…¥å£
"src/cli/**/*.py" = [
    "T201",     # å…è®¸printï¼ˆç”¨æˆ·äº¤äº’ï¼‰
    "B904",     # å…è®¸raise without from
]

# é…ç½®æ–‡ä»¶
"conftest.py" = [
    "D",        # ä¸å¼ºåˆ¶docstring
    "ANN",      # ä¸å¼ºåˆ¶ç±»å‹æ³¨è§£
]

# ç±»å‹å­˜æ ¹
"*.pyi" = [
    "D",        # å­˜æ ¹ä¸éœ€è¦docstring
    "ANN",      # å­˜æ ¹æ ¼å¼ä¸åŒ
]

[tool.ruff.lint.mccabe]
# åœˆå¤æ‚åº¦é™åˆ¶ - æè‡´ä¸¥æ ¼
max-complexity = 10  # é»˜è®¤10ï¼Œä¸å…è®¸æ›´é«˜

[tool.ruff.lint.pylint]
# Pylinté…ç½®
max-args = 7           # æœ€å¤§å‚æ•°æ•°ï¼ˆCTPæ¥å£éœ€è¦ï¼‰
max-branches = 12      # æœ€å¤§åˆ†æ”¯æ•°
max-returns = 6        # æœ€å¤§returnè¯­å¥æ•°
max-statements = 50    # æœ€å¤§è¯­å¥æ•°
max-locals = 15        # æœ€å¤§å±€éƒ¨å˜é‡æ•°
max-public-methods = 20  # æœ€å¤§å…¬å…±æ–¹æ³•æ•°
max-bool-expr = 5      # æœ€å¤§å¸ƒå°”è¡¨è¾¾å¼æ•°

[tool.ruff.lint.isort]
# å¯¼å…¥æ’åºé…ç½®
known-first-party = ["src"]
known-third-party = ["fastapi", "pydantic", "numpy", "pandas"]
force-single-line = false
force-sort-within-sections = true
lines-after-imports = 2
lines-between-types = 1
split-on-trailing-comma = true
section-order = [
    "future",
    "standard-library",
    "third-party",
    "first-party",
    "local-folder",
]

[tool.ruff.lint.pydocstyle]
# æ–‡æ¡£å­—ç¬¦ä¸²é£æ ¼
convention = "google"  # ä½¿ç”¨Googleé£æ ¼

[tool.ruff.lint.flake8-annotations]
# ç±»å‹æ³¨è§£é…ç½®
allow-star-arg-any = false
ignore-fully-untyped = false
mypy-init-return = true
suppress-dummy-args = false
suppress-none-returning = false

[tool.ruff.lint.flake8-bugbear]
# Bugbearé…ç½®
extend-immutable-calls = [
    "fastapi.Depends",
    "fastapi.Query",
    "fastapi.Path",
    "fastapi.Body",
    "fastapi.Header",
    "fastapi.Cookie",
    "fastapi.Form",
    "fastapi.File",
]

[tool.ruff.lint.flake8-builtins]
# å†…ç½®åç§°ä¿æŠ¤
builtins-ignorelist = ["id", "type", "input", "format", "hash"]

[tool.ruff.lint.flake8-comprehensions]
# æ¨å¯¼å¼é…ç½®
allow-dict-calls-with-keyword-arguments = true

[tool.ruff.lint.flake8-errmsg]
# é”™è¯¯æ¶ˆæ¯é…ç½®
max-string-length = 50

[tool.ruff.lint.flake8-implicit-str-concat]
# å­—ç¬¦ä¸²æ‹¼æ¥é…ç½®
allow-multiline = true

[tool.ruff.lint.flake8-import-conventions]
# å¯¼å…¥çº¦å®š
[tool.ruff.lint.flake8-import-conventions.aliases]
numpy = "np"
pandas = "pd"
matplotlib = "mpl"
"matplotlib.pyplot" = "plt"
seaborn = "sns"
scipy = "sp"

[tool.ruff.lint.flake8-pytest-style]
# Pytesté£æ ¼é…ç½®
fixture-parentheses = true
parametrize-names-type = "tuple"
parametrize-values-type = "list"
parametrize-values-row-type = "tuple"
raises-require-match-for = ["ValueError", "TypeError", "AttributeError"]

[tool.ruff.lint.flake8-quotes]
# å¼•å·é…ç½®
docstring-quotes = "double"
inline-quotes = "double"
multiline-quotes = "double"

[tool.ruff.lint.flake8-tidy-imports]
# æ•´æ´å¯¼å…¥é…ç½®
ban-relative-imports = "all"

[tool.ruff.lint.flake8-type-checking]
# ç±»å‹æ£€æŸ¥å¯¼å…¥é…ç½®
strict = true
exempt-modules = ["typing", "typing_extensions"]

[tool.ruff.lint.flake8-unused-arguments]
# æœªä½¿ç”¨å‚æ•°é…ç½®
ignore-variadic-names = true

[tool.ruff.format]
# æ ¼å¼åŒ–é…ç½®
quote-style = "double"
indent-style = "space"
skip-magic-trailing-comma = false
line-ending = "auto"
docstring-code-format = true
docstring-code-line-length = 80

# =============================================================================
# ğŸ”¥ MyPy - æè‡´ä¸¥æ ¼ç±»å‹æ£€æŸ¥é…ç½®
# =============================================================================
[tool.mypy]
python_version = "3.11"
pretty = true
show_error_context = true
show_column_numbers = true
show_error_codes = true
color_output = true

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# æè‡´ä¸¥æ ¼æ¨¡å¼ - å…¨éƒ¨å¯ç”¨
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# ä¸¥æ ¼æ¨¡å¼åŸºç¡€
strict = true

# ç±»å‹æ£€æŸ¥å®Œæ•´æ€§
disallow_any_unimported = true
disallow_any_expr = true
disallow_any_decorated = true
disallow_any_explicit = true
disallow_any_generics = true
disallow_subclassing_any = true

# å‡½æ•°å®šä¹‰æ£€æŸ¥
disallow_untyped_calls = true
disallow_untyped_defs = true
disallow_incomplete_defs = true
disallow_untyped_decorators = true
check_untyped_defs = true

# å…¶ä»–ä¸¥æ ¼æ£€æŸ¥
no_implicit_optional = true
no_implicit_reexport = true
strict_optional = true
strict_equality = true
strict_concatenate = true

# è­¦å‘Šé…ç½®
warn_return_any = true
warn_unused_ignores = true
warn_unused_configs = true
warn_redundant_casts = true
warn_unreachable = true
warn_no_return = true

# é”™è¯¯å¤„ç†
ignore_errors = false
allow_untyped_globals = false
allow_redefinition = false

# å‘½åç©ºé—´åŒ…
namespace_packages = true
explicit_package_bases = true

# å¢é‡æ¨¡å¼
incremental = true
cache_dir = ".cache/mypy"

# æ’ä»¶
plugins = [
    "pydantic.mypy",
]

# æ’é™¤
exclude = [
    "build/",
    "dist/",
    ".venv/",
    "__pycache__/",
    ".git/",
]

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# æ¨¡å—çº§é…ç½®
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ ¸å¿ƒäº¤æ˜“æ¨¡å— - æœ€ä¸¥æ ¼
[[tool.mypy.overrides]]
module = [
    "src.trading.*",
    "src.execution.*",
    "src.risk.*",
    "src.market.*",
    "src.broker.*",
    "src.gateway.*",
]
# æ‰€æœ‰ä¸¥æ ¼é€‰é¡¹å‡å·²åœ¨å…¨å±€å¯ç”¨
disallow_any_expr = true
warn_unreachable = true
extra_checks = true

# æ•°æ®å’Œç­–ç•¥æ¨¡å— - æœ€ä¸¥æ ¼
[[tool.mypy.overrides]]
module = [
    "src.data.*",
    "src.strategy.*",
    "src.backtesting.*",
    "src.simulation.*",
    "src.portfolio.*",
    "src.performance.*",
]
disallow_any_expr = true
warn_unreachable = true

# AI/MLæ¨¡å— - ä¸¥æ ¼ä½†å…è®¸numpy/pandasçš„Any
[[tool.mypy.overrides]]
module = [
    "src.ai.*",
    "src.ml.*",
    "src.analytics.*",
    "src.visualization.*",
    "src.optimization.*",
]
disallow_any_expr = false  # numpy/pandasè¿”å›Any
disallow_any_explicit = false

# æµ‹è¯•æ¨¡å— - æ”¾å®½
[[tool.mypy.overrides]]
module = "tests.*"
disallow_untyped_decorators = false
disallow_any_expr = false
warn_unreachable = false

# è„šæœ¬æ¨¡å— - æ”¾å®½
[[tool.mypy.overrides]]
module = "scripts.*"
disallow_untyped_defs = false
disallow_any_expr = false

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç¬¬ä¸‰æ–¹åº“é…ç½®
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# CTP SDK - æ— ç±»å‹å­˜æ ¹
[[tool.mypy.overrides]]
module = [
    "ctp",
    "ctp.*",
    "thostmduserapi",
    "thostmduserapi.*",
    "thosttraderapi",
    "thosttraderapi.*",
]
ignore_missing_imports = true
follow_imports = "skip"

# ç§‘å­¦è®¡ç®—åº“ - æ— å®Œæ•´ç±»å‹å­˜æ ¹
[[tool.mypy.overrides]]
module = [
    "shap",
    "shap.*",
    "xgboost",
    "xgboost.*",
    "pandas_ta",
    "pandas_ta.*",
    "talib",
    "talib.*",
    "scipy.optimize",
]
ignore_missing_imports = true

# Pydanticé…ç½®
[tool.pydantic-mypy]
init_forbid_extra = true
init_typed = true
warn_required_dynamic_aliases = true
warn_untyped_fields = true

# =============================================================================
# ğŸ”¥ Pytest - æè‡´ä¸¥æ ¼æµ‹è¯•é…ç½®
# =============================================================================
[tool.pytest.ini_options]
minversion = "7.4"
testpaths = ["tests"]
python_files = ["test_*.py", "*_test.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ä¸¥æ ¼æ¨¡å¼é…ç½®
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
addopts = [
    # ä¸¥æ ¼æ¨¡å¼
    "--strict-markers",
    "--strict-config",
    
    # è¦†ç›–ç‡ - 100%è¦æ±‚
    "--cov=src",
    "--cov-branch",
    "--cov-report=term-missing:skip-covered",
    "--cov-report=html:reports/coverage",
    "--cov-report=xml:reports/coverage.xml",
    "--cov-fail-under=100",
    
    # è¾“å‡ºæ ¼å¼
    "-v",
    "--tb=short",
    "--showlocals",
    
    # è­¦å‘Šå¤„ç† - ä¸¥æ ¼
    "-W", "error::DeprecationWarning",
    "-W", "error::PendingDeprecationWarning",
    "-W", "error::FutureWarning",
    
    # æ—¥å¿—
    "--log-cli-level=WARNING",
    "--log-file=logs/test.log",
    "--log-file-level=DEBUG",
    "--log-file-format=%(asctime)s [%(levelname)8s] %(name)s: %(message)s",
    "--log-file-date-format=%Y-%m-%d %H:%M:%S",
    
    # è¶…æ—¶
    "--timeout=300",
    "--timeout_method=thread",
    
    # éšæœºé¡ºåºï¼ˆæ£€æµ‹æµ‹è¯•é—´ä¾èµ–ï¼‰
    "-p", "no:randomly",  # å¦‚éœ€éšæœºåŒ–åˆ™æ”¹ä¸º "randomly"
    
    # å¹¶è¡Œæ‰§è¡Œ
    # "-n", "auto",  # å¯ç”¨pytest-xdistå¹¶è¡Œ
    
    # é‡è¯•å¤±è´¥æµ‹è¯•
    # "--reruns=2",  # å¯ç”¨pytest-rerunfailures
]

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# æµ‹è¯•æ ‡è®°
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
markers = [
    # æ‰§è¡Œé€Ÿåº¦
    "slow: æ…¢é€Ÿæµ‹è¯•ï¼ˆè¶…è¿‡5ç§’ï¼‰",
    "fast: å¿«é€Ÿæµ‹è¯•ï¼ˆä½äº1ç§’ï¼‰",
    
    # æµ‹è¯•ç±»å‹
    "unit: å•å…ƒæµ‹è¯•",
    "integration: é›†æˆæµ‹è¯•",
    "e2e: ç«¯åˆ°ç«¯æµ‹è¯•",
    "smoke: å†’çƒŸæµ‹è¯•",
    
    # äº¤æ˜“ç›¸å…³
    "live: å®ç›˜æµ‹è¯•ï¼ˆéœ€è¦äº¤æ˜“æ‰€è¿æ¥ï¼‰",
    "paper: æ¨¡æ‹Ÿç›˜æµ‹è¯•",
    "backtest: å›æµ‹æµ‹è¯•",
    "simulation: ä»¿çœŸæµ‹è¯•",
    "replay: è¡Œæƒ…å›æ”¾æµ‹è¯•",
    
    # åŠŸèƒ½æ¨¡å—
    "trading: äº¤æ˜“æ¨¡å—æµ‹è¯•",
    "risk: é£æ§æ¨¡å—æµ‹è¯•",
    "strategy: ç­–ç•¥æ¨¡å—æµ‹è¯•",
    "data: æ•°æ®æ¨¡å—æµ‹è¯•",
    "market: è¡Œæƒ…æ¨¡å—æµ‹è¯•",
    
    # AI/ML
    "ai: AIç›¸å…³æµ‹è¯•",
    "ml: æœºå™¨å­¦ä¹ æµ‹è¯•",
    "optimization: ä¼˜åŒ–æµ‹è¯•",
    
    # ç‰¹æ®Šæ ‡è®°
    "skip_ci: CIç¯å¢ƒè·³è¿‡",
    "requires_ctp: éœ€è¦CTP SDK",
    "requires_gpu: éœ€è¦GPU",
    "destructive: ç ´åæ€§æµ‹è¯•ï¼ˆä¿®æ”¹çŠ¶æ€ï¼‰",
]

# è¿‡æ»¤è­¦å‘Š
filterwarnings = [
    "error",
    "ignore::pytest.PytestUnraisableExceptionWarning",
    "ignore::DeprecationWarning:pkg_resources.*",
]

# å¼‚æ­¥æ¨¡å¼
asyncio_mode = "auto"

# =============================================================================
# ğŸ”¥ Coverage - æè‡´ä¸¥æ ¼è¦†ç›–ç‡é…ç½®
# =============================================================================
[tool.coverage.run]
source = ["src"]
branch = true
parallel = true
concurrency = ["thread", "multiprocessing"]
relative_files = true
data_file = ".coverage"
dynamic_context = "test_function"

# æ’é™¤é¡¹
omit = [
    # å…¥å£è„šæœ¬
    "src/cli/*",
    "src/scripts/*",
    "src/app/*_entry.py",
    
    # ç±»å‹å­˜æ ¹
    "*.pyi",
    
    # é…ç½®
    "conftest.py",
    
    # æµ‹è¯•
    "tests/*",
]

[tool.coverage.paths]
source = [
    "src/",
]

[tool.coverage.report]
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# æè‡´ä¸¥æ ¼ï¼š100%è¦†ç›–ç‡è¦æ±‚
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
fail_under = 100
precision = 2
show_missing = true
skip_covered = false
skip_empty = false

# å¿…é¡»è¦†ç›–çš„æ¨¡å—
include = [
    "src/trading/*",
    "src/execution/*",
    "src/risk/*",
    "src/market/*",
    "src/data/*",
    "src/strategy/*",
    "src/backtesting/*",
    "src/common/*",
    "src/broker/*",
    "src/gateway/*",
    "src/simulation/*",
    "src/config/*",
    "src/utils/*",
    "src/ai/*",
    "src/ml/*",
    "src/analytics/*",
    "src/visualization/*",
    "src/optimization/*",
    "src/portfolio/*",
    "src/performance/*",
]

# æ’é™¤è¡Œï¼ˆå¿…é¡»æœ‰æ³¨é‡Šè¯´æ˜ç†ç”±ï¼‰
exclude_lines = [
    # æ ‡å‡†æ’é™¤
    "pragma: no cover",
    
    # ç±»å‹æ£€æŸ¥
    "if TYPE_CHECKING:",
    "if typing.TYPE_CHECKING:",
    
    # æŠ½è±¡æ–¹æ³•
    "@abstractmethod",
    "@abc.abstractmethod",
    "raise NotImplementedError",
    
    # å…¥å£ç‚¹
    'if __name__ == "__main__":',
    'if __name__ == .__main__.:',
    
    # é˜²å¾¡æ€§ç¼–ç¨‹ï¼ˆä¸åº”åˆ°è¾¾ï¼‰
    "raise AssertionError",
    "raise RuntimeError\$.*unreachable.*\$",
    
    # è°ƒè¯•ä»£ç 
    "def __repr__",
    "def __str__",
    
    # åè®®æ–¹æ³•
    "\\.\\.\\.",
    "pass",
]

# éƒ¨åˆ†è¡Œæ’é™¤
partial_branches = [
    "pragma: no branch",
]

[tool.coverage.html]
directory = "reports/coverage/html"
title = "cn-futures-auto-trader è¦†ç›–ç‡æŠ¥å‘Š"
show_contexts = true

[tool.coverage.xml]
output = "reports/coverage/coverage.xml"

[tool.coverage.json]
output = "reports/coverage/coverage.json"
pretty_print = true
show_contexts = true

# =============================================================================
# ğŸ”¥ å…¶ä»–å·¥å…·é…ç½®
# =============================================================================

# Bandit - å®‰å…¨æ‰«æ
[tool.bandit]
exclude_dirs = ["tests", "scripts", ".venv"]
skips = []  # ä¸è·³è¿‡ä»»ä½•æ£€æŸ¥
severity = "low"  # æŠ¥å‘Šæ‰€æœ‰çº§åˆ«

# Black - ä»£ç æ ¼å¼åŒ–ï¼ˆå¦‚ä¸RuffåŒæ—¶ä½¿ç”¨ï¼‰
[tool.black]
line-length = 120
target-version = ["py311"]
include = '\.pyi?$'
extend-exclude = '''
/(
    \.git
    | \.venv
    | build
    | dist
)/
'''