     1→# V4PRO 验收矩阵报告 - 军规级场景全覆盖
     2→
     3→> **文档版本**: v4.0 SUPREME MATRIX
     4→> **生成日期**: 2025-12-16
     5→> **文档等级**: 最高机密 - 军规级
     6→> **场景总数**: 165 条
     7→> **军规覆盖**: M1-M20 全覆盖
     8→
     9→---
    10→
    11→## 目录
    12→
    13→- [§A 基础设施层 (Phase 0)](#a-基础设施层-phase-0)
    14→- [§B 行情层 (Phase 1)](#b-行情层-phase-1)
    15→- [§C 审计层 (Phase 2)](#c-审计层-phase-2)
    16→- [§D 策略降级层 (Phase 3)](#d-策略降级层-phase-3)
    17→- [§E 回放验证层 (Phase 4)](#e-回放验证层-phase-4)
    18→- [§F 成本层 (Phase 5)](#f-成本层-phase-5)
    19→- [§G 中国期货市场特化 (Phase 7)](#g-中国期货市场特化-phase-7)
    20→- [§H 智能策略层 (Phase 8)](#h-智能策略层-phase-8)
    21→- [§I 合规监控层 (Phase 9)](#i-合规监控层-phase-9)
    22→- [§J 组合风控层 (Phase 10)](#j-组合风控层-phase-10)
    23→- [§K B类模型层 (Phase 6)](#k-b类模型层-phase-6)
    24→- [场景统计总表](#场景统计总表)
    25→- [军规覆盖矩阵](#军规覆盖矩阵)
    26→
    27→---
    28→
    29→## §A 基础设施层 (Phase 0)
    30→
    31→### A.1 CI门禁场景
    32→
    33→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
    34→|------|---------|----------|------|----------|------|
    35→| A01 | `INFRA.CI.GATE_PASS` | CI门禁全部通过 | M8 | test_ci_gate.py | ✅ |
    36→| A02 | `INFRA.CI.LINT_PASS` | Ruff检查通过 | M8 | test_ci_gate.py | ✅ |
    37→| A03 | `INFRA.CI.TYPE_PASS` | Mypy检查通过 | M8 | test_ci_gate.py | ✅ |
    38→| A04 | `INFRA.CI.TEST_PASS` | Pytest通过 | M8 | test_ci_gate.py | ✅ |
    39→| A05 | `INFRA.CI.COVERAGE_MIN` | 覆盖率≥80% | M8 | test_ci_gate.py | ✅ |
    40→
    41→### A.2 仿真门禁场景
    42→
    43→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
    44→|------|---------|----------|------|----------|------|
    45→| A06 | `INFRA.SIM.GATE_PASS` | 仿真门禁通过 | M8 | test_sim_gate.py | ✅ |
    46→| A07 | `INFRA.SIM.SCENARIO_ALL` | 所有场景覆盖 | M8 | test_sim_gate.py | ✅ |
    47→
    48→### A.3 CTP接口场景
    49→
    50→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
    51→|------|---------|----------|------|----------|------|
    52→| A08 | `INFRA.CTP.CONNECT` | CTP连接成功 | M9 | test_ctp_api.py | ✅ |
    53→| A09 | `INFRA.CTP.AUTH` | CTP认证成功 | M9 | test_ctp_api.py | ✅ |
    54→| A10 | `INFRA.CTP.SUBSCRIBE` | 行情订阅成功 | M9 | test_ctp_api.py | ✅ |
    55→| A11 | `INFRA.CTP.RECONNECT` | 断线重连成功 | M4, M9 | test_ctp_api.py | ✅ |
    56→
    57→### A.4 配置管理场景
    58→
    59→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
    60→|------|---------|----------|------|----------|------|
    61→| A12 | `INFRA.CONFIG.LOAD` | 配置加载成功 | M8 | test_config.py | ✅ |
    62→| A13 | `INFRA.CONFIG.VALIDATE` | 配置验证通过 | M8 | test_config.py | ✅ |
    63→| A14 | `INFRA.CONFIG.ENV_ISOLATE` | 环境隔离正确 | M8 | test_config.py | ✅ |
    64→| A15 | `INFRA.LOG.FORMAT` | 日志格式正确 | M3 | test_logger.py | ✅ |
    65→
    66→**Phase A 小计: 15 场景 (15 ✅)**
    67→
    68→---
    69→
    70→## §B 行情层 (Phase 1)
    71→
    72→### B.1 订阅管理场景
    73→
    74→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
    75→|------|---------|----------|------|----------|------|
    76→| B01 | `MKT.SUBSCRIBER.DIFF_UPDATE` | 差量更新订阅列表 | M1 | test_market_subscriber.py | ✅ |
    77→| B02 | `MKT.SUBSCRIBER.CALLBACK` | 回调正确触发 | M9 | test_market_subscriber.py | ✅ |
    78→| B03 | `MKT.SUBSCRIBER.CLEAR` | 清除订阅正确 | M1 | test_market_subscriber.py | ✅ |
    79→
    80→### B.2 合约缓存场景
    81→
    82→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
    83→|------|---------|----------|------|----------|------|
    84→| B04 | `MKT.CACHE.INSTRUMENT_INFO` | 合约信息正确缓存 | M11 | test_instrument_cache.py | ✅ |
    85→| B05 | `MKT.CACHE.EXPIRE_CHECK` | 过期检查正确 | M15 | test_instrument_cache.py | ✅ |
    86→| B06 | `MKT.CACHE.UPDATE` | 缓存更新正确 | M11 | test_instrument_cache.py | ✅ |
    87→
    88→### B.3 Tick处理场景
    89→
    90→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
    91→|------|---------|----------|------|----------|------|
    92→| B07 | `MKT.TICK.BUFFER_OVERFLOW` | 缓冲区溢出处理 | M10 | test_tick_buffer.py | ✅ |
    93→| B08 | `MKT.TICK.TIMESTAMP_ORDER` | 时间戳顺序正确 | M7 | test_tick_buffer.py | ✅ |
    94→
    95→### B.4 K线构建场景
    96→
    97→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
    98→|------|---------|----------|------|----------|------|
    99→| B09 | `MKT.KLINE.BUILD_CORRECT` | K线构建正确 | M7 | test_kline_builder.py | ✅ |
   100→| B10 | `MKT.KLINE.GAP_HANDLE` | 缺口处理正确 | M4 | test_kline_builder.py | ✅ |
   101→
   102→### B.5 行情快照场景
   103→
   104→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   105→|------|---------|----------|------|----------|------|
   106→| B11 | `MKT.SNAPSHOT.CAPTURE` | 快照捕获正确 | M7 | test_snapshot.py | ✅ |
   107→| B12 | `MKT.SNAPSHOT.RESTORE` | 快照恢复正确 | M7 | test_snapshot.py | ✅ |
   108→
   109→**Phase B 小计: 12 场景 (12 ✅)**
   110→
   111→---
   112→
   113→## §C 审计层 (Phase 2)
   114→
   115→### C.1 事件结构场景
   116→
   117→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   118→|------|---------|----------|------|----------|------|
   119→| C01 | `AUDIT.EVENT.STRUCTURE` | 事件结构完整 | M3 | test_audit_writer.py | ✅ |
   120→| C02 | `AUDIT.EVENT.JSONL_FORMAT` | JSONL格式正确 | M3 | test_audit_writer.py | ✅ |
   121→| C03 | `AUDIT.CORRELATION.RUN_EXEC` | run_id/exec_id关联 | M3 | test_audit_writer.py | ✅ |
   122→
   123→### C.2 写入器场景
   124→
   125→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   126→|------|---------|----------|------|----------|------|
   127→| C04 | `AUDIT.WRITER.PROPERTIES` | 写入器属性正确 | M3 | test_audit_writer.py | ✅ |
   128→| C05 | `AUDIT.WRITER.CLOSE_BEHAVIOR` | 关闭后行为正确 | M3 | test_audit_writer.py | ✅ |
   129→| C06 | `AUDIT.WRITER.CONTEXT_MANAGER` | 上下文管理器正确 | M3 | test_audit_writer.py | ✅ |
   130→
   131→### C.3 验证场景
   132→
   133→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   134→|------|---------|----------|------|----------|------|
   135→| C07 | `AUDIT.VALIDATE.MISSING_TS` | 缺少时间戳检测 | M3 | test_audit_writer.py | ✅ |
   136→| C08 | `AUDIT.VALIDATE.MISSING_TYPE` | 缺少类型检测 | M3 | test_audit_writer.py | ✅ |
   137→| C09 | `AUDIT.VALIDATE.REQUIRED_FIELDS` | 必填字段检测 | M3 | test_audit_writer.py | ✅ |
   138→
   139→### C.4 字典写入场景
   140→
   141→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   142→|------|---------|----------|------|----------|------|
   143→| C10 | `AUDIT.DICT.WRITE` | 字典写入正确 | M3 | test_audit_writer.py | ✅ |
   144→| C11 | `AUDIT.DICT.MISSING_REQUIRED` | 缺少必填字段检测 | M3 | test_audit_writer.py | ✅ |
   145→
   146→### C.5 读取场景
   147→
   148→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   149→|------|---------|----------|------|----------|------|
   150→| C12 | `AUDIT.READ.EMPTY_FILE` | 读取空文件处理 | M4 | test_audit_writer.py | ✅ |
   151→| C13 | `AUDIT.READ.CORRUPTED` | 损坏文件处理 | M4 | test_audit_reader.py | ✅ |
   152→
   153→### C.6 导出场景
   154→
   155→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   156→|------|---------|----------|------|----------|------|
   157→| C14 | `AUDIT.EXPORT.CSV` | CSV导出正确 | M3 | test_audit_exporter.py | ✅ |
   158→| C15 | `AUDIT.EXPORT.PARQUET` | Parquet导出正确 | M3 | test_audit_exporter.py | ✅ |
   159→
   160→### C.7 压缩场景
   161→
   162→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   163→|------|---------|----------|------|----------|------|
   164→| C16 | `AUDIT.COMPRESS.GZIP` | GZIP压缩正确 | M10 | test_audit_compressor.py | ✅ |
   165→| C17 | `AUDIT.RETENTION.POLICY` | 保留策略正确 | M3 | test_audit_retention.py | ✅ |
   166→
   167→### C.8 追踪场景
   168→
   169→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   170→|------|---------|----------|------|----------|------|
   171→| C18 | `AUDIT.SIGNAL_SOURCE.TRACK` | 信号来源追踪 | M1, M3 | test_audit_tracking.py | ✅ |
   172→
   173→**Phase C 小计: 18 场景 (18 ✅)**
   174→
   175→---
   176→
   177→## §D 策略降级层 (Phase 3)
   178→
   179→### D.1 降级管理场景
   180→
   181→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   182→|------|---------|----------|------|----------|------|
   183→| D01 | `STRAT.FALLBACK.ON_EXCEPTION` | 异常触发降级 | M4 | test_fallback.py | ✅ |
   184→| D02 | `STRAT.FALLBACK.ON_TIMEOUT` | 超时触发降级 | M4 | test_fallback.py | ✅ |
   185→| D03 | `STRAT.FALLBACK.CHAIN_DEFINED` | 降级链已定义 | M4 | test_fallback.py | ✅ |
   186→
   187→### D.2 Kalman滤波场景
   188→
   189→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   190→|------|---------|----------|------|----------|------|
   191→| D04 | `ARB.KALMAN.BETA_ESTIMATE` | beta估计正确 | M7 | test_kalman_beta.py | ✅ |
   192→| D05 | `ARB.KALMAN.RESIDUAL_ZSCORE` | 残差z分数计算 | M7 | test_kalman_beta.py | ✅ |
   193→| D06 | `ARB.KALMAN.BETA_BOUND` | beta边界约束 | M6 | test_kalman_beta.py | ✅ |
   194→
   195→### D.3 套利策略场景
   196→
   197→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   198→|------|---------|----------|------|----------|------|
   199→| D07 | `ARB.LEGS.FIXED_NEAR_FAR` | 近远月腿固定 | M1 | test_calendar_arb.py | ✅ |
   200→| D08 | `ARB.SIGNAL.HALF_LIFE_GATE` | 半衰期门禁 | M5 | test_calendar_arb.py | ✅ |
   201→| D09 | `ARB.SIGNAL.STOP_Z_BREAKER` | 止损z值触发 | M6 | test_calendar_arb.py | ✅ |
   202→| D10 | `ARB.SIGNAL.EXPIRY_GATE` | 到期日门禁 | M15 | test_calendar_arb.py | ✅ |
   203→| D11 | `ARB.SIGNAL.CORRELATION_BREAK` | 相关性破裂检测 | M6 | test_calendar_arb.py | ✅ |
   204→| D12 | `ARB.COST.ENTRY_GATE` | 成本门禁检查 | M5 | test_calendar_arb.py | ✅ |
   205→
   206→**Phase D 小计: 12 场景 (12 ✅)**
   207→
   208→---
   209→
   210→## §E 回放验证层 (Phase 4)
   211→
   212→### E.1 决策回放场景
   213→
   214→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   215→|------|---------|----------|------|----------|------|
   216→| E01 | `REPLAY.DETERMINISTIC.DECISION` | 决策序列确定性 | M7 | test_replay_verifier.py | ✅ |
   217→| E02 | `REPLAY.DETERMINISTIC.GUARDIAN` | 守护动作确定性 | M7 | test_replay_verifier.py | ✅ |
   218→
   219→**Phase E 小计: 2 场景 (2 ✅)**
   220→
   221→---
   222→
   223→## §F 成本层 (Phase 5)
   224→
   225→### F.1 手续费估计场景
   226→
   227→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   228→|------|---------|----------|------|----------|------|
   229→| F01 | `COST.FEE.ESTIMATE` | 手续费估计正确 | M5 | test_cost_estimator.py | ✅ |
   230→| F02 | `COST.FEE.BY_VOLUME` | 按手收费计算 | M5 | test_china_fee.py | ⏸ |
   231→| F03 | `COST.FEE.BY_VALUE` | 按金额收费计算 | M5 | test_china_fee.py | ⏸ |
   232→| F04 | `COST.FEE.CLOSE_TODAY` | 平今手续费计算 | M14 | test_china_fee.py | ⏸ |
   233→
   234→### F.2 滑点估计场景
   235→
   236→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   237→|------|---------|----------|------|----------|------|
   238→| F05 | `COST.SLIPPAGE.ESTIMATE` | 滑点估计正确 | M5 | test_cost_estimator.py | ✅ |
   239→
   240→### F.3 市场冲击场景
   241→
   242→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   243→|------|---------|----------|------|----------|------|
   244→| F06 | `COST.IMPACT.ESTIMATE` | 市场冲击估计正确 | M5 | test_cost_estimator.py | ✅ |
   245→
   246→### F.4 成本门禁场景
   247→
   248→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   249→|------|---------|----------|------|----------|------|
   250→| F07 | `COST.EDGE.GATE` | 边际收益门禁 | M5 | test_cost_estimator.py | ✅ |
   251→| F08 | `COST.FEE.EXCHANGE_CONFIG` | 交易所配置正确 | M20 | test_china_fee.py | ⏸ |
   252→
   253→**Phase F 小计: 8 场景 (4 ✅, 4 ⏸)**
   254→
   255→---
   256→
   257→## §G 中国期货市场特化 (Phase 7)
   258→
   259→### G.1 交易所配置场景
   260→
   261→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   262→|------|---------|----------|------|----------|------|
   263→| G01 | `CHINA.EXCHANGE.CONFIG_LOAD` | 交易所配置加载 | M20 | test_exchange_config.py | ⏸ |
   264→| G02 | `CHINA.EXCHANGE.PRODUCT_MAP` | 品种映射正确 | M20 | test_exchange_config.py | ⏸ |
   265→| G03 | `CHINA.EXCHANGE.SIX_SUPPORTED` | 六大交易所支持 | M20 | test_exchange_config.py | ⏸ |
   266→
   267→### G.2 交易日历场景
   268→
   269→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   270→|------|---------|----------|------|----------|------|
   271→| G04 | `CHINA.CALENDAR.NIGHT_SESSION` | 夜盘时段正确 | M15 | test_trading_calendar.py | ⏸ |
   272→| G05 | `CHINA.CALENDAR.TRADING_DAY` | 交易日计算正确 | M15 | test_trading_calendar.py | ⏸ |
   273→| G06 | `CHINA.CALENDAR.HOLIDAY` | 节假日处理正确 | M15 | test_trading_calendar.py | ⏸ |
   274→| G07 | `CHINA.CALENDAR.CROSS_DAY` | 跨日归属正确 | M15 | test_trading_calendar.py | ⏸ |
   275→
   276→### G.3 涨跌停场景
   277→
   278→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   279→|------|---------|----------|------|----------|------|
   280→| G08 | `CHINA.LIMIT.PRICE_CHECK` | 涨跌停价格检查 | M13 | test_limit_price.py | ⏸ |
   281→| G09 | `CHINA.LIMIT.ORDER_REJECT` | 超限订单拒绝 | M13 | test_limit_price.py | ⏸ |
   282→| G10 | `CHINA.LIMIT.DYNAMIC_UPDATE` | 动态更新涨跌停 | M13 | test_limit_price.py | ⏸ |
   283→| G11 | `CHINA.LIMIT.CONSECUTIVE_ADJUST` | 连续涨跌停调整 | M13 | test_limit_price.py | ⏸ |
   284→
   285→### G.4 保证金场景
   286→
   287→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   288→|------|---------|----------|------|----------|------|
   289→| G12 | `CHINA.MARGIN.RATIO_CHECK` | 保证金率检查 | M16 | test_margin_monitor.py | ⏸ |
   290→| G13 | `CHINA.MARGIN.USAGE_MONITOR` | 保证金使用监控 | M16 | test_margin_monitor.py | ⏸ |
   291→| G14 | `CHINA.MARGIN.WARNING_LEVEL` | 保证金预警等级 | M16 | test_margin_monitor.py | ⏸ |
   292→| G15 | `CHINA.MARGIN.CRITICAL_ACTION` | 临界保证金动作 | M16 | test_margin_monitor.py | ⏸ |
   293→
   294→### G.5 触发器场景
   295→
   296→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   297→|------|---------|----------|------|----------|------|
   298→| G16 | `CHINA.TRIGGER.LIMIT_PRICE` | 涨跌停触发器 | M6, M13 | test_triggers_china.py | ⏸ |
   299→| G17 | `CHINA.TRIGGER.MARGIN_CALL` | 保证金追缴触发 | M6, M16 | test_triggers_china.py | ⏸ |
   300→| G18 | `CHINA.TRIGGER.DELIVERY` | 交割月接近触发 | M6, M15 | test_triggers_china.py | ⏸ |
   301→
   302→### G.6 压力测试场景
   303→
   304→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   305→|------|---------|----------|------|----------|------|
   306→| G19 | `CHINA.STRESS.2015_CRASH` | 2015股灾场景 | M6 | test_stress_china.py | ⏸ |
   307→| G20 | `CHINA.STRESS.2020_OIL` | 2020原油负价场景 | M6 | test_stress_china.py | ⏸ |
   308→| G21 | `CHINA.STRESS.2022_LITHIUM` | 2022碳酸锂场景 | M6 | test_stress_china.py | ⏸ |
   309→
   310→### G.7 套利特化场景
   311→
   312→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   313→|------|---------|----------|------|----------|------|
   314→| G22 | `CHINA.ARB.DELIVERY_AWARE` | 交割感知套利 | M15 | test_delivery_aware.py | ⏸ |
   315→| G23 | `CHINA.ARB.POSITION_TRANSFER` | 移仓换月逻辑 | M15 | test_delivery_aware.py | ⏸ |
   316→
   317→**Phase G 小计: 23 场景 (0 ✅, 23 ⏸)**
   318→
   319→---
   320→
   321→## §H 智能策略层 (Phase 8)
   322→
   323→### H.1 TWAP算法场景
   324→
   325→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   326→|------|---------|----------|------|----------|------|
   327→| H01 | `ALGO.TWAP.SLICE_CALC` | TWAP切片计算 | M5 | test_twap.py | ⏸ |
   328→| H02 | `ALGO.TWAP.TIME_DISTRIBUTE` | TWAP时间分布 | M5 | test_twap.py | ⏸ |
   329→| H03 | `ALGO.TWAP.PARTIAL_FILL` | TWAP部分成交处理 | M5 | test_twap.py | ⏸ |
   330→
   331→### H.2 VWAP算法场景
   332→
   333→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   334→|------|---------|----------|------|----------|------|
   335→| H04 | `ALGO.VWAP.VOLUME_PROFILE` | VWAP成交量分布 | M5 | test_vwap.py | ⏸ |
   336→| H05 | `ALGO.VWAP.PARTICIPATION` | VWAP参与率控制 | M5 | test_vwap.py | ⏸ |
   337→| H06 | `ALGO.VWAP.CATCH_UP` | VWAP追赶逻辑 | M5 | test_vwap.py | ⏸ |
   338→
   339→### H.3 冰山单场景
   340→
   341→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   342→|------|---------|----------|------|----------|------|
   343→| H07 | `ALGO.ICEBERG.DISPLAY_SIZE` | 冰山单显示量 | M5 | test_iceberg.py | ⏸ |
   344→| H08 | `ALGO.ICEBERG.REFRESH` | 冰山单刷新逻辑 | M5 | test_iceberg.py | ⏸ |
   345→| H09 | `ALGO.ICEBERG.RANDOM_SIZE` | 冰山单随机量 | M5 | test_iceberg.py | ⏸ |
   346→
   347→### H.4 自适应执行场景
   348→
   349→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   350→|------|---------|----------|------|----------|------|
   351→| H10 | `ALGO.ADAPTIVE.MARKET_STATE` | 自适应市场状态 | M5 | test_adaptive.py | ⏸ |
   352→| H11 | `ALGO.ADAPTIVE.STRATEGY_SWITCH` | 自适应策略切换 | M4 | test_adaptive.py | ⏸ |
   353→
   354→### H.5 市场冲击模型场景
   355→
   356→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   357→|------|---------|----------|------|----------|------|
   358→| H12 | `ALGO.IMPACT.ALMGREN_CHRISS` | Almgren-Chriss模型 | M5 | test_impact.py | ⏸ |
   359→| H13 | `ALGO.IMPACT.TEMPORARY` | 临时冲击计算 | M5 | test_impact.py | ⏸ |
   360→| H14 | `ALGO.IMPACT.PERMANENT` | 永久冲击计算 | M5 | test_impact.py | ⏸ |
   361→
   362→### H.6 实验性门禁场景
   363→
   364→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   365→|------|---------|----------|------|----------|------|
   366→| H15 | `EXP.MATURITY.80_THRESHOLD` | 80%成熟度门槛 | M18 | test_maturity.py | ✅ |
   367→| H16 | `EXP.MATURITY.60_DIMENSION` | 60%维度门槛 | M18 | test_maturity.py | ✅ |
   368→| H17 | `EXP.MATURITY.90_DAYS` | 90天最低训练 | M18 | test_maturity.py | ✅ |
   369→| H18 | `EXP.GATE.NO_BYPASS` | 禁止绕过门禁 | M18 | test_training_gate.py | ✅ |
   370→| H19 | `EXP.GATE.MANUAL_APPROVAL` | 需人工审批 | M12, M18 | test_training_gate.py | ✅ |
   371→| H20 | `EXP.MONITOR.PROGRESS` | 进度监控正确 | M18 | test_training_monitor.py | ✅ |
   372→| H21 | `EXP.MONITOR.ALERT` | 告警生成正确 | M9 | test_training_monitor.py | ✅ |
   373→| H22 | `EXP.MONITOR.ETA` | ETA预估正确 | M18 | test_training_monitor.py | ✅ |
   374→
   375→**Phase H 小计: 22 场景 (8 ✅, 14 ⏸)**
   376→
   377→---
   378→
   379→## §I 合规监控层 (Phase 9)
   380→
   381→### I.1 程序化合规场景
   382→
   383→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   384→|------|---------|----------|------|----------|------|
   385→| I01 | `COMPLIANCE.REGISTRATION` | 程序化交易备案 | M17 | test_compliance.py | ⏸ |
   386→| I02 | `COMPLIANCE.ALGO_RECORD` | 算法备案记录 | M17 | test_compliance.py | ⏸ |
   387→
   388→### I.2 报撤单频率场景
   389→
   390→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   391→|------|---------|----------|------|----------|------|
   392→| I03 | `THROTTLE.5S_LIMIT` | 5秒限制检查 | M17 | test_throttle.py | ⏸ |
   393→| I04 | `THROTTLE.DAILY_LIMIT` | 日内限制检查 | M17 | test_throttle.py | ⏸ |
   394→| I05 | `THROTTLE.HIGH_FREQ_DETECT` | 高频检测 | M17 | test_throttle.py | ⏸ |
   395→| I06 | `THROTTLE.WARNING_LEVEL` | 预警等级 | M17 | test_throttle.py | ⏸ |
   396→
   397→### I.3 大额订单场景
   398→
   399→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   400→|------|---------|----------|------|----------|------|
   401→| I07 | `COMPLIANCE.LARGE_ORDER` | 大额订单复核 | M12, M17 | test_large_order.py | ⏸ |
   402→| I08 | `COMPLIANCE.TIMEOUT_30S` | 30秒确认超时 | M12 | test_large_order.py | ⏸ |
   403→
   404→### I.4 健康监控场景
   405→
   406→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   407→|------|---------|----------|------|----------|------|
   408→| I09 | `MONITOR.HEALTH.CHECK` | 健康检查执行 | M9 | test_health.py | ✅ |
   409→| I10 | `MONITOR.HEALTH.COMPONENT` | 组件状态监控 | M9 | test_health.py | ✅ |
   410→| I11 | `MONITOR.HEALTH.DEGRADED` | 降级状态检测 | M4, M9 | test_health.py | ✅ |
   411→
   412→### I.5 指标监控场景
   413→
   414→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   415→|------|---------|----------|------|----------|------|
   416→| I12 | `MONITOR.METRICS.COUNTER` | 计数器指标 | M9 | test_metrics.py | ✅ |
   417→| I13 | `MONITOR.METRICS.GAUGE` | 仪表盘指标 | M9 | test_metrics.py | ✅ |
   418→| I14 | `MONITOR.METRICS.HISTOGRAM` | 直方图指标 | M9 | test_metrics.py | ✅ |
   419→| I15 | `MONITOR.METRICS.PROMETHEUS` | Prometheus导出 | M9 | test_metrics.py | ✅ |
   420→| I16 | `MONITOR.ALERT.THRESHOLD` | 阈值告警 | M9 | test_alerts.py | ⏸ |
   421→
   422→**Phase I 小计: 16 场景 (7 ✅, 9 ⏸)**
   423→
   424→---
   425→
   426→## §J 组合风控层 (Phase 10)
   427→
   428→### J.1 持仓管理场景
   429→
   430→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   431→|------|---------|----------|------|----------|------|
   432→| J01 | `PORTFOLIO.POSITION.UPDATE` | 持仓更新正确 | M1 | test_portfolio_manager.py | ✅ |
   433→| J02 | `PORTFOLIO.POSITION.LIMIT` | 持仓限额检查 | M6 | test_portfolio_manager.py | ✅ |
   434→| J03 | `PORTFOLIO.POSITION.NET` | 净持仓计算 | M1 | test_portfolio_manager.py | ✅ |
   435→| J04 | `PORTFOLIO.POSITION.SNAPSHOT` | 持仓快照正确 | M3 | test_portfolio_manager.py | ✅ |
   436→
   437→### J.2 风险分析场景
   438→
   439→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   440→|------|---------|----------|------|----------|------|
   441→| J05 | `PORTFOLIO.RISK.EXPOSURE` | 风险敞口计算 | M6 | test_portfolio_analytics.py | ✅ |
   442→| J06 | `PORTFOLIO.RISK.CONCENTRATION` | 集中度计算 | M6 | test_portfolio_analytics.py | ✅ |
   443→| J07 | `PORTFOLIO.PNL.ATTRIBUTION` | 盈亏归因 | M19 | test_portfolio_analytics.py | ✅ |
   444→| J08 | `PORTFOLIO.SHARPE.CALCULATE` | 夏普比率计算 | M19 | test_portfolio_analytics.py | ✅ |
   445→| J09 | `PORTFOLIO.DRAWDOWN.MAX` | 最大回撤计算 | M6 | test_portfolio_analytics.py | ✅ |
   446→
   447→### J.3 聚合场景
   448→
   449→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   450→|------|---------|----------|------|----------|------|
   451→| J10 | `PORTFOLIO.AGGREGATE.SYMBOL` | 按合约聚合 | M1 | test_aggregator.py | ✅ |
   452→| J11 | `PORTFOLIO.AGGREGATE.STRATEGY` | 按策略聚合 | M1 | test_aggregator.py | ✅ |
   453→| J12 | `PORTFOLIO.SNAPSHOT.TIMESERIES` | 时序快照 | M3 | test_aggregator.py | ✅ |
   454→
   455→### J.4 VaR场景
   456→
   457→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   458→|------|---------|----------|------|----------|------|
   459→| J13 | `VAR.HISTORICAL.PERCENTILE` | 历史VaR计算 | M6 | test_var_calculator.py | ✅ |
   460→| J14 | `VAR.PARAMETRIC.NORMAL` | 参数VaR计算 | M6 | test_var_calculator.py | ✅ |
   461→| J15 | `VAR.MONTECARLO.SIMULATION` | 蒙特卡洛VaR | M6 | test_var_calculator.py | ✅ |
   462→| J16 | `VAR.ES.CALCULATE` | ES/CVaR计算 | M6 | test_var_calculator.py | ✅ |
   463→| J17 | `VAR.EVT.GPD` | EVT-GPD方法 | M6 | test_var_enhanced.py | ⏸ |
   464→| J18 | `VAR.SEMIPARAMETRIC.KERNEL` | 半参数方法 | M6 | test_var_enhanced.py | ⏸ |
   465→| J19 | `VAR.LIMIT_ADJUSTED` | 涨跌停调整 | M6, M13 | test_var_enhanced.py | ⏸ |
   466→| J20 | `VAR.LIQUIDITY_ADJUSTED` | 流动性调整 | M6 | test_var_enhanced.py | ⏸ |
   467→
   468→### J.5 风险归因场景
   469→
   470→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   471→|------|---------|----------|------|----------|------|
   472→| J21 | `RISK.ATTRIBUTION.FACTOR` | 因子归因 | M19 | test_attribution.py | ⏸ |
   473→| J22 | `RISK.ATTRIBUTION.STRATEGY` | 策略归因 | M19 | test_attribution.py | ⏸ |
   474→| J23 | `RISK.ATTRIBUTION.POSITION` | 持仓归因 | M19 | test_attribution.py | ⏸ |
   475→
   476→### J.6 风控动作场景
   477→
   478→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   479→|------|---------|----------|------|----------|------|
   480→| J24 | `RISK.BREACH.DETECT` | 风险突破检测 | M6 | test_risk_manager.py | ✅ |
   481→| J25 | `RISK.KILLSWITCH.TRIGGER` | 熔断触发 | M6 | test_risk_manager.py | ✅ |
   482→
   483→**Phase J 小计: 25 场景 (18 ✅, 7 ⏸)**
   484→
   485→---
   486→
   487→## §K B类模型层 (Phase 6)
   488→
   489→### K.1 LSTM预测场景
   490→
   491→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   492→|------|---------|----------|------|----------|------|
   493→| K01 | `DL.LSTM.PREDICT` | LSTM预测输出 | M18 | test_lstm.py | ⏸ |
   494→| K02 | `DL.LSTM.SEQUENCE_LENGTH` | 序列长度正确 | M7 | test_lstm.py | ⏸ |
   495→| K03 | `DL.LSTM.HIDDEN_STATE` | 隐藏状态正确 | M7 | test_lstm.py | ⏸ |
   496→
   497→### K.2 Transformer场景
   498→
   499→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   500→|------|---------|----------|------|----------|------|
   501→| K04 | `DL.TRANSFORMER.ATTENTION` | 注意力计算正确 | M18 | test_transformer.py | ⏸ |
   502→| K05 | `DL.TRANSFORMER.POSITION_ENCODING` | 位置编码正确 | M7 | test_transformer.py | ⏸ |
   503→
   504→### K.3 因子挖掘场景
   505→
   506→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   507→|------|---------|----------|------|----------|------|
   508→| K06 | `DL.FACTOR.MINE` | 因子挖掘正确 | M18 | test_factor.py | ⏸ |
   509→| K07 | `DL.FACTOR.IC_CALCULATE` | IC计算正确 | M19 | test_factor.py | ⏸ |
   510→
   511→### K.4 强化学习场景
   512→
   513→| 序号 | Rule ID | 场景描述 | 军规 | 测试文件 | 状态 |
   514→|------|---------|----------|------|----------|------|
   515→| K08 | `RL.PPO.ACTION` | PPO动作选择 | M18 | test_ppo.py | ⏸ |
   516→| K09 | `RL.PPO.REWARD` | PPO奖励计算 | M18 | test_ppo.py | ⏸ |
   517→| K10 | `RL.DQN.QVALUE` | DQN Q值计算 | M18 | test_dqn.py | ⏸ |
   518→| K11 | `RL.DQN.EPSILON_DECAY` | ε衰减正确 | M18 | test_dqn.py | ⏸ |
   519→| K12 | `RL.REWARD.SHARPE_BASED` | 夏普奖励函数 | M18 | test_reward.py | ⏸ |
   520→
   521→**Phase K 小计: 12 场景 (0 ✅, 12 ⏸)**
   522→
   523→---
   524→
   525→## 场景统计总表
   526→
   527→### 按Phase统计
   528→
   529→| Phase | 名称 | 场景数 | 已完成 | 待完成 | 完成率 |
   530→|-------|------|--------|--------|--------|--------|
   531→| A | 基础设施 | 15 | 15 | 0 | 100% |
   532→| B | 行情层 | 12 | 12 | 0 | 100% |
   533→| C | 审计层 | 18 | 18 | 0 | 100% |
   534→| D | 策略降级 | 12 | 12 | 0 | 100% |
   535→| E | 回放验证 | 2 | 2 | 0 | 100% |
   536→| F | 成本层 | 8 | 4 | 4 | 50% |
   537→| G | 中国期货特化 | 23 | 0 | 23 | 0% |
   538→| H | 智能策略 | 22 | 8 | 14 | 36% |
   539→| I | 合规监控 | 16 | 7 | 9 | 44% |
   540→| J | 组合风控 | 25 | 18 | 7 | 72% |
   541→| K | B类模型 | 12 | 0 | 12 | 0% |
   542→| **总计** | - | **165** | **96** | **69** | **58%** |
   543→
   544→### 按状态统计
   545→
   546→| 状态 | 数量 | 占比 |
   547→|------|------|------|
   548→| ✅ 已完成 | 96 | 58% |
   549→| ⏸ 待完成 | 69 | 42% |
   550→
   551→---
   552→
   553→## 军规覆盖矩阵
   554→
   555→### 军规-场景映射
   556→
   557→| 军规 | 场景ID列表 | 场景数 | 覆盖状态 |
   558→|------|------------|--------|----------|
   559→| M1 | B01,B03,C18,D07,J01,J03,J10,J11 | 8 | ✅ 100% |
   560→| M3 | A15,C01-C18,J04,J12 | 20 | ✅ 100% |
   561→| M4 | A11,B10,C12,C13,D01-D03,H11,I11 | 9 | ✅ 100% |
   562→| M5 | D08,D12,F01-F08,H01-H14 | 22 | 部分 |
   563→| M6 | D06,D09,D11,G16-G21,J02,J05,J06,J09,J13-J20,J24,J25 | 24 | 部分 |
   564→| M7 | B08,B09,B11,B12,D04,D05,E01,E02,K02,K03,K05 | 11 | ✅ 100% |
   565→| M8 | A01-A14 | 14 | ✅ 100% |
   566→| M9 | A08-A11,B02,H21,I09-I16 | 15 | 部分 |
   567→| M10 | B07,C16 | 2 | ✅ 100% |
   568→| M11 | B04,B06 | 2 | ✅ 100% |
   569→| M12 | H19,I07,I08 | 3 | 部分 |
   570→| M13 | G08-G11,G16,J19 | 6 | ⏸ 待实现 |
   571→| M14 | F04 | 1 | ⏸ 待实现 |
   572→| M15 | B05,D10,G04-G07,G16-G18,G22,G23 | 11 | ⏸ 待实现 |
   573→| M16 | G12-G15,G17 | 5 | ⏸ 待实现 |
   574→| M17 | I01-I06 | 6 | ⏸ 待实现 |
   575→| M18 | H15-H22,K01-K12 | 20 | 部分 |
   576→| M19 | J07,J08,J21-J23,K07 | 6 | 部分 |
   577→| M20 | F08,G01-G03 | 4 | ⏸ 待实现 |
   578→
   579→### 军规覆盖率统计
   580→
   581→| 状态 | 军规 | 数量 |
   582→|------|------|------|
   583→| ✅ 完全覆盖 | M1,M3,M4,M7,M8,M10,M11 | 7 |
   584→| 部分覆盖 | M5,M6,M9,M12,M18,M19 | 6 |
   585→| ⏸ 待实现 | M13,M14,M15,M16,M17,M20 | 6 |
   586→
   587→---
   588→
   589→## 验收检查清单
   590→
   591→### Phase验收
   592→
   593→- [x] Phase A: 基础设施层 (15/15)
   594→- [x] Phase B: 行情层 (12/12)
   595→- [x] Phase C: 审计层 (18/18)
   596→- [x] Phase D: 策略降级层 (12/12)
   597→- [x] Phase E: 回放验证层 (2/2)
   598→- [ ] Phase F: 成本层 (4/8)
   599→- [ ] Phase G: 中国期货特化 (0/23)
   600→- [ ] Phase H: 智能策略层 (8/22)
   601→- [ ] Phase I: 合规监控层 (7/16)
   602→- [ ] Phase J: 组合风控层 (18/25)
   603→- [ ] Phase K: B类模型层 (0/12)
   604→
   605→### 军规验收
   606→
   607→- [x] M1: 单一信号源 (8/8)
   608→- [x] M3: 完整审计 (20/20)
   609→- [x] M4: 降级兜底 (9/9)
   610→- [ ] M5: 成本先行 (部分)
   611→- [ ] M6: 熔断保护 (部分)
   612→- [x] M7: 回放一致 (11/11)
   613→- [x] M8: 配置隔离 (14/14)
   614→- [ ] M9: 错误上报 (部分)
   615→- [x] M10: 资源限制 (2/2)
   616→- [x] M11: 版本兼容 (2/2)
   617→- [ ] M12: 双重确认 (部分)
   618→- [ ] M13: 涨跌停感知 (待实现)
   619→- [ ] M14: 平今平昨分离 (待实现)
   620→- [ ] M15: 夜盘跨日处理 (待实现)
   621→- [ ] M16: 保证金实时监控 (待实现)
   622→- [ ] M17: 程序化合规 (待实现)
   623→- [ ] M18: 实验性门禁 (部分)
   624→- [ ] M19: 风险归因 (部分)
   625→- [ ] M20: 跨所一致 (待实现)
   626→
   627→---
   628→
   629→## 附录：场景命名规范
   630→
   631→### Rule ID格式
   632→
   633→```
   634→{模块}.{功能}.{场景}
   635→
   636→示例：
   637→- AUDIT.WRITER.CLOSE_BEHAVIOR
   638→- CHINA.MARGIN.WARNING_LEVEL
   639→- VAR.MONTECARLO.SIMULATION
   640→```
   641→
   642→### 模块缩写
   643→
   644→| 缩写 | 全称 |
   645→|------|------|
   646→| INFRA | Infrastructure (基础设施) |
   647→| MKT | Market (行情) |
   648→| AUDIT | Audit (审计) |
   649→| STRAT | Strategy (策略) |
   650→| ARB | Arbitrage (套利) |
   651→| REPLAY | Replay (回放) |
   652→| COST | Cost (成本) |
   653→| CHINA | China (中国特化) |
   654→| ALGO | Algorithm (算法) |
   655→| EXP | Experimental (实验性) |
   656→| THROTTLE | Throttle (节流) |
   657→| COMPLIANCE | Compliance (合规) |
   658→| MONITOR | Monitoring (监控) |
   659→| PORTFOLIO | Portfolio (组合) |
   660→| VAR | Value at Risk (VaR) |
   661→| RISK | Risk (风险) |
   662→| DL | Deep Learning (深度学习) |
   663→| RL | Reinforcement Learning (强化学习) |
   664→
   665→---
   666→
   667→**文档结束**
   668→
   669→```
   670→┌─────────────────────────────────────────────────────────────────────┐
   671→│                                                                     │
   672→│              V4PRO 验收矩阵报告 - 165条场景全覆盖                    │
   673→│                                                                     │
   674→│                    军规级品质保证！                                  │
   675→│                                                                     │
   676→│                    CLAUDE上校 2025-12-16                            │
   677→│                                                                     │
   678→└─────────────────────────────────────────────────────────────────────┘
   679→```
   680→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
