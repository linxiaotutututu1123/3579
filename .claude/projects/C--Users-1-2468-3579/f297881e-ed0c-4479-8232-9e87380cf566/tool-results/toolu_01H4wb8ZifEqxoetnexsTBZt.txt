            0.06,
            0.08,
            0.10,
        ] * 10
    
        hist = calc.historical_var(returns)
        param = calc.parametric_var(returns)
        mc = calc.monte_carlo_var(returns, simulations=1000)
    
        # ���з���Ӧ�÷�������VaR
        assert hist.var >= 0
        assert param.var >= 0
>       assert mc.var >= 0
E       AssertionError: assert -0.024734529010298698 >= 0
E        +  where -0.024734529010298698 = VaRResult(var=-0.024734529010298698, confidence=0.95, method='monte_carlo', expected_shortfall=-0.024734529010298698, sample_size=100, metadata={'simulations': 1000, 'horizon': 1}).var

tests\test_var_calculator.py:143: AssertionError
=============================== tests coverage ================================
______________ coverage: platform win32, python 3.12.10-final-0 _______________

Name                                              Stmts   Miss Branch BrPart  Cover   Missing
---------------------------------------------------------------------------------------------
src\app\config.py                                   182      3     60      2    98%   191, 328->332, 429-430
src\app\logger.py                                   148      1     28      3    98%   209->183, 375, 456->459
src\audit\order_trail.py                             78     12      0      0    85%   68, 72-74, 118, 122-124, 166, 170-172
src\audit\writer.py                                  81      1     20      3    96%   54->exit, 137, 203->201
src\brokers\ctp\api.py                              238     38     40      5    83%   299-313, 353->350, 355-361, 414-417, 435-436, 449-452, 490-497, 528-530, 556->560, 579
src\brokers\ctp\config.py                           122      0     36      2    99%   268->272, 333->337
src\compliance\china_futures_rules.py               180      4     56      6    96%   269->272, 443, 462, 467, 532, 597->602
src\compliance\programmatic_trading.py              219      7     56      9    94%   221, 262, 265, 268, 295, 308, 370->367, 563->567, 592, 603->606
src\config.py                                        26      1      2      1    93%   33
src\cost\china_fee_calculator.py                    127     11     38      6    88%   354, 357, 388->392, 395->399, 404-405, 413-416, 484-489
src\cost\estimator.py                                82      9     22      4    82%   266-268, 272->277, 289-291, 304-306
src\execution\auto\engine.py                        175     44     62     14    67%   163-175, 190, 205-209, 230, 239, 269, 273, 285, 343, 348-356, 391->exit, 402-406, 419-424, 470-472, 474, 477-482
src\execution\auto\exec_context.py                  125     10     20      7    88%   116->115, 118, 133, 151-152, 166-167, 181->178, 208, 229-230, 328
src\execution\auto\order_context.py                  81      0     14      2    98%   223->225, 225->227
src\execution\auto\position_tracker.py              119      3     26      4    95%   174->189, 183->189, 288, 305, 325
src\execution\auto\retry.py                          98      3     24      2    96%   101, 128, 245
src\execution\auto\timeout.py                        82      3     22      3    94%   73, 86, 231
src\execution\broker_factory.py                      22      1      8      1    93%   79
src\execution\ctp_broker.py                          88      9     18      3    89%   105, 130->exit, 159-165, 194, 223-224
src\execution\flatten_executor.py                    73      4     22      5    91%   39, 41, 43, 45, 116->123
src\execution\flatten_plan.py                        57      0     22      1    99%   72->74
src\execution\pair\leg_manager.py                   125     11     28     10    86%   75, 80, 91, 96->99, 107, 165, 233, 251, 268, 286, 347, 362, 375->373
src\execution\pair\pair_executor.py                 175     37     42     11    74%   185, 229-252, 282, 287, 310, 316, 320-344, 350->exit, 361, 365, 381-382, 407, 455-472, 476
src\execution\protection\fat_finger.py               77      5      8      0    94%   107, 141, 146, 151, 236
src\execution\protection\limit_price.py             165      2     44      4    97%   580->586, 583->580, 599, 613
src\execution\protection\liquidity.py                80      9     12      3    87%   70, 104, 137, 142, 147, 200-201, 212-213
src\execution\protection\margin_monitor.py          238      4     58      2    98%   547, 626-628
src\execution\protection\throttle.py                 97     12     26      6    82%   70, 109, 114, 128, 185, 202, 205->208, 245, 253-258
src\guardian\actions.py                              89     12     26      5    85%   71, 75, 164->162, 183-184, 192, 227, 241-242, 250, 282-283, 292
src\guardian\monitor.py                             108     20     32      7    78%   106, 116, 164, 189-190, 194, 225->221, 235-236, 260-265, 270-273, 295-296
src\guardian\recovery.py                            116     10     16      0    92%   196-197, 208-209, 221-222, 234-235, 256-257
src\guardian\state_machine.py                        49      1      6      1    96%   167
src\guardian\triggers.py                            109      0     28      1    99%   362->361
src\guardian\triggers_china.py                      206      2     52      2    98%   269, 537
src\market\exchange_config.py                        87      1     16      1    98%   624
src\market\instrument_cache.py                       61      4     10      0    92%   133-136
src\market\quality.py                                72      2     26      2    96%   150, 222
src\market\subscriber.py                             52      1     12      0    98%   29
src\market\trading_calendar.py                      193     24     96     16    83%   334, 340, 348, 350, 369, 397, 417, 424, 432-433, 437, 459-461, 488, 497-500, 507, 511-514, 560->562
src\market\universe_selector.py                      91      9     30      4    89%   91, 122, 127, 140, 195-196, 206-207, 233
src\monitoring\health.py                             75      1      8      1    98%   166
src\portfolio\analytics.py                           91      0     24      1    99%   255->253
src\portfolio\manager.py                             99     20     14      2    77%   119->125, 127-130, 233-236, 240-243, 260-266, 281
src\portfolio\rebalancer.py                          34      0     20      1    98%   128->30
src\replay\runner.py                                 56      1     10      1    97%   132
src\replay\verifier.py                              105      0     30      1    99%   208->218
src\risk\manager.py                                  85      2     22      3    95%   23->exit, 84, 195
src\risk\state.py                                    37      1      4      1    95%   32
src\risk\stress_test_china.py                       187      1     48      1    99%   476
src\risk\var_calculator.py                          104      1     26      2    98%   204->202, 262
src\runner.py                                        60      4      4      2    91%   56, 60, 104->108, 147-148
src\strategy\calendar_arb\delivery_aware.py         206      6     62     10    94%   227, 276->274, 333, 419, 467, 472->465, 480, 579, 594->608, 602->608
src\strategy\calendar_arb\kalman_beta.py            125      6     18      4    93%   271, 275, 303, 312, 317-318
src\strategy\calendar_arb\strategy.py               251    160     60      0    29%   136, 185-210, 229-237, 249-290, 314-396, 427, 438-441, 451-468, 482-485, 499-502, 519-526, 544-562, 573-577, 589-595, 604-611, 619-643, 654-660, 671, 682, 687, 692, 697, 702, 706, 724-725
src\strategy\dl\features.py                          36      0     16      4    92%   40->39, 45->49, 50->54, 56->55
src\strategy\dl\policy.py                            13      0      2      1    93%   32->35
src\strategy\ensemble_moe.py                        101      6     22      7    89%   101, 119, 178, 182, 188, 191->190, 194
src\strategy\experimental\maturity_evaluator.py     317     36    102     22    85%   132, 256->260, 307-308, 310-311, 328, 372-373, 375-376, 386, 388, 402-404, 414, 416, 504, 506, 516, 518, 593, 623, 649, 662-671, 698, 742-743, 773, 784
src\strategy\experimental\training_gate.py          112     28     16      3    70%   89->93, 94-96, 201-207, 238-240, 253-256, 269-273, 284, 295, 322, 339, 357, 370, 375
src\strategy\experimental\training_monitor.py       248      7     78     14    94%   150->155, 158->165, 173->180, 181, 183->186, 218, 342, 354->358, 406-410, 482, 485->492, 591->594
src\strategy\fallback.py                            138      0     16      2    99%   282->256, 299->256
src\strategy\linear_ai.py                            81      3     28      4    94%   107->105, 114, 124, 138
src\strategy\top_tier_trend_risk_parity.py           92      3     22      3    95%   100, 109, 113
src\trading\ci_gate.py                              401    161    116      7    51%   233->exit, 275-293, 305-306, 312, 317, 330-333, 385, 387, 408-409, 444->446, 446->448, 448->451, 452->exit, 523-541, 546-565, 570-582, 631-652, 885, 900-901, 906, 915-916, 920, 929, 933-936, 953-1028, 1043-1079, 1091-1106, 1132-1133, 1138, 1143-1146, 1151, 1156-1159, 1163, 1167, 1181, 1185-1188
src\trading\live_guard.py                            54      0      8      1    98%   137->exit
src\trading\orchestrator.py                          53      5      8      2    89%   100, 146-163
src\trading\replay.py                                35      0     14      1    98%   119->101
src\trading\serial_exec.py                           26      0      6      1    97%   66->71
src\trading\sim.py                                   35      0     14      1    98%   117->100
src\trading\sim_gate.py                             143     12     18      5    87%   115-116, 152, 187->189, 189->191, 191->194, 195->exit, 293-294, 373, 385, 421-426
---------------------------------------------------------------------------------------------
TOTAL                                              9313    794   2206    266    89%

54 files skipped due to complete coverage.
Required test coverage of 85.0% reached. Total coverage: 88.84%
=========================== short test summary info ===========================
FAILED tests/test_var_calculator.py::TestVaRCalculatorIntegration::test_all_methods_consistent
1 failed, 1686 passed in 6.96s