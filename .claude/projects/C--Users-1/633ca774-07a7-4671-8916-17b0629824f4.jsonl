{"type":"queue-operation","operation":"dequeue","timestamp":"2025-12-09T01:06:37.523Z","sessionId":"633ca774-07a7-4671-8916-17b0629824f4"}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_opened_file>The user opened the file c:\\Users\\1\\Desktop\\ç«å±±æ–¹èˆŸå¤§æ¨¡å‹ä½“éªŒä¸­å¿ƒ-ç«å±±å¼•æ“_files\\ç»ˆæç‰ˆä¿®å¤æºç .py in the IDE. This may or may not be related to the current task.</ide_opened_file>"},{"type":"text","text":"ä½ æ˜¯è°"}]},"uuid":"ff6d0cc2-c51a-452e-aefd-335f2832165f","timestamp":"2025-12-09T01:06:37.555Z"}
{"parentUuid":"ff6d0cc2-c51a-452e-aefd-335f2832165f","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","message":{"model":"claude-opus-4-5-20251101","id":"msg_01HhcUg1cJj4yWZLivjTkUFw","type":"message","role":"assistant","content":[{"type":"text","text":"æˆ‘æ˜¯ Claudeï¼Œç”± Anthropic å¼€å‘çš„ AI åŠ©æ‰‹ã€‚æˆ‘ç›®å‰æ­£åœ¨é€šè¿‡ Claude Codeï¼ˆAnthropic çš„å®˜æ–¹å‘½ä»¤è¡Œå·¥å…·ï¼‰è¿è¡Œã€‚\n\næˆ‘å¯ä»¥å¸®åŠ©ä½ å®Œæˆè½¯ä»¶å·¥ç¨‹ä»»åŠ¡ï¼Œæ¯”å¦‚ï¼š\n- é˜…è¯»å’Œç†è§£ä»£ç \n- ä¿®å¤ bug\n- æ·»åŠ æ–°åŠŸèƒ½\n- é‡æ„ä»£ç \n- è§£é‡Šä»£ç é€»è¾‘\n\næˆ‘çœ‹åˆ°ä½ æ‰“å¼€äº†ä¸€ä¸ª Python æ–‡ä»¶ `ç»ˆæç‰ˆä¿®å¤æºç .py`ã€‚æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿ"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":17553,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":17553,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"type":"assistant","uuid":"c120aa8d-dc60-4a5c-9c15-6945f87beb75","timestamp":"2025-12-09T01:06:42.957Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2025-12-09T01:08:03.825Z","sessionId":"633ca774-07a7-4671-8916-17b0629824f4"}
{"parentUuid":"c120aa8d-dc60-4a5c-9c15-6945f87beb75","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_opened_file>The user opened the file c:\\Users\\1\\Desktop\\ç«å±±æ–¹èˆŸå¤§æ¨¡å‹ä½“éªŒä¸­å¿ƒ-ç«å±±å¼•æ“_files\\ç»ˆæç‰ˆä¿®å¤æºç .py in the IDE. This may or may not be related to the current task.</ide_opened_file>"},{"type":"text","text":"ä½ æ˜¯è°"}]},"uuid":"797a4265-b86f-44ce-90d8-d88538d2cd4d","timestamp":"2025-12-09T01:08:03.854Z"}
{"parentUuid":"797a4265-b86f-44ce-90d8-d88538d2cd4d","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","message":{"model":"claude-opus-4-5-20251101","id":"msg_019cKnvQJt2Gsow23sUSWV7J","type":"message","role":"assistant","content":[{"type":"text","text":"æˆ‘æ˜¯ Claudeï¼Œç”± Anthropic å…¬å¸å¼€å‘çš„ AI åŠ©æ‰‹ã€‚\n\nå½“å‰æˆ‘è¿è¡Œåœ¨ Claude Code ç¯å¢ƒä¸­ï¼Œä½¿ç”¨çš„æ¨¡å‹æ˜¯ **Claude Opus 4.5**ï¼ˆAnthropic æœ€æ–°çš„å‰æ²¿æ¨¡å‹ï¼‰ã€‚\n\næˆ‘å¯ä»¥å¸®åŠ©ä½ å¤„ç†è½¯ä»¶å¼€å‘ç›¸å…³çš„ä»»åŠ¡ï¼Œæ¯”å¦‚é˜…è¯»ä»£ç ã€ä¿®å¤ bugã€ç¼–å†™æ–°åŠŸèƒ½ç­‰ã€‚\n\nä½ æœ‰ä»€ä¹ˆéœ€è¦å¸®åŠ©çš„å—ï¼Ÿ"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":235,"cache_read_input_tokens":17553,"cache_creation":{"ephemeral_5m_input_tokens":235,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"type":"assistant","uuid":"99bd33d0-88cc-46cd-a677-c204eff5d758","timestamp":"2025-12-09T01:08:08.738Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2025-12-09T01:08:44.674Z","sessionId":"633ca774-07a7-4671-8916-17b0629824f4"}
{"parentUuid":"99bd33d0-88cc-46cd-a677-c204eff5d758","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","type":"user","message":{"role":"user","content":[{"type":"text","text":"å…¨é¢çš„æ£€æŸ¥è¿™ä¸ªæ¨¡å‹ä»£ç çš„æœ‰é”™ï¼Œæ£€æŸ¥å®Œè·Ÿæ±‡æŠ¥"}]},"uuid":"eeae179e-dfe7-42ce-9747-00476d93fb65","timestamp":"2025-12-09T01:08:44.695Z"}
{"parentUuid":"eeae179e-dfe7-42ce-9747-00476d93fb65","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","message":{"model":"claude-opus-4-5-20251101","id":"msg_017ZU2XhuSp195fWd3R1Jkqk","type":"message","role":"assistant","content":[{"type":"text","text":"æˆ‘æ¥è¯»å–å¹¶å…¨é¢æ£€æŸ¥è¿™ä¸ªä»£ç æ–‡ä»¶ã€‚"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":17941,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":17941,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"type":"assistant","uuid":"eaae2a28-4519-41ec-88cb-dd6739ee4796","timestamp":"2025-12-09T01:08:48.524Z"}
{"parentUuid":"eaae2a28-4519-41ec-88cb-dd6739ee4796","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","message":{"model":"claude-opus-4-5-20251101","id":"msg_017ZU2XhuSp195fWd3R1Jkqk","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KExqiDe95GmprtCJtiZcYV","name":"Read","input":{"file_path":"c:\\Users\\1\\Desktop\\ç«å±±æ–¹èˆŸå¤§æ¨¡å‹ä½“éªŒä¸­å¿ƒ-ç«å±±å¼•æ“_files\\ç»ˆæç‰ˆä¿®å¤æºç .py"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":17941,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":17941,"ephemeral_1h_input_tokens":0},"output_tokens":108,"service_tier":"standard"}},"type":"assistant","uuid":"e51ff5ad-e004-4507-bb57-0260b12523ef","timestamp":"2025-12-09T01:08:49.354Z"}
{"parentUuid":"e51ff5ad-e004-4507-bb57-0260b12523ef","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","slug":"misty-marinating-boot","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01KExqiDe95GmprtCJtiZcYV","type":"tool_result","content":"     1â†’# -*- coding: utf-8 -*-\n     2â†’\"\"\"\n     3â†’ğŸ”·ğŸ’ é’»çŸ³å…‰å­¦æ€§èƒ½é‡å­çº§ç²¾å¯†è¯„ä¼°ç³»ç»Ÿ - å…¨çƒæœ€å®Œç¾é’»çŸ³ç§‘å­¦è®¡ç®—å¼•æ“ ğŸ’ğŸ”·\n     4â†’ä½œè€…ï¼šæ—å°å…”\n     5â†’\n     6â†’===ã€ç³»ç»Ÿæ¦‚è¿°ã€‘===\n     7â†’æœ¬ç³»ç»Ÿæ˜¯å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦é’»çŸ³å…‰å­¦æ€§èƒ½é‡åŒ–è¯„ä¼°å¹³å°ï¼Œé‡‡ç”¨ï¼š\n     8â†’ğŸ”¬ å®Œæ•´é‡å­å…‰å­¦ç‰©ç†æ¨¡æ‹Ÿ\n     9â†’ğŸ“Š è’™ç‰¹å¡æ´›å…‰çº¿è¿½è¸ªå¼•æ“ï¼ˆ10,000+å…‰å­é‡‡æ ·ï¼‰\n    10â†’ğŸŒˆ å…¨å…‰è°±è¦†ç›–ï¼ˆ380-780nmï¼Œæ¯1nmé‡‡æ ·ï¼‰\n    11â†’ğŸ¯ è¶…é«˜ç²¾åº¦æ•°å­¦è¿ç®—ï¼ˆ50ä½å°æ•°ç²¾åº¦ï¼‰\n    12â†’âš¡ å¤šçº¿ç¨‹å¹¶è¡Œè®¡ç®—æ¶æ„\n    13â†’ğŸŒ¡ï¸ æ¸©åº¦ç›¸å…³å…‰å­¦ç‰¹æ€§å»ºæ¨¡\n    14â†’ğŸ’« è§å…‰æ•ˆåº”å®Œæ•´æ¨¡æ‹Ÿ\n    15â†’ğŸ” è¡¨é¢å¾®è§‚ç»“æ„ç²¾ç¡®å»ºæ¨¡\n    16â†’\n    17â†’===ã€æ ¸å¿ƒç§‘å­¦åŸç†ã€‘===\n    18â†’1ï¸âƒ£ **æ”¹è¿›Sellmeieræ–¹ç¨‹**ï¼šæ¸©åº¦ä¿®æ­£ã€è‰²æ•£ä¼˜åŒ–ã€å®éªŒæ•°æ®æ ¡å‡†\n    19â†’2ï¸âƒ£ **å®Œæ•´è²æ¶…å°”ç†è®º**ï¼šåæŒ¯æ€æ¼”åŒ–ã€å¤šå±‚è–„è†œå¹²æ¶‰ã€è¡¨é¢ç²—ç³™åº¦å»ºæ¨¡\n    20â†’3ï¸âƒ£ **è’™ç‰¹å¡æ´›è·¯å¾„è¿½è¸ª**ï¼šå…‰çº¿å¤šé‡æ•£å°„ã€å†…éƒ¨ç¼ºé™·æ¨¡æ‹Ÿã€èƒ½é‡å®ˆæ’éªŒè¯\n    21â†’4ï¸âƒ£ **é‡å­è§å…‰æ¨¡å‹**ï¼šUVæ¿€å‘ã€å‘å°„å…‰è°±ã€é‡å­äº§ç‡è®¡ç®—\n    22â†’5ï¸âƒ£ **è‰²æ•£åˆ†æç®—æ³•**ï¼šæ³¢é•¿ç›¸å…³æŠ˜å°„ç‡ã€é˜¿è´æ•°è®¡ç®—ã€ç«å½©é‡åŒ–\n    23â†’6ï¸âƒ£ **ç»Ÿè®¡è¯¯å·®åˆ†æ**ï¼šè´å¶æ–¯æ¨æ–­ã€ç½®ä¿¡åŒºé—´ã€ä¸ç¡®å®šæ€§é‡åŒ–\n    24â†’\n    25â†’===ã€8å¤§è¾“å…¥å‚æ•°ã€‘===\n    26â†’- å† è§’ Crown Angle (Î¸c)ï¼šå†³å®šå…‰çº¿è¿›å…¥å’Œå‡ºå°„çš„å…³é”®è§’åº¦\n    27â†’- äº­è§’ Pavilion Angle (Î¸p)ï¼šæ§åˆ¶å…¨å†…åå°„å’Œå…‰çº¿å›å°„\n    28â†’- å°å®½æ¯” Table Ratio (T)ï¼šå½±å“äº®åº¦å’Œå¯¹ç§°æ€§\n    29â†’- å† é«˜æ¯” Crown Height (C)ï¼šå†³å®šå…‰çº¿åˆ†æ•£å’Œç«å½©\n    30â†’- äº­æ·±æ¯” Pavilion Depth (P)ï¼šå½±å“å…‰çº¿è·¯å¾„é•¿åº¦\n    31â†’- å…¨æ·±æ¯” Total Depth (TD)ï¼šæ•´ä½“æ¯”ä¾‹åè°ƒæ€§\n    32â†’- å…‹æ‹‰é‡é‡ Carat (ct)ï¼šå°ºå¯¸ç›¸å…³å…‰å­¦æ•ˆåº”\n    33â†’- ç›´å¾„ Diameter (D)ï¼šå®é™…å¤§å°å¯¹å…‰å­¦çš„å½±å“\n    34â†’\n    35â†’===ã€åŸºå‡†é’»çŸ³å‚æ•° - ä¸–ç•Œä¸Šæœ€å®Œç¾çš„ç†æƒ³åˆ‡å·¥ã€‘===\n    36â†’ğŸ† **å®Œç¾åŸºå‡†æ¯”ä¾‹**ï¼š\n    37â†’- å† è§’ï¼š34.5Â°ï¼ˆæœ€ä¼˜å…‰çº¿è¿›å…¥è§’åº¦ï¼‰\n    38â†’- äº­è§’ï¼š40.75Â°ï¼ˆå®Œç¾å…¨å†…åå°„è§’åº¦ï¼‰\n    39â†’- å°å®½æ¯”ï¼š55.5%ï¼ˆæœ€ä¼˜äº®åº¦ä¸ç«å½©å¹³è¡¡ï¼‰\n    40â†’- å† é«˜æ¯”ï¼š15.2%ï¼ˆç†æƒ³å…‰çº¿åˆ†æ•£é«˜åº¦ï¼‰\n    41â†’- äº­æ·±æ¯”ï¼š43.1%ï¼ˆå®Œç¾å…‰çº¿å›å°„æ·±åº¦ï¼‰\n    42â†’- å…¨æ·±æ¯”ï¼š61.8%ï¼ˆé»„é‡‘æ¯”ä¾‹ï¼Œç¬¦åˆæ–æ³¢é‚£å¥‘æ•°åˆ—ï¼‰\n    43â†’- å…‹æ‹‰ï¼š1.0000 ctï¼ˆæ ‡å‡†å‚è€ƒé‡é‡ï¼‰\n    44â†’- ç›´å¾„ï¼š6.500 mmï¼ˆå®Œç¾å‡ ä½•å°ºå¯¸ï¼‰\n    45â†’\n    46â†’ğŸ’¯ **åŸºå‡†é’»çŸ³å¼ºåˆ¶æ»¡åˆ†çº§æ•°**ï¼šäº®åº¦=10.0ï¼Œç«å½©=10.0ï¼Œé—ªåº¦=10.0\n    47â†’\n    48â†’===ã€è¯„åˆ†ç³»ç»Ÿ - å…¨ä¸–ç•Œæœ€ç§‘å­¦çš„å…‰å­¦è¯„ä»·ä½“ç³»ã€‘===\n    49â†’ğŸ”¸ **ä¸‰å¤§æ ¸å¿ƒæŒ‡æ ‡** (0-10åˆ†)ï¼š\n    50â†’   - äº®åº¦ (äº®åº¦)ï¼šæ€»è¿”å›å…‰èƒ½é‡ï¼ŒCIE V(Î»)åŠ æƒ\n    51â†’   - ç«å½© (ç«å½©)ï¼šè‰²æ•£å¼ºåº¦ï¼Œå…‰è°±åˆ†ç¦»åº¦é‡åŒ–\n    52â†’   - é—ªåº¦ (é—ªåº¦)ï¼šåŠ¨æ€å…‰å­¦æ•ˆæœï¼Œè·¯å¾„å˜åŒ–ç‡\n    53â†’\n    54â†’ğŸ”¸ **ç»¼åˆè¯„åˆ†å…¬å¼**ï¼š\n    55â†’   - å…‰å­¦æ€§èƒ½ OP = 0.50Ã—B + 0.35Ã—F + 0.15Ã—S\n    56â†’   - ç»¼åˆç¾è§‚åº¦ CS = 0.65Ã—OP + 0.35Ã—(HAÃ·10)\n    57â†’\n    58â†’ğŸ”¸ **ç­‰çº§åˆ’åˆ†æ ‡å‡†**ï¼š\n    59â†’   - æä¼˜ EXï¼šOP â‰¥ 9.5ï¼ˆä¸–ç•Œé¡¶çº§é’»çŸ³ï¼‰\n    60â†’   - ä¼˜ VGï¼š9.0 â‰¤ OP < 9.5ï¼ˆé«˜ç«¯é’»çŸ³ï¼‰\n    61â†’   - è‰¯ Goodï¼š8.0 â‰¤ OP < 9.0ï¼ˆä¼˜è´¨é’»çŸ³ï¼‰\n    62â†’   - ä¸€èˆ¬ Fairï¼šOP < 8.0ï¼ˆæ™®é€šé’»çŸ³ï¼‰\n    63â†’\n    64â†’===ã€å¯†ç ä¿æŠ¤åŠŸèƒ½ã€‘===\n    65â†’ğŸ” ç®¡ç†å‘˜å¯†ç ï¼š200115\n    66â†’ğŸ¯ åŠŸèƒ½ï¼šå¯è°ƒæ•´åŸºå‡†ç›®æ ‡åˆ†æ•°ï¼Œé€‚åº”ä¸åŒå¸‚åœºéœ€æ±‚\n    67â†’âš™ï¸ æ ‡å®šï¼šè‡ªåŠ¨é‡æ–°æ ¡å‡†ç³»ç»Ÿï¼Œç¡®ä¿åŸºå‡†é’»çŸ³è·å¾—æ»¡åˆ†\n    68â†’\n    69â†’===ã€æŠ€æœ¯åˆ›æ–°ç‚¹ã€‘===\n    70â†’ğŸš€ **å…¨çƒé¦–åˆ›**ï¼š\n    71â†’- è¶…é«˜ç²¾åº¦ï¼ˆ50ä½å°æ•°ï¼‰é‡å­å…‰å­¦è®¡ç®—\n    72â†’- å®Œæ•´åæŒ¯æ€æ¼”åŒ–è¿½è¸ª\n    73â†’- å¤šå±‚è–„è†œå¹²æ¶‰å»ºæ¨¡\n    74â†’- æ¸©åº¦ç›¸å…³å…‰å­¦ç‰¹æ€§\n    75â†’- è§å…‰é‡å­æ•ˆç‡è®¡ç®—\n    76â†’- å†…éƒ¨ç¼ºé™·æ•£å°„åˆ†æ\n    77â†’- è’™ç‰¹å¡æ´›ç»Ÿè®¡éªŒè¯\n    78â†’- GPUåŠ é€Ÿå¹¶è¡Œè®¡ç®—æ¶æ„\n    79â†’\n    80â†’ğŸ† **ç²¾åº¦ä¿è¯**ï¼šæ— é™æ¥è¿‘ç°å®æµ‹é‡ç»“æœï¼Œè¯¯å·®å°äº0.001%\n    81â†’ğŸ”¬ **ç§‘å­¦éªŒè¯**ï¼šåŸºäºNISTæ ‡å‡†æ•°æ®å’ŒGIAè®¤è¯æ ‡å‡†\n    82â†’ğŸ“ˆ **å¸‚åœºåº”ç”¨**ï¼šæ”¯æŒGIAã€IGIã€HRDç­‰å›½é™…è¯ä¹¦ä½“ç³»\n    83â†’\n    84â†’===ã€ä½¿ç”¨ç¯å¢ƒã€‘===\n    85â†’ğŸ’» æ”¯æŒWindows EXEç‹¬ç«‹è¿è¡Œ\n    86â†’ğŸ–¥ï¸ å®Œæ•´ä¸­æ–‡ç•Œé¢ï¼Œç”¨æˆ·å‹å¥½è®¾è®¡\n    87â†’ğŸ“Š ä¸°å¯Œå¯è§†åŒ–å±•ç¤ºï¼Œ3Då›¾å½¢è¾“å‡º\n    88â†’ğŸ“‹ è¯¦ç»†è¯„ä¼°æŠ¥å‘Šï¼Œæ”¯æŒPDFå¯¼å‡º\n    89â†’ğŸ”’ æ•°æ®å®‰å…¨ä¿æŠ¤ï¼Œæœ¬åœ°åŒ–å­˜å‚¨\n    90â†’\n    91â†’ğŸ–ï¸ æœ¬ç³»ç»Ÿä»£è¡¨äº†é’»çŸ³å…‰å­¦è¯„ä¼°é¢†åŸŸçš„ä¸–ç•Œæœ€é«˜æ°´å‡†ï¼Œæ˜¯é’»çŸ³è¡Œä¸šé©å‘½æ€§çš„ç§‘å­¦å·¥å…·ï¼\n    92â†’ğŸ… ä½œè€…ï¼šæ—å°å…” - é’»çŸ³å…‰å­¦ç§‘å­¦ç ”ç©¶çš„å…ˆé©±è€…\n    93â†’\"\"\"\n    94â†’\n    95â†’import math\n    96â†’import json\n    97â†’import os\n    98â†’import sys\n    99â†’import threading\n   100â†’import queue\n   101â†’import cosmic_animation  # ğŸŒŒ å®‡å®™çº§åŠ¨ç”»ç³»ç»Ÿ\n   102â†’import logging\n   103â†’import random\n   104â†’import tempfile\n   105â†’from dataclasses import dataclass\n   106â†’from datetime import datetime\n   107â†’from decimal import Decimal, getcontext, ROUND_HALF_EVEN\n   108â†’from typing import Dict, Any, Tuple, List\n   109â†’\n   110â†’import tkinter as tk\n   111â†’from tkinter import ttk, messagebox, filedialog, Canvas\n   112â†’from PIL import Image, ImageTk, ImageDraw, ImageFont\n   113â†’\n   114â†’# ---------------- ğŸ”¥ å…¨ä¸–ç•Œæœ€å¼ºè¶…é«˜ç²¾åº¦æ•°å­¦é…ç½® ğŸ”¥ ----------------\n   115â†’getcontext().prec = 200  # ğŸŒŒ å®‡å®™çº§ç²¾åº¦ï¼è¶…è¶ŠåŸå­çº§å‡ ä¸‡å€ï¼è¾¾åˆ°å®‡å®™çº§æ— æ•Œè®¡ç®—å¨åŠ›ï¼\n   116â†’PI = Decimal('3.141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067983148086513282306647093844609550582231725359408128')  # ğŸ”¥ è¶…é«˜ç²¾åº¦Ï€å€¼ï¼š100ä½å°æ•°ï¼Œç¡®ä¿é‡å­çº§è®¡ç®—ç²¾åº¦ï¼\n   117â†’E = Decimal('2.7182818284590452353602874713526624977572470936999595749669676277240766303535475945713821785251664274')  # ğŸ”¥ è¶…é«˜ç²¾åº¦eå€¼ï¼šè‡ªç„¶å¯¹æ•°åº•\n   118â†’LN2 = Decimal('0.693147180559945309417232121458176568075500134360255254120680009')  # ln(2)\n   119â†’LN10 = Decimal('2.302585092994045684017991454684364207601101488628772976033327900')  # ln(10)\n   120â†’LOG2_E = Decimal('1.4426950408889634073599246810018921374266459541529859341354494069311092191811850798855266')  # logâ‚‚(e)\n   121â†’LOG10_E = Decimal('0.4342944819032518276511289189166050822943970058036665661145378325854649557025852744675194660')  # logâ‚â‚€(e)\n   122â†’SQRT2 = Decimal('1.4142135623730950488016887242096980785696718753769480731766797379907324784621070388503875343276415727')  # âˆš2\n   123â†’SQRT_PI = Decimal('1.772453850905516027298167483341145182797549456122387128213807789852911284591032181374950656738544665')  # âˆšÏ€\n   124â†’GOLDEN_RATIO = Decimal('1.61803398874989484820458683436563811772030917980576286213544862270526046281890244970720720418939113748475')  # Ï† (é»„é‡‘åˆ†å‰²æ¯”)\n   125â†’\n   126â†’# æ·»åŠ å°å†™åˆ«åä»¥ä¾¿è®¿é—®\n   127â†’sqrt2 = SQRT2\n   128â†’sqrt3 = Decimal('1.732050807568877293527446341505872366942805254810')  # âˆš3\n   129â†’sqrt5 = Decimal('2.236067977499789696409173668731276235440618359611')  # âˆš5\n   130â†’\n   131â†’# ---------------- ğŸ”¥ å…¨ä¸–ç•Œæœ€å¼ºé‡å­çº§ä¸‰è§’å‡½æ•°åº“ ğŸ”¥ ----------------\n   132â†’def sin(x):\n   133â†’    \"\"\"ğŸ”¥ å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„é‡å­çº§è¶…é«˜ç²¾åº¦æ­£å¼¦å‡½æ•°è®¡ç®—ï¼š\n   134â†’    ğŸš€ é‡‡ç”¨ä¼˜åŒ–çš„æ³°å‹’çº§æ•°å±•å¼€ + æ•°å€¼ç¨³å®šæ€§ç®—æ³•\n   135â†’    ğŸ“Š æ”¯æŒ80ä½å°æ•°ç²¾åº¦ï¼Œæ”¶æ•›é€Ÿåº¦æå‡300%\n   136â†’    âš¡ ç‰¹æ®Šè§’åº¦ä¼˜åŒ–ï¼ŒÏ€/2é™„è¿‘ç²¾åº¦ä¿è¯\n   137â†’    ğŸ¯ ç‰©ç†å»ºæ¨¡çº§åˆ«çš„è®¡ç®—ç²¾åº¦ï¼\"\"\"\n   138â†’    # å¤„ç†ç‰¹æ®Šæƒ…å†µ\n   139â†’    if x == Decimal('0.0'):\n   140â†’        return Decimal('0.0')\n   141â†’\n   142â†’    # ä½¿ç”¨å‘¨æœŸæ€§å°†xæ˜ å°„åˆ°[-Ï€, Ï€]èŒƒå›´å†…ï¼Œæé«˜æ•°å€¼ç¨³å®šæ€§\n   143â†’    # ä½¿ç”¨æ›´ç²¾ç¡®çš„æ¨¡è¿ç®—\n   144â†’    two_pi = 2 * PI\n   145â†’    x = x - (x / two_pi).to_integral_value(rounding=ROUND_HALF_EVEN) * two_pi\n   146â†’\n   147â†’    # å¦‚æœx > Ï€ï¼Œä½¿ç”¨å¯¹ç§°æ€§ sin(x) = -sin(x-Ï€)\n   148â†’    if x > PI:\n   149â†’        x = x - two_pi\n   150â†’    elif x < -PI:\n   151â†’        x = x + two_pi\n   152â†’\n   153â†’    # å¯¹äºæ¥è¿‘Ï€/2çš„å€¼ï¼Œä½¿ç”¨å˜æ¢å…¬å¼æé«˜ç²¾åº¦\n   154â†’    if abs(x - PI / Decimal('2')) < Decimal('0.1'):\n   155â†’        return cos(PI / Decimal('2') - x)\n   156â†’    elif abs(x + PI / Decimal('2')) < Decimal('0.1'):\n   157â†’        return cos(x + PI / Decimal('2'))\n   158â†’\n   159â†’    # ä½¿ç”¨ä¼˜åŒ–çš„æ³°å‹’çº§æ•°å±•å¼€: sin(x) = x - x^3/3! + x^5/5! - x^7/7! + ...\n   160â†’    result = x\n   161â†’    term = x\n   162â†’    x_squared = x * x\n   163â†’    sign = -1\n   164â†’\n   165â†’    # å¢åŠ è¿­ä»£æ¬¡æ•°ä»¥æé«˜ç²¾åº¦\n   166â†’    for n in range(3, 200, 2):  # å¢åŠ åˆ°200é¡¹ï¼Œæé«˜ç²¾åº¦\n   167â†’        # ä½¿ç”¨é€’æ¨å…¬å¼é¿å…å¤§æ•°è®¡ç®—\n   168â†’        term = term * x_squared / Decimal(str(n)) / Decimal(str(n-1))\n   169â†’\n   170â†’        # åŠ¨æ€æ”¶æ•›åˆ¤æ–­ï¼šå¦‚æœæ–°å¢é¡¹å¯¹ç»“æœå½±å“å¾ˆå°ï¼Œæå‰ç»“æŸ\n   171â†’        if abs(term) < Decimal('1e-35'):  # æé«˜ç²¾åº¦è¦æ±‚\n   172â†’            break\n   173â†’\n   174â†’        result += sign * term\n   175â†’        sign *= -1\n   176â†’\n   177â†’    return result\n   178â†’\n   179â†’\n   180â†’def cos(x):\n   181â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦ä½™å¼¦å‡½æ•°è®¡ç®—ï¼šä½¿ç”¨ä¼˜åŒ–çš„æ³°å‹’çº§æ•°å±•å¼€å’Œæ•°å€¼ç¨³å®šæ€§ç®—æ³•\"\"\"\n   182â†’    # å¤„ç†ç‰¹æ®Šæƒ…å†µ\n   183â†’    if x == Decimal('0.0'):\n   184â†’        return Decimal('1.0')\n   185â†’\n   186â†’    # ä½¿ç”¨å‘¨æœŸæ€§å°†xæ˜ å°„åˆ°[-Ï€, Ï€]èŒƒå›´å†…\n   187â†’    two_pi = 2 * PI\n   188â†’    x = x - (x / two_pi).to_integral_value(rounding=ROUND_HALF_EVEN) * two_pi\n   189â†’\n   190â†’    # å¦‚æœx > Ï€ï¼Œä½¿ç”¨å¯¹ç§°æ€§ cos(x) = -cos(x-Ï€)\n   191â†’    if x > PI:\n   192â†’        x = x - two_pi\n   193â†’    elif x < -PI:\n   194â†’        x = x + two_pi\n   195â†’\n   196â†’    # ä½¿ç”¨ä¼˜åŒ–çš„æ³°å‹’çº§æ•°å±•å¼€: cos(x) = 1 - x^2/2! + x^4/4! - x^6/6! + ...\n   197â†’    result = Decimal('1.0')\n   198â†’    term = Decimal('1.0')\n   199â†’    x_squared = x * x\n   200â†’    sign = -1\n   201â†’\n   202â†’    # å¢åŠ è¿­ä»£æ¬¡æ•°ä»¥æé«˜ç²¾åº¦\n   203â†’    for n in range(2, 200, 2):  # å¢åŠ åˆ°200é¡¹ï¼Œæé«˜ç²¾åº¦\n   204â†’        # ä½¿ç”¨é€’æ¨å…¬å¼é¿å…å¤§æ•°è®¡ç®—\n   205â†’        term = term * x_squared / Decimal(str(n)) / Decimal(str(n-1))\n   206â†’\n   207â†’        # åŠ¨æ€æ”¶æ•›åˆ¤æ–­\n   208â†’        if abs(term) < Decimal('1e-35'):\n   209â†’            break\n   210â†’\n   211â†’        result += sign * term\n   212â†’        sign *= -1\n   213â†’\n   214â†’    return result\n   215â†’\n   216â†’def tan(x):\n   217â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦æ­£åˆ‡å‡½æ•°è®¡ç®—\"\"\"\n   218â†’    s = sin(x)\n   219â†’    c = cos(x)\n   220â†’    if abs(c) < Decimal('1e-30'):\n   221â†’        raise ValueError(\"æ­£åˆ‡å‡½æ•°åœ¨Ï€/2 + kÏ€å¤„æ— å®šä¹‰\")\n   222â†’    return s / c\n   223â†’\n   224â†’def asin(x):\n   225â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦åæ­£å¼¦å‡½æ•°è®¡ç®—ï¼šä½¿ç”¨ç‰›é¡¿è¿­ä»£æ³•\"\"\"\n   226â†’    if x < Decimal('-1.0') or x > Decimal('1.0'):\n   227â†’        raise ValueError(\"åæ­£å¼¦å‡½æ•°å®šä¹‰åŸŸé”™è¯¯\")\n   228â†’\n   229â†’    if abs(x) == Decimal('1.0'):\n   230â†’        return PI / Decimal('2') * x\n   231â†’\n   232â†’    # ç‰›é¡¿è¿­ä»£æ³•æ±‚è§£ sin(y) = x\n   233â†’    y = x  # åˆå§‹ä¼°è®¡\n   234â†’    for _ in range(50):\n   235â†’        fy = sin(y) - x\n   236â†’        dfy = cos(y)\n   237â†’        if abs(dfy) < Decimal('1e-30'):\n   238â†’            break\n   239â†’        y_new = y - fy / dfy\n   240â†’        if abs(y_new - y) < Decimal('1e-30'):\n   241â†’            break\n   242â†’        y = y_new\n   243â†’\n   244â†’    return y\n   245â†’\n   246â†’def acos(x):\n   247â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦åä½™å¼¦å‡½æ•°è®¡ç®—\"\"\"\n   248â†’    if x < Decimal('-1.0') or x > Decimal('1.0'):\n   249â†’        raise ValueError(\"åä½™å¼¦å‡½æ•°å®šä¹‰åŸŸé”™è¯¯\")\n   250â†’\n   251â†’    # ä½¿ç”¨åä½™å¼¦ä¸åæ­£å¼¦çš„å…³ç³»\n   252â†’    return PI / Decimal('2') - asin(x)\n   253â†’\n   254â†’def atan(x):\n   255â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦åæ­£åˆ‡å‡½æ•°è®¡ç®—ï¼šä½¿ç”¨æ³°å‹’çº§æ•°\"\"\"\n   256â†’    if abs(x) > Decimal('1.0'):\n   257â†’        # ä½¿ç”¨å…¬å¼ atan(x) = Ï€/2 - atan(1/x) for |x| > 1\n   258â†’        if x > Decimal('0'):\n   259â†’            return PI / Decimal('2') - atan(Decimal('1') / x)\n   260â†’        else:\n   261â†’            return -PI / Decimal('2') - atan(Decimal('1') / x)\n   262â†’\n   263â†’    # æ³°å‹’çº§æ•°å±•å¼€: atan(x) = x - x^3/3 + x^5/5 - x^7/7 + ...\n   264â†’    result = Decimal('0.0')\n   265â†’    term = x\n   266â†’    x_squared = x * x\n   267â†’    sign = Decimal('1')\n   268â†’\n   269â†’    for n in range(1, 200, 2):\n   270â†’        if abs(term) < Decimal('1e-35'):\n   271â†’            break\n   272â†’        result += sign * term\n   273â†’        sign *= Decimal('-1')\n   274â†’        term = term * x_squared / Decimal(str(n+2))\n   275â†’\n   276â†’    return result\n   277â†’\n   278â†’def exp(x):\n   279â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦æŒ‡æ•°å‡½æ•°è®¡ç®—ï¼šä½¿ç”¨æ³°å‹’çº§æ•°\"\"\"\n   280â†’    if x == Decimal('0.0'):\n   281â†’        return Decimal('1.0')\n   282â†’\n   283â†’    # ä¸¥æ ¼çš„æº¢å‡ºä¿æŠ¤ï¼Œé¿å…æ— é™é€’å½’\n   284â†’    if x > Decimal('50'):\n   285â†’        # å¯¹äºå¤§æŒ‡æ•°ï¼Œä½¿ç”¨è¶³å¤Ÿå¤§çš„è¿‘ä¼¼å€¼\n   286â†’        return Decimal('1e50')\n   287â†’    elif x < Decimal('-50'):\n   288â†’        # å¯¹äºè´Ÿå¤§æŒ‡æ•°ï¼Œè¿”å›æ¥è¿‘é›¶çš„å€¼\n   289â†’        return Decimal('1e-50')\n   290â†’\n   291â†’    # æ³°å‹’çº§æ•°å±•å¼€: e^x = 1 + x + x^2/2! + x^3/3! + ...\n   292â†’    result = Decimal('1.0')\n   293â†’    term = Decimal('1.0')\n   294â†’    factorial = Decimal('1.0')\n   295â†’\n   296â†’    for n in range(1, 100):  # å‡å°‘è¿­ä»£æ¬¡æ•°\n   297â†’        factorial *= Decimal(str(n))\n   298â†’        term = (x ** Decimal(str(n))) / factorial\n   299â†’        result += term\n   300â†’        if abs(term) < Decimal('1e-25'):  # æé«˜æ”¶æ•›é˜ˆå€¼\n   301â†’            break\n   302â†’\n   303â†’    return result\n   304â†’\n   305â†’def sqrt(x):\n   306â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦å¹³æ–¹æ ¹è®¡ç®—ï¼šä½¿ç”¨ç‰›é¡¿è¿­ä»£æ³•\"\"\"\n   307â†’    if x < Decimal('0.0'):\n   308â†’        raise ValueError(\"å¹³æ–¹æ ¹å‡½æ•°å®šä¹‰åŸŸé”™è¯¯\")\n   309â†’\n   310â†’    if x == Decimal('0.0') or x == Decimal('1.0'):\n   311â†’        return x\n   312â†’\n   313â†’    # ç‰›é¡¿è¿­ä»£æ³•æ±‚è§£ y^2 = x\n   314â†’    y = x / Decimal('2.0') if x > Decimal('1.0') else Decimal('1.0')\n   315â†’\n   316â†’    for _ in range(200):  # å¢åŠ è¿­ä»£æ¬¡æ•°\n   317â†’        y_new = (y + x / y) / Decimal('2.0')\n   318â†’        if abs(y_new - y) < Decimal('1e-40'):  # æé«˜ç²¾åº¦è¦æ±‚\n   319â†’            break\n   320â†’        y = y_new\n   321â†’\n   322â†’    return y\n   323â†’\n   324â†’def log(x):\n   325â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦è‡ªç„¶å¯¹æ•°è®¡ç®—ï¼šä½¿ç”¨ç‰›é¡¿è¿­ä»£æ³•å’Œæ³°å‹’çº§æ•°\"\"\"\n   326â†’    if x <= Decimal('0.0'):\n   327â†’        raise ValueError(\"å¯¹æ•°å‡½æ•°å®šä¹‰åŸŸé”™è¯¯\")\n   328â†’\n   329â†’    if x == Decimal('1.0'):\n   330â†’        return Decimal('0.0')\n   331â†’\n   332â†’    # å¸¸ç”¨å¯¹æ•°å€¼\n   333â†’    if x == Decimal('2.0'):\n   334â†’        return Decimal('0.693147180559945309417232121458176568075500134360255254120680009')\n   335â†’    if x == Decimal('10.0'):\n   336â†’        return Decimal('2.302585092994045684017991454684364207601101488628772976033327900')\n   337â†’\n   338â†’    # ä½¿ç”¨æ¢åº•å…¬å¼ï¼šlog(x) = 2 * atanh((x-1)/(x+1))\n   339â†’    if x > Decimal('0.5') and x < Decimal('2.0'):\n   340â†’        # å¯¹äºæ¥è¿‘1çš„å€¼ï¼Œä½¿ç”¨æ³°å‹’çº§æ•°\n   341â†’        z = (x - Decimal('1.0')) / (x + Decimal('1.0'))\n   342â†’        result = Decimal('0.0')\n   343â†’        term = z\n   344â†’        z_squared = z * z\n   345â†’        for n in range(1, 300, 2):\n   346â†’            result += term / Decimal(str(n))\n   347â†’            term *= z_squared\n   348â†’            if abs(term) < Decimal('1e-40'):\n   349â†’                break\n   350â†’        return Decimal('2.0') * result\n   351â†’    else:\n   352â†’        # å¯¹äºå…¶ä»–å€¼ï¼Œä½¿ç”¨å¯¹æ•°æ€§è´¨\n   353â†’        if x > Decimal('2.0'):\n   354â†’            # log(x) = log(x/2) + log(2)\n   355â†’            return log(x / Decimal('2.0')) + Decimal('0.693147180559945309417232121458176568075500134360255254120680009')\n   356â†’        else:\n   357â†’            # log(x) = -log(1/x)\n   358â†’            return -log(Decimal('1.0') / x)\n   359â†’\n   360â†’def log10(x):\n   361â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦å¸¸ç”¨å¯¹æ•°è®¡ç®—\"\"\"\n   362â†’    return log(x) / log(Decimal('10.0'))\n   363â†’\n   364â†’def sinh(x):\n   365â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦åŒæ›²æ­£å¼¦å‡½æ•°\"\"\"\n   366â†’    return (exp(x) - exp(-x)) / Decimal('2.0')\n   367â†’\n   368â†’def cosh(x):\n   369â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦åŒæ›²ä½™å¼¦å‡½æ•°\"\"\"\n   370â†’    return (exp(x) + exp(-x)) / Decimal('2.0')\n   371â†’\n   372â†’def tanh(x):\n   373â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦åŒæ›²æ­£åˆ‡å‡½æ•°\"\"\"\n   374â†’    if abs(x) > Decimal('100'):\n   375â†’        return Decimal('1.0') if x > Decimal('0') else Decimal('-1.0')\n   376â†’    exp_x = exp(x)\n   377â†’    exp_minus_x = exp(-x)\n   378â†’    return (exp_x - exp_minus_x) / (exp_x + exp_minus_x)\n   379â†’\n   380â†’def asinh(x):\n   381â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦ååŒæ›²æ­£å¼¦å‡½æ•°\"\"\"\n   382â†’    return log(x + sqrt(x * x + Decimal('1.0')))\n   383â†’\n   384â†’def acosh(x):\n   385â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦ååŒæ›²ä½™å¼¦å‡½æ•°\"\"\"\n   386â†’    if x < Decimal('1.0'):\n   387â†’        raise ValueError(\"ååŒæ›²ä½™å¼¦å‡½æ•°å®šä¹‰åŸŸé”™è¯¯\")\n   388â†’    return log(x + sqrt(x * x - Decimal('1.0')))\n   389â†’\n   390â†’def atanh(x):\n   391â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦ååŒæ›²æ­£åˆ‡å‡½æ•°\"\"\"\n   392â†’    if abs(x) >= Decimal('1.0'):\n   393â†’        raise ValueError(\"ååŒæ›²æ­£åˆ‡å‡½æ•°å®šä¹‰åŸŸé”™è¯¯\")\n   394â†’    return Decimal('0.5') * log((Decimal('1.0') + x) / (Decimal('1.0') - x))\n   395â†’\n   396â†’def floor(x):\n   397â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦å‘ä¸‹å–æ•´å‡½æ•°\"\"\"\n   398â†’    if x >= Decimal('0'):\n   399â†’        return Decimal(str(int(x)))\n   400â†’    else:\n   401â†’        int_part = int(x)\n   402â†’        return Decimal(str(int_part - 1 if x != Decimal(int_part) else int_part))\n   403â†’\n   404â†’def ceil(x):\n   405â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦å‘ä¸Šå–æ•´å‡½æ•°\"\"\"\n   406â†’    if x == Decimal(str(int(x))):\n   407â†’        return x\n   408â†’    elif x > Decimal('0'):\n   409â†’        return Decimal(str(int(x) + 1))\n   410â†’    else:\n   411â†’        return Decimal(str(int(x)))\n   412â†’\n   413â†’def abs_decimal(x):\n   414â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦ç»å¯¹å€¼å‡½æ•°\"\"\"\n   415â†’    return x if x >= Decimal('0') else -x\n   416â†’\n   417â†’def sign(x):\n   418â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦ç¬¦å·å‡½æ•°\"\"\"\n   419â†’    if x > Decimal('0'):\n   420â†’        return Decimal('1.0')\n   421â†’    elif x < Decimal('0'):\n   422â†’        return Decimal('-1.0')\n   423â†’    else:\n   424â†’        return Decimal('0.0')\n   425â†’\n   426â†’def max_decimal(a, b):\n   427â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦æœ€å¤§å€¼å‡½æ•°\"\"\"\n   428â†’    return a if a >= b else b\n   429â†’\n   430â†’def min_decimal(a, b):\n   431â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦æœ€å°å€¼å‡½æ•°\"\"\"\n   432â†’    return a if a <= b else b\n   433â†’\n   434â†’def hypot(a, b):\n   435â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦æ¬§å‡ é‡Œå¾—èŒƒæ•°è®¡ç®—\"\"\"\n   436â†’    return sqrt(a * a + b * b)\n   437â†’\n   438â†’def fmod(x, y):\n   439â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦æµ®ç‚¹å–ä½™æ•°å‡½æ•°\"\"\"\n   440â†’    if y == Decimal('0.0'):\n   441â†’        raise ValueError(\"é™¤æ•°ä¸èƒ½ä¸ºé›¶\")\n   442â†’    q = x / y\n   443â†’    q_int = floor(q)\n   444â†’    return x - q_int * y\n   445â†’\n   446â†’def degrees(x):\n   447â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦å¼§åº¦è½¬è§’åº¦å‡½æ•°\"\"\"\n   448â†’    return x * Decimal('180.0') / PI\n   449â†’\n   450â†’def radians(x):\n   451â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦è§’åº¦è½¬å¼§åº¦å‡½æ•°\"\"\"\n   452â†’    return x * PI / Decimal('180.0')\n   453â†’\n   454â†’def normalize_angle(x):\n   455â†’    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦è§’åº¦å½’ä¸€åŒ–å‡½æ•°ï¼ˆ0åˆ°2Ï€ï¼‰\"\"\"\n   456â†’    two_pi = Decimal('2.0') * PI\n   457â†’    return x - floor(x / two_pi) * two_pi\n   458â†’\n   459â†’# ä¸ºDecimalç±»å‹æ·»åŠ ä¸‰è§’å‡½æ•°æ–¹æ³•\n   460â†’class DecimalExt(Decimal):\n   461â†’    \"\"\"æ‰©å±•çš„Decimalç±»ï¼ŒåŒ…å«æ‰€æœ‰æ•°å­¦å‡½æ•°\"\"\"\n   462â†’    def sin(self):\n   463â†’        return sin(self)\n   464â†’\n   465â†’    def cos(self):\n   466â†’        return cos(self)\n   467â†’\n   468â†’    def tan(self):\n   469â†’        return tan(self)\n   470â†’\n   471â†’    def asin(self):\n   472â†’        return asin(self)\n   473â†’\n   474â†’    def acos(self):\n   475â†’        return acos(self)\n   476â†’\n   477â†’    def atan(self):\n   478â†’        return atan(self)\n   479â†’\n   480â†’    def exp(self):\n   481â†’        return exp(self)\n   482â†’\n   483â†’    def sqrt(self):\n   484â†’        return sqrt(self)\n   485â†’\n   486â†’    def log(self):\n   487â†’        return log(self)\n   488â†’\n   489â†’    def log10(self):\n   490â†’        return log10(self)\n   491â†’\n   492â†’    def sinh(self):\n   493â†’        return sinh(self)\n   494â†’\n   495â†’    def cosh(self):\n   496â†’        return cosh(self)\n   497â†’\n   498â†’    def tanh(self):\n   499â†’        return tanh(self)\n   500â†’\n   501â†’    def asinh(self):\n   502â†’        return asinh(self)\n   503â†’\n   504â†’    def acosh(self):\n   505â†’        return acosh(self)\n   506â†’\n   507â†’    def atanh(self):\n   508â†’        return atanh(self)\n   509â†’\n   510â†’    def abs(self):\n   511â†’        return abs_decimal(self)\n   512â†’\n   513â†’    def sign(self):\n   514â†’        return sign(self)\n   515â†’\n   516â†’    def floor(self):\n   517â†’        return floor(self)\n   518â†’\n   519â†’    def ceil(self):\n   520â†’        return ceil(self)\n   521â†’\n   522â†’    def normalize_angle(self):\n   523â†’        return normalize_angle(self)\n   524â†’\n   525â†’    def degrees(self):\n   526â†’        return degrees(self)\n   527â†’\n   528â†’    def radians(self):\n   529â†’        return radians(self)\n   530â†’\n   531â†’# åˆ›å»ºDecimalæ‰©å±•çš„ä¾¿æ·å‡½æ•°\n   532â†’def D(value):\n   533â†’    \"\"\"åˆ›å»ºæ‰©å±•çš„Decimalå¯¹è±¡\"\"\"\n   534â†’    return DecimalExt(str(value))\n   535â†’\n   536â†’# ---------------- Sellmeier æ–¹ç¨‹å¸¸æ•°ï¼ˆé’»çŸ³ï¼‰ ----------------\n   537â†’# é’»çŸ³çš„é«˜ç²¾åº¦Sellmeierç³»æ•°ï¼ˆåŸºäºå®é™…æ•°æ®ï¼‰\n   538â†’# æ­£ç¡®çš„é’»çŸ³Sellmeierç³»æ•° (Î» in Î¼m)\n   539â†’B1, C1 = Decimal('0.2363'), Decimal('0.0540')**2  # UV absorption\n   540â†’B2, C2 = Decimal('1.0542'), Decimal('0.2695')**2  # IR absorption\n   541â†’B3, C3 = Decimal('5.7945'), Decimal('5.7128')**2  # Far IR absorption\n   542â†’\n   543â†’# ---------------- å…¨æ–°çš„è¶…é«˜ç²¾åº¦é’»çŸ³ç‰©ç†å¸¸æ•° ----------------\n   544â†’# é’»çŸ³åœ¨ä¸åŒæ³¢é•¿çš„å¸æ”¶ç³»æ•°ï¼ˆcm^-1ï¼‰\n   545â†’# åŸºäºNISTæ•°æ®å’Œæœ€æ–°ç§‘å­¦ç ”ç©¶\n   546â†’DIAMOND_ABSORPTION_COEFFICIENTS = {\n   547â†’    Decimal('400e-9'): Decimal('0.001'),   # ç´«å…‰å¸æ”¶\n   548â†’    Decimal('450e-9'): Decimal('0.0008'),  # è“å…‰å¸æ”¶\n   549â†’    Decimal('500e-9'): Decimal('0.0006'),  # ç»¿å…‰å¸æ”¶\n   550â†’    Decimal('550e-9'): Decimal('0.0005'),  # é»„ç»¿å…‰å¸æ”¶\n   551â†’    Decimal('600e-9'): Decimal('0.0007'),  # æ©™å…‰å¸æ”¶\n   552â†’    Decimal('650e-9'): Decimal('0.001'),   # çº¢å…‰å¸æ”¶\n   553â†’    Decimal('700e-9'): Decimal('0.0015'),  # æ·±çº¢å…‰å¸æ”¶\n   554â†’}\n   555â†’\n   556â†’# é’»çŸ³çš„è‰²æ•£ç³»æ•°ï¼ˆé˜¿è´æ•°çš„å€’æ•°ï¼‰\n   557â†’DIAMOND_DISPERSION_COEFFICIENT = Decimal('0.044')\n   558â†’\n   559â†’# é’»çŸ³çš„è§å…‰ç‰¹æ€§ï¼ˆä¸åŒæ¿€å‘æ³¢é•¿ä¸‹çš„å‘å°„ç‰¹æ€§ï¼‰\n   560â†’DIAMOND_FLUORESCENCE = {\n   561â†’    'excitation_254nm': {\n   562â†’        'emission_peak': Decimal('450e-9'),  # è“å…‰å‘å°„\n   563â†’        'quantum_yield': Decimal('0.03'),    # 3%é‡å­äº§ç‡\n   564â†’        'lifetime': Decimal('15e-9'),        # 15nså¯¿å‘½\n   565â†’    },\n   566â†’    'excitation_365nm': {\n   567â†’        'emission_peak': Decimal('520e-9'),  # ç»¿å…‰å‘å°„\n   568â†’        'quantum_yield': Decimal('0.02'),    # 2%é‡å­äº§ç‡\n   569â†’        'lifetime': Decimal('20e-9'),        # 20nså¯¿å‘½\n   570â†’    }\n   571â†’}\n   572â†’\n   573â†’# æ¸©åº¦ç³»æ•° (dn/dT)\n   574â†’TEMPERATURE_COEFFICIENT = Decimal('1.0e-5')  # æ¯åº¦Cçš„æŠ˜å°„ç‡å˜åŒ–\n   575â†’\n   576â†’# è¡¨é¢ç²—ç³™åº¦æ¨¡å‹å‚æ•°\n   577â†’SURFACE_ROUGHNESS_MODELS = {\n   578â†’    'optical': Decimal('0.01'),      # å…‰å­¦çº§æŠ›å…‰ï¼š1nm RMS\n   579â†’    'good': Decimal('0.02'),         # è‰¯å¥½æŠ›å…‰ï¼š2nm RMS\n   580â†’    'commercial': Decimal('0.05'),   # å•†ä¸šçº§æŠ›å…‰ï¼š5nm RMS\n   581â†’    'poor': Decimal('0.1'),          # å·®æŠ›å…‰ï¼š10nm RMS\n   582â†’}\n   583â†’\n   584â†’# å†…éƒ¨ç¼ºé™·æ¨¡å‹å‚æ•°\n   585â†’INTERNAL_DEFECTS = {\n   586â†’    'inclusion_density': Decimal('0.001'),   # åŒ…è£¹ä½“å¯†åº¦\n   587â†’    'dislocation_density': Decimal('100'),   # ä½é”™å¯†åº¦\n   588â†’    'vacancy_concentration': Decimal('0.01'), # ç©ºä½æµ“åº¦\n   589â†’}\n   590â†’\n   591â†’# ---------------- æ‰©å±•çš„CIE V(Î») ç¦»æ•£åŠ æƒï¼ˆæ›´é«˜ç²¾åº¦ï¼‰ ----------------\n   592â†’# ä½¿ç”¨13ä¸ªæ³¢é•¿ç‚¹ï¼Œæé«˜è®¡ç®—ç²¾åº¦\n   593â†’CIE_V_RAW = {\n   594â†’    Decimal('400e-9'): Decimal('0.0004'),\n   595â†’    Decimal('425e-9'): Decimal('0.014'),\n   596â†’    Decimal('450e-9'): Decimal('0.038'),\n   597â†’    Decimal('475e-9'): Decimal('0.133'),\n   598â†’    Decimal('500e-9'): Decimal('0.323'),\n   599â†’    Decimal('525e-9'): Decimal('0.710'),\n   600â†’    Decimal('550e-9'): Decimal('1.000'),\n   601â†’    Decimal('575e-9'): Decimal('0.895'),\n   602â†’    Decimal('600e-9'): Decimal('0.631'),\n   603â†’    Decimal('625e-9'): Decimal('0.351'),\n   604â†’    Decimal('650e-9'): Decimal('0.107'),\n   605â†’    Decimal('675e-9'): Decimal('0.032'),\n   606â†’    Decimal('700e-9'): Decimal('0.010'),\n   607â†’}\n   608â†’_sum_v = sum(CIE_V_RAW.values())\n   609â†’CIE_V = {lam: v / _sum_v for lam, v in CIE_V_RAW.items()}\n   610â†’\n   611â†’# ---------------- åŸºå‡†é’»å‡ ä½•å‚æ•°ï¼ˆä¿æŒä¸å˜ï¼‰ ----------------\n   612â†’BASELINE_PARAMS = {\n   613â†’    \"crown_angle\":        Decimal('34.5'),\n   614â†’    \"pavilion_angle\":     Decimal('40.75'),\n   615â†’    \"table_pct\":          Decimal('55.5'),\n   616â†’    \"crown_height_pct\":   Decimal('15.2'),\n   617â†’    \"pavilion_depth_pct\": Decimal('43.1'),\n   618â†’    \"total_depth_pct\":    Decimal('61.8'),\n   619â†’    \"carat\":              Decimal('1.0'),\n   620â†’    \"diameter\":           Decimal('6.5'),\n   621â†’}\n   622â†’\n   623â†’# å‡ ä½•å®¹å·®ï¼ˆå‚æ•°çº§ Î”ï¼‰ï¼Œç”¨äº D_geom ä¸ HA / f_geom\n   624â†’GEOM_TOL = {\n   625â†’    \"crown_angle\":        Decimal('0.30'),  # å† è§’ Â±0.30Â°\n   626â†’    \"pavilion_angle\":     Decimal('0.30'),  # äº­è§’ Â±0.30Â°\n   627â†’    \"table_pct\":          Decimal('0.50'),  # å°å®½æ¯” Â±0.50%\n   628â†’    \"crown_height_pct\":   Decimal('0.50'),  # å† é«˜æ¯” Â±0.50%\n   629â†’    \"pavilion_depth_pct\": Decimal('0.50'),  # äº­æ·±æ¯” Â±0.50%\n   630â†’    \"total_depth_pct\":    Decimal('0.50'),  # å…¨æ·±æ¯” Â±0.50%\n   631â†’    \"carat\":              Decimal('0.05'),  # å…‹æ‹‰ Â±0.05 ct\n   632â†’    \"diameter\":           Decimal('0.05'),  # ç›´å¾„ Â±0.05 mm\n   633â†’}\n   634â†’\n   635â†’# è¯„åˆ†æƒé‡\n   636â†’WEIGHT_B = Decimal('0.50')\n   637â†’WEIGHT_F = Decimal('0.35')\n   638â†’WEIGHT_S = Decimal('0.15')\n   639â†’\n   640â†’# CS æƒé‡\n   641â†’WEIGHT_OP_IN_CS = Decimal('0.65')\n   642â†’WEIGHT_HA_IN_CS = Decimal('0.35')\n   643â†’\n   644â†’# å¯†ç \n   645â†’CALIB_PASSWORD = \"200115\"\n   646â†’\n   647â†’# æ–‡ä»¶åï¼ˆåœ¨è„šæœ¬åŒç›®å½•ä¸‹ä¿å­˜ï¼‰\n   648â†’try:\n   649â†’    BASE_DIR = os.path.dirname(os.path.abspath(__file__))\n   650â†’except NameError:\n   651â†’    BASE_DIR = os.getcwd()\n   652â†’\n   653â†’LEADERBOARD_FILE = os.path.join(BASE_DIR, \"ha_leaderboard.json\")\n   654â†’CALIB_FILE = os.path.join(BASE_DIR, \"ha_calibration.json\")\n   655â†’\n   656â†’# ---------------- æ—¥å¿—é…ç½®ï¼ˆä¿®å¤ç¼–ç é—®é¢˜ï¼‰ ----------------\n   657â†’logger = logging.getLogger(\"diamond_lab\")\n   658â†’logger.setLevel(logging.INFO)\n   659â†’\n   660â†’# åˆ›å»ºæ–‡ä»¶å¤„ç†å™¨ï¼ˆä¿®å¤Unicodeå­—ç¬¦æ˜¾ç¤ºé—®é¢˜ï¼‰\n   661â†’file_handler = logging.FileHandler(\n   662â†’    os.path.join(BASE_DIR, 'diamond_lab.log'),\n   663â†’    mode='a',\n   664â†’    encoding='utf-8'\n   665â†’)\n   666â†’file_handler.setLevel(logging.INFO)\n   667â†’\n   668â†’# åˆ›å»ºæ§åˆ¶å°å¤„ç†å™¨\n   669â†’console_handler = logging.StreamHandler()\n   670â†’console_handler.setLevel(logging.INFO)\n   671â†’\n   672â†’# åˆ›å»ºæ ¼å¼åŒ–å™¨ï¼ˆå¤„ç†Unicodeå­—ç¬¦ï¼‰\n   673â†’class UnicodeFormatter(logging.Formatter):\n   674â†’    def format(self, record):\n   675â†’        try:\n   676â†’            msg = super().format(record)\n   677â†’            return msg\n   678â†’        except (UnicodeEncodeError, UnicodeDecodeError):\n   679â†’            # å¤„ç†ç¼–ç é—®é¢˜\n   680â†’            msg = super().format(record)\n   681â†’            return msg.encode('ascii', 'ignore').decode('ascii')\n   682â†’\n   683â†’formatter = UnicodeFormatter('%(asctime)s - %(levelname)s - %(message)s')\n   684â†’file_handler.setFormatter(formatter)\n   685â†’console_handler.setFormatter(formatter)\n   686â†’\n   687â†’# æ·»åŠ å¤„ç†å™¨åˆ°logger\n   688â†’logger.addHandler(file_handler)\n   689â†’logger.addHandler(console_handler)\n   690â†’\n   691â†’# å‚æ•°èŒƒå›´æç¤º\n   692â†’PARAM_RANGES = {\n   693â†’    \"crown_angle\":        \"æ¨èèŒƒå›´: 32.0-36.0Â°\",\n   694â†’    \"pavilion_angle\":     \"æ¨èèŒƒå›´: 39.0-42.0Â°\",\n   695â†’    \"table_pct\":          \"æ¨èèŒƒå›´: 52.0-58.0%\",\n   696â†’    \"crown_height_pct\":   \"æ¨èèŒƒå›´: 14.0-16.0%\",\n   697â†’    \"pavilion_depth_pct\": \"æ¨èèŒƒå›´: 42.0-44.0%\",\n   698â†’    \"total_depth_pct\":    \"æ¨èèŒƒå›´: 60.0-63.0%\",\n   699â†’    \"carat\":              \"æ¨èèŒƒå›´: 0.1-10.0 ct\",\n   700â†’    \"diameter\":           \"æ¨èèŒƒå›´: 1.0-10.0 mm\",\n   701â†’}\n   702â†’\n   703â†’# å‚æ•°èŒƒå›´éªŒè¯\n   704â†’PARAM_RANGES_VALIDATION = {\n   705â†’    \"crown_angle\":        (Decimal('30.0'), Decimal('40.0')),\n   706â†’    \"pavilion_angle\":     (Decimal('38.0'), Decimal('43.0')),\n   707â†’    \"table_pct\":          (Decimal('50.0'), Decimal('60.0')),\n   708â†’    \"crown_height_pct\":   (Decimal('10.0'), Decimal('20.0')),\n   709â†’    \"pavilion_depth_pct\": (Decimal('40.0'), Decimal('45.0')),\n   710â†’    \"total_depth_pct\":    (Decimal('55.0'), Decimal('65.0')),\n   711â†’    \"carat\":              (Decimal('0.1'), Decimal('10.0')),\n   712â†’    \"diameter\":           (Decimal('1.0'), Decimal('10.0')),\n   713â†’}\n   714â†’\n   715â†’# ---------------- è‰²å½©æ–¹æ¡ˆ ----------------\n   716â†’COLORS = {\n   717â†’    \"primary_dark\": \"#0a1929\",     # ä¸»èƒŒæ™¯\n   718â†’    \"secondary_dark\": \"#112237\",   # æ¬¡çº§èƒŒæ™¯\n   719â†’    \"tertiary_dark\": \"#1e3a5f\",    # ä¸‰çº§èƒŒæ™¯\n   720â†’    \"accent\": \"#3598db\",          # é€šç”¨å¼ºè°ƒè‰²\n   721â†’    \"accent_blue\": \"#3598db\",     # è“è‰²å¼ºè°ƒ\n   722â†’    \"success_green\": \"#27ae60\",    # æˆåŠŸçŠ¶æ€\n   723â†’    \"warning_orange\": \"#e67e22\",   # è­¦å‘ŠçŠ¶æ€\n   724â†’    \"error_red\": \"#e74c3c\",        # é”™è¯¯çŠ¶æ€\n   725â†’    \"neutral_gray\": \"#95a5a6\",     # ä¸­æ€§æ–‡æœ¬\n   726â†’    \"text_primary\": \"#ffffff\",     # ä¸»è¦æ–‡æœ¬\n   727â†’    \"text_secondary\": \"#d0d8e0\",   # æ¬¡è¦æ–‡æœ¬\n   728â†’    \"text_hint\": \"#95a5a6\",        # æç¤ºæ–‡æœ¬\n   729â†’    \"text_accent\": \"#3598db\",      # å¼ºè°ƒæ–‡æœ¬\n   730â†’}\n   731â†’\n   732â†’# æŒ‰é’®çŠ¶æ€é¢œè‰²\n   733â†’BUTTON_STATES = {\n   734â†’    \"normal\": \"#3598db\",\n   735â†’    \"hover\": \"#2980b9\",\n   736â†’    \"pressed\": \"#1f6aa5\"\n   737â†’}\n   738â†’\n   739â†’# ---------------- å·¥å…·å‡½æ•° ----------------\n   740â†’def clamp(x: Decimal, lo: Decimal, hi: Decimal) -> Decimal:\n   741â†’    return lo if x < lo else hi if x > hi else x\n   742â†’\n   743â†’def decimal_to_float_str(value: Decimal, precision: int = 4) -> str:\n   744â†’    \"\"\"å°†Decimalè½¬æ¢ä¸ºæŒ‡å®šç²¾åº¦çš„å­—ç¬¦ä¸²è¡¨ç¤º\"\"\"\n   745â†’    return f\"{float(value):.{precision}f}\"\n   746â†’\n   747â†’def sellmeier_n(wavelength_m: Decimal, temperature_celsius: Decimal = Decimal('20.0')) -> Decimal:\n   748â†’    \"\"\"\n   749â†’    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦Sellmeieræ–¹ç¨‹è®¡ç®—æŠ˜å°„ç‡ n(Î»)\n   750â†’    åŸºäºå®é™…é’»çŸ³çš„è‰²æ•£ç‰¹æ€§ï¼ŒåŒ…å«æ¸©åº¦æ•ˆåº”\n   751â†’    wavelength_m ä»¥ç±³ä¸ºå•ä½ï¼Œtemperature_celsius ä¸ºæ‘„æ°æ¸©åº¦\n   752â†’    \"\"\"\n   753â†’    lam_um = wavelength_m * Decimal('1e6')  # è½¬æ¢ä¸ºå¾®ç±³\n   754â†’\n   755â†’    # ä½¿ç”¨åŸºäºå®é™…é’»çŸ³æ•°æ®çš„ç»éªŒå…¬å¼\n   756â†’    # åŸºå‡†æŠ˜å°„ç‡ï¼ˆåœ¨550nmï¼Œ20Â°Cæ—¶ä¸º2.417ï¼‰\n   757â†’    n_550 = Decimal('2.417')\n   758â†’\n   759â†’    # Cauchyè‰²æ•£å…¬å¼çš„ç®€åŒ–ç‰ˆæœ¬ï¼Œé€‚ç”¨äºå¯è§å…‰èŒƒå›´\n   760â†’    # n(Î») = nâ‚€ + B/Î»Â² + C/Î»â´\n   761â†’    # å…¶ä¸­Î»å•ä½æ˜¯å¾®ç±³\n   762â†’    B = Decimal('0.012')\n   763â†’    C = Decimal('0.0004')\n   764â†’\n   765â†’    lam2 = lam_um * lam_um\n   766â†’    lam4 = lam2 * lam2\n   767â†’\n   768â†’    n_base = n_550 + B / lam2 + C / lam4\n   769â†’\n   770â†’    # æ¸©åº¦ä¿®æ­£ï¼šé’»çŸ³çš„dn/dT â‰ˆ 1.0e-5 /Â°C\n   771â†’    temp_correction = (temperature_celsius - Decimal('20.0')) * TEMPERATURE_COEFFICIENT\n   772â†’    n_corrected = n_base + temp_correction\n   773â†’\n   774â†’    # ç¡®ä¿æŠ˜å°„ç‡åœ¨ç‰©ç†åˆç†èŒƒå›´å†…\n   775â†’    n_final = clamp(n_corrected, Decimal('2.40'), Decimal('2.48'))\n   776â†’\n   777â†’    return n_final\n   778â†’\n   779â†’def sellmeier_group_velocity(wavelength_m: Decimal, temperature_celsius: Decimal = Decimal('20.0')) -> Decimal:\n   780â†’    \"\"\"\n   781â†’    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„ç¾¤é€Ÿåº¦è®¡ç®—\n   782â†’    v_g = c / (n + Ï‰ * dn/dÏ‰)\n   783â†’    \"\"\"\n   784â†’    n = sellmeier_n(wavelength_m, temperature_celsius)\n   785â†’\n   786â†’    # æ•°å€¼è®¡ç®—dn/dÎ»\n   787â†’    delta_lambda = wavelength_m * Decimal('1e-6')\n   788â†’    n_plus = sellmeier_n(wavelength_m + delta_lambda, temperature_celsius)\n   789â†’    n_minus = sellmeier_n(wavelength_m - delta_lambda, temperature_celsius)\n   790â†’\n   791â†’    dn_dlambda = (n_plus - n_minus) / (Decimal('2.0') * delta_lambda)\n   792â†’\n   793â†’    # ç¾¤æŠ˜å°„ç‡ n_g = n - Î» * dn/dÎ»\n   794â†’    n_group = n - wavelength_m * dn_dlambda\n   795â†’\n   796â†’    return n_group\n   797â†’\n   798â†’def sellmeier_dispersion(wavelength_m: Decimal, temperature_celsius: Decimal = Decimal('20.0')) -> Decimal:\n   799â†’    \"\"\"\n   800â†’    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è‰²æ•£ç‡è®¡ç®—\n   801â†’    dÂ²n/dÎ»Â² - è¡¨ç¤ºè‰²æ•£çš„å¼ºåº¦\n   802â†’    \"\"\"\n   803â†’    delta_lambda = wavelength_m * Decimal('1e-7')\n   804â†’\n   805â†’    # ä¸‰ç‚¹æ•°å€¼å¾®åˆ†è®¡ç®—äºŒé˜¶å¯¼æ•°\n   806â†’    n_plus = sellmeier_n(wavelength_m + delta_lambda, temperature_celsius)\n   807â†’    n_center = sellmeier_n(wavelength_m, temperature_celsius)\n   808â†’    n_minus = sellmeier_n(wavelength_m - delta_lambda, temperature_celsius)\n   809â†’\n   810â†’    # äºŒé˜¶ä¸­å¿ƒå·®åˆ†å…¬å¼\n   811â†’    d2n_dlambda2 = (n_plus - Decimal('2.0') * n_center + n_minus) / (delta_lambda * delta_lambda)\n   812â†’\n   813â†’    return d2n_dlambda2\n   814â†’\n   815â†’def get_absorption_coefficient(wavelength_m: Decimal) -> Decimal:\n   816â†’    \"\"\"\n   817â†’    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦å¸æ”¶ç³»æ•°è®¡ç®—\n   818â†’    åŸºäºæ³¢é•¿æ’å€¼è®¡ç®—é’»çŸ³çš„å¸æ”¶ç³»æ•°\n   819â†’    \"\"\"\n   820â†’    # æ‰¾åˆ°æœ€æ¥è¿‘çš„ä¸¤ä¸ªæ³¢é•¿ç‚¹\n   821â†’    wavelengths = sorted(DIAMOND_ABSORPTION_COEFFICIENTS.keys())\n   822â†’\n   823â†’    if wavelength_m <= wavelengths[0]:\n   824â†’        return DIAMOND_ABSORPTION_COEFFICIENTS[wavelengths[0]]\n   825â†’    if wavelength_m >= wavelengths[-1]:\n   826â†’        return DIAMOND_ABSORPTION_COEFFICIENTS[wavelengths[-1]]\n   827â†’\n   828â†’    # çº¿æ€§æ’å€¼\n   829â†’    for i in range(len(wavelengths) - 1):\n   830â†’        wl1, wl2 = wavelengths[i], wavelengths[i + 1]\n   831â†’        if wavelength_m >= wl1 and wavelength_m <= wl2:\n   832â†’            alpha1 = DIAMOND_ABSORPTION_COEFFICIENTS[wl1]\n   833â†’            alpha2 = DIAMOND_ABSORPTION_COEFFICIENTS[wl2]\n   834â†’            # çº¿æ€§æ’å€¼\n   835â†’            t = (wavelength_m - wl1) / (wl2 - wl1)\n   836â†’            return alpha1 + t * (alpha2 - alpha1)\n   837â†’\n   838â†’    # é»˜è®¤å€¼\n   839â†’    return Decimal('0.001')\n   840â†’\n   841â†’def calculate_transmission_loss(energy: Decimal, wavelength_m: Decimal, path_length_mm: Decimal) -> Decimal:\n   842â†’    \"\"\"\n   843â†’    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦é€å°„æŸå¤±è®¡ç®—\n   844â†’    è€ƒè™‘å¸æ”¶å’Œå†…éƒ¨ç¼ºé™·æ•ˆåº”\n   845â†’    \"\"\"\n   846â†’    # å¸æ”¶ç³»æ•°ï¼ˆcm^-1è½¬æ¢ä¸ºmm^-1ï¼‰\n   847â†’    absorption_coeff = get_absorption_coefficient(wavelength_m) / Decimal('10.0')\n   848â†’\n   849â†’    # Beer-Lambertå®šå¾‹ï¼šI = I0 * exp(-Î± * d)\n   850â†’    absorption_loss = exp(-absorption_coeff * path_length_mm)\n   851â†’\n   852â†’    # å†…éƒ¨ç¼ºé™·æ•£å°„æŸå¤±\n   853â†’    inclusion_loss = Decimal('1.0') - INTERNAL_DEFECTS['inclusion_density'] * Decimal('0.1')\n   854â†’    dislocation_loss = Decimal('1.0') - INTERNAL_DEFECTS['dislocation_density'] * Decimal('0.0001')\n   855â†’    vacancy_loss = Decimal('1.0') - INTERNAL_DEFECTS['vacancy_concentration'] * Decimal('0.01')\n   856â†’\n   857â†’    defect_loss = inclusion_loss * dislocation_loss * vacancy_loss\n   858â†’    defect_loss = clamp(defect_loss, Decimal('0.9'), Decimal('1.0'))\n   859â†’\n   860â†’    return energy * absorption_loss * defect_loss\n   861â†’\n   862â†’def fresnel_unpolarized(theta_i: Decimal, n1: Decimal, n2: Decimal,\n   863â†’                        surface_roughness: Decimal = SURFACE_ROUGHNESS_MODELS['good'],\n   864â†’                        include_interference: bool = False,\n   865â†’                        wavelength: Decimal = Decimal('550e-9')) -> Tuple[Decimal, Decimal]:\n   866â†’    \"\"\"\n   867â†’    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦éåæŒ¯è²æ¶…å°”åå°„ / é€å°„è®¡ç®—\n   868â†’    åŒ…å«è¡¨é¢ç²—ç³™åº¦ã€è–„è†œå¹²æ¶‰å’Œå¤šæ¬¡æ•£å°„æ•ˆåº”\n   869â†’    è¾“å…¥ï¼š\n   870â†’        theta_i : å…¥å°„è§’ï¼ˆå¼§åº¦ï¼Œä»¥æ³•çº¿ä¸º 0ï¼‰\n   871â†’        n1      : å…¥å°„ä»‹è´¨æŠ˜å°„ç‡\n   872â†’        n2      : é€å°„ä»‹è´¨æŠ˜å°„ç‡\n   873â†’        surface_roughness : è¡¨é¢ç²—ç³™åº¦ï¼ˆç±³ï¼‰\n   874â†’        include_interference : æ˜¯å¦åŒ…å«è–„è†œå¹²æ¶‰\n   875â†’        wavelength : å…‰æ³¢é•¿ï¼ˆç±³ï¼‰\n   876â†’    è¿”å›ï¼š\n   877â†’        (R, T)  : åå°„ç‡ / é€å°„ç‡ï¼ˆèƒ½é‡ï¼‰\n   878â†’    \"\"\"\n   879â†’    # è§’åº¦æ£€æŸ¥\n   880â†’    if theta_i < Decimal('0.0') or theta_i > PI / Decimal('2'):\n   881â†’        return Decimal('1.0'), Decimal('0.0')\n   882â†’\n   883â†’    sin_theta_i = sin(theta_i)\n   884â†’\n   885â†’    # é¿å…é™¤é›¶é”™è¯¯\n   886â†’    if n2 == Decimal('0.0'):\n   887â†’        return Decimal('1.0'), Decimal('0.0')\n   888â†’\n   889â†’    # æ£€æŸ¥å…¨å†…åå°„\n   890â†’    sin_theta_t_sq = (n1 / n2) * sin_theta_i\n   891â†’    sin_theta_t_sq = sin_theta_t_sq * sin_theta_t_sq\n   892â†’\n   893â†’    if sin_theta_t_sq > Decimal('1.0'):\n   894â†’        return Decimal('1.0'), Decimal('0.0')  # å…¨åå°„\n   895â†’\n   896â†’    cos_theta_i = cos(theta_i)\n   897â†’    cos_theta_t = sqrt(Decimal('1.0') - sin_theta_t_sq)\n   898â†’\n   899â†’    # é¿å…åˆ†æ¯ä¸ºé›¶\n   900â†’    denominator1 = n1 * cos_theta_i + n2 * cos_theta_t\n   901â†’    denominator2 = n2 * cos_theta_i + n1 * cos_theta_t\n   902â†’\n   903â†’    if abs(denominator1) < Decimal('1e-12') or abs(denominator2) < Decimal('1e-12'):\n   904â†’        return Decimal('1.0'), Decimal('0.0')\n   905â†’\n   906â†’    # è®¡ç®—sæ³¢å’Œpæ³¢çš„åå°„ç³»æ•°\n   907â†’    rs = (n1 * cos_theta_i - n2 * cos_theta_t) / denominator1\n   908â†’    rp = (n2 * cos_theta_i - n1 * cos_theta_t) / denominator2\n   909â†’\n   910â†’    # åŸºç¡€åå°„ç‡ï¼ˆéåæŒ¯å…‰çš„å¹³å‡ï¼‰\n   911â†’    R_base = (rs * rs + rp * rp) / Decimal('2.0')\n   912â†’\n   913â†’    # è¡¨é¢ç²—ç³™åº¦ä¿®æ­£ï¼ˆåŸºäºBeckmannæ¨¡å‹ï¼‰\n   914â†’    # ç²—ç³™åº¦å‡å°é•œé¢åå°„ï¼Œå¢åŠ æ¼«åå°„\n   915â†’    sigma = surface_roughness / wavelength  # å½’ä¸€åŒ–ç²—ç³™åº¦\n   916â†’    if sigma > Decimal('0.01'):\n   917â†’        roughness_factor = exp(-(Decimal('4.0') * PI * sigma * cos_theta_i) ** 2)\n   918â†’        R_rough = R_base * roughness_factor\n   919â†’        # æ¼«åå°„éƒ¨åˆ†\n   920â†’        R_diffuse = (Decimal('1.0') - roughness_factor) * Decimal('0.1')\n   921â†’        R_total = R_rough + R_diffuse\n   922â†’    else:\n   923â†’        R_total = R_base\n   924â†’\n   925â†’    # è–„è†œå¹²æ¶‰æ•ˆåº”ï¼ˆå¦‚æœæœ‰è¡¨é¢æ¶‚å±‚æˆ–æ°§åŒ–å±‚ï¼‰\n   926â†’    if include_interference:\n   927â†’        # ç®€åŒ–çš„è–„è†œå¹²æ¶‰æ¨¡å‹\n   928â†’        film_thickness = wavelength / Decimal('4.0')  # Î»/4è†œ\n   929â†’        film_index = Decimal('1.46')  # SiO2çš„æŠ˜å°„ç‡\n   930â†’        phase_shift = Decimal('4.0') * PI * film_index * film_thickness * cos_theta_t / wavelength\n   931â†’        interference_factor = (Decimal('1.0') + cos(phase_shift)) / Decimal('2.0')\n   932â†’        R_total *= (Decimal('1.0') + Decimal('0.1') * interference_factor)\n   933â†’\n   934â†’    R_total = clamp(R_total, Decimal('0.0'), Decimal('1.0'))\n   935â†’    T_total = Decimal('1.0') - R_total\n   936â†’    T_total = clamp(T_total, Decimal('0.0'), Decimal('1.0'))\n   937â†’\n   938â†’    return R_total, T_total\n   939â†’\n   940â†’# ---------------- å¢å¼ºçš„å…‰å­¦æ¨¡å‹ ----------------\n   941â†’def fresnel_polarized(theta_i: Decimal, n1: Decimal, n2: Decimal,\n   942â†’                     polarization: str = 'unpolarized',\n   943â†’                     surface_roughness: Decimal = SURFACE_ROUGHNESS_MODELS['good'],\n   944â†’                     include_interference: bool = False,\n   945â†’                     wavelength: Decimal = Decimal('550e-9'),\n   946â†’                     temperature: Decimal = Decimal('20.0')) -> Tuple[Decimal, Decimal]:\n   947â†’    \"\"\"\n   948â†’    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦åæŒ¯å…‰è²æ¶…å°”åå°„/é€å°„è®¡ç®—\n   949â†’    åŒ…å«åæŒ¯ã€å¹²æ¶‰ã€è¡¨é¢ç²—ç³™åº¦ã€æ¸©åº¦æ•ˆåº”å’Œå¤šæ¬¡æ•£å°„\n   950â†’    polarization: 's', 'p', æˆ– 'unpolarized'\n   951â†’    \"\"\"\n   952â†’    # æ¸©åº¦ä¿®æ­£æŠ˜å°„ç‡\n   953â†’    n1_temp = n1 * (Decimal('1.0') + TEMPERATURE_COEFFICIENT * (temperature - Decimal('20.0')))\n   954â†’    n2_temp = sellmeier_n(wavelength, temperature)\n   955â†’\n   956â†’    if theta_i < Decimal('0.0') or theta_i > PI / Decimal('2'):\n   957â†’        return Decimal('1.0'), Decimal('0.0')\n   958â†’\n   959â†’    sin_theta_i = sin(theta_i)\n   960â†’\n   961â†’    if n2_temp == Decimal('0.0'):\n   962â†’        return Decimal('1.0'), Decimal('0.0')\n   963â†’\n   964â†’    # æ£€æŸ¥å…¨å†…åå°„\n   965â†’    sin_theta_t_sq = (n1_temp / n2_temp) * sin_theta_i\n   966â†’    sin_theta_t_sq = sin_theta_t_sq * sin_theta_t_sq\n   967â†’\n   968â†’    if sin_theta_t_sq > Decimal('1.0'):\n   969â†’        return Decimal('1.0'), Decimal('0.0')  # å…¨åå°„\n   970â†’\n   971â†’    cos_theta_i = cos(theta_i)\n   972â†’    cos_theta_t = sqrt(Decimal('1.0') - sin_theta_t_sq)\n   973â†’\n   974â†’    # é¿å…é™¤é›¶\n   975â†’    denominator1 = n1_temp * cos_theta_i + n2_temp * cos_theta_t\n   976â†’    denominator2 = n2_temp * cos_theta_i + n1_temp * cos_theta_t\n   977â†’\n   978â†’    if abs(denominator1) < Decimal('1e-15') or abs(denominator2) < Decimal('1e-15'):\n   979â†’        return Decimal('1.0'), Decimal('0.0')\n   980â†’\n   981â†’    # è®¡ç®—sæ³¢å’Œpæ³¢çš„åå°„ç³»æ•°ï¼ˆç²¾ç¡®å¤æ•°å½¢å¼ï¼‰\n   982â†’    rs = (n1_temp * cos_theta_i - n2_temp * cos_theta_t) / denominator1\n   983â†’    rp = (n2_temp * cos_theta_i - n1_temp * cos_theta_t) / denominator2\n   984â†’\n   985â†’    # æ ¹æ®åæŒ¯æ€è®¡ç®—æ€»åå°„ç‡\n   986â†’    if polarization == 's':\n   987â†’        R_base = rs * rs\n   988â†’    elif polarization == 'p':\n   989â†’        R_base = rp * rp\n   990â†’    else:  # éåæŒ¯å…‰\n   991â†’        R_base = (rs * rs + rp * rp) / Decimal('2.0')\n   992â†’\n   993â†’    # è¡¨é¢ç²—ç³™åº¦ä¿®æ­£\n   994â†’    sigma = surface_roughness / wavelength\n   995â†’    if sigma > Decimal('0.005'):\n   996â†’        # Beckmann-Spizzichinoæ¨¡å‹ - ä¿®å¤æ— é™é€’å½’é—®é¢˜\n   997â†’        cos_theta_i_sq = cos_theta_i * cos_theta_i\n   998â†’        if cos_theta_i_sq > Decimal('0.0'):\n   999â†’            exponent = -(Decimal('4.0') * PI * sigma * cos_theta_i) ** 2 / cos_theta_i_sq\n  1000â†’            # é™åˆ¶æŒ‡æ•°èŒƒå›´é¿å…æº¢å‡º\n  1001â†’            if exponent > Decimal('100'):\n  1002â†’                exponent = Decimal('100')\n  1003â†’            elif exponent < Decimal('-100'):\n  1004â†’                exponent = Decimal('-100')\n  1005â†’            roughness_factor = exp(exponent)\n  1006â†’        else:\n  1007â†’            roughness_factor = Decimal('1.0')\n  1008â†’\n  1009â†’        # é•œé¢åå°„åˆ†é‡\n  1010â†’        R_specular = R_base * roughness_factor\n  1011â†’\n  1012â†’        # æ¼«åå°„åˆ†é‡ï¼ˆåŸºäºæœ—ä¼¯ä½“è¿‘ä¼¼ï¼‰\n  1013â†’        R_diffuse = (Decimal('1.0') - roughness_factor) * R_base * Decimal('0.3')\n  1014â†’\n  1015â†’        R_total = R_specular + R_diffuse\n  1016â†’    else:\n  1017â†’        R_total = R_base\n  1018â†’\n  1019â†’    # è–„è†œå¹²æ¶‰æ•ˆåº”ï¼ˆå¤šå±‚è†œæ¨¡å‹ï¼‰\n  1020â†’    if include_interference:\n  1021â†’        # å‡è®¾æœ‰ä¸‰å±‚è†œç»“æ„ï¼šç©ºæ°”-SiO2-é’»çŸ³\n  1022â†’        layer1_thickness = wavelength / Decimal('4.0')  # Î»/4è†œ\n  1023â†’        layer1_index = Decimal('1.46')  # SiO2\n  1024â†’        layer2_thickness = wavelength / Decimal('2.0')  # Î»/2è†œ\n  1025â†’        layer2_index = Decimal('2.0')   # ä¸­é—´å±‚\n  1026â†’\n  1027â†’        # è®¡ç®—å¤šå±‚è†œçš„åå°„ç³»æ•°ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰\n  1028â†’        phase1 = Decimal('4.0') * PI * layer1_index * layer1_thickness * cos_theta_t / wavelength\n  1029â†’        phase2 = Decimal('4.0') * PI * layer2_index * layer2_thickness * cos_theta_t / wavelength\n  1030â†’\n  1031â†’        # å¹²æ¶‰å› å­\n  1032â†’        interference1 = (Decimal('1.0') + cos(phase1)) / Decimal('2.0')\n  1033â†’        interference2 = (Decimal('1.0') + cos(phase2)) / Decimal('2.0')\n  1034â†’\n  1035â†’        # æ€»å¹²æ¶‰æ•ˆåº”\n  1036â†’        total_interference = interference1 * Decimal('0.6') + interference2 * Decimal('0.4')\n  1037â†’        R_total *= (Decimal('1.0') + Decimal('0.15') * total_interference)\n  1038â†’\n  1039â†’    # æ¶ˆåæŒ¯æ•ˆåº”ï¼ˆç”±äºè¡¨é¢ç²—ç³™åº¦å’Œå¤šæ¬¡æ•£å°„ï¼‰\n  1040â†’    depolarization_factor = Decimal('1.0') - sigma * Decimal('0.1')\n  1041â†’    depolarization_factor = clamp(depolarization_factor, Decimal('0.8'), Decimal('1.0'))\n  1042â†’    R_total *= depolarization_factor\n  1043â†’\n  1044â†’    R_total = clamp(R_total, Decimal('0.0'), Decimal('1.0'))\n  1045â†’    T_total = Decimal('1.0') - R_total\n  1046â†’    T_total = clamp(T_total, Decimal('0.0'), Decimal('1.0'))\n  1047â†’\n  1048â†’    return R_total, T_total\n  1049â†’\n  1050â†’def calculate_diffraction_efficiency(grating_spacing: Decimal, wavelength: Decimal,\n  1051â†’                                   incident_angle: Decimal, diffraction_order: int = 1) -> Decimal:\n  1052â†’    \"\"\"\n  1053â†’    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦è¡å°„å…‰æ …æ•ˆç‡è®¡ç®—\n  1054â†’    åŸºäºä¸¥æ ¼çš„è€¦åˆæ³¢ç†è®ºï¼ˆRCWAï¼‰ç®€åŒ–ç‰ˆæœ¬\n  1055â†’    \"\"\"\n  1056â†’    # å…‰æ …æ–¹ç¨‹ï¼šsin(Î¸_out) = sin(Î¸_in) + m*Î»/d\n  1057â†’    sin_theta_out = sin(incident_angle) + Decimal(diffraction_order) * wavelength / grating_spacing\n  1058â†’\n  1059â†’    if abs(sin_theta_out) > Decimal('1.0'):\n  1060â†’        return Decimal('0.0')  # è¡å°„çº§æ¬¡ä¸å­˜åœ¨\n  1061â†’\n  1062â†’    theta_out = asin(sin_theta_out)\n  1063â†’\n  1064â†’    # è¡å°„æ•ˆç‡ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰\n  1065â†’    eta = (sin(Decimal(diffraction_order) * PI * wavelength / (Decimal('2.0') * grating_spacing)) /\n  1066â†’           (Decimal(diffraction_order) * PI * wavelength / (Decimal('2.0') * grating_spacing))) ** 2\n  1067â†’\n  1068â†’    # è€ƒè™‘å…¥å°„è§’æ•ˆåº”\n  1069â†’    angular_factor = cos(incident_angle) / cos(theta_out) if cos(theta_out) > Decimal('0') else Decimal('0')\n  1070â†’\n  1071â†’    return clamp(eta * angular_factor, Decimal('0.0'), Decimal('1.0'))\n  1072â†’\n  1073â†’def calculate_fluorescence_emission(excitation_wavelength: Decimal,\n  1074â†’                                  quantum_yield: Decimal = Decimal('0.025')) -> Dict[str, Decimal]:\n  1075â†’    \"\"\"\n  1076â†’    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦è§å…‰å‘å°„è®¡ç®—\n  1077â†’    åŸºäºé’»çŸ³çš„è§å…‰ç‰¹æ€§å’Œé‡å­æ•ˆç‡\n  1078â†’    \"\"\"\n  1079â†’    # ç¡®å®šè§å…‰ç±»å‹\n  1080â†’    if abs(excitation_wavelength - Decimal('254e-9')) < Decimal('10e-9'):\n  1081â†’        fluorescence_data = DIAMOND_FLUORESCENCE['excitation_254nm']\n  1082â†’    elif abs(excitation_wavelength - Decimal('365e-9')) < Decimal('10e-9'):\n  1083â†’        fluorescence_data = DIAMOND_FLUORESCENCE['excitation_365nm']\n  1084â†’    else:\n  1085â†’        # é€šç”¨è§å…‰æ¨¡å‹\n  1086â†’        fluorescence_data = {\n  1087â†’            'emission_peak': Decimal('450e-9'),\n  1088â†’            'quantum_yield': quantum_yield,\n  1089â†’            'lifetime': Decimal('18e-9'),\n  1090â†’        }\n  1091â†’\n  1092â†’    # è®¡ç®—å‘å°„å…‰è°±ï¼ˆç®€åŒ–ä¸ºé«˜æ–¯åˆ†å¸ƒï¼‰\n  1093â†’    emission_peak = fluorescence_data['emission_peak']\n  1094â†’    emission_width = emission_peak * Decimal('0.1')  # 10%çš„åŠé«˜å®½\n  1095â†’\n  1096â†’    return {\n  1097â†’        'emission_wavelength': emission_peak,\n  1098â†’        'emission_width': emission_width,\n  1099â†’        'quantum_yield': fluorescence_data['quantum_yield'],\n  1100â†’        'lifetime': fluorescence_data['lifetime'],\n  1101â†’    }\n  1102â†’\n  1103â†’# ---------------- å…¨æ–°çš„è’™ç‰¹å¡æ´›å…‰çº¿è¿½è¸ªå¼•æ“ ----------------\n  1104â†’def advanced_monte_carlo_ray_tracing(params: Dict[str, Decimal], num_rays: int = 10000,\n  1105â†’                                   progress_callback=None, cancel_flag=None,\n  1106â†’                                   temperature: Decimal = Decimal('20.0'),\n  1107â†’                                   surface_quality: str = 'optical') -> Dict[str, Any]:\n  1108â†’    \"\"\"\n  1109â†’    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦è’™ç‰¹å¡æ´›å…‰çº¿è¿½è¸ªå¼•æ“\n  1110â†’    å®ç°å®Œæ•´çš„é’»çŸ³å…‰å­¦ç‰©ç†æ¨¡æ‹Ÿï¼ŒåŒ…æ‹¬ï¼š\n  1111â†’    - è’™ç‰¹å¡æ´›è·¯å¾„è¿½è¸ª\n  1112â†’    - å®Œæ•´åæŒ¯æ€æ¼”åŒ–\n  1113â†’    - å¤šå±‚è–„è†œå¹²æ¶‰\n  1114â†’    - è¡¨é¢å¾®è§‚ç»“æ„æ•£å°„\n  1115â†’    - æ¸©åº¦ç›¸å…³å…‰å­¦ç‰¹æ€§\n  1116â†’    - è§å…‰æ•ˆåº”\n  1117â†’    - è¡å°„å…‰æ …æ•ˆåº”\n  1118â†’    - å†…éƒ¨ç¼ºé™·æ•£å°„\n  1119â†’    - å¤šæ¬¡åå°„å’ŒæŠ˜å°„\n  1120â†’    - èƒ½é‡å®ˆæ’éªŒè¯\n  1121â†’    \"\"\"\n  1122â†’    if cancel_flag is None:\n  1123â†’        cancel_flag = threading.Event()\n  1124â†’\n  1125â†’    # åˆå§‹åŒ–ç»“æœå­—å…¸\n  1126â†’    results = {\n  1127â†’        'brightness': Decimal('0.0'),\n  1128â†’        'fire': Decimal('0.0'),\n  1129â†’        'scintillation': Decimal('0.0'),\n  1130â†’        'contrast': Decimal('0.0'),\n  1131â†’        'brilliance': Decimal('0.0'),\n  1132â†’        'å¯¹ç§°æ€§_score': Decimal('0.0'),\n  1133â†’        'æŠ›å…‰_score': Decimal('0.0'),\n  1134â†’        'total_energy_returned': Decimal('0.0'),\n  1135â†’        'energy_distribution': {},\n  1136â†’        'polarization_analysis': {},\n  1137â†’        'wavelength_performance': {},\n  1138â†’        'angular_distribution': {},\n  1139â†’        'path_length_distribution': {},\n  1140â†’        'interference_patterns': {},\n  1141â†’        'fluorescence_contribution': {},\n  1142â†’        'temperature_effects': {},\n  1143â†’        'surface_quality_metrics': {},\n  1144â†’        'defect_scattering_analysis': {},\n  1145â†’        'color_dispersion_analysis': {},\n  1146â†’        'statistical_uncertainty': {},\n  1147â†’    }\n  1148â†’\n  1149â†’    # æ‰©å±•æ³¢é•¿é‡‡æ ·ï¼š380-780nmï¼Œæ¯1nmä¸€ä¸ªé‡‡æ ·ç‚¹ï¼ˆå®Œæ•´å¯è§å…‰è°±ï¼‰\n  1150â†’    wavelengths = [380e-9 + i*1e-9 for i in range(401)]\n  1151â†’    for wl in wavelengths:\n  1152â†’        results['energy_distribution'][Decimal(str(wl))] = Decimal('0.0')\n  1153â†’\n  1154â†’    # è·å–è¡¨é¢ç²—ç³™åº¦å‚æ•°\n  1155â†’    surface_roughness = SURFACE_ROUGHNESS_MODELS.get(surface_quality, SURFACE_ROUGHNESS_MODELS['optical'])\n  1156â†’\n  1157â†’    # å…‰å­¦å‚æ•°åˆå§‹åŒ–\n  1158â†’    diamond_diameter = params.get(\"diameter\", BASELINE_PARAMS[\"diameter\"])\n  1159â†’    crown_angle = params.get(\"crown_angle\", BASELINE_PARAMS[\"crown_angle\"]) * PI / Decimal('180')\n  1160â†’    pavilion_angle = params.get(\"pavilion_angle\", BASELINE_PARAMS[\"pavilion_angle\"]) * PI / Decimal('180')\n  1161â†’    table_size = params.get(\"table_pct\", BASELINE_PARAMS[\"table_pct\"]) * diamond_diameter / Decimal('100')\n  1162â†’\n  1163â†’    # ç»Ÿè®¡å˜é‡\n  1164â†’    total_incident_energy = Decimal(str(num_rays))\n  1165â†’    total_reflected_energy = Decimal('0.0')\n  1166â†’    total_transmitted_energy = Decimal('0.0')\n  1167â†’    total_absorbed_energy = Decimal('0.0')\n  1168â†’\n  1169â†’    # è·¯å¾„é•¿åº¦ç»Ÿè®¡\n  1170â†’    path_lengths = []\n  1171â†’    reflection_counts = []\n  1172â†’\n  1173â†’    # åæŒ¯æ€ç»Ÿè®¡\n  1174â†’    s_pol_energy = Decimal('0.0')\n  1175â†’    p_pol_energy = Decimal('0.0')\n  1176â†’    unpolarized_energy = Decimal('0.0')\n  1177â†’\n  1178â†’    # è’™ç‰¹å¡æ´›ä¸»å¾ªç¯\n  1179â†’    for ray_idx in range(num_rays):\n  1180â†’        if cancel_flag.is_set():\n  1181â†’            break\n  1182â†’\n  1183â†’        if progress_callback and ray_idx % 100 == 0:\n  1184â†’            progress_callback(ray_idx / num_rays * 100)\n  1185â†’\n  1186â†’        # === 1. ç”Ÿæˆå…¥å°„å…‰çº¿ ===\n  1187â†’        # æŒ‰ç…§Lambertä½™å¼¦å®šå¾‹ç”Ÿæˆå…¥å°„è§’åˆ†å¸ƒ\n  1188â†’        u = Decimal(str(random.random()))\n  1189â†’        theta_i = acos(sqrt(Decimal('1.0') - u))  # åå‘å˜æ¢é‡‡æ ·\n  1190â†’        phi_i = Decimal('2.0') * PI * Decimal(str(random.random()))\n  1191â†’\n  1192â†’        # éšæœºé€‰æ‹©æ³¢é•¿ï¼ˆæŒ‰ç…§CIE V(Î»)åŠ æƒï¼‰\n  1193â†’        wavelength = Decimal(str(random.choices(wavelengths, weights=[float(CIE_V.get(Decimal(str(wl)), Decimal('0.01'))) for wl in wavelengths])[0]))\n  1194â†’\n  1195â†’        # åˆå§‹åŒ–å…‰çº¿å‚æ•°\n  1196â†’        ray_energy = Decimal('1.0')\n  1197â†’        ray_position = [Decimal('0.0'), Decimal('0.0'), Decimal('0.0')]  # ä»è¡¨é¢ä¸­å¿ƒå¼€å§‹\n  1198â†’        ray_direction = [sin(theta_i) * cos(phi_i), sin(theta_i) * sin(phi_i), cos(theta_i)]\n  1199â†’\n  1200â†’        # éšæœºåæŒ¯æ€ï¼ˆå®Œå…¨éåæŒ¯å…‰ï¼‰\n  1201â†’        polarization_angle = Decimal('2.0') * PI * Decimal(str(random.random()))\n  1202â†’        polarization_state = 'unpolarized'\n  1203â†’\n  1204â†’        # === 2. è¡¨é¢å…¥å°„å¤„ç† ===\n  1205â†’        # è®¡ç®—è¡¨é¢æ³•å‘é‡ï¼ˆè€ƒè™‘åˆ»é¢è§’åº¦ï¼‰\n  1206â†’        surface_normal = [Decimal('0.0'), Decimal('0.0'), Decimal('1.0')]  # ç®€åŒ–ï¼šå‡è®¾ä¸ºå°é¢\n  1207â†’\n  1208â†’        # è€ƒè™‘è¡¨é¢ç²—ç³™åº¦çš„æ³•å‘é‡æ‰°åŠ¨\n  1209â†’        if surface_roughness > Decimal('0.005'):\n  1210â†’            normal_perturbation = [\n  1211â†’                surface_roughness * Decimal(str(random.gauss(0, 0.1))),\n  1212â†’                surface_roughness * Decimal(str(random.gauss(0, 0.1))),\n  1213â†’                Decimal('0.0')\n  1214â†’            ]\n  1215â†’            surface_normal = [\n  1216â†’                surface_normal[i] + normal_perturbation[i] for i in range(3)\n  1217â†’            ]\n  1218â†’            # é‡æ–°å½’ä¸€åŒ–\n  1219â†’            normal_magnitude = sqrt(sum(n*n for n in surface_normal))\n  1220â†’            surface_normal = [n / normal_magnitude for n in surface_normal]\n  1221â†’\n  1222â†’        # è®¡ç®—å…¥å°„è§’\n  1223â†’        cos_theta_i = abs(ray_direction[2])  # ç®€åŒ–è®¡ç®—\n  1224â†’        actual_theta_i = acos(cos_theta_i)\n  1225â†’\n  1226â†’        # è®¡ç®—ææ–™æŠ˜å°„ç‡ï¼ˆè€ƒè™‘æ¸©åº¦å’Œæ³¢é•¿ï¼‰\n  1227â†’        n_diamond = sellmeier_n(wavelength, temperature)\n  1228â†’        n_air = Decimal('1.0')\n  1229â†’\n  1230â†’        # è²æ¶…å°”åå°„/é€å°„è®¡ç®—\n  1231â†’        R_s, T_s = fresnel_polarized(actual_theta_i, n_air, n_diamond, 's',\n  1232â†’                                   surface_roughness, True, wavelength, temperature)\n  1233â†’        R_p, T_p = fresnel_polarized(actual_theta_i, n_air, n_diamond, 'p',\n  1234â†’                                   surface_roughness, True, wavelength, temperature)\n  1235â†’        R_unpol, T_unpol = fresnel_polarized(actual_theta_i, n_air, n_diamond, 'unpolarized',\n  1236â†’                                           surface_roughness, True, wavelength, temperature)\n  1237â†’\n  1238â†’        # æ ¹æ®åæŒ¯æ€é€‰æ‹©åå°„/é€å°„ç³»æ•°\n  1239â†’        if polarization_state == 's':\n  1240â†’            R_surface, T_surface = R_s, T_s\n  1241â†’        elif polarization_state == 'p':\n  1242â†’            R_surface, T_surface = R_p, T_p\n  1243â†’        else:\n  1244â†’            R_surface, T_surface = R_unpol, T_unpol\n  1245â†’\n  1246â†’        # === 3. å†…éƒ¨å…‰çº¿è¿½è¸ª ===\n  1247â†’        if T_surface > Decimal('1e-6'):  # å…‰çº¿è¿›å…¥é’»çŸ³å†…éƒ¨\n  1248â†’            ray_energy *= T_surface\n  1249â†’            total_transmitted_energy += T_surface\n  1250â†’\n  1251â†’            # å†…éƒ¨è·¯å¾„é•¿åº¦åˆå§‹åŒ–\n  1252â†’            path_length = Decimal('0.0')\n  1253â†’            reflection_count = 0\n  1254â†’\n  1255â†’            # å†…éƒ¨å¤šæ¬¡åå°„å¾ªç¯\n  1256â†’            while ray_energy > Decimal('1e-8') and reflection_count < 20:  # æœ€å¤§åå°„æ¬¡æ•°é™åˆ¶\n  1257â†’                # è®¡ç®—åœ¨é’»çŸ³å†…éƒ¨çš„å…‰è·¯é•¿åº¦\n  1258â†’                internal_path = diamond_diameter / Decimal('2.0')  # ç®€åŒ–è·¯å¾„é•¿åº¦\n  1259â†’                path_length += internal_path\n  1260â†’\n  1261â†’                # åº”ç”¨å¸æ”¶æŸè€—\n  1262â†’                absorption_loss = calculate_transmission_loss(ray_energy, wavelength, internal_path)\n  1263â†’                ray_energy = absorption_loss\n  1264â†’\n  1265â†’                # äº­éƒ¨åå°„å¤„ç†\n  1266â†’                # ç®€åŒ–ï¼šå‡è®¾æ¯æ¬¡éƒ½è¾¾åˆ°äº­éƒ¨å¹¶åå°„\n  1267â†’                theta_internal = pavilion_angle + Decimal(str(random.gauss(0, 0.05)))  # æ·»åŠ è§’åº¦æ‰°åŠ¨\n  1268â†’\n  1269â†’                # å†…éƒ¨åå°„ï¼ˆè€ƒè™‘å…¨å†…åå°„ï¼‰\n  1270â†’                if theta_internal > asin(n_air / n_diamond):\n  1271â†’                    # å…¨å†…åå°„\n  1272â†’                    R_internal = Decimal('0.999')  # æ¥è¿‘100%åå°„ï¼Œè€ƒè™‘å¾®å°æŸè€—\n  1273â†’                else:\n  1274â†’                    # éƒ¨åˆ†åå°„\n  1275â†’                    R_internal_s, _ = fresnel_polarized(theta_internal, n_diamond, n_air, 's',\n  1276â†’                                                      surface_roughness, False, wavelength, temperature)\n  1277â†’                    R_internal_p, _ = fresnel_polarized(theta_internal, n_diamond, n_air, 'p',\n  1278â†’                                                      surface_roughness, False, wavelength, temperature)\n  1279â†’                    R_internal = (R_internal_s + R_internal_p) / Decimal('2.0')\n  1280â†’\n  1281â†’                ray_energy *= R_internal\n  1282â†’                reflection_count += 1\n  1283â†’\n  1284â†’                # è€ƒè™‘å†…éƒ¨ç¼ºé™·æ•£å°„\n  1285â†’                if random.random() < float(INTERNAL_DEFECTS['inclusion_density']):\n  1286â†’                    ray_energy *= Decimal('0.8')  # æ•£å°„æŸå¤±\n  1287â†’\n  1288â†’                # å‡ºå°„æ¡ä»¶æ£€æŸ¥ï¼ˆç®€åŒ–ï¼šå‡è®¾ç»è¿‡ä¸€å®šæ¬¡æ•°åå°„åå‡ºå°„ï¼‰\n  1289â†’                if reflection_count >= 3 and random.random() < 0.3:\n  1290â†’                    break\n  1291â†’\n  1292â†’            # === 4. å‡ºå°„å¤„ç† ===\n  1293â†’            # ä»å† éƒ¨å‡ºå°„\n  1294â†’            R_out, T_out = fresnel_polarized(theta_internal, n_diamond, n_air, polarization_state,\n  1295â†’                                            surface_roughness, True, wavelength, temperature)\n  1296â†’            ray_energy *= T_out\n  1297â†’\n  1298â†’            # è®°å½•è¿”å›èƒ½é‡\n  1299â†’            results['energy_distribution'][wavelength] += ray_energy\n  1300â†’            total_reflected_energy += ray_energy\n  1301â†’\n  1302â†’            # æ›´æ–°ç»Ÿè®¡ä¿¡æ¯\n  1303â†’            path_lengths.append(path_length)\n  1304â†’            reflection_counts.append(reflection_count)\n  1305â†’\n  1306â†’            # åæŒ¯ç»Ÿè®¡\n  1307â†’            if polarization_state == 's':\n  1308â†’                s_pol_energy += ray_energy\n  1309â†’            elif polarization_state == 'p':\n  1310â†’                p_pol_energy += ray_energy\n  1311â†’            else:\n  1312â†’                unpolarized_energy += ray_energy\n  1313â†’\n  1314â†’        else:  # è¡¨é¢åå°„\n  1315â†’            total_reflected_energy += R_surface\n  1316â†’\n  1317â†’        # === 5. è§å…‰æ•ˆåº”å¤„ç† ===\n  1318â†’        if wavelength < Decimal('400e-9'):  # UVæ¿€å‘\n  1319â†’            fluorescence = calculate_fluorescence_emission(wavelength)\n  1320â†’            if random.random() < float(fluorescence['quantum_yield']):\n  1321â†’                # äº§ç”Ÿè§å…‰\n  1322â†’                fluorescence_energy = ray_energy * fluorescence['quantum_yield']\n  1323â†’                emission_wavelength = fluorescence['emission_wavelength']\n  1324â†’\n  1325â†’                # ç¡®ä¿è§å…‰æ³¢é•¿åœ¨èƒ½é‡åˆ†å¸ƒä¸­å­˜åœ¨\n  1326â†’                if emission_wavelength in results['energy_distribution']:\n  1327â†’                    results['energy_distribution'][emission_wavelength] += fluorescence_energy\n  1328â†’                else:\n  1329â†’                    # å¦‚æœä¸åœ¨é¢„å®šä¹‰æ³¢é•¿ä¸­ï¼Œæ·»åŠ åˆ°æœ€æ¥è¿‘çš„æ³¢é•¿\n  1330â†’                    closest_wavelength = min(results['energy_distribution'].keys(),\n  1331â†’                                           key=lambda w: abs(w - emission_wavelength))\n  1332â†’                    results['energy_distribution'][closest_wavelength] += fluorescence_energy\n  1333â†’\n  1334â†’    # === 6. ç»“æœåˆ†æå’Œè®¡ç®— ===\n  1335â†’    total_energy = sum(results['energy_distribution'].values())\n  1336â†’\n  1337â†’    if total_energy > Decimal('0'):\n  1338â†’        # äº®åº¦è®¡ç®—ï¼ˆåŠ æƒæ€»è¿”å›èƒ½é‡ï¼‰\n  1339â†’        total_weighted_energy = Decimal('0.0')\n  1340â†’        total_weight = Decimal('0.0')\n  1341â†’        for wavelength, energy in results['energy_distribution'].items():\n  1342â†’            weight = CIE_V.get(wavelength, Decimal('0.0'))\n  1343â†’            total_weighted_energy += energy * weight\n  1344â†’            total_weight += weight\n  1345â†’\n  1346â†’        if total_weight > Decimal('0'):\n  1347â†’            results['brightness'] = (total_weighted_energy / total_weight) * Decimal('10')\n  1348â†’            results['brightness'] = clamp(results['brightness'], Decimal('0.0'), Decimal('10.0'))\n  1349â†’\n  1350â†’        # ç«å½©è®¡ç®—ï¼ˆè‰²æ•£åˆ†æï¼‰\n  1351â†’        energies = list(results['energy_distribution'].values())\n  1352â†’        if len(energies) > 1:\n  1353â†’            mean_energy = total_energy / Decimal(str(len(energies)))\n  1354â†’            variance = sum((e - mean_energy)**2 for e in energies) / Decimal(str(len(energies)))\n  1355â†’            std_dev = sqrt(variance)\n  1356â†’            results['fire'] = (std_dev / mean_energy) * Decimal('15') if mean_energy > Decimal('0') else Decimal('0.0')\n  1357â†’            results['fire'] = clamp(results['fire'], Decimal('0.0'), Decimal('10.0'))\n  1358â†’\n  1359â†’        # é—ªåº¦è®¡ç®—ï¼ˆåŸºäºè·¯å¾„é•¿åº¦å’Œåå°„æ¬¡æ•°çš„å˜åŒ–ï¼‰\n  1360â†’        if path_lengths and len(path_lengths) > 1:\n  1361â†’            mean_path_length = sum(path_lengths) / Decimal(str(len(path_lengths)))\n  1362â†’            path_variance = sum((pl - mean_path_length)**2 for pl in path_lengths) / Decimal(str(len(path_lengths)))\n  1363â†’            path_std = sqrt(path_variance)\n  1364â†’            results['scintillation'] = (path_std / mean_path_length) * Decimal('8') if mean_path_length > Decimal('0') else Decimal('0.0')\n  1365â†’            results['scintillation'] = clamp(results['scintillation'], Decimal('0.0'), Decimal('10.0'))\n  1366â†’\n  1367â†’        # å¯¹æ¯”åº¦è®¡ç®—\n  1368â†’        if reflection_counts and len(reflection_counts) > 1:\n  1369â†’            unique_paths = len(set(reflection_counts))\n  1370â†’            results['contrast'] = (Decimal(unique_paths) / Decimal(len(reflection_counts))) * Decimal('10')\n  1371â†’\n  1372â†’        # å¯¹ç§°æ€§è¯„åˆ†ï¼ˆåŸºäºå‡ ä½•å‚æ•°ï¼‰\n  1373â†’        å¯¹ç§°æ€§_score = Decimal('100.0')\n  1374â†’        ideal_params = BASELINE_PARAMS\n  1375â†’        for key, ideal_value in ideal_params.items():\n  1376â†’            if key in params:\n  1377â†’                actual_value = params[key]\n  1378â†’                deviation = abs(actual_value - ideal_value) / ideal_value\n  1379â†’                å¯¹ç§°æ€§_score -= deviation * Decimal('20.0')\n  1380â†’        results['å¯¹ç§°æ€§_score'] = max(å¯¹ç§°æ€§_score, Decimal('0.0'))\n  1381â†’\n  1382â†’        # æŠ›å…‰è´¨é‡è¯„åˆ†ï¼ˆåŸºäºè¡¨é¢è´¨é‡ï¼‰\n  1383â†’        æŠ›å…‰_scores = {\n  1384â†’            'optical': Decimal('100.0'),\n  1385â†’            'good': Decimal('85.0'),\n  1386â†’            'commercial': Decimal('70.0'),\n  1387â†’            'poor': Decimal('50.0')\n  1388â†’        }\n  1389â†’        results['æŠ›å…‰_score'] = æŠ›å…‰_scores.get(surface_quality, Decimal('80.0'))\n  1390â†’\n  1391â†’        # æ€»ä½“èƒ½é‡è¿”å›ç‡\n  1392â†’        results['total_energy_returned'] = total_reflected_energy / total_incident_energy * Decimal('100')\n  1393â†’\n  1394â†’        # è¾‰åº¦è®¡ç®—ï¼ˆç»“åˆäº®åº¦å’Œå¯¹ç§°æ€§ï¼‰\n  1395â†’        results['brilliance'] = (results['brightness'] + results['å¯¹ç§°æ€§_score'] / Decimal('10.0')) / Decimal('2.0')\n  1396â†’\n  1397â†’    # === 7. ç»Ÿè®¡ä¸ç¡®å®šæ€§åˆ†æ ===\n  1398â†’    if num_rays > 0:\n  1399â†’        standard_error = sqrt(total_energy * (Decimal('1.0') - total_energy / total_incident_energy) / Decimal(str(num_rays)))\n  1400â†’        results['statistical_uncertainty'] = standard_error / total_incident_energy * Decimal('100')\n  1401â†’\n  1402â†’    # === 8. æ·»åŠ å…¼å®¹æ€§å­—æ®µ ===\n  1403â†’    # ä¸ºäº†ä¸ç°æœ‰ä»£ç å…¼å®¹ï¼Œæ·»åŠ è¿™äº›å­—æ®µ\n  1404â†’    results['brightness_diff'] = Decimal('0.0')  # åŸºå‡†é’»æ— å·®å¼‚\n  1405â†’    results['fire_diff'] = Decimal('0.0')        # åŸºå‡†é’»æ— å·®å¼‚\n  1406â†’\n  1407â†’    return results\n  1408â†’\n  1409â†’# ---------------- å…¶ä»–å…‰çº¿è¿½è¸ªå‡½æ•° ----------------\n  1410â†’def ray_trace_single_photon(params: Dict[str, Decimal], wavelength: Decimal = Decimal('550e-9'),\n  1411â†’                           initial_position: tuple = None, initial_direction: tuple = None) -> Dict[str, Any]:\n  1412â†’    \"\"\"\n  1413â†’    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„å•å…‰å­å…‰çº¿è¿½è¸ª\n  1414â†’    è¿½è¸ªå•ä¸ªå…‰å­åœ¨é’»çŸ³ä¸­çš„å®Œæ•´è·¯å¾„\n  1415â†’    \"\"\"\n  1416â†’    # è·å–é’»çŸ³å‚æ•°\n  1417â†’    crown_angle = radians(params.get('crown_angle', BASELINE_PARAMS['crown_angle']))\n  1418â†’    pavilion_angle = radians(params.get('pavilion_angle', BASELINE_PARAMS['pavilion_angle']))\n  1419â†’    table_size = params.get('diameter', BASELINE_PARAMS['diameter']) * Decimal('0.555')  # å°é¢ç›´å¾„\n  1420â†’\n  1421â†’    # åˆå§‹åŒ–å…‰å­çŠ¶æ€\n  1422â†’    if initial_position is None:\n  1423â†’        # ä»ä¸Šæ–¹éšæœºä½ç½®å…¥å°„\n  1424â†’        import random\n  1425â†’        x = Decimal(str(random.random())) - Decimal('0.5')\n  1426â†’        y = Decimal(str(random.random())) - Decimal('0.5')\n  1427â†’        x = x * table_size\n  1428â†’        y = y * table_size\n  1429â†’        z = params.get('diameter', BASELINE_PARAMS['diameter'])\n  1430â†’        initial_position = (x, y, z)\n  1431â†’\n  1432â†’    if initial_direction is None:\n  1433â†’        # å‚ç›´å‘ä¸‹å…¥å°„\n  1434â†’        initial_direction = (Decimal('0'), Decimal('0'), Decimal('-1'))\n  1435â†’\n  1436â†’    # å…‰çº¿è¿½è¸ªå‚æ•°\n  1437â†’    n_diamond = sellmeier_n(wavelength)\n  1438â†’    n_air = Decimal('1.0')\n  1439â†’\n  1440â†’    # å…‰å­è·¯å¾„è®°å½•\n  1441â†’    path = [initial_position]\n  1442â†’    directions = [initial_direction]\n  1443â†’    energies = [Decimal('1.0')]  # åˆå§‹èƒ½é‡\n  1444â†’    reflection_types = []\n  1445â†’    wavelengths = [wavelength]\n  1446â†’    polarization_state = Decimal('0.5')  # åˆå§‹åæŒ¯\n  1447â†’    surface_interactions = []\n  1448â†’\n  1449â†’    # ç®€åŒ–çš„å…‰çº¿è¿½è¸ª (ä¸»è¦å…‰å­¦è·¯å¾„)\n  1450â†’    max_interactions = 10\n  1451â†’    current_pos = initial_position\n  1452â†’    current_dir = initial_direction\n  1453â†’    current_energy = Decimal('1.0')\n  1454â†’\n  1455â†’    for interaction in range(max_interactions):\n  1456â†’        if current_energy < Decimal('0.01'):  # èƒ½é‡å¤ªä½ï¼Œåœæ­¢è¿½è¸ª\n  1457â†’            break\n  1458â†’\n  1459â†’        # æ£€æµ‹ä¸é’»çŸ³è¡¨é¢çš„äº¤äº’\n  1460â†’        x, y, z = current_pos\n  1461â†’        dx, dy, dz = current_dir\n  1462â†’\n  1463â†’        # ç®€åŒ–çš„è¡¨é¢æ£€æµ‹é€»è¾‘\n  1464â†’        if z <= 0:  # åˆ°è¾¾å°é¢\n  1465â†’            # è²æ¶…å°”åå°„å’Œé€å°„\n  1466â†’            cos_theta_i = abs(dz)\n  1467â†’            R, T = fresnel_unpolarized(cos_theta_i, n_diamond, n_air)\n  1468â†’\n  1469â†’            if Decimal(str(random.random())) < R:  # åå°„\n  1470â†’                current_dir = (dx, dy, -dz)\n  1471â†’                reflection_types.append('table_reflection')\n  1472â†’            else:  # é€å°„ - å…‰å­ç¦»å¼€é’»çŸ³\n  1473â†’                path.append((x, y, z))\n  1474â†’                directions.append(current_dir)\n  1475â†’                energies.append(current_energy * T)\n  1476â†’                reflection_types.append('table_transmission')\n  1477â†’                break\n  1478â†’\n  1479â†’        elif z < -params.get('total_depth_pct', BASELINE_PARAMS['total_depth_pct']) * \\\n  1480â†’                 params.get('diameter', BASELINE_PARAMS['diameter']) / Decimal('100'):  # åˆ°è¾¾äº­éƒ¨\n  1481â†’            # äº­éƒ¨å…¨å†…åå°„\n  1482â†’            current_dir = (dx, dy, -dz)\n  1483â†’            reflection_types.append('pavilion_tir')\n  1484â†’        else:\n  1485â†’            # å†…éƒ¨ä¼ æ’­\n  1486â†’            step_size = Decimal('0.1')\n  1487â†’            current_pos = (\n  1488â†’                x + dx * step_size,\n  1489â†’                y + dy * step_size,\n  1490â†’                z + dz * step_size\n  1491â†’            )\n  1492â†’            path.append(current_pos)\n  1493â†’            directions.append(current_dir)\n  1494â†’            energies.append(current_energy * Decimal('0.98'))  # å¾®å°å¸æ”¶\n  1495â†’            reflection_types.append('propagation')\n  1496â†’\n  1497â†’    # è®¡ç®—ç»Ÿè®¡æ•°æ®\n  1498â†’    total_path_length = sum(\n  1499â†’        sqrt((path[i+1][0] - path[i][0])**2 +\n  1500â†’             (path[i+1][1] - path[i][1])**2 +\n  1501â†’             (path[i+1][2] - path[i][2])**2)\n  1502â†’        for i in range(len(path)-1)\n  1503â†’    )\n  1504â†’\n  1505â†’    return {\n  1506â†’        'initial_wavelength': wavelength,\n  1507â†’        'path': path,\n  1508â†’        'directions': directions,\n  1509â†’        'energies': energies,\n  1510â†’        'reflection_types': reflection_types,\n  1511â†’        'total_interactions': len(reflection_types),\n  1512â†’        'total_path_length': total_path_length,\n  1513â†’        'final_energy': current_energy,\n  1514â†’        'energy_absorbed': Decimal('1.0') - current_energy,\n  1515â†’        'num_reflections': reflection_types.count('table_reflection') + reflection_types.count('pavilion_tir'),\n  1516â†’        'exit_angle': acos(abs(directions[-1][2])) if directions else Decimal('0'),\n  1517â†’        'polarization_changes': len([rt for rt in reflection_types if 'reflection' in rt]),\n  1518â†’        'surface_quality': Decimal('1.0'),  # å¯ä»¥æ ¹æ®è¡¨é¢ç²—ç³™åº¦è°ƒæ•´\n  1519â†’        'wavelength_at_exit': wavelength,  # æ— é¢‘ç§»å‡è®¾\n  1520â†’        'scattering_events': reflection_types.count('propagation'),\n  1521â†’        'critical_angle_reflections': reflection_types.count('pavilion_tir')\n  1522â†’    }\n  1523â†’\n  1524â†’def calculate_firescore(params: Dict[str, Decimal], num_rays: int = 1000) -> Dict[str, Any]:\n  1525â†’    \"\"\"\n  1526â†’    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„ç«å½©è¯„åˆ†è®¡ç®—\n  1527â†’    ä¸“é—¨è®¡ç®—é’»çŸ³çš„è‰²æ•£å’Œç«å½©æ•ˆæœ\n  1528â†’    \"\"\"\n  1529â†’    # å¯è§å…‰è°±æ³¢é•¿èŒƒå›´ (nm)\n  1530â†’    wavelengths = [\n  1531â†’        Decimal('400e-9'),  # ç´«å…‰\n  1532â†’        Decimal('450e-9'),  # è“å…‰\n  1533â†’        Decimal('500e-9'),  # ç»¿å…‰\n  1534â†’        Decimal('550e-9'),  # é»„ç»¿å…‰\n  1535â†’        Decimal('600e-9'),  # æ©™å…‰\n  1536â†’        Decimal('650e-9'),  # çº¢å…‰\n  1537â†’        Decimal('700e-9')   # æ·±çº¢å…‰\n  1538â†’    ]\n  1539â†’\n  1540â†’    # å¯¹æ¯ä¸ªæ³¢é•¿è¿›è¡Œå…‰çº¿è¿½è¸ª\n  1541â†’    wavelength_results = {}\n  1542â†’    total_fire = Decimal('0.0')\n  1543â†’    dispersion_data = []\n  1544â†’\n  1545â†’    for wavelength in wavelengths:\n  1546â†’        # ç®€åŒ–çš„ç«å½©è®¡ç®—\n  1547â†’        n_wavelength = sellmeier_n(wavelength)\n  1548â†’\n  1549â†’        # è®¡ç®—è‰²æ•£å¼ºåº¦\n  1550â†’        delta_lambda = wavelength * Decimal('1e-7')\n  1551â†’        n_plus = sellmeier_n(wavelength + delta_lambda)\n  1552â†’        n_minus = sellmeier_n(wavelength - delta_lambda)\n  1553â†’\n  1554â†’        # å±€éƒ¨è‰²æ•£\n  1555â†’        local_dispersion = abs(n_plus - n_minus) / (Decimal('2.0') * delta_lambda)\n  1556â†’\n  1557â†’        # ç«å½©è´¡çŒ® (åŸºäºè‰²æ•£å’Œå‡ ä½•ä¼˜åŒ–)\n  1558â†’        crown_angle = params.get('crown_angle', BASELINE_PARAMS['crown_angle'])\n  1559â†’        pavilion_angle = params.get('pavilion_angle', BASELINE_PARAMS['pavilion_angle'])\n  1560â†’\n  1561â†’        # ç«å½©å¢å¼ºå› å­\n  1562â†’        angle_factor = exp(-((crown_angle - Decimal('34.5'))**2 +\n  1563â†’                           (pavilion_angle - Decimal('40.75'))**2) / Decimal('100.0'))\n  1564â†’\n  1565â†’        # æ³¢é•¿ç‰¹å®šçš„ç«å½©è¯„åˆ†\n  1566â†’        fire_contribution = local_dispersion * angle_factor * Decimal('1000.0')\n  1567â†’        wavelength_nm = wavelength * Decimal('1e9')\n  1568â†’        wavelength_results[str(wavelength_nm)] = {\n  1569â†’            'refractive_index': n_wavelength,\n  1570â†’            'local_dispersion': local_dispersion,\n  1571â†’            'fire_contribution': fire_contribution,\n  1572â†’            'angle_factor': angle_factor\n  1573â†’        }\n  1574â†’\n  1575â†’        total_fire += fire_contribution\n  1576â†’        dispersion_data.append((float(wavelength_nm), float(n_wavelength)))\n  1577â†’\n  1578â†’    # è®¡ç®—ç«å½©è¯„åˆ† (0-10)\n  1579â†’    fire_score = total_fire / Decimal('7.0')  # 7ä¸ªæ³¢é•¿å¹³å‡\n  1580â†’    fire_score = clamp(fire_score, Decimal('0.0'), Decimal('10.0'))\n  1581â†’\n  1582â†’    # è®¡ç®—è‰²æ•£ç‰¹å¾\n  1583â†’    max_dispersion = max([data['local_dispersion'] for data in wavelength_results.values()])\n  1584â†’    min_dispersion = min([data['local_dispersion'] for data in wavelength_results.values()])\n  1585â†’    dispersion_range = max_dispersion - min_dispersion\n  1586â†’\n  1587â†’    return {\n  1588â†’        'fire_score': fire_score,\n  1589â†’        'total_fire': total_fire,\n  1590â†’        'wavelength_analysis': wavelength_results,\n  1591â†’        'dispersion_range': dispersion_range,\n  1592â†’        'max_dispersion': max_dispersion,\n  1593â†’        'min_dispersion': min_dispersion,\n  1594â†’        'dispersion_curve': dispersion_data,\n  1595â†’        'fire_intensity': fire_score,\n  1596â†’        'color_separation': dispersion_range * Decimal('10000.0'),\n  1597â†’        'spectral_purity': Decimal('1.0') - (dispersion_range / max_dispersion) if max_dispersion > 0 else Decimal('0.0'),\n  1598â†’        'brilliance_to_fire_ratio': Decimal('1.0'),  # å¯ä»¥ä¸äº®åº¦è¯„åˆ†ç»“åˆ\n  1599â†’    }\n  1600â†’\n  1601â†’def calculate_scint_score(params: Dict[str, Decimal], num_rays: int = 1000) -> Dict[str, Any]:\n  1602â†’    \"\"\"\n  1603â†’    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„é—ªåº¦è¯„åˆ†è®¡ç®—\n  1604â†’    è®¡ç®—é’»çŸ³çš„é—ªçƒå’ŒåŠ¨æ€å…‰å­¦æ•ˆæœ\n  1605â†’    \"\"\"\n  1606â†’    # è·å–é’»çŸ³å‚æ•°\n  1607â†’    diameter = params.get('diameter', BASELINE_PARAMS['diameter'])\n  1608â†’    crown_angle = params.get('crown_angle', BASELINE_PARAMS['crown_angle'])\n  1609â†’    pavilion_angle = params.get('pavilion_angle', BASELINE_PARAMS['pavilion_angle'])\n  1610â†’    table_pct = params.get('table_pct', BASELINE_PARAMS['table_pct'])\n  1611â†’\n  1612â†’    # é—ªåº¦å½±å“å› ç´ è®¡ç®—\n  1613â†’    factors = {}\n  1614â†’\n  1615â†’    # 1. å¯¹ç§°æ€§å› å­\n  1616â†’    å¯¹ç§°æ€§_deviation = abs(crown_angle - Decimal('34.5')) + abs(pavilion_angle - Decimal('40.75'))\n  1617â†’    å¯¹ç§°æ€§_factor = exp(-å¯¹ç§°æ€§_deviation / Decimal('10.0'))\n  1618â†’    factors['å¯¹ç§°æ€§_factor'] = å¯¹ç§°æ€§_factor\n  1619â†’\n  1620â†’    # 2. æ¯”ä¾‹å› å­\n  1621â†’    table_deviation = abs(table_pct - Decimal('55.5'))\n  1622â†’    proportion_factor = exp(-table_deviation / Decimal('20.0'))\n  1623â†’    factors['proportion_factor'] = proportion_factor\n  1624â†’\n  1625â†’    # 3. åˆ‡å·¥ç²¾åº¦å› å­\n  1626â†’    precision_factor = Decimal('1.0')  # å‡è®¾ç†æƒ³åˆ‡å·¥ï¼Œå®é™…å¯ä»¥æ ¹æ®è¡¨é¢è´¨é‡è°ƒæ•´\n  1627â†’    factors['precision_factor'] = precision_factor\n  1628â†’\n  1629â†’    # 4. å…‰å­¦è·¯å¾„å¤šæ ·æ€§\n  1630â†’    path_diversity = calculate_path_diversity(params, num_rays)\n  1631â†’    factors['path_diversity'] = path_diversity\n  1632â†’\n  1633â†’    # 5. è§†è§’ä¾èµ–æ€§\n  1634â†’    angular_response = calculate_angular_response(params)\n  1635â†’    factors['angular_response'] = angular_response\n  1636â†’\n  1637â†’    # ç»¼åˆé—ªåº¦è¯„åˆ†\n  1638â†’    scintillation_score = (\n  1639â†’        å¯¹ç§°æ€§_factor * Decimal('0.3') +\n  1640â†’        proportion_factor * Decimal('0.2') +\n  1641â†’        precision_factor * Decimal('0.2') +\n  1642â†’        path_diversity * Decimal('0.2') +\n  1643â†’        angular_response * Decimal('0.1')\n  1644â†’    ) * Decimal('10.0')\n  1645â†’\n  1646â†’    scintillation_score = clamp(scintillation_score, Decimal('0.0'), Decimal('10.0'))\n  1647â†’\n  1648â†’    # è¯¦ç»†çš„é—ªåº¦åˆ†æ\n  1649â†’    return {\n  1650â†’        'scintillation_score': scintillation_score,\n  1651â†’        'å¯¹ç§°æ€§_factor': å¯¹ç§°æ€§_factor,\n  1652â†’        'proportion_factor': proportion_factor,\n  1653â†’        'precision_factor': precision_factor,\n  1654â†’        'path_diversity': path_diversity,\n  1655â†’        'angular_response': angular_response,\n  1656â†’        'brilliance_consistency': å¯¹ç§°æ€§_factor,  # äº®åº¦ä¸€è‡´æ€§\n  1657â†’        'sparkle_intensity': path_diversity * Decimal('10.0'),\n  1658â†’        'dynamic_range': angular_response * Decimal('5.0'),\n  1659â†’        'contrast_ratio': å¯¹ç§°æ€§_factor * precision_factor,\n  1660â†’        'flash_frequency': path_diversity * Decimal('2.0'),  # é—ªçƒé¢‘ç‡\n  1661â†’        'viewing_angle_dependency': Decimal('1.0') - angular_response  # è§†è§’ä¾èµ–æ€§\n  1662â†’    }\n  1663â†’\n  1664â†’def trace_ideal_heart_arrow(params: Dict[str, Decimal], num_rays: int = 500) -> Dict[str, Any]:\n  1665â†’    \"\"\"\n  1666â†’    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„8å¿ƒ8ç®­å›¾æ¡ˆå…‰çº¿è¿½è¸ª\n  1667â†’    ä¸“é—¨ç”¨äºå¿ƒç®­æ•ˆæœçš„å¯è§†åŒ–å’Œè¯„åˆ†\n  1668â†’    \"\"\"\n  1669â†’    # è·å–å…³é”®å‡ ä½•å‚æ•°\n  1670â†’    crown_angle = params.get('crown_angle', BASELINE_PARAMS['crown_angle'])\n  1671â†’    pavilion_angle = params.get('pavilion_angle', BASELINE_PARAMS['pavilion_angle'])\n  1672â†’    table_pct = params.get('table_pct', BASELINE_PARAMS['table_pct'])\n  1673â†’\n  1674â†’    # å¿ƒç®­å›¾æ¡ˆçš„8ä¸ªä¸»è¦æ–¹å‘\n  1675â†’    directions = []\n  1676â†’    for i in range(8):\n  1677â†’        angle = radians(Decimal('45') * Decimal(i))\n  1678â†’        directions.append((cos(angle), sin(angle), Decimal('-1')))\n  1679â†’\n  1680â†’    # è¿½è¸ªæ¯ä¸ªæ–¹å‘çš„å…‰çº¿æŸ\n  1681â†’    heart_patterns = []\n  1682â†’    arrow_patterns = []\n  1683â†’\n  1684â†’    for dir_idx, direction in enumerate(directions):\n  1685â†’        # å¿ƒéƒ¨å›¾æ¡ˆ (è§‚å¯Ÿäº­éƒ¨åå°„)\n  1686â†’        heart_rays = []\n  1687â†’        for ray_idx in range(num_rays // 8):\n  1688â†’            # åœ¨è¯¥æ–¹å‘é™„è¿‘éšæœºåˆ†å¸ƒå…‰çº¿\n  1689â†’            result = ray_trace_single_photon(params, Decimal('550e-9'),\n  1690â†’                                           initial_direction=direction)\n  1691â†’            if result['num_reflections'] > 0:\n  1692â†’                heart_rays.append(result)\n  1693â†’\n  1694â†’        # ç®­å¤´å›¾æ¡ˆ (è§‚å¯Ÿå°é¢åå°„)\n  1695â†’        arrow_rays = []\n  1696â†’        for ray_idx in range(num_rays // 8):\n  1697â†’            # åå‘å…‰çº¿ (ä»ä¸‹æ–¹è§‚å¯Ÿ)\n  1698â†’            reverse_dir = (-direction[0], -direction[1], direction[2])\n  1699â†’            result = ray_trace_single_photon(params, Decimal('550e-9'),\n  1700â†’                                           initial_direction=reverse_dir)\n  1701â†’            if result['num_reflections'] > 0:\n  1702â†’                arrow_rays.append(result)\n  1703â†’\n  1704â†’        heart_patterns.append(heart_rays)\n  1705â†’        arrow_patterns.append(arrow_rays)\n  1706â†’\n  1707â†’    # è®¡ç®—å¿ƒç®­è´¨é‡æŒ‡æ ‡\n  1708â†’    heart_quality = calculate_pattern_quality(heart_patterns, 'heart')\n  1709â†’    arrow_quality = calculate_pattern_quality(arrow_patterns, 'arrow')\n  1710â†’\n  1711â†’    # å¯¹ç§°æ€§åˆ†æ\n  1712â†’    å¯¹ç§°æ€§_analysis = analyze_pattern_å¯¹ç§°æ€§(heart_patterns, arrow_patterns)\n  1713â†’\n  1714â†’    # ç»¼åˆå¿ƒç®­è¯„åˆ†\n  1715â†’    ha_score = (heart_quality + arrow_quality) / Decimal('2.0')\n  1716â†’    ha_score *= å¯¹ç§°æ€§_analysis\n  1717â†’\n  1718â†’    return {\n  1719â†’        'heart_arrow_score': ha_score,\n  1720â†’        'heart_patterns': heart_patterns,\n  1721â†’        'arrow_patterns': arrow_patterns,\n  1722â†’        'heart_quality': heart_quality,\n  1723â†’        'arrow_quality': arrow_quality,\n  1724â†’        'å¯¹ç§°æ€§_score': å¯¹ç§°æ€§_analysis,\n  1725â†’        'pattern_clarity': ha_score,\n  1726â†’        'directional_consistency': ha_score,\n  1727â†’        'optical_precision': ha_score,\n  1728â†’        'ideal_pattern_match': ha_score,\n  1729â†’        'ray_distribution': å¯¹ç§°æ€§_analysis,\n  1730â†’        'contrast_uniformity': å¯¹ç§°æ€§_analysis\n  1731â†’    }\n  1732â†’\n  1733â†’def quantum_ray_tracing(params: Dict[str, Decimal], num_photons: int = 10000,\n  1734â†’                       quantum_effects: bool = True) -> Dict[str, Any]:\n  1735â†’    \"\"\"\n  1736â†’    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„é‡å­çº§å…‰çº¿è¿½è¸ª\n  1737â†’    åŒ…å«é‡å­æ•ˆåº”çš„è¶…é«˜ç²¾åº¦å…‰çº¿è¿½è¸ª\n  1738â†’    \"\"\"\n  1739â†’    import random\n  1740â†’    import math\n  1741â†’\n  1742â†’    # é‡å­æ•ˆåº”å‚æ•°\n  1743â†’    planck_constant = Decimal('6.62607015e-34')\n  1744â†’    light_speed = Decimal('299792458')\n  1745â†’\n  1746â†’    # åˆå§‹åŒ–é‡å­ç»Ÿè®¡\n  1747â†’    quantum_stats = {\n  1748â†’        'coherent_photons': 0,\n  1749â†’        'entangled_pairs': 0,\n  1750â†’        'quantum_interference_events': 0,\n  1751â†’        'wavefunction_collapses': 0,\n  1752â†’        'quantum_uncertainty': Decimal('0.0')\n  1753â†’    }\n  1754â†’\n  1755â†’    # å…‰å­æ³¢å‡½æ•°æ•°ç»„\n  1756â†’    photon_wavefunctions = []\n  1757â†’    photon_energies = []\n  1758â†’    photon_phases = []\n  1759â†’    polarization_states = []\n  1760â†’\n  1761â†’    # ç”Ÿæˆå…‰å­æŸ\n  1762â†’    for i in range(num_photons):\n  1763â†’        # éšæœºæ³¢é•¿ (å¯è§å…‰è°±)\n  1764â†’        wavelength = Decimal(str(random.uniform(380, 780))) * Decimal('1e-9')\n  1765â†’        energy = planck_constant * light_speed / wavelength\n  1766â†’        phase = Decimal(str(random.uniform(0, 2 * float(PI))))\n  1767â†’\n  1768â†’        # åæŒ¯æ€ (0=æ°´å¹³, 1=å‚ç›´, ä¸­é—´å€¼=éƒ¨åˆ†åæŒ¯)\n  1769â†’        polarization = Decimal(str(random.uniform(0, 1)))\n  1770â†’\n  1771â†’        photon_wavefunctions.append({\n  1772â†’            'amplitude': Decimal('1.0'),\n  1773â†’            'phase': phase,\n  1774â†’            'wavelength': wavelength,\n  1775â†’            'energy': energy,\n  1776â†’            'polarization': polarization,\n  1777â†’            'coherence_length': wavelength * Decimal('1000')  # ç›¸å¹²é•¿åº¦\n  1778â†’        })\n  1779â†’\n  1780â†’        photon_energies.append(energy)\n  1781â†’        photon_phases.append(phase)\n  1782â†’        polarization_states.append(polarization)\n  1783â†’\n  1784â†’    # é‡å­å¹²æ¶‰è®¡ç®—\n  1785â†’    interference_patterns = []\n  1786â†’    for i in range(min(100, len(photon_wavefunctions))):\n  1787â†’        for j in range(i+1, min(100, len(photon_wavefunctions))):\n  1788â†’            # è®¡ç®—ä¸¤ä¸ªå…‰å­çš„å¹²æ¶‰\n  1789â†’            wf1 = photon_wavefunctions[i]\n  1790â†’            wf2 = photon_wavefunctions[j]\n  1791â†’\n  1792â†’            # æ³¢é•¿å·®å†³å®šå¹²æ¶‰\n  1793â†’            wavelength_diff = abs(wf1['wavelength'] - wf2['wavelength'])\n  1794â†’            phase_diff = abs(wf1['phase'] - wf2['phase'])\n  1795â†’\n  1796â†’            # ç›¸å¹²æ¡ä»¶\n  1797â†’            coherence_condition = (wavelength_diff < wf1['wavelength'] * Decimal('1e-6') and\n  1798â†’                                phase_diff < Decimal('0.1'))\n  1799â†’\n  1800â†’            if coherence_condition:\n  1801â†’                quantum_stats['coherent_photons'] += 1\n  1802â†’\n  1803â†’                # å¹²æ¶‰å¼ºåº¦\n  1804â†’                interference_intensity = (\n  1805â†’                    wf1['amplitude'] * wf2['amplitude'] *\n  1806â†’                    cos(phase_diff).quantize(Decimal('1e-30'))\n  1807â†’                )\n  1808â†’\n  1809â†’                interference_patterns.append({\n  1810â†’                    'photon_pair': (i, j),\n  1811â†’                    'intensity': interference_intensity,\n  1812â†’                    'phase_relationship': phase_diff,\n  1813â†’                    'coherence_degree': Decimal('1.0') - wavelength_diff / wf1['wavelength']\n  1814â†’                })\n  1815â†’\n  1816â†’    # ä¼ ç»Ÿå…‰çº¿è¿½è¸ªä¸é‡å­æ•ˆåº”ç»“åˆ\n  1817â†’    classical_results = advanced_monte_carlo_ray_tracing(params, min(1000, num_photons))\n  1818â†’\n  1819â†’    # é‡å­ä¿®æ­£å› å­\n  1820â†’    quantum_correction = Decimal('1.0') + Decimal(str(len(interference_patterns))) / Decimal('10000.0')\n  1821â†’\n  1822â†’    # é‡å­ä¸ç¡®å®šæ€§\n  1823â†’    avg_energy = sum(photon_energies) / Decimal(len(photon_energies))\n  1824â†’    energy_variance = sum((e - avg_energy)**2 for e in photon_energies) / Decimal(len(photon_energies))\n  1825â†’    quantum_stats['quantum_uncertainty'] = sqrt(energy_variance) / avg_energy\n  1826â†’\n  1827â†’    # åº”ç”¨é‡å­ä¿®æ­£\n  1828â†’    quantum_results = classical_results.copy()\n  1829â†’    quantum_results['brightness'] *= quantum_correction\n  1830â†’    quantum_results['fire'] *= quantum_correction\n  1831â†’    quantum_results['scintillation'] *= quantum_correction\n  1832â†’    quantum_results['contrast'] *= quantum_correction\n  1833â†’\n  1834â†’    # æ·»åŠ é‡å­ç»Ÿè®¡ä¿¡æ¯\n  1835â†’    quantum_results.update({\n  1836â†’        'quantum_statistics': quantum_stats,\n  1837â†’        'interference_patterns': interference_patterns,\n  1838â†’        'quantum_correction_factor': quantum_correction,\n  1839â†’        'coherent_photon_ratio': Decimal(quantum_stats['coherent_photons']) / Decimal(num_photons),\n  1840â†’        'quantum_uncertainty': quantum_stats['quantum_uncertainty'],\n  1841â†’        'wavefunction_superposition': len(interference_patterns),\n  1842â†’        'quantum_entanglement_probability': Decimal(str(random.uniform(0, 0.1))),  # æ¨¡æ‹Ÿé‡å­çº ç¼ æ¦‚ç‡\n  1843â†’        'decoherence_events': num_photons - quantum_stats['coherent_photons'],\n  1844â†’        'quantum_efficiency': quantum_correction * Decimal('100.0'),\n  1845â†’        'quantum_clarity': Decimal('1.0') - quantum_stats['quantum_uncertainty'],\n  1846â†’        'photon_coherence_time': Decimal('1e-15'),  # é£ç§’çº§ç›¸å¹²æ—¶é—´\n  1847â†’        'quantum_noise_level': quantum_stats['quantum_uncertainty'] * Decimal('0.1')\n  1848â†’    })\n  1849â†’\n  1850â†’    return quantum_results\n  1851â†’\n  1852â†’# è¾…åŠ©å‡½æ•°\n  1853â†’def calculate_path_diversity(params: Dict[str, Decimal], num_rays: int) -> Decimal:\n  1854â†’    \"\"\"è®¡ç®—å…‰çº¿è·¯å¾„å¤šæ ·æ€§\"\"\"\n  1855â†’    # ç®€åŒ–å®ç°ï¼šåŸºäºå‡ ä½•å‚æ•°è®¡ç®—è·¯å¾„å¤šæ ·æ€§\n  1856â†’    crown_angle = params.get('crown_angle', BASELINE_PARAMS['crown_angle'])\n  1857â†’    pavilion_angle = params.get('pavilion_angle', BASELINE_PARAMS['pavilion_angle'])\n  1858â†’\n  1859â†’    # è§’åº¦å˜åŒ–å¢åŠ è·¯å¾„å¤šæ ·æ€§\n  1860â†’    angle_variance = (crown_angle - Decimal('34.5'))**2 + (pavilion_angle - Decimal('40.75'))**2\n  1861â†’    diversity = Decimal('1.0') + angle_variance / Decimal('100.0')\n  1862â†’\n  1863â†’    return clamp(diversity, Decimal('0.0'), Decimal('1.0'))\n  1864â†’\n  1865â†’def calculate_angular_response(params: Dict[str, Decimal]) -> Decimal:\n  1866â†’    \"\"\"è®¡ç®—è§†è§’å“åº”\"\"\"\n  1867â†’    # åŸºäºå°é¢å¤§å°å’Œåˆ‡å·¥è®¡ç®—è§†è§’ä¾èµ–æ€§\n  1868â†’    table_pct = params.get('table_pct', BASELINE_PARAMS['table_pct'])\n  1869â†’\n  1870â†’    # å°é¢è¶Šå¤§ï¼Œè§†è§’ä¾èµ–æ€§è¶Šå°\n  1871â†’    angular_response = table_pct / Decimal('60.0')\n  1872â†’\n  1873â†’    return clamp(angular_response, Decimal('0.0'), Decimal('1.0'))\n  1874â†’\n  1875â†’def calculate_pattern_quality(patterns, pattern_type):\n  1876â†’    \"\"\"è®¡ç®—å›¾æ¡ˆè´¨é‡\"\"\"\n  1877â†’    if not patterns:\n  1878â†’        return Decimal('0.0')\n  1879â†’\n  1880â†’    # è®¡ç®—æ¯ä¸ªæ–¹å‘çš„å°„çº¿æ•°é‡ä¸€è‡´æ€§\n  1881â†’    ray_counts = [len(pattern) for pattern in patterns]\n  1882â†’    if not ray_counts:\n  1883â†’        return Decimal('0.0')\n  1884â†’\n  1885â†’    avg_count = sum(ray_counts) / Decimal(len(ray_counts))\n  1886â†’    variance = sum((count - avg_count)**2 for count in ray_counts) / Decimal(len(ray_counts))\n  1887â†’\n  1888â†’    # ä¸€è‡´æ€§è¶Šé«˜ï¼Œè´¨é‡è¶Šå¥½\n  1889â†’    consistency = Decimal('1.0') - variance / (avg_count * avg_count) if avg_count > 0 else Decimal('0.0')\n  1890â†’\n  1891â†’    return clamp(consistency, Decimal('0.0'), Decimal('1.0'))\n  1892â†’\n  1893â†’def analyze_pattern_å¯¹ç§°æ€§(heart_patterns, arrow_patterns):\n  1894â†’    \"\"\"åˆ†æå›¾æ¡ˆå¯¹ç§°æ€§\"\"\"\n  1895â†’    # 8æ–¹å‘å¯¹ç§°æ€§åˆ†æ\n  1896â†’    heart_å¯¹ç§°æ€§ = calculate_pattern_quality(heart_patterns, 'heart')\n  1897â†’    arrow_å¯¹ç§°æ€§ = calculate_pattern_quality(arrow_patterns, 'arrow')\n  1898â†’\n  1899â†’    # ç»¼åˆå¯¹ç§°æ€§\n  1900â†’    overall_å¯¹ç§°æ€§ = (heart_å¯¹ç§°æ€§ + arrow_å¯¹ç§°æ€§) / Decimal('2.0')\n  1901â†’\n  1902â†’    return clamp(overall_å¯¹ç§°æ€§, Decimal('0.0'), Decimal('1.0'))\n  1903â†’\n  1904â†’# ---------------- å‡ ä½•åç¦»åº¦ä¸ HA ----------------\n  1905â†’def geometry_metrics(params: Dict[str, Decimal]) -> Tuple[Decimal, Decimal]:\n  1906â†’    \"\"\"\n  1907â†’    è®¡ç®—ï¼š\n  1908â†’      - D_geomï¼šå‡ ä½•åç¦»åº¦ï¼ˆåŸºäº GEOM_TOL çš„å½’ä¸€åŒ–æ¬§æ°è·ç¦»ï¼‰\n  1909â†’      - HA    ï¼šå‡ ä½•å…«å¿ƒå…«ç®­å¾—åˆ†ï¼ˆ0~100ï¼ŒåŸºå‡†é’»å”¯ä¸€ 100ï¼‰\n  1910â†’    \"\"\"\n  1911â†’    sum_sq = Decimal('0.0')\n  1912â†’    n = 0\n  1913â†’    for key, tol in GEOM_TOL.items():\n  1914â†’        v = params.get(key, BASELINE_PARAMS[key])\n  1915â†’        v0 = BASELINE_PARAMS[key]\n  1916â†’        dv = (v - v0) / tol\n  1917â†’        sum_sq += dv * dv\n  1918â†’        n += 1\n  1919â†’    if n == 0:\n  1920â†’        return Decimal('0.0'), Decimal('100.0')\n  1921â†’\n  1922â†’    d_geom = sqrt(sum_sq / Decimal(n))  # RMS\n  1923â†’\n  1924â†’    # HAï¼šä»¥ d_geom ä¸ºè‡ªå˜é‡çš„è½¯æƒ©ç½šï¼Œd_geom<=1 åŸºæœ¬ä¸æ‰£åˆ†ï¼›>1 é€æ¸æ‰£\n  1925â†’    if d_geom <= Decimal('1.0'):\n  1926â†’        ha = Decimal('100.0')\n  1927â†’    else:\n  1928â†’        # ä»¥ (d_geom-1)^2 ä½œæŒ‡æ•°è¡°å‡ï¼Œè¶…è¿‡ 3 æ—¶æ¥è¿‘ 0\n  1929â†’        ha = Decimal('100.0') * exp(-(d_geom - Decimal('1.0')) ** 2 / Decimal('2.0'))\n  1930â†’\n  1931â†’    return d_geom, ha\n  1932â†’\n  1933â†’# ---------------- å…¶ä»–å‡ ä½•è¯„ä¼°å‡½æ•° ----------------\n  1934â†’def calculate_crown_metrics(params: Dict[str, Decimal]) -> Dict[str, Decimal]:\n  1935â†’    \"\"\"\n  1936â†’    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„å† éƒ¨å‡ ä½•è¯„ä¼°\n  1937â†’    è®¡ç®—å† éƒ¨çš„å„é¡¹å‡ ä½•æŒ‡æ ‡\n  1938â†’    \"\"\"\n  1939â†’    crown_angle = params.get('crown_angle', BASELINE_PARAMS['crown_angle'])\n  1940â†’    crown_height = params.get('crown_height_pct', BASELINE_PARAMS['crown_height_pct'])\n  1941â†’    table_pct = params.get('table_pct', BASELINE_PARAMS['table_pct'])\n  1942â†’\n  1943â†’    # å† éƒ¨è§’åº¦è¯„åˆ† (ç†æƒ³èŒƒå›´: 34-36åº¦)\n  1944â†’    angle_score = Decimal('1.0') - abs(crown_angle - Decimal('34.5')) / Decimal('10.0')\n  1945â†’    angle_score = clamp(angle_score, Decimal('0.0'), Decimal('1.0'))\n  1946â†’\n  1947â†’    # å† é«˜ç™¾åˆ†æ¯”è¯„åˆ† (ç†æƒ³èŒƒå›´: 15-17%)\n  1948â†’    height_score = Decimal('1.0') - abs(crown_height - Decimal('15.2')) / Decimal('5.0')\n  1949â†’    height_score = clamp(height_score, Decimal('0.0'), Decimal('1.0'))\n  1950â†’\n  1951â†’    # å°é¢ç™¾åˆ†æ¯”è¯„åˆ† (ç†æƒ³èŒƒå›´: 53-57%)\n  1952â†’    table_score = Decimal('1.0') - abs(table_pct - Decimal('55.5')) / Decimal('10.0')\n  1953â†’    table_score = clamp(table_score, Decimal('0.0'), Decimal('1.0'))\n  1954â†’\n  1955â†’    # å† éƒ¨ç»¼åˆè¯„åˆ†\n  1956â†’    crown_score = (angle_score * Decimal('0.4') +\n  1957â†’                   height_score * Decimal('0.4') +\n  1958â†’                   table_score * Decimal('0.2'))\n  1959â†’\n  1960â†’    return {\n  1961â†’        'crown_angle_score': angle_score,\n  1962â†’        'crown_height_score': height_score,\n  1963â†’        'table_score': table_score,\n  1964â†’        'crown_overall_score': crown_score,\n  1965â†’        'crown_angle': crown_angle,\n  1966â†’        'crown_height': crown_height,\n  1967â†’        'table_pct': table_pct\n  1968â†’    }\n  1969â†’\n  1970â†’def calculate_pavilion_metrics(params: Dict[str, Decimal]) -> Dict[str, Decimal]:\n  1971â†’    \"\"\"\n  1972â†’    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„äº­éƒ¨å‡ ä½•è¯„ä¼°\n  1973â†’    è®¡ç®—äº­éƒ¨çš„å„é¡¹å‡ ä½•æŒ‡æ ‡\n  1974â†’    \"\"\"\n  1975â†’    pavilion_angle = params.get('pavilion_angle', BASELINE_PARAMS['pavilion_angle'])\n  1976â†’    pavilion_depth = params.get('pavilion_depth_pct', BASELINE_PARAMS['pavilion_depth_pct'])\n  1977â†’\n  1978â†’    # äº­éƒ¨è§’åº¦è¯„åˆ† (ç†æƒ³èŒƒå›´: 40.6-40.9åº¦)\n  1979â†’    angle_score = Decimal('1.0') - abs(pavilion_angle - Decimal('40.75')) / Decimal('5.0')\n  1980â†’    angle_score = clamp(angle_score, Decimal('0.0'), Decimal('1.0'))\n  1981â†’\n  1982â†’    # äº­æ·±ç™¾åˆ†æ¯”è¯„åˆ† (ç†æƒ³èŒƒå›´: 42.5-43.5%)\n  1983â†’    depth_score = Decimal('1.0') - abs(pavilion_depth - Decimal('43.1')) / Decimal('5.0')\n  1984â†’    depth_score = clamp(depth_score, Decimal('0.0'), Decimal('1.0'))\n  1985â†’\n  1986â†’    # äº­éƒ¨ç»¼åˆè¯„åˆ†\n  1987â†’    pavilion_score = (angle_score * Decimal('0.6') + depth_score * Decimal('0.4'))\n  1988â†’\n  1989â†’    return {\n  1990â†’        'pavilion_angle_score': angle_score,\n  1991â†’        'pavilion_depth_score': depth_score,\n  1992â†’        'pavilion_overall_score': pavilion_score,\n  1993â†’        'pavilion_angle': pavilion_angle,\n  1994â†’        'pavilion_depth': pavilion_depth\n  1995â†’    }\n  1996â†’\n  1997â†’def calculate_ideal_heart_arrow_score(params: Dict[str, Decimal]) -> Decimal:\n  1998â†’    \"\"\"\n  1999â†’    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„å¿ƒç®­å›¾æ¡ˆè¯„åˆ†\n  2000â†’    åŸºäº8å¿ƒ8ç®­å›¾æ¡ˆçš„å‡ ä½•è®¡ç®—\n  2001â†’    \"\"\"\n  2002â†’    # è·å–å…³é”®å‡ ä½•å‚æ•°\n  2003â†’    crown_angle = params.get('crown_angle', BASELINE_PARAMS['crown_angle'])\n  2004â†’    pavilion_angle = params.get('pavilion_angle', BASELINE_PARAMS['pavilion_angle'])\n  2005â†’    table_pct = params.get('table_pct', BASELINE_PARAMS['table_pct'])\n  2006â†’    crown_height = params.get('crown_height_pct', BASELINE_PARAMS['crown_height_pct'])\n  2007â†’    pavilion_depth = params.get('pavilion_depth_pct', BASELINE_PARAMS['pavilion_depth_pct'])\n  2008â†’\n  2009â†’    # ç†æƒ³å€¼\n  2010â†’    ideal_crown_angle = Decimal('34.5')\n  2011â†’    ideal_pavilion_angle = Decimal('40.75')\n  2012â†’    ideal_table_pct = Decimal('55.5')\n  2013â†’    ideal_crown_height = Decimal('15.2')\n  2014â†’    ideal_pavilion_depth = Decimal('43.1')\n  2015â†’\n  2016â†’    # è®¡ç®—åå·®\n  2017â†’    crown_angle_deviation = abs(crown_angle - ideal_crown_angle) / ideal_crown_angle\n  2018â†’    pavilion_angle_deviation = abs(pavilion_angle - ideal_pavilion_angle) / ideal_pavilion_angle\n  2019â†’    table_deviation = abs(table_pct - ideal_table_pct) / ideal_table_pct\n  2020â†’    crown_height_deviation = abs(crown_height - ideal_crown_height) / ideal_crown_height\n  2021â†’    pavilion_depth_deviation = abs(pavilion_depth - ideal_pavilion_depth) / ideal_pavilion_depth\n  2022â†’\n  2023â†’    # ç»¼åˆè¯„åˆ† (åå·®è¶Šå°åˆ†æ•°è¶Šé«˜)\n  2024â†’    total_deviation = (crown_angle_deviation + pavilion_angle_deviation +\n  2025â†’                      table_deviation + crown_height_deviation + pavilion_depth_deviation)\n  2026â†’\n  2027â†’    # è½¬æ¢ä¸º0-100åˆ†\n  2028â†’    ha_score = Decimal('100.0') * exp(-Decimal('5.0') * total_deviation)\n  2029â†’\n  2030â†’    return ha_score\n  2031â†’\n  2032â†’def evaluate_æ¯”ä¾‹(params: Dict[str, Decimal]) -> Dict[str, Decimal]:\n  2033â†’    \"\"\"\n  2034â†’    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„æ¯”ä¾‹è¯„ä¼°\n  2035â†’    è¯„ä¼°é’»çŸ³çš„æ•´ä½“æ¯”ä¾‹åˆç†æ€§\n  2036â†’    \"\"\"\n  2037â†’    # è·å–å‚æ•°\n  2038â†’    table_pct = params.get('table_pct', BASELINE_PARAMS['table_pct'])\n  2039â†’    crown_height = params.get('crown_height_pct', BASELINE_PARAMS['crown_height_pct'])\n  2040â†’    pavilion_depth = params.get('pavilion_depth_pct', BASELINE_PARAMS['pavilion_depth_pct'])\n  2041â†’    total_depth = params.get('total_depth_pct', BASELINE_PARAMS['total_depth_pct'])\n  2042â†’\n  2043â†’    # å„é¡¹è¯„åˆ†\n  2044â†’    table_score = Decimal('1.0') - abs(table_pct - Decimal('55.5')) / Decimal('15.0')\n  2045â†’    crown_height_score = Decimal('1.0') - abs(crown_height - Decimal('15.2')) / Decimal('8.0')\n  2046â†’    pavilion_depth_score = Decimal('1.0') - abs(pavilion_depth - Decimal('43.1')) / Decimal('8.0')\n  2047â†’    total_depth_score = Decimal('1.0') - abs(total_depth - Decimal('61.8')) / Decimal('10.0')\n  2048â†’\n  2049â†’    # é™åˆ¶åœ¨0-1èŒƒå›´\n  2050â†’    for score in [table_score, crown_height_score, pavilion_depth_score, total_depth_score]:\n  2051â†’        score = clamp(score, Decimal('0.0'), Decimal('1.0'))\n  2052â†’\n  2053â†’    # æ•´ä½“æ¯”ä¾‹è¯„åˆ†\n  2054â†’    æ¯”ä¾‹_score = (table_score * Decimal('0.2') +\n  2055â†’                        crown_height_score * Decimal('0.2') +\n  2056â†’                        pavilion_depth_score * Decimal('0.3') +\n  2057â†’                        total_depth_score * Decimal('0.3'))\n  2058â†’\n  2059â†’    return {\n  2060â†’        'table_score': table_score,\n  2061â†’        'crown_height_score': crown_height_score,\n  2062â†’        'pavilion_depth_score': pavilion_depth_score,\n  2063â†’        'total_depth_score': total_depth_score,\n  2064â†’        'æ¯”ä¾‹_overall_score': æ¯”ä¾‹_score\n  2065â†’    }\n  2066â†’\n  2067â†’def evaluate_å¯¹ç§°æ€§(params: Dict[str, Decimal]) -> Dict[str, Decimal]:\n  2068â†’    \"\"\"\n  2069â†’    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„å¯¹ç§°æ€§è¯„ä¼°\n  2070â†’    åŸºäºå‡ ä½•å‚æ•°çš„å¯¹ç§°æ€§åˆ†æ\n  2071â†’    \"\"\"\n  2072â†’    # ç†æƒ³åŸºå‡†å‚æ•°\n  2073â†’    ideal_params = BASELINE_PARAMS\n  2074â†’\n  2075â†’    # è®¡ç®—å„é¡¹å¯¹ç§°æ€§æŒ‡æ ‡\n  2076â†’    å¯¹ç§°æ€§_scores = {}\n  2077â†’\n  2078â†’    # å† éƒ¨å¯¹ç§°æ€§ (åŸºäºå† è§’å’Œå† é«˜çš„ä¸€è‡´æ€§)\n  2079â†’    crown_angle = params.get('crown_angle', ideal_params['crown_angle'])\n  2080â†’    crown_height = params.get('crown_height_pct', ideal_params['crown_height_pct'])\n  2081â†’\n  2082â†’    # å† éƒ¨å¯¹ç§°æ€§è¯„åˆ†\n  2083â†’    crown_å¯¹ç§°æ€§ = Decimal('1.0') - (\n  2084â†’        abs(crown_angle - ideal_params['crown_angle']) / Decimal('20.0') +\n  2085â†’        abs(crown_height - ideal_params['crown_height_pct']) / Decimal('10.0')\n  2086â†’    ) / Decimal('2.0')\n  2087â†’\n  2088â†’    # äº­éƒ¨å¯¹ç§°æ€§\n  2089â†’    pavilion_angle = params.get('pavilion_angle', ideal_params['pavilion_angle'])\n  2090â†’    pavilion_depth = params.get('pavilion_depth_pct', ideal_params['pavilion_depth_pct'])\n  2091â†’\n  2092â†’    pavilion_å¯¹ç§°æ€§ = Decimal('1.0') - (\n  2093â†’        abs(pavilion_angle - ideal_params['pavilion_angle']) / Decimal('20.0') +\n  2094â†’        abs(pavilion_depth - ideal_params['pavilion_depth_pct']) / Decimal('10.0')\n  2095â†’    ) / Decimal('2.0')\n  2096â†’\n  2097â†’    # æ•´ä½“å¯¹ç§°æ€§\n  2098â†’    overall_å¯¹ç§°æ€§ = (crown_å¯¹ç§°æ€§ + pavilion_å¯¹ç§°æ€§) / Decimal('2.0')\n  2099â†’\n  2100â†’    # é™åˆ¶èŒƒå›´\n  2101â†’    overall_å¯¹ç§°æ€§ = clamp(overall_å¯¹ç§°æ€§, Decimal('0.0'), Decimal('1.0'))\n  2102â†’\n  2103â†’    return {\n  2104â†’        'crown_å¯¹ç§°æ€§': crown_å¯¹ç§°æ€§,\n  2105â†’        'pavilion_å¯¹ç§°æ€§': pavilion_å¯¹ç§°æ€§,\n  2106â†’        'overall_å¯¹ç§°æ€§': overall_å¯¹ç§°æ€§,\n  2107â†’        'å¯¹ç§°æ€§_score': overall_å¯¹ç§°æ€§\n  2108â†’    }\n  2109â†’\n  2110â†’# ---------------- äº®åº¦ / ç«å½©çš„å‡ ä½•ä¿®æ­£å› å­ ----------------\n  2111â†’def brightness_geom_factor(params: Dict[str, Decimal]) -> Decimal:\n  2112â†’    \"\"\"\n  2113â†’    äº®åº¦çš„å‡ ä½•ä¿®æ­£å› å­ï¼š\n  2114â†’    - è®© T / C / P / TD ç›´æ¥å‚ä¸ raw_brightnessï¼Œè€Œä¸æ˜¯åªé  pavilion_angle\n  2115â†’    - åŸºå‡†é’»å‡ ä½•ä¸‹ = 1.0\n  2116â†’    - åœ¨ Â±å‡ ä¸ªç™¾åˆ†ç‚¹çš„æ­£å¸¸å·¥ä½œåŒºé—´å†…åªåš\"æ¸©å’Œè°ƒæ•´\"ï¼Œæç«¯åˆ‡å·¥æ‰æ˜æ˜¾æ‰£åˆ†\n  2117â†’    \"\"\"\n  2118â†’    t   = params.get(\"table_pct\",          BASELINE_PARAMS[\"table_pct\"])\n  2119â†’    c_h = params.get(\"crown_height_pct\",   BASELINE_PARAMS[\"crown_height_pct\"])\n  2120â†’    p_d = params.get(\"pavilion_depth_pct\", BASELINE_PARAMS[\"pavilion_depth_pct\"])\n  2121â†’    td  = params.get(\"total_depth_pct\",    BASELINE_PARAMS[\"total_depth_pct\"])\n  2122â†’\n  2123â†’    def g(v: Decimal, v0: Decimal, span: Decimal) -> Decimal:\n  2124â†’        dv = (v - v0) / span\n  2125â†’        return (-dv * dv).exp()\n  2126â†’\n  2127â†’    # å°é¢ Â±8%ï¼Œå† é«˜ / äº­æ·± Â±4%ï¼Œå…¨æ·± Â±8% ä½œä¸º\"èˆ’æœçš„å·¥ä½œåŒºé—´\"\n  2128â†’    f_t  = g(t,   BASELINE_PARAMS[\"table_pct\"],          Decimal('8.0'))\n  2129â†’    f_ch = g(c_h, BASELINE_PARAMS[\"crown_height_pct\"],   Decimal('4.0'))\n  2130â†’    f_pd = g(p_d, BASELINE_PARAMS[\"pavilion_depth_pct\"], Decimal('4.0'))\n  2131â†’    f_td = g(td,  BASELINE_PARAMS[\"total_depth_pct\"],    Decimal('8.0'))\n  2132â†’\n  2133â†’    return f_t * f_ch * f_pd * f_td\n  2134â†’\n  2135â†’def fire_geom_factor(params: Dict[str, Decimal]) -> Decimal:\n  2136â†’    \"\"\"\n  2137â†’    ç«å½©çš„å‡ ä½•ä¿®æ­£å› å­ï¼š\n  2138â†’    - å† è§’ / å† é«˜ / äº­æ·± / å°é¢å½±å“\"è‰²æ•£å±•ç¤ºç©ºé—´\"\n  2139â†’    - åŸºå‡†é’» = 1.0ï¼Œè½»å¾®åç¦»ä¸ä¼šä¸€åˆ€åˆ‡\n  2140â†’    \"\"\"\n  2141â†’    t     = params.get(\"table_pct\",          BASELINE_PARAMS[\"table_pct\"])\n  2142â†’    c_ang = params.get(\"crown_angle\",        BASELINE_PARAMS[\"crown_angle\"])\n  2143â†’    c_h   = params.get(\"crown_height_pct\",   BASELINE_PARAMS[\"crown_height_pct\"])\n  2144â†’    p_d   = params.get(\"pavilion_depth_pct\", BASELINE_PARAMS[\"pavilion_depth_pct\"])\n  2145â†’\n  2146â†’    def g(v: Decimal, v0: Decimal, span: Decimal) -> Decimal:\n  2147â†’        dv = (v - v0) / span\n  2148â†’        return (-dv * dv).exp()\n  2149â†’\n  2150â†’    # å°é¢ Â±10%ï¼Œå† è§’ Â±4Â°ï¼Œå† é«˜ / äº­æ·± Â±5% çš„åŒºé—´\n  2151â†’    f_t  = g(t,     BASELINE_PARAMS[\"table_pct\"],          Decimal('10.0'))\n  2152â†’    f_ca = g(c_ang, BASELINE_PARAMS[\"crown_angle\"],         Decimal('4.0'))\n  2153â†’    f_ch = g(c_h,   BASELINE_PARAMS[\"crown_height_pct\"],    Decimal('5.0'))\n  2154â†’    f_pd = g(p_d,   BASELINE_PARAMS[\"pavilion_depth_pct\"],  Decimal('5.0'))\n  2155â†’\n  2156â†’    return f_t * f_ca * f_ch * f_pd\n  2157â†’\n  2158â†’# ---------------- äº®åº¦ / ç«å½© / é—ªåº¦ï¼šåŸå§‹ç‰©ç† surrogate ----------------\n  2159â†’def raw_brightness_calculate(lam: Decimal, v_weight: Decimal, params: Dict[str, Decimal],\n  2160â†’                           high_precision: bool, cancel_flag: threading.Event) -> Decimal:\n  2161â†’    \"\"\"äº®åº¦è®¡ç®—ï¼šæ·»åŠ åæŒ¯æ•ˆåº”å®Œæ•´å¤„ç†\"\"\"\n  2162â†’    if cancel_flag.is_set():\n  2163â†’        return Decimal('0.0')\n  2164â†’\n  2165â†’    n_d = sellmeier_n(lam)\n  2166â†’    theta_c = asin(Decimal('1.0') / n_d)\n  2167â†’\n  2168â†’    theta_step_deg = Decimal('0.5') if high_precision else Decimal('1.0')\n  2169â†’    thetas = [Decimal(str(i)) * theta_step_deg for i in range(0, int(Decimal('90') / theta_step_deg) + 1)]\n  2170â†’\n  2171â†’    flux_theta: List[Decimal] = []\n  2172â†’    for theta_i in thetas:\n  2173â†’        if cancel_flag.is_set():\n  2174â†’            return Decimal('0.0')\n  2175â†’\n  2176â†’        theta_i_rad = theta_i * PI / Decimal('180')\n  2177â†’        w = cos(theta_i_rad) * sin(theta_i_rad)  # Lambert æƒé‡\n  2178â†’\n  2179â†’        # å®Œæ•´åæŒ¯å¤„ç†ï¼šåˆ†åˆ«è®¡ç®—sæ³¢å’Œpæ³¢\n  2180â†’        R_in_s, T_in_s = fresnel_polarized(theta_i_rad, Decimal('1.0'), n_d, 's')\n  2181â†’        R_in_p, T_in_p = fresnel_polarized(theta_i_rad, Decimal('1.0'), n_d, 'p')\n  2182â†’\n  2183â†’        # å†…éƒ¨å°„çº¿è¿‘ä¼¼ï¼šç”¨ pavilion_angle è¡¨å¾åˆ°äº­é¢çš„å¹³å‡å¤¹è§’\n  2184â†’        pavilion_angle_deg = params.get(\"pavilion_angle\", BASELINE_PARAMS[\"pavilion_angle\"])\n  2185â†’        pavilion_angle = pavilion_angle_deg * PI / Decimal('180')\n  2186â†’        theta_pav = pavilion_angle\n  2187â†’\n  2188â†’        R_pav_s, _ = fresnel_polarized(theta_pav, n_d, Decimal('1.0'), 's') if theta_pav <= theta_c else (Decimal('1.0'), Decimal('0.0'))\n  2189â†’        R_pav_p, _ = fresnel_polarized(theta_pav, n_d, Decimal('1.0'), 'p') if theta_pav <= theta_c else (Decimal('1.0'), Decimal('0.0'))\n  2190â†’\n  2191â†’        # å† éƒ¨å‡ºå°„ï¼šé’»çŸ³ -> ç©ºæ°”ï¼ˆè¿‘ä¼¼å¯¹ç§°ï¼‰\n  2192â†’        R_out_s, T_out_s = fresnel_polarized(theta_i_rad, n_d, Decimal('1.0'), 's')\n  2193â†’        R_out_p, T_out_p = fresnel_polarized(theta_i_rad, n_d, Decimal('1.0'), 'p')\n  2194â†’\n  2195â†’        # è®¡ç®—æ€»é€å°„ç‡ï¼ˆsæ³¢å’Œpæ³¢å¹³å‡ï¼‰\n  2196â†’        flux_s = T_in_s * R_pav_s * T_out_s\n  2197â†’        flux_p = T_in_p * R_pav_p * T_out_p\n  2198â†’        flux = (flux_s + flux_p) / Decimal('2.0')\n  2199â†’\n  2200â†’        flux_theta.append(flux * w)\n  2201â†’\n  2202â†’    # Î¸ æ–¹å‘ç§¯åˆ†ï¼ˆæ¢¯å½¢ï¼‰\n  2203â†’    integral_theta = Decimal('0.0')\n  2204â†’    for i in range(1, len(thetas)):\n  2205â†’        if cancel_flag.is_set():\n  2206â†’            return Decimal('0.0')\n  2207â†’\n  2208â†’        delta_theta = (thetas[i] - thetas[i-1]) * PI / Decimal('180')  # è½¬æ¢ä¸ºå¼§åº¦\n  2209â†’        integral_theta += Decimal('0.5') * (flux_theta[i] + flux_theta[i-1]) * delta_theta\n  2210â†’\n  2211â†’    return v_weight * integral_theta\n  2212â†’\n  2213â†’def raw_brightness(params: Dict[str, Decimal], high_precision: bool = False,\n  2214â†’                  cancel_flag: threading.Event = None) -> Decimal:\n  2215â†’    \"\"\"\n  2216â†’    äº®åº¦ Brightness çš„åŸå§‹ç‰©ç†é‡ï¼ˆæœªç¼©æ”¾ã€æœªå‡ ä½•æƒ©ç½šï¼‰ï¼š\n  2217â†’      - Sellmeier n(Î»)\n  2218â†’      - Fresnel åå°„ / é€å°„\n  2219â†’      - Lambert å…‰åœºç§¯åˆ†ï¼ˆæƒé‡ cosÎ¸Â·sinÎ¸ï¼‰\n  2220â†’      - CIE V(Î») åŠ æƒ\n  2221â†’      - T / C / P / TD å‡ ä½•å› å­\n  2222â†’    \"\"\"\n  2223â†’    if cancel_flag is None:\n  2224â†’        cancel_flag = threading.Event()\n  2225â†’\n  2226â†’    total = Decimal('0.0')\n  2227â†’\n  2228â†’    for lam, v_weight in CIE_V.items():\n  2229â†’        if cancel_flag.is_set():\n  2230â†’            return Decimal('0.0')\n  2231â†’\n  2232â†’        total += raw_brightness_calculate(lam, v_weight, params, high_precision, cancel_flag)\n  2233â†’\n  2234â†’    # å‡ ä½•ä¿®æ­£ï¼ˆåŸºå‡†é’» = 1.0ï¼‰\n  2235â†’    if not cancel_flag.is_set():\n  2236â†’        total *= brightness_geom_factor(params)\n  2237â†’\n  2238â†’    return total\n  2239â†’\n  2240â†’def raw_fire(params: Dict[str, Decimal], high_precision: bool = False,\n  2241â†’            cancel_flag: threading.Event = None) -> Decimal:\n  2242â†’    \"\"\"ä¼˜åŒ–çš„ç«å½©è®¡ç®—æ¨¡å‹ï¼šè€ƒè™‘å¤šæ¬¡å†…éƒ¨åå°„å’Œæ›´å¤šæ³¢é•¿\"\"\"\n  2243â†’    if cancel_flag is None:\n  2244â†’        cancel_flag = threading.Event()\n  2245â†’\n  2246â†’    if cancel_flag.is_set():\n  2247â†’        return Decimal('0.0')\n  2248â†’\n  2249â†’    diameter = params.get(\"diameter\", BASELINE_PARAMS[\"diameter\"])\n  2250â†’    pavilion_angle_deg = params.get(\"pavilion_angle\", BASELINE_PARAMS[\"pavilion_angle\"])\n  2251â†’    pavilion_angle = pavilion_angle_deg * PI / Decimal('180')\n  2252â†’\n  2253â†’    # æ‰©å±•ï¼šç³»ç»Ÿé‡‡æ ·æ›´å¤šæ³¢é•¿ç‚¹\n  2254â†’    wavelengths = [400e-9 + i*10e-9 for i in range(31)]  # 400-700nm\n  2255â†’    incident_deg_list = [0, 10, 20, 30, 40] if high_precision else [0, 20, 40]\n  2256â†’    points: List[Tuple[Decimal, Decimal]] = []\n  2257â†’\n  2258â†’    for lam in wavelengths:\n  2259â†’        if cancel_flag.is_set():\n  2260â†’            return Decimal('0.0')\n  2261â†’\n  2262â†’        n_d = sellmeier_n(Decimal(str(lam)))\n  2263â†’        for theta_in_deg in incident_deg_list:\n  2264â†’            if cancel_flag.is_set():\n  2265â†’                return Decimal('0.0')\n  2266â†’\n  2267â†’            theta_in = Decimal(str(theta_in_deg)) * PI / Decimal('180')\n  2268â†’            _, T_in = fresnel_unpolarized(theta_in, Decimal('1.0'), n_d)\n  2269â†’            if T_in <= Decimal('1e-6'):\n  2270â†’                continue\n  2271â†’\n  2272â†’            # è€ƒè™‘å¤šæ¬¡å†…éƒ¨åå°„\n  2273â†’            max_reflections = 3 if high_precision else 2\n  2274â†’            for reflection_count in range(1, max_reflections + 1):\n  2275â†’                if cancel_flag.is_set():\n  2276â†’                    return Decimal('0.0')\n  2277â†’\n  2278â†’                sin_t = sin(theta_in) * Decimal('1.0') / n_d\n  2279â†’                if abs(sin_t) > Decimal('1.0'):\n  2280â†’                    continue\n  2281â†’                theta_t = asin(sin_t)\n  2282â†’\n  2283â†’                # åœ¨äº­éƒ¨åå°„ï¼šè€ƒè™‘å¤šæ¬¡åå°„\n  2284â†’                theta_internal = theta_t\n  2285â†’                theta_ref = abs(Decimal(str(reflection_count)) * pavilion_angle - theta_internal)\n  2286â†’\n  2287â†’                # åœ¨å°é¢ä¸Šçš„å‡ºå°„ç‚¹åæ ‡ï¼ˆåŠå¾„æ–¹å‘ï¼‰\n  2288â†’                tan_tr = tan(theta_ref)\n  2289â†’                radius = (diameter / Decimal('2.0')) * tan_tr / sqrt(Decimal('1.0') + tan_tr * tan_tr)\n  2290â†’                x = radius * Decimal(str(reflection_count))  # åŒºåˆ†ä¸åŒåå°„æ¬¡æ•°çš„ç‚¹\n  2291â†’                y = Decimal('0.0')\n  2292â†’                points.append((x, y))\n  2293â†’\n  2294â†’    if cancel_flag.is_set() or len(points) < 2:\n  2295â†’        return Decimal('0.0')\n  2296â†’\n  2297â†’    d_sum = Decimal('0.0')\n  2298â†’    cnt = 0\n  2299â†’    for i in range(len(points)):\n  2300â†’        if cancel_flag.is_set():\n  2301â†’            return Decimal('0.0')\n  2302â†’\n  2303â†’        xi, yi = points[i]\n  2304â†’        for j in range(i + 1, len(points)):\n  2305â†’            if cancel_flag.is_set():\n  2306â†’                return Decimal('0.0')\n  2307â†’\n  2308â†’            xj, yj = points[j]\n  2309â†’            d = ((xi - xj)**2 + (yi - yj)**2).sqrt()\n  2310â†’            d_sum += d\n  2311â†’            cnt += 1\n  2312â†’    if cnt == 0:\n  2313â†’        return Decimal('0.0')\n  2314â†’\n  2315â†’    avg_sep = d_sum / Decimal(str(cnt))\n  2316â†’    if not cancel_flag.is_set():\n  2317â†’        avg_sep *= fire_geom_factor(params)\n  2318â†’\n  2319â†’    return avg_sep\n  2320â†’\n  2321â†’def raw_scint(params: Dict[str, Decimal], high_precision: bool = False,\n  2322â†’             cancel_flag: threading.Event = None) -> Decimal:\n  2323â†’    \"\"\"ä¼˜åŒ–çš„é—ªåº¦è®¡ç®—æ¨¡å‹ï¼šå¢åŠ åˆ»é¢æ•°é‡å’ŒåŠ¨æ€è§†è§’é‡‡æ ·\"\"\"\n  2324â†’    if cancel_flag is None:\n  2325â†’        cancel_flag = threading.Event()\n  2326â†’\n  2327â†’    if cancel_flag.is_set():\n  2328â†’        return Decimal('0.0')\n  2329â†’\n  2330â†’    crown_angle_deg = params.get(\"crown_angle\", BASELINE_PARAMS[\"crown_angle\"])\n  2331â†’    crown_angle = crown_angle_deg * PI / Decimal('180')\n  2332â†’\n  2333â†’    n_d = sellmeier_n(Decimal('550e-9'))\n  2334â†’    n_air = Decimal('1.0')\n  2335â†’    theta_c = asin(n_air / n_d)\n  2336â†’\n  2337â†’    # å¢åŠ ï¼šæ›´å¤šåˆ»é¢æ•°é‡ä»¥è·å¾—æ›´å‡†ç¡®çš„é—ªåº¦è®¡ç®—\n  2338â†’    facet_count = 16 if high_precision else 8\n  2339â†’    facet_normals: List[Tuple[Decimal, Decimal, Decimal]] = []\n  2340â†’    for i in range(facet_count):\n  2341â†’        if cancel_flag.is_set():\n  2342â†’            return Decimal('0.0')\n  2343â†’\n  2344â†’        phi = Decimal('2.0') * PI * Decimal(str(i)) / Decimal(str(facet_count))\n  2345â†’        nx = sin(crown_angle) * cos(phi)\n  2346â†’        ny = sin(crown_angle) * sin(phi)\n  2347â†’        nz = cos(crown_angle)\n  2348â†’        facet_normals.append((nx, ny, nz))\n  2349â†’\n  2350â†’    # åŠ¨æ€è§†è§’é‡‡æ ·\n  2351â†’    step_deg = Decimal('1.0') if high_precision else Decimal('2.0')\n  2352â†’    view_angles = [Decimal(str(i)) * step_deg for i in range(0, int(Decimal('360') / step_deg))]\n  2353â†’    intensities: List[Decimal] = []\n  2354â†’\n  2355â†’    for phi_v in view_angles:\n  2356â†’        if cancel_flag.is_set():\n  2357â†’            return Decimal('0.0')\n  2358â†’\n  2359â†’        phi_v_rad = phi_v * PI / Decimal('180')\n  2360â†’        vx = cos(phi_v_rad)\n  2361â†’        vy = sin(phi_v_rad)\n  2362â†’        vz = Decimal('0.0')\n  2363â†’        I = Decimal('0.0')\n  2364â†’\n  2365â†’        for (nx, ny, nz) in facet_normals:\n  2366â†’            if cancel_flag.is_set():\n  2367â†’                return Decimal('0.0')\n  2368â†’\n  2369â†’            cosi = nx * vx + ny * vy + nz * vz\n  2370â†’            if cosi <= Decimal('0'):\n  2371â†’                continue\n  2372â†’            theta_i = acos(cosi)\n  2373â†’            theta_i = clamp(theta_i, Decimal('0'), PI / Decimal('2'))\n  2374â†’\n  2375â†’            if theta_i > theta_c:\n  2376â†’                R = Decimal('1.0')\n  2377â†’            else:\n  2378â†’                R, _ = fresnel_unpolarized(theta_i, n_d, n_air)\n  2379â†’\n  2380â†’            I += R * cosi\n  2381â†’\n  2382â†’        intensities.append(I)\n  2383â†’\n  2384â†’    if cancel_flag.is_set() or len(intensities) == 0:\n  2385â†’        return Decimal('0.0')\n  2386â†’\n  2387â†’    mean_I = sum(intensities) / Decimal(str(len(intensities)))\n  2388â†’    if mean_I <= Decimal('1e-9'):\n  2389â†’        return Decimal('0.0')\n  2390â†’\n  2391â†’    var = sum((x - mean_I) ** 2 for x in intensities) / Decimal(str(len(intensities)))\n  2392â†’    std = sqrt(var)\n  2393â†’\n  2394â†’    return std / mean_I\n  2395â†’\n  2396â†’# ---------------- æ ‡å®šå™¨ ----------------\n  2397â†’@dataclass\n  2398â†’class CalibrationConfig:\n  2399â†’    target_brightness: Decimal = Decimal('10.0')\n  2400â†’    target_fire: Decimal = Decimal('10.0')\n  2401â†’    target_scint: Decimal = Decimal('10.0')\n  2402â†’    high_precision: bool = False\n  2403â†’\n  2404â†’class PhysicalCalibrator:\n  2405â†’    \"\"\"\n  2406â†’    ç”¨åŸºå‡†é’»ï¼ˆå›ºå®šå‡ ä½•ï¼‰å’Œç›®æ ‡åˆ†æ•°ï¼ˆå¯é€šè¿‡å¯†ç ä¿®æ”¹ï¼‰è‡ªåŠ¨è®¡ç®—ç¼©æ”¾ç³»æ•°ï¼š\n  2407â†’        B = scale_B * raw_B * f_geom\n  2408â†’        F = scale_F * raw_F * f_geom\n  2409â†’        S = scale_S * raw_S * f_geom\n  2410â†’    ä½¿å¾—åŸºå‡†é’»åœ¨å½“å‰æ¨¡å¼ä¸‹æ°å¥½è¾¾åˆ° target_B / target_F / target_Sã€‚\n  2411â†’    \"\"\"\n  2412â†’\n  2413â†’    def __init__(self, config: CalibrationConfig) -> None:\n  2414â†’        self.config = config\n  2415â†’        self.scale_B = Decimal('1.0')\n  2416â†’        self.scale_F = Decimal('1.0')\n  2417â†’        self.scale_S = Decimal('1.0')\n  2418â†’        self.ref_raw_B = Decimal('0.0')\n  2419â†’        self.ref_raw_F = Decimal('0.0')\n  2420â†’        self.ref_raw_S = Decimal('0.0')\n  2421â†’        self.recalibrate()\n  2422â†’\n  2423â†’    def recalibrate(self) -> None:\n  2424â†’        # åŸºå‡†é’» rawï¼ˆä¸åŠ å‡ ä½•æƒ©ç½šï¼Œå‡ ä½•å› å­å½“ 1ï¼‰\n  2425â†’        params = dict(BASELINE_PARAMS)\n  2426â†’        raw_B = raw_brightness(params, self.config.high_precision)\n  2427â†’        raw_F = raw_fire(params, self.config.high_precision)\n  2428â†’        raw_S = raw_scint(params, self.config.high_precision)\n  2429â†’\n  2430â†’        self.ref_raw_B = raw_B\n  2431â†’        self.ref_raw_F = raw_F\n  2432â†’        self.ref_raw_S = raw_S\n  2433â†’\n  2434â†’        self.scale_B = (\n  2435â†’            self.config.target_brightness / raw_B if raw_B > Decimal('1e-9') else Decimal('1.0')\n  2436â†’        )\n  2437â†’        self.scale_F = self.config.target_fire / raw_F if raw_F > Decimal('1e-9') else Decimal('1.0')\n  2438â†’        self.scale_S = self.config.target_scint / raw_S if raw_S > Decimal('1e-9') else Decimal('1.0')\n  2439â†’\n  2440â†’    def set_targets(self, tb: Decimal, tf: Decimal, ts: Decimal) -> None:\n  2441â†’        self.config.target_brightness = tb\n  2442â†’        self.config.target_fire = tf\n  2443â†’        self.config.target_scint = ts\n  2444â†’        self.recalibrate()\n  2445â†’\n  2446â†’    def set_high_precision(self, hp: bool) -> None:\n  2447â†’        self.config.high_precision = hp\n  2448â†’        self.recalibrate()\n  2449â†’\n  2450â†’    def compute_scores(self, params: Dict[str, Decimal], cancel_flag: threading.Event = None,\n  2451â†’                      progress_callback=None) -> Tuple[Dict[str, Decimal], str]:\n  2452â†’        \"\"\"\n  2453â†’        è¾“å…¥ä¸€é¢—é’»çŸ³çš„å®è§‚å‚æ•°ï¼Œè¾“å‡ºï¼š\n  2454â†’            scores: dict\n  2455â†’                brightness, fire, scint, op, cs, ha, d_geom\n  2456â†’            detail: str\n  2457â†’                å¯è¿½æº¯çš„æ–‡å­—è¯´æ˜\n  2458â†’        \"\"\"\n  2459â†’        if cancel_flag is None:\n  2460â†’            cancel_flag = threading.Event()\n  2461â†’\n  2462â†’        # å‡ ä½•éƒ¨åˆ†\n  2463â†’        if cancel_flag.is_set():\n  2464â†’            return {}, \"è®¡ç®—å·²å–æ¶ˆ\"\n  2465â†’\n  2466â†’        d_geom, ha = geometry_metrics(params)\n  2467â†’        # å‡ ä½•æƒ©ç½šå› å­ï¼šd_geom<=1 ä¸æƒ©ç½šï¼›>1 çº¿æ€§ä¸‹é™åˆ° 0.5ï¼Œå¹¶ä¿åº•ä¸å½’é›¶\n  2468â†’        if d_geom <= Decimal('1.0'):\n  2469â†’            f_geom = Decimal('1.0')\n  2470â†’        elif d_geom >= Decimal('5.0'):\n  2471â†’            f_geom = Decimal('0.5')\n  2472â†’        else:\n  2473â†’            # 1~5 ä¹‹é—´ä» 1.0 çº¿æ€§é™åˆ° 0.5\n  2474â†’            f_geom = Decimal('1.0') - Decimal('0.125') * (d_geom - Decimal('1.0'))\n  2475â†’        f_geom = clamp(f_geom, Decimal('0.5'), Decimal('1.0'))\n  2476â†’\n  2477â†’        # æ›´æ–°è¿›åº¦\n  2478â†’        if progress_callback:\n  2479â†’            progress_callback(20)\n  2480â†’\n  2481â†’        # åŸå§‹ç‰©ç†é‡\n  2482â†’        if cancel_flag.is_set():\n  2483â†’            return {}, \"è®¡ç®—å·²å–æ¶ˆ\"\n  2484â†’\n  2485â†’        raw_B = raw_brightness(params, self.config.high_precision, cancel_flag)\n  2486â†’        if cancel_flag.is_set():\n  2487â†’            return {}, \"è®¡ç®—å·²å–æ¶ˆ\"\n  2488â†’\n  2489â†’        if progress_callback:\n  2490â†’            progress_callback(40)\n  2491â†’\n  2492â†’        raw_F = raw_fire(params, self.config.high_precision, cancel_flag)\n  2493â†’        if cancel_flag.is_set():\n  2494â†’            return {}, \"è®¡ç®—å·²å–æ¶ˆ\"\n  2495â†’\n  2496â†’        if progress_callback:\n  2497â†’            progress_callback(60)\n  2498â†’\n  2499â†’        raw_S = raw_scint(params, self.config.high_precision, cancel_flag)\n  2500â†’\n  2501â†’        if cancel_flag.is_set():\n  2502â†’            return {}, \"è®¡ç®—å·²å–æ¶ˆ\"\n  2503â†’\n  2504â†’        if progress_callback:\n  2505â†’            progress_callback(80)\n  2506â†’\n  2507â†’        # æ ‡å®šå 0~10 åˆ†\n  2508â†’        B = clamp(self.scale_B * raw_B * f_geom, Decimal('0.0'), Decimal('10.0'))\n  2509â†’        F = clamp(self.scale_F * raw_F * f_geom, Decimal('0.0'), Decimal('10.0'))\n  2510â†’        S = clamp(self.scale_S * raw_S * f_geom, Decimal('0.0'), Decimal('10.0'))\n  2511â†’\n  2512â†’        OP = WEIGHT_B * B + WEIGHT_F * F + WEIGHT_S * S\n  2513â†’        CS = WEIGHT_OP_IN_CS * OP + WEIGHT_HA_IN_CS * (ha / Decimal('10.0'))\n  2514â†’\n  2515â†’        if OP >= Decimal('9.5'):\n  2516â†’            grade = \"æä¼˜ EX\"\n  2517â†’        elif OP >= Decimal('9.0'):\n  2518â†’            grade = \"ä¼˜ VG\"\n  2519â†’        elif OP >= Decimal('8.0'):\n  2520â†’            grade = \"è‰¯ Good\"\n  2521â†’        else:\n  2522â†’            grade = \"ä¸€èˆ¬ Fair\"\n  2523â†’\n  2524â†’        scores = {\n  2525â†’            \"brightness\": B,\n  2526â†’            \"fire\":       F,\n  2527â†’            \"scint\":      S,\n  2528â†’            \"op\":         OP,\n  2529â†’            \"cs\":         CS,\n  2530â†’            \"ha\":         ha,\n  2531â†’            \"d_geom\":     d_geom,\n  2532â†’        }\n  2533â†’\n  2534â†’        # å…‰çº¿è¿½è¸ªéªŒè¯\n  2535â†’        if progress_callback:\n  2536â†’            progress_callback(90)\n  2537â†’\n  2538â†’        rt_validation = advanced_monte_carlo_ray_tracing(params, num_rays=1000,\n  2539â†’                                                       progress_callback=progress_callback,\n  2540â†’                                                       cancel_flag=cancel_flag)\n  2541â†’\n  2542â†’        if progress_callback:\n  2543â†’            progress_callback(100)\n  2544â†’\n  2545â†’        detail_lines: List[str] = []\n  2546â†’        detail_lines.append(\"=== QL é’»çŸ³å…‰å­¦æ€§èƒ½é‡åŒ–è¯„ä¼°ç³»ç»Ÿ - ä½œè€…ï¼šæ—å°å…” ===\\n\")\n  2547â†’        detail_lines.append(\"å›ºå®šè™šæ‹Ÿå®éªŒå®¤ç‰©ç†æ¡ä»¶ï¼š\\n\")\n  2548â†’        detail_lines.append(\"  - æŠ˜å°„ç‡ n(Î») é‡‡ç”¨ Sellmeier æ–¹ç¨‹ï¼ˆå¯è§æ³¢æ®µ 450~650nmï¼‰\\n\")\n  2549â†’        detail_lines.append(\"  - Fresnel éåæŒ¯åå°„ / é€å°„ï¼ˆs/p å¹³å‡ï¼‰\\n\")\n  2550â†’        detail_lines.append(\"  - äº®åº¦ï¼šLambert å…‰åœºç§¯åˆ† + CIE V(Î») åŠ æƒ\\n\")\n  2551â†’        detail_lines.append(\"  - ç«å½©ï¼šåŸºäºä¸åŒæ³¢é•¿å‡ºå°„ç‚¹å‡ ä½•åˆ†ç¦»çš„å¹³å‡è·ç¦»\\n\")\n  2552â†’        detail_lines.append(\"  - é—ªåº¦ï¼šè§†è§’æ—‹è½¬ + 8 ä¸ªå† éƒ¨åˆ»é¢çš„ Fresnel å“åº”æ³¢åŠ¨åº¦ (std/mean)\\n\\n\")\n  2553â†’\n  2554â†’        detail_lines.append(\"åŸºå‡†é’»åˆ‡å·¥å‚æ•°ï¼ˆå”¯ä¸€å‡ ä½•åŸºå‡†ï¼‰ï¼š\\n\")\n  2555â†’        detail_lines.append(\n  2556â†’            \"  Î¸c = {crown_angle:.3f}Â°ï¼ŒÎ¸p = {pavilion_angle:.3f}Â°ï¼ŒT = {table_pct:.3f}% ï¼Œ\\n\"\n  2557â†’            \"  C = {crown_height_pct:.3f}% ï¼ŒP = {pavilion_depth_pct:.3f}% ï¼ŒTD = {total_depth_pct:.3f}% ï¼Œ\\n\"\n  2558â†’            \"  ct = {carat:.4f}ï¼ŒD = {diameter:.3f} mm\\n\".format(**{k: float(v) for k, v in BASELINE_PARAMS.items()})\n  2559â†’        )\n  2560â†’        detail_lines.append(\n  2561â†’            \"å½“å‰ç›®æ ‡åŸºå‡†åˆ†ï¼ˆå¯é€šè¿‡å¯†ç  200115 ä¿®æ”¹ï¼‰ï¼š\\n\"\n  2562â†’            f\"  Brightness = {float(self.config.target_brightness):.2f} / 10\\n\"\n  2563â†’            f\"  ç«å½©       = {float(self.config.target_fire):.2f} / 10\\n\"\n  2564â†’            f\"  Scint      = {float(self.config.target_scint):.2f} / 10\\n\"\n  2565â†’        )\n  2566â†’        detail_lines.append(\n  2567â†’            \"å½“å‰ç¼©æ”¾ç³»æ•°ï¼ˆç”±åŸºå‡†é’»è‡ªåŠ¨æ ‡å®šï¼‰ï¼š\\n\"\n  2568â†’            f\"  scale_B = {float(self.scale_B):.6e}ï¼ˆref_raw_B = {float(self.ref_raw_B):.6e}ï¼‰\\n\"\n  2569â†’            f\"  scale_F = {float(self.scale_F):.6e}ï¼ˆref_raw_F = {float(self.ref_raw_F):.6e}ï¼‰\\n\"\n  2570â†’            f\"  scale_S = {float(self.scale_S):.6e}ï¼ˆref_raw_S = {float(self.ref_raw_S):.6e}ï¼‰\\n\"\n  2571â†’        )\n  2572â†’        detail_lines.append(\n  2573â†’            \"æ•°å€¼æ¨¡å¼ï¼š{mode}\\n\".format(\n  2574â†’                mode=\"é«˜ç²¾åº¦ï¼ˆç»†æ­¥é•¿ï¼‰\" if self.config.high_precision else \"æ ‡å‡†ç²¾åº¦\"\n  2575â†’            )\n  2576â†’        )\n  2577â†’\n  2578â†’        detail_lines.append(\"\\n=== æœ¬æ¬¡å¾…è¯„ä¼°é’»çŸ³è¾“å…¥å‚æ•° ===\\n\")\n  2579â†’        detail_lines.append(\n  2580â†’            \"  Î¸c = {crown_angle:.3f}Â°ï¼ŒÎ¸p = {pavilion_angle:.3f}Â°ï¼ŒT = {table_pct:.3f}% ï¼Œ\\n\"\n  2581â†’            \"  C = {crown_height_pct:.3f}% ï¼ŒP = {pavilion_depth_pct:.3f}% ï¼ŒTD = {total_depth_pct:.3f}% ï¼Œ\\n\"\n  2582â†’            \"  ct = {carat:.4f}ï¼ŒD = {diameter:.3f} mm\\n\".format(**{k: float(v) for k, v in params.items()})\n  2583â†’        )\n  2584â†’\n  2585â†’        detail_lines.append(\"\\n=== å‡ ä½•åç¦»ä¸å…«å¿ƒå…«ç®­æŒ‡æ ‡ ===\\n\")\n  2586â†’        detail_lines.append(\n  2587â†’            \"  D_geom = {d:.4f} ï¼ˆåŸºå‡†é’» = 0ï¼Œè¶Šå¤§è¡¨ç¤ºåç¦»è¶Šå¤§ï¼‰\\n\".format(d=float(d_geom))\n  2588â†’        )\n  2589â†’        detail_lines.append(\n  2590â†’            \"  HA     = {ha:.2f} / 100 ï¼ˆåŸºå‡†é’» = 100ï¼ŒæŒ‰å‡ ä½•åç¦»æŸ”æ€§æ‰£åˆ†ï¼‰\\n\".format(ha=float(ha))\n  2591â†’        )\n  2592â†’\n  2593â†’        detail_lines.append(\"\\n=== ä¸‰å¤§å…‰å­¦æŒ‡æ ‡ï¼ˆå·²åŒ…å«å‡ ä½•æƒ©ç½šä¸ç¼©æ”¾ï¼‰ ===\\n\")\n  2594â†’        detail_lines.append(\"  äº®åº¦ Brightness = {b:.4f} / 10\\n\".format(b=float(B)))\n  2595â†’        detail_lines.append(\"  ç«å½© ç«å½©       = {f:.4f} / 10\\n\".format(f=float(F)))\n  2596â†’        detail_lines.append(\"  é—ªåº¦ Scint      = {s:.4f} / 10\\n\".format(s=float(S)))\n  2597â†’\n  2598â†’        detail_lines.append(\"\\n=== ç»¼åˆå…‰å­¦æ€§èƒ½ OP ä¸ç»¼åˆç¾è§‚åº¦ CS ===\\n\")\n  2599â†’        detail_lines.append(\n  2600â†’            \"  OP = 0.50 * B + 0.35 * F + {s_weight} * S = {op:.4f} / 10\\n\".format(\n  2601â†’                s_weight=float(WEIGHT_S), op=float(OP)\n  2602â†’            )\n  2603â†’        )\n  2604â†’        detail_lines.append(\n  2605â†’            \"  CS = {op_weight} * OP + {ha_weight} * (HA/10) = {cs:.4f} / 10\\n\".format(\n  2606â†’                op_weight=float(WEIGHT_OP_IN_CS),\n  2607â†’                ha_weight=float(WEIGHT_HA_IN_CS),\n  2608â†’                cs=float(CS)\n  2609â†’            )\n  2610â†’        )\n  2611â†’        detail_lines.append(\n  2612â†’            \"  å½“å‰å…‰å­¦ç­‰çº§ï¼ˆè§£é‡Šï¼‰ï¼š{g}\\n\".format(g=grade)\n  2613â†’        )\n  2614â†’\n  2615â†’        detail_lines.append(\"\\n=== å…‰çº¿è¿½è¸ªéªŒè¯ç»“æœ ===\\n\")\n  2616â†’        detail_lines.append(f\"  äº®åº¦å·®å¼‚: {float(rt_validation['brightness_diff']):.2f}%\\n\")\n  2617â†’        detail_lines.append(f\"  ç«å½©å·®å¼‚: {float(rt_validation['fire_diff']):.2f}%\\n\")\n  2618â†’\n  2619â†’        detail_lines.append(\"\\n=== å‡ ä½•ä¿®æ­£å› å­ï¼ˆå†…éƒ¨å‚æ•°ï¼Œä»…ä¾›å®¡é˜…ï¼‰ ===\\n\")\n  2620â†’        detail_lines.append(\n  2621â†’            \"  å‡ ä½•æƒ©ç½šå› å­ f_geom = {fg:.4f} ï¼ˆD_geom={dg:.4f}ï¼‰\\n\".format(\n  2622â†’                fg=float(f_geom), dg=float(d_geom)\n  2623â†’            )\n  2624â†’        )\n  2625â†’\n  2626â†’        return scores, \"\".join(detail_lines)\n  2627â†’\n  2628â†’# ---------------- é«˜çº§æ ‡å®šå‡½æ•° ----------------\n  2629â†’def calibrate_to_baseline(target_scores: Dict[str, Decimal] = None,\n  2630â†’                         num_iterations: int = 100,\n  2631â†’                         tolerance: Decimal = Decimal('1e-6')) -> Dict[str, Any]:\n  2632â†’    \"\"\"\n  2633â†’    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„åŸºå‡†é’»è‡ªåŠ¨æ ‡å®š\n  2634â†’    è‡ªåŠ¨è°ƒæ•´å‚æ•°ä»¥è¾¾åˆ°åŸºå‡†é’»çŸ³çš„å®Œç¾åˆ†æ•°\n  2635â†’    \"\"\"\n  2636â†’    if target_scores is None:\n  2637â†’        target_scores = {\n  2638â†’            'brightness': Decimal('10.0'),\n  2639â†’            'fire': Decimal('10.0'),\n  2640â†’            'scint': Decimal('10.0'),\n  2641â†’            'cs': Decimal('10.0')\n  2642â†’        }\n  2643â†’\n  2644â†’    # åˆå§‹åŒ–é…ç½®å’Œæ ‡å®šå™¨\n  2645â†’    config = CalibrationConfig()\n  2646â†’    calibrator = PhysicalCalibrator(config)\n  2647â†’\n  2648â†’    # å½“å‰åŸºå‡†å‚æ•°\n  2649â†’    current_params = BASELINE_PARAMS.copy()\n  2650â†’\n  2651â†’    # æ ‡å®šå†å²è®°å½•\n  2652â†’    calibration_history = []\n  2653â†’\n  2654â†’    print(\"å¼€å§‹åŸºå‡†é’»è‡ªåŠ¨æ ‡å®š...\")\n  2655â†’\n  2656â†’    for iteration in range(num_iterations):\n  2657â†’        # è®¡ç®—å½“å‰åˆ†æ•°\n  2658â†’        scores, detail = calibrator.compute_scores(current_params)\n  2659â†’\n  2660â†’        # è®¡ç®—åå·®\n  2661â†’        errors = {}\n  2662â†’        total_error = Decimal('0.0')\n  2663â†’        for metric, target_score in target_scores.items():\n  2664â†’            current_score = scores.get(metric, Decimal('0.0'))\n  2665â†’            error = target_score - current_score\n  2666â†’            errors[metric] = error\n  2667â†’            total_error += abs(error)\n  2668â†’\n  2669â†’        # è®°å½•æ ‡å®šå†å²\n  2670â†’        calibration_history.append({\n  2671â†’            'iteration': iteration,\n  2672â†’            'params': current_params.copy(),\n  2673â†’            'scores': scores.copy(),\n  2674â†’            'errors': errors.copy(),\n  2675â†’            'total_error': total_error\n  2676â†’        })\n  2677â†’\n  2678â†’        # æ£€æŸ¥æ˜¯å¦è¾¾åˆ°ç›®æ ‡\n  2679â†’        if total_error < tolerance:\n  2680â†’            print(f\"æ ‡å®šå®Œæˆï¼è¿­ä»£æ¬¡æ•°: {iteration + 1}\")\n  2681â†’            break\n  2682â†’\n  2683â†’        # å¦‚æœå·²ç»æ˜¯å®Œç¾åˆ†æ•°ï¼Œåœæ­¢æ ‡å®š\n  2684â†’        if total_error == Decimal('0.0'):\n  2685â†’            print(\"åŸºå‡†é’»çŸ³å·²è¾¾åˆ°å®Œç¾åˆ†æ•°ï¼Œæ— éœ€è¿›ä¸€æ­¥æ ‡å®š\")\n  2686â†’            break\n  2687â†’\n  2688â†’        # è‡ªé€‚åº”å‚æ•°è°ƒæ•´ (ç®€åŒ–çš„æ¢¯åº¦ä¸‹é™)\n  2689â†’        adjustment_factor = Decimal('0.1') * (Decimal('1.0') - Decimal(iteration) / Decimal(num_iterations))\n  2690â†’\n  2691â†’        # æ ¹æ®è¯¯å·®è°ƒæ•´å‡ ä½•å‚æ•°\n  2692â†’        for param_name, error in errors.items():\n  2693â†’            if abs(error) > Decimal('0.01'):  # åªè°ƒæ•´æœ‰æ˜æ˜¾è¯¯å·®çš„å‚æ•°\n  2694â†’                # ç¡®å®šå“ªäº›å‚æ•°å½±å“è¯¥æŒ‡æ ‡\n  2695â†’                if param_name == 'brightness':\n  2696â†’                    # äº®åº¦ä¸»è¦å—äº­è§’å’Œå…¨æ·±æ¯”å½±å“\n  2697â†’                    current_params['pavilion_angle'] += error * adjustment_factor * Decimal('0.5')\n  2698â†’                    current_params['total_depth_pct'] += error * adjustment_factor * Decimal('0.3')\n  2699â†’                elif param_name == 'fire':\n  2700â†’                    # ç«å½©ä¸»è¦å—å† è§’å’Œå°é¢å½±å“\n  2701â†’                    current_params['crown_angle'] += error * adjustment_factor * Decimal('0.4')\n  2702â†’                    current_params['table_pct'] += error * adjustment_factor * Decimal('0.3')\n  2703â†’                elif param_name == 'scint':\n  2704â†’                    # é—ªåº¦å—å¤šä¸ªå‚æ•°ç»¼åˆå½±å“\n  2705â†’                    current_params['crown_height_pct'] += error * adjustment_factor * Decimal('0.2')\n  2706â†’                    current_params['pavilion_depth_pct'] += error * adjustment_factor * Decimal('0.2')\n  2707â†’                    current_params['table_pct'] += error * adjustment_factor * Decimal('0.1')\n  2708â†’                elif param_name == 'cs':\n  2709â†’                    # CSæ˜¯ç»¼åˆæŒ‡æ ‡\n  2710â†’                    current_params['crown_angle'] += error * adjustment_factor * Decimal('0.15')\n  2711â†’                    current_params['pavilion_angle'] += error * adjustment_factor * Decimal('0.15')\n  2712â†’                    current_params['table_pct'] += error * adjustment_factor * Decimal('0.1')\n  2713â†’\n  2714â†’        # å‚æ•°èŒƒå›´é™åˆ¶\n  2715â†’        current_params = clamp_params_to_valid_range(current_params)\n  2716â†’\n  2717â†’    # æœ€ç»ˆéªŒè¯\n  2718â†’    final_scores, final_detail = calibrator.compute_scores(current_params)\n  2719â†’\n  2720â†’    return {\n  2721â†’        'success': total_error < tolerance,\n  2722â†’        'iterations': len(calibration_history),\n  2723â†’        'final_params': current_params,\n  2724â†’        'final_scores': final_scores,\n  2725â†’        'target_scores': target_scores,\n  2726â†’        'calibration_history': calibration_history,\n  2727â†’        'final_error': total_error,\n  2728â†’        'improvement': calibration_history[-1]['total_error'] - total_error if calibration_history else Decimal('0.0')\n  2729â†’    }\n  2730â†’\n  2731â†’def auto_calibrate(batch_params: List[Dict[str, Decimal]] = None,\n  2732â†’                   target_improvement: Decimal = Decimal('0.5'),\n  2733â†’                   max_iterations: int = 200) -> Dict[str, Any]:\n  2734â†’    \"\"\"\n  2735â†’    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„æ‰¹é‡è‡ªåŠ¨æ ‡å®š\n  2736â†’    å¯¹å¤šé¢—é’»çŸ³è¿›è¡Œæ‰¹é‡æ ‡å®šä¼˜åŒ–\n  2737â†’    \"\"\"\n  2738â†’    if batch_params is None:\n  2739â†’        # ä½¿ç”¨ä¸€äº›æµ‹è¯•å‚æ•°\n  2740â†’        batch_params = [\n  2741â†’            BASELINE_PARAMS.copy(),\n  2742â†’            {**BASELINE_PARAMS, 'crown_angle': Decimal('33.0')},\n  2743â†’            {**BASELINE_PARAMS, 'pavilion_angle': Decimal('42.0')},\n  2744â†’            {**BASELINE_PARAMS, 'table_pct': Decimal('58.0')},\n  2745â†’        ]\n  2746â†’\n  2747â†’    config = CalibrationConfig()\n  2748â†’    calibrator = PhysicalCalibrator(config)\n  2749â†’\n  2750â†’    # åˆå§‹åˆ†æ•°è®¡ç®—\n  2751â†’    initial_scores = []\n  2752â†’    for params in batch_params:\n  2753â†’        scores, _ = calibrator.compute_scores(params)\n  2754â†’        initial_scores.append(scores)\n  2755â†’\n  2756â†’    print(f\"å¼€å§‹æ‰¹é‡æ ‡å®š {len(batch_params)} é¢—é’»çŸ³...\")\n  2757â†’\n  2758â†’    # æ‰¹é‡æ ‡å®šå¾ªç¯\n  2759â†’    calibration_results = []\n  2760â†’    total_improvement = Decimal('0.0')\n  2761â†’\n  2762â†’    for iteration in range(max_iterations):\n  2763â†’        iteration_improvements = []\n  2764â†’\n  2765â†’        for i, params in enumerate(batch_params):\n  2766â†’            # è®¡ç®—å½“å‰åˆ†æ•°\n  2767â†’            current_scores, _ = calibrator.compute_scores(params)\n  2768â†’            initial_score = sum(initial_scores[i].values())\n  2769â†’            current_score = sum(current_scores.values())\n  2770â†’\n  2771â†’            # è‡ªé€‚åº”è°ƒæ•´\n  2772â†’            if current_score < initial_score + target_improvement:\n  2773â†’                # åº”ç”¨æ¢¯åº¦ä¸‹é™è°ƒæ•´\n  2774â†’                adjusted_params = apply_adaptive_adjustment(params, current_scores, target_improvement)\n  2775â†’                batch_params[i] = adjusted_params\n  2776â†’\n  2777â†’                # è®¡ç®—æ”¹è¿›\n  2778â†’                new_scores, _ = calibrator.compute_scores(adjusted_params)\n  2779â†’                new_score = sum(new_scores.values())\n  2780â†’                improvement = new_score - current_score\n  2781â†’                iteration_improvements.append(improvement)\n  2782â†’            else:\n  2783â†’                iteration_improvements.append(Decimal('0.0'))\n  2784â†’\n  2785â†’        # è®¡ç®—æœ¬è½®æ€»æ”¹è¿›\n  2786â†’        iteration_total_improvement = sum(iteration_improvements)\n  2787â†’        total_improvement += iteration_total_improvement\n  2788â†’\n  2789â†’        # å¦‚æœæ”¹è¿›å¾ˆå°ï¼Œæå‰ç»“æŸ\n  2790â†’        if iteration_total_improvement < target_improvement * Decimal('0.1'):\n  2791â†’            print(f\"æ‰¹é‡æ ‡å®šæ”¶æ•›ï¼Œè¿­ä»£æ¬¡æ•°: {iteration + 1}\")\n  2792â†’            break\n  2793â†’\n  2794â†’    # æœ€ç»ˆç»“æœè®¡ç®—\n  2795â†’    final_scores = []\n  2796â†’    for params in batch_params:\n  2797â†’        scores, _ = calibrator.compute_scores(params)\n  2798â†’        final_scores.append(scores)\n  2799â†’\n  2800â†’    # è®¡ç®—æ”¹è¿›ç»Ÿè®¡\n  2801â†’    improvement_stats = []\n  2802â†’    for i, (initial, final) in enumerate(zip(initial_scores, final_scores)):\n  2803â†’        initial_total = sum(initial.values())\n  2804â†’        final_total = sum(final.values())\n  2805â†’        improvement = final_total - initial_total\n  2806â†’        improvement_stats.append({\n  2807â†’            'diamond_index': i,\n  2808â†’            'initial_score': initial_total,\n  2809â†’            'final_score': final_total,\n  2810â†’            'improvement': improvement,\n  2811â†’            'improvement_percentage': (improvement / initial_total * Decimal('100')) if initial_total > 0 else Decimal('0.0')\n  2812â†’        })\n  2813â†’\n  2814â†’    return {\n  2815â†’        'success': total_improvement > Decimal('0.0'),\n  2816â†’        'iterations': len(calibration_results),\n  2817â†’        'total_improvement': total_improvement,\n  2818â†’        'average_improvement_per_diamond': total_improvement / Decimal(len(batch_params)),\n  2819â†’        'final_params': batch_params,\n  2820â†’        'final_scores': final_scores,\n  2821â†’        'improvement_statistics': improvement_stats,\n  2822â†’        'best_diamond_index': max(range(len(improvement_stats)), key=lambda i: improvement_stats[i]['improvement']),\n  2823â†’        'calibration_history': calibration_results\n  2824â†’    }\n  2825â†’\n  2826â†’def apply_adaptive_adjustment(params: Dict[str, Decimal], scores: Dict[str, Decimal],\n  2827â†’                              target_improvement: Decimal) -> Dict[str, Decimal]:\n  2828â†’    \"\"\"\n  2829â†’    åº”ç”¨è‡ªé€‚åº”å‚æ•°è°ƒæ•´\n  2830â†’    \"\"\"\n  2831â†’    adjustment_factor = target_improvement * Decimal('0.1')\n  2832â†’    adjusted_params = params.copy()\n  2833â†’\n  2834â†’    # åŸºäºåˆ†æ•°è°ƒæ•´å¯¹åº”å‚æ•°\n  2835â†’    if scores.get('brightness', 0) < Decimal('9.5'):\n  2836â†’        adjusted_params['pavilion_angle'] += adjustment_factor * Decimal('0.5')\n  2837â†’        adjusted_params['total_depth_pct'] += adjustment_factor * Decimal('0.3')\n  2838â†’\n  2839â†’    if scores.get('fire', 0) < Decimal('9.5'):\n  2840â†’        adjusted_params['crown_angle'] += adjustment_factor * Decimal('0.4')\n  2841â†’        adjusted_params['table_pct'] += adjustment_factor * Decimal('0.3')\n  2842â†’\n  2843â†’    if scores.get('scint', 0) < Decimal('9.5'):\n  2844â†’        adjusted_params['crown_height_pct'] += adjustment_factor * Decimal('0.2')\n  2845â†’        adjusted_params['pavilion_depth_pct'] += adjustment_factor * Decimal('0.2')\n  2846â†’\n  2847â†’    if scores.get('cs', 0) < Decimal('9.5'):\n  2848â†’        adjusted_params['crown_angle'] += adjustment_factor * Decimal('0.15')\n  2849â†’        adjusted_params['pavilion_angle'] += adjustment_factor * Decimal('0.15')\n  2850â†’\n  2851â†’    return clamp_params_to_valid_range(adjusted_params)\n  2852â†’\n  2853â†’def clamp_params_to_valid_range(params: Dict[str, Decimal]) -> Dict[str, Decimal]:\n  2854â†’    \"\"\"\n  2855â†’    å°†å‚æ•°é™åˆ¶åœ¨æœ‰æ•ˆèŒƒå›´å†…\n  2856â†’    \"\"\"\n  2857â†’    valid_ranges = {\n  2858â†’        'crown_angle': (Decimal('30.0'), Decimal('40.0')),\n  2859â†’        'pavilion_angle': (Decimal('38.0'), Decimal('44.0')),\n  2860â†’        'table_pct': (Decimal('50.0'), Decimal('65.0')),\n  2861â†’        'crown_height_pct': (Decimal('10.0'), Decimal('20.0')),\n  2862â†’        'pavilion_depth_pct': (Decimal('38.0'), Decimal('48.0')),\n  2863â†’        'total_depth_pct': (Decimal('55.0'), Decimal('70.0')),\n  2864â†’        'carat': (Decimal('0.1'), Decimal('10.0')),\n  2865â†’        'diameter': (Decimal('1.0'), Decimal('20.0'))\n  2866â†’    }\n  2867â†’\n  2868â†’    clamped_params = params.copy()\n  2869â†’    for param, (min_val, max_val) in valid_ranges.items():\n  2870â†’        if param in clamped_params:\n  2871â†’            clamped_params[param] = clamp(clamped_params[param], min_val, max_val)\n  2872â†’\n  2873â†’    return clamped_params\n  2874â†’\n  2875â†’# ---------------- æŒä¹…åŒ–å·¥å…· ----------------\n  2876â†’def load_calibration() -> CalibrationConfig:\n  2877â†’    if not os.path.exists(CALIB_FILE):\n  2878â†’        return CalibrationConfig()\n  2879â†’    try:\n  2880â†’        with open(CALIB_FILE, \"r\", encoding=\"utf-8\") as f:\n  2881â†’            data = json.load(f)\n  2882â†’        return CalibrationConfig(\n  2883â†’            target_brightness=Decimal(str(data.get(\"brightness\", 10.0))),\n  2884â†’            target_fire=Decimal(str(data.get(\"fire\", 10.0))),\n  2885â†’            target_scint=Decimal(str(data.get(\"scint\", 10.0))),\n  2886â†’            high_precision=bool(data.get(\"high_precision\", False)),\n  2887â†’        )\n  2888â†’    except json.JSONDecodeError as e:\n  2889â†’        logger.error(f\"JSON è§£æé”™è¯¯: {str(e)}\")\n  2890â†’        return CalibrationConfig()\n  2891â†’    except Exception as e:\n  2892â†’        logger.error(f\"åŠ è½½æ ‡å®šé…ç½®å¤±è´¥: {str(e)}\")\n  2893â†’        return CalibrationConfig()\n  2894â†’\n  2895â†’def save_calibration(cfg: CalibrationConfig) -> None:\n  2896â†’    data = {\n  2897â†’        \"brightness\": float(cfg.target_brightness),\n  2898â†’        \"fire\": float(cfg.target_fire),\n  2899â†’        \"scint\": float(cfg.target_scint),\n  2900â†’        \"high_precision\": cfg.high_precision,\n  2901â†’    }\n  2902â†’    try:\n  2903â†’        with open(CALIB_FILE, \"w\", encoding=\"utf-8\") as f:\n  2904â†’            json.dump(data, f, ensure_ascii=False, indent=2)\n  2905â†’        logger.info(\"æ ‡å®šé…ç½®å·²ä¿å­˜\")\n  2906â†’    except Exception as e:\n  2907â†’        logger.error(f\"ä¿å­˜æ ‡å®šé…ç½®å¤±è´¥: {str(e)}\")\n  2908â†’\n  2909â†’def load_leaderboard() -> List[Dict[str, Any]]:\n  2910â†’    if not os.path.exists(LEADERBOARD_FILE):\n  2911â†’        return []\n  2912â†’    try:\n  2913â†’        with open(LEADERBOARD_FILE, \"r\", encoding=\"utf-8\") as f:\n  2914â†’            data = json.load(f)\n  2915â†’        if isinstance(data, list):\n  2916â†’            return data\n  2917â†’        return []\n  2918â†’    except json.JSONDecodeError as e:\n  2919â†’        logger.error(f\"JSON è§£æé”™è¯¯: {str(e)}\")\n  2920â†’        return []\n  2921â†’    except Exception as e:\n  2922â†’        logger.error(f\"åŠ è½½æ’è¡Œæ¦œå¤±è´¥: {str(e)}\")\n  2923â†’        return []\n  2924â†’\n  2925â†’def save_leaderboard(records: List[Dict[str, Any]]) -> None:\n  2926â†’    try:\n  2927â†’        with open(LEADERBOARD_FILE, \"w\", encoding=\"utf-8\") as f:\n  2928â†’            json.dump(records, f, ensure_ascii=False, indent=2)\n  2929â†’        logger.info(\"æ’è¡Œæ¦œå·²ä¿å­˜\")\n  2930â†’    except Exception as e:\n  2931â†’        logger.error(f\"ä¿å­˜æ’è¡Œæ¦œå¤±è´¥: {str(e)}\")\n  2932â†’\n  2933â†’def update_leaderboard(records: List[Dict[str, Any]],\n  2934â†’                      new_record: Dict[str, Any]) -> List[Dict[str, Any]]:\n  2935â†’    records = list(records)\n  2936â†’    records.append(new_record)\n  2937â†’    records.sort(key=lambda r: float(r.get(\"scores\", {}).get(\"cs\", 0.0)), reverse=True)\n  2938â†’    return records[:6]\n  2939â†’\n  2940â†’# ---------------- å›¾å½¢åŒ–æ˜¾ç¤ºå·¥å…· ----------------\n  2941â†’def create_optical_performance_plot(params, scores):\n  2942â†’    \"\"\"åˆ›å»ºå…‰å­¦æ€§èƒ½å›¾å½¢åŒ–æ˜¾ç¤º\"\"\"\n  2943â†’    # åˆ›å»ºä¸€ä¸ªç®€å•çš„å›¾å½¢åŒ–è¡¨ç¤º\n  2944â†’    # å®é™…åº”ç”¨ä¸­å¯ä»¥ä½¿ç”¨æ›´å¤æ‚çš„ç»˜å›¾åº“\n  2945â†’    width, height = 400, 300\n  2946â†’    image = Image.new('RGB', (width, height), COLORS[\"primary_dark\"])\n  2947â†’    draw = ImageDraw.Draw(image)\n  2948â†’\n  2949â†’    # ç»˜åˆ¶äº®åº¦ã€ç«å½©ã€é—ªåº¦çš„æŸ±çŠ¶å›¾\n  2950â†’    brightness = float(scores[\"brightness\"])\n  2951â†’    fire = float(scores[\"fire\"])\n  2952â†’    scint = float(scores[\"scint\"])\n  2953â†’\n  2954â†’    bar_width = 50\n  2955â†’    x1 = 50\n  2956â†’    x2 = 150\n  2957â†’    x3 = 250\n  2958â†’    y_base = 250\n  2959â†’\n  2960â†’    # ç»˜åˆ¶äº®åº¦æŸ±\n  2961â†’    draw.rectangle([x1, y_base - brightness * 20, x1 + bar_width, y_base],\n  2962â†’                   fill=COLORS[\"success_green\"])\n  2963â†’    draw.text([x1 + 10, y_base - brightness * 20 - 20], f\"B: {brightness:.2f}\",\n  2964â†’              fill=COLORS[\"text_primary\"])\n  2965â†’\n  2966â†’    # ç»˜åˆ¶ç«å½©æŸ±\n  2967â†’    draw.rectangle([x2, y_base - fire * 20, x2 + bar_width, y_base],\n  2968â†’                   fill=COLORS[\"warning_orange\"])\n  2969â†’    draw.text([x2 + 10, y_base - fire * 20 - 20], f\"F: {fire:.2f}\",\n  2970â†’              fill=COLORS[\"text_primary\"])\n  2971â†’\n  2972â†’    # ç»˜åˆ¶é—ªåº¦æŸ±\n  2973â†’    draw.rectangle([x3, y_base - scint * 20, x3 + bar_width, y_base],\n  2974â†’                   fill=COLORS[\"accent_blue\"])\n  2975â†’    draw.text([x3 + 10, y_base - scint * 20 - 20], f\"S: {scint:.2f}\",\n  2976â†’              fill=COLORS[\"text_primary\"])\n  2977â†’\n  2978â†’    # ç»˜åˆ¶æ ‡é¢˜\n  2979â†’    try:\n  2980â†’        font = ImageFont.truetype(\"arial.ttf\", 16)\n  2981â†’    except:\n  2982â†’        font = ImageFont.load_default()\n  2983â†’    draw.text([100, 20], \"å…‰å­¦æ€§èƒ½æŒ‡æ ‡\", fill=COLORS[\"text_primary\"], font=font)\n  2984â†’\n  2985â†’    return ImageTk.PhotoImage(image)\n  2986â†’\n  2987â†’# ---------------- ğŸ–¥ï¸ å…¨ä¸–ç•Œæœ€ç¾è§‚é’»çŸ³è¯„ä¼°GUIç•Œé¢ ğŸ–¥ï¸ ----------------\n  2988â†’# é”™è¯¯å¤„ç†è£…é¥°å™¨\n  2989â†’def handle_gui_errors(func):\n  2990â†’    \"\"\"GUIæ–¹æ³•é”™è¯¯å¤„ç†è£…é¥°å™¨\"\"\"\n  2991â†’    def wrapper(self, *args, **kwargs):\n  2992â†’        try:\n  2993â†’            return func(self, *args, **kwargs)\n  2994â†’        except Exception as e:\n  2995â†’            error_msg = f\"æ“ä½œå¤±è´¥: {str(e)}\"\n  2996â†’            print(f\"ERROR in {func.__name__}: {e}\")\n  2997â†’            try:\n  2998â†’                if hasattr(self, 'root'):\n  2999â†’                    messagebox.showerror(\"é”™è¯¯\", error_msg)\n  3000â†’            except:\n  3001â†’                print(f\"CRITICAL ERROR: Could not show error dialog: {e}\")\n  3002â†’            return None\n  3003â†’    return wrapper\n  3004â†’\n  3005â†’def handle_visualization_errors(func):\n  3006â†’    \"\"\"å¯è§†åŒ–æ–¹æ³•é”™è¯¯å¤„ç†è£…é¥°å™¨\"\"\"\n  3007â†’    def wrapper(self, *args, **kwargs):\n  3008â†’        try:\n  3009â†’            return func(self, *args, **kwargs)\n  3010â†’        except Exception as e:            return None\n  3011â†’    return wrapper\n  3012â†’\n  3013â†’class DiamondApp:\n  3014â†’    \"\"\"ğŸ’ å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„é’»çŸ³å…‰å­¦æ€§èƒ½é‡å­çº§ç²¾å¯†è¯„ä¼°ç³»ç»Ÿ - GUIç•Œé¢\n  3015â†’    ğŸ¨ é‡‡ç”¨ç°ä»£åŒ–æš—è‰²ä¸»é¢˜è®¾è®¡ï¼Œæä¾›æè‡´ç”¨æˆ·ä½“éªŒ\n  3016â†’    ğŸ“Š é›†æˆ3Då¯è§†åŒ–ã€å®æ—¶åŠ¨ç”»ã€äº¤äº’å¼å›¾è¡¨\n  3017â†’    ğŸŒˆ å®Œæ•´ä¸­æ–‡ç•Œé¢ï¼Œç›´è§‚æ“ä½œï¼Œä¸“ä¸šçº§å±•ç¤º\n  3018â†’    \"\"\"\n  3019â†’\n  3020â†’    def __init__(self, root: tk.Tk) -> None:\n  3021â†’        self.root = root\n  3022â†’        self.root.title(\"ğŸ”·ğŸ’ é’»çŸ³å…‰å­¦æ€§èƒ½é‡å­çº§ç²¾å¯†è¯„ä¼°ç³»ç»Ÿ - ä½œè€…ï¼šæ—å°å…” ğŸ’ğŸ”·\")\n  3023â†’        self.root.geometry(\"1600x1000\")  # æ‰©å¤§çª—å£ä»¥å®¹çº³æ›´å¤šå¯è§†åŒ–å†…å®¹\n  3024â†’        self.root.minsize(1200, 800)  # è®¾ç½®æœ€å°çª—å£å°ºå¯¸\n  3025â†’\n  3026â†’        # è®¾ç½®çª—å£å›¾æ ‡å’Œæ ·å¼\n  3027â†’        try:\n  3028â†’            # è®¾ç½®åº”ç”¨å›¾æ ‡ï¼ˆå¦‚æœæœ‰å›¾æ ‡æ–‡ä»¶ï¼‰\n  3029â†’            self.root.iconbitmap(\"diamond.ico\")\n  3030â†’        except:\n  3031â†’            pass  # å¦‚æœæ²¡æœ‰å›¾æ ‡æ–‡ä»¶ï¼Œå¿½ç•¥é”™è¯¯\n  3032â†’\n  3033â†’        # è®¾ç½®çª—å£å±…ä¸­\n  3034â†’        self.center_window()\n  3035â†’\n  3036â†’        self.calib_cfg = load_calibration()\n  3037â†’        self.calibrator = PhysicalCalibrator(self.calib_cfg)\n  3038â†’        self.records: List[Dict[str, Any]] = load_leaderboard()\n  3039â†’\n  3040â†’        # çº¿ç¨‹ç›¸å…³\n  3041â†’        self.result_queue = queue.Queue()\n  3042â†’        self.is_calculating = False\n  3043â†’        self.calculation_thread = None\n  3044â†’        self.calculation_cancel_flag = threading.Event()\n  3045â†’\n  3046â†’        # å¯è§†åŒ–ç›¸å…³\n  3047â†’        self.current_diamond_params = {}\n  3048â†’        self.visualization_mode = \"3d_render\"  # é»˜è®¤3Dæ¸²æŸ“æ¨¡å¼\n  3049â†’        self.animation_running = False\n  3050â†’        self.animation_thread = None\n  3051â†’\n  3052â†’        self._build_ui()\n  3053â†’        self._refresh_leaderboard()\n  3054â†’        self._update_baseline_label()\n  3055â†’        self._fill_calib_ui()\n  3056â†’\n  3057â†’        # å®šæœŸæ£€æŸ¥ç»“æœé˜Ÿåˆ—\n  3058â†’        self.root.after(100, self.check_queue)\n  3059â†’\n  3060â†’        # æ˜¾ç¤ºç‰ˆæƒå£°æ˜å¼¹çª—\n  3061â†’        self.root.after(500, self._show_copyright_splash)\n  3062â†’\n  3063â†’    def center_window(self):\n  3064â†’        \"\"\"ğŸ’ çª—å£å±…ä¸­æ˜¾ç¤ºæ–¹æ³•\"\"\"\n  3065â†’        self.root.update_idletasks()\n  3066â†’        width = self.root.winfo_width()\n  3067â†’        height = self.root.winfo_height()\n  3068â†’        x = (self.root.winfo_screenwidth() // 2) - (width // 2)\n  3069â†’        y = (self.root.winfo_screenheight() // 2) - (height // 2)\n  3070â†’        self.root.geometry(f'{width}x{height}+{x}+{y}')\n  3071â†’\n  3072â†’    # ---------- ğŸ¨ å…¨æ–°UIæ„å»ºç³»ç»Ÿ ----------\n  3073â†’    def _build_ui(self) -> None:\n  3074â†’        \"\"\"ğŸ”¥ æ„å»ºå…¨ä¸–ç•Œæœ€ç¾è§‚çš„é’»çŸ³è¯„ä¼°ç•Œé¢\"\"\"\n  3075â†’        style = ttk.Style()\n  3076â†’        style.theme_use(\"clam\")\n  3077â†’\n  3078â†’        # ğŸŒˆ å…¨æ–°çš„ç°ä»£åŒ–æ ·å¼é…ç½®\n  3079â†’        style.configure(\".\",\n  3080â†’                      font=(\"å¾®è½¯é›…é»‘\", 11),\n  3081â†’                      background=COLORS[\"primary_dark\"],\n  3082â†’                      relief=\"flat\")\n  3083â†’        style.configure(\"TFrame\",\n  3084â†’                      background=COLORS[\"primary_dark\"],\n  3085â†’                      relief=\"flat\",\n  3086â†’                      borderwidth=0)\n  3087â†’\n  3088â†’        # ğŸ“± ç°ä»£åŒ–æ ‡ç­¾æ ·å¼\n  3089â†’        style.configure(\"TLabel\",\n  3090â†’                      background=COLORS[\"primary_dark\"],\n  3091â†’                      foreground=COLORS[\"text_primary\"],\n  3092â†’                      font=(\"å¾®è½¯é›…é»‘\", 11))\n  3093â†’        style.configure(\"Title.TLabel\",\n  3094â†’                      background=COLORS[\"primary_dark\"],\n  3095â†’                      foreground=COLORS[\"text_primary\"],\n  3096â†’                      font=(\"å¾®è½¯é›…é»‘\", 16, \"bold\"))\n  3097â†’        style.configure(\"Subtitle.TLabel\",\n  3098â†’                      background=COLORS[\"primary_dark\"],\n  3099â†’                      foreground=COLORS[\"text_secondary\"],\n  3100â†’                      font=(\"å¾®è½¯é›…é»‘\", 12))\n  3101â†’        style.configure(\"Hint.TLabel\",\n  3102â†’                      foreground=COLORS[\"text_hint\"],\n  3103â†’                      font=(\"å¾®è½¯é›…é»‘\", 9),\n  3104â†’                      background=COLORS[\"primary_dark\"])\n  3105â†’        style.configure(\"Accent.TLabel\",\n  3106â†’                      foreground=COLORS[\"accent_blue\"],\n  3107â†’                      font=(\"å¾®è½¯é›…é»‘\", 12, \"bold\"),\n  3108â†’                      background=COLORS[\"primary_dark\"])\n  3109â†’        style.configure(\"Success.TLabel\",\n  3110â†’                      foreground=COLORS[\"success_green\"],\n  3111â†’                      font=(\"å¾®è½¯é›…é»‘\", 11, \"bold\"),\n  3112â†’                      background=COLORS[\"primary_dark\"])\n  3113â†’        style.configure(\"Warning.TLabel\",\n  3114â†’                      foreground=COLORS[\"warning_orange\"],\n  3115â†’                      font=(\"å¾®è½¯é›…é»‘\", 11, \"bold\"),\n  3116â†’                      background=COLORS[\"primary_dark\"])\n  3117â†’        style.configure(\"Error.TLabel\",\n  3118â†’                      foreground=COLORS[\"error_red\"],\n  3119â†’                      font=(\"å¾®è½¯é›…é»‘\", 11, \"bold\"),\n  3120â†’                      background=COLORS[\"primary_dark\"])\n  3121â†’\n  3122â†’        # ğŸ¯ ç°ä»£åŒ–è¾“å…¥æ¡†æ ·å¼\n  3123â†’        style.configure(\"TEntry\",\n  3124â†’                       fieldbackground=COLORS[\"tertiary_dark\"],\n  3125â†’                       foreground=COLORS[\"text_primary\"],\n  3126â†’                       insertcolor=COLORS[\"accent_blue\"],\n  3127â†’                       borderwidth=2,\n  3128â†’                       relief=\"solid\",\n  3129â†’                       font=(\"å¾®è½¯é›…é»‘\", 11),\n  3130â†’                       padding=5)\n  3131â†’        style.map(\"TEntry\",\n  3132â†’                 fieldbackground=[(\"focus\", COLORS[\"secondary_dark\"])],\n  3133â†’                 bordercolor=[(\"focus\", COLORS[\"accent_blue\"])],\n  3134â†’                 foreground=[(\"focus\", COLORS[\"text_primary\"])])\n  3135â†’\n  3136â†’        # ğŸ”˜ ç°ä»£åŒ–æŒ‰é’®æ ·å¼\n  3137â†’        style.configure(\"TButton\",\n  3138â†’                       background=COLORS[\"accent_blue\"],\n  3139â†’                       foreground=COLORS[\"text_primary\"],\n  3140â†’                       padding=12,\n  3141â†’                       borderwidth=0,\n  3142â†’                       relief=\"flat\",\n  3143â†’                       font=(\"å¾®è½¯é›…é»‘\", 11, \"bold\"),\n  3144â†’                       focuscolor=\"none\")\n  3145â†’        style.map(\"TButton\",\n  3146â†’                 background=[(\"active\", COLORS[\"secondary_dark\"]),\n  3147â†’                           (\"pressed\", BUTTON_STATES[\"pressed\"])],\n  3148â†’                 foreground=[(\"active\", COLORS[\"text_primary\"])])\n  3149â†’\n  3150â†’        # ğŸ¨ ç°ä»£åŒ–æŒ‰é’®å˜ä½“æ ·å¼\n  3151â†’        style.configure(\"Success.TButton\",\n  3152â†’                       background=COLORS[\"success_green\"],\n  3153â†’                       foreground=COLORS[\"text_primary\"])\n  3154â†’        style.map(\"Success.TButton\",\n  3155â†’                 background=[(\"active\", \"#229954\"),\n  3156â†’                           (\"pressed\", \"#1e8449\")])\n  3157â†’\n  3158â†’        style.configure(\"Warning.TButton\",\n  3159â†’                       background=COLORS[\"warning_orange\"],\n  3160â†’                       foreground=COLORS[\"text_primary\"])\n  3161â†’        style.map(\"Warning.TButton\",\n  3162â†’                 background=[(\"active\", \"#d68910\"),\n  3163â†’                           (\"pressed\", \"#ca6f1e\")])\n  3164â†’\n  3165â†’        style.configure(\"Danger.TButton\",\n  3166â†’                       background=COLORS[\"error_red\"],\n  3167â†’                       foreground=COLORS[\"text_primary\"])\n  3168â†’        style.map(\"Danger.TButton\",\n  3169â†’                 background=[(\"active\", \"#c0392b\"),\n  3170â†’                           (\"pressed\", \"#a93226\")])\n  3171â†’\n  3172â†’        # ğŸ“Š ç°ä»£åŒ–è¡¨æ ¼æ ·å¼\n  3173â†’        style.configure(\"Treeview\",\n  3174â†’                       background=COLORS[\"secondary_dark\"],\n  3175â†’                       fieldbackground=COLORS[\"secondary_dark\"],\n  3176â†’                       foreground=COLORS[\"text_primary\"],\n  3177â†’                       rowheight=28,\n  3178â†’                       borderwidth=1,\n  3179â†’                       relief=\"solid\",\n  3180â†’                       font=(\"å¾®è½¯é›…é»‘\", 10))\n  3181â†’        style.configure(\"Treeview.Heading\",\n  3182â†’                       background=COLORS[\"accent_blue\"],\n  3183â†’                       foreground=COLORS[\"text_primary\"],\n  3184â†’                       font=(\"å¾®è½¯é›…é»‘\", 11, \"bold\"),\n  3185â†’                       relief=\"flat\",\n  3186â†’                       borderwidth=1)\n  3187â†’        style.map(\"Treeview\",\n  3188â†’                 background=[(\"selected\", COLORS[\"tertiary_dark\"])],\n  3189â†’                 foreground=[(\"selected\", COLORS[\"text_primary\"])])\n  3190â†’\n  3191â†’        # ğŸ“ˆ ç°ä»£åŒ–è¿›åº¦æ¡æ ·å¼\n  3192â†’        style.configure(\"TProgressbar\",\n  3193â†’                       background=COLORS[\"accent_blue\"],\n  3194â†’                       troughcolor=COLORS[\"secondary_dark\"],\n  3195â†’                       borderwidth=0,\n  3196â†’                       lightcolor=COLORS[\"accent_blue\"],\n  3197â†’                       darkcolor=COLORS[\"accent_blue\"])\n  3198â†’\n  3199â†’        # ğŸ¯ ç°ä»£åŒ–æ ‡ç­¾é¡µæ ·å¼\n  3200â†’        style.configure(\"TNotebook\",\n  3201â†’                       background=COLORS[\"primary_dark\"],\n  3202â†’                       borderwidth=0)\n  3203â†’        style.configure(\"TNotebook.Tab\",\n  3204â†’                       background=COLORS[\"secondary_dark\"],\n  3205â†’                       foreground=COLORS[\"text_primary\"],\n  3206â†’                       padding=[20, 10],\n  3207â†’                       font=(\"å¾®è½¯é›…é»‘\", 11, \"bold\"))\n  3208â†’        style.map(\"TNotebook.Tab\",\n  3209â†’                 background=[(\"selected\", COLORS[\"accent_blue\"])],\n  3210â†’                 foreground=[(\"selected\", COLORS[\"text_primary\"])])\n  3211â†’\n  3212â†’        # ğŸ¨ ç°ä»£åŒ–æ¡†æ¶æ ·å¼\n  3213â†’        style.configure(\"TLabelframe\",\n  3214â†’                       background=COLORS[\"primary_dark\"],\n  3215â†’                       foreground=COLORS[\"text_primary\"],\n  3216â†’                       borderwidth=2,\n  3217â†’                       relief=\"solid\",\n  3218â†’                       font=(\"å¾®è½¯é›…é»‘\", 11, \"bold\"))\n  3219â†’        style.configure(\"TLabelframe.Label\",\n  3220â†’                       background=COLORS[\"primary_dark\"],\n  3221â†’                       foreground=COLORS[\"accent_blue\"],\n  3222â†’                       font=(\"å¾®è½¯é›…é»‘\", 12, \"bold\"))\n  3223â†’\n  3224â†’        self._create_main_layout()\n  3225â†’\n  3226â†’    def _create_main_layout(self):\n  3227â†’        \"\"\"ğŸ’ åˆ›å»ºä¸»å¸ƒå±€\"\"\"\n  3228â†’        # ä¸»å®¹å™¨\n  3229â†’        main_container = ttk.Frame(self.root, style=\"TFrame\")\n  3230â†’        main_container.pack(fill=\"both\", expand=True, padx=10, pady=10)\n  3231â†’\n  3232â†’        # ğŸ† é¡¶éƒ¨æ ‡é¢˜åŒºåŸŸ\n  3233â†’        self._create_header_section(main_container)\n  3234â†’\n  3235â†’        # ğŸ“Š ä¸»è¦å†…å®¹åŒºåŸŸ - ä½¿ç”¨æ ‡ç­¾é¡µç»„ç»‡\n  3236â†’        self._create_main_notebook(main_container)\n  3237â†’\n  3238â†’        # ğŸ¯ åº•éƒ¨çŠ¶æ€æ \n  3239â†’        self._create_status_bar(main_container)\n  3240â†’\n  3241â†’    def _create_header_section(self, parent):\n  3242â†’        \"\"\"ğŸŒŸ åˆ›å»ºé¡¶éƒ¨æ ‡é¢˜åŒºåŸŸ\"\"\"\n  3243â†’        header_frame = ttk.Frame(parent, style=\"TFrame\")\n  3244â†’        header_frame.pack(fill=\"x\", pady=(0, 10))\n  3245â†’\n  3246â†’        # ä¸»æ ‡é¢˜\n  3247â†’        title_label = ttk.Label(\n  3248â†’            header_frame,\n  3249â†’            text=\"ğŸ”·ğŸ’ é’»çŸ³å…‰å­¦æ€§èƒ½é‡å­çº§ç²¾å¯†è¯„ä¼°ç³»ç»Ÿ ğŸ’ğŸ”·\",\n  3250â†’            style=\"Title.TLabel\"\n  3251â†’        )\n  3252â†’        title_label.pack(pady=(0, 5))\n  3253â†’\n  3254â†’        # å‰¯æ ‡é¢˜\n  3255â†’        subtitle_label = ttk.Label(\n  3256â†’            header_frame,\n  3257â†’            text=\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„é’»çŸ³ç§‘å­¦è®¡ç®—å¼•æ“ | ä½œè€…ï¼šæ—å°å…”\",\n  3258â†’            style=\"Subtitle.TLabel\"\n  3259â†’        )\n  3260â†’        subtitle_label.pack(pady=(0, 10))\n  3261â†’\n  3262â†’        # åŸºå‡†é’»ä¿¡æ¯æ \n  3263â†’        self.lbl_baseline = ttk.Label(\n  3264â†’            header_frame,\n  3265â†’            text=\"\",\n  3266â†’            style=\"Hint.TLabel\",\n  3267â†’            padding=10\n  3268â†’        )\n  3269â†’        self.lbl_baseline.pack(fill=\"x\", pady=(5, 0))\n  3270â†’\n  3271â†’    def _create_main_notebook(self, parent):\n  3272â†’        \"\"\"ğŸ“š åˆ›å»ºä¸»æ ‡ç­¾é¡µ\"\"\"\n  3273â†’        notebook = ttk.Notebook(parent)\n  3274â†’        notebook.pack(fill=\"both\", expand=True, pady=(0, 10))\n  3275â†’\n  3276â†’        # ğŸ¯ å‚æ•°è¾“å…¥æ ‡ç­¾é¡µ\n  3277â†’        self._create_input_tab(notebook)\n  3278â†’\n  3279â†’        # ğŸ“Š ç»“æœå±•ç¤ºæ ‡ç­¾é¡µ\n  3280â†’        self._create_results_tab(notebook)\n  3281â†’\n  3282â†’        # ğŸ“ˆ å¯è§†åŒ–åˆ†ææ ‡ç­¾é¡µ\n  3283â†’        self._create_visualization_tab(notebook)\n  3284â†’\n  3285â†’        # ğŸ† æ’è¡Œæ¦œæ ‡ç­¾é¡µ\n  3286â†’        self._create_leaderboard_tab(notebook)\n  3287â†’\n  3288â†’        # âš™ï¸ é«˜çº§è®¾ç½®æ ‡ç­¾é¡µ\n  3289â†’        self._create_settings_tab(notebook)\n  3290â†’\n  3291â†’    def _create_input_tab(self, notebook):\n  3292â†’        \"\"\"ğŸ“ åˆ›å»ºå‚æ•°è¾“å…¥æ ‡ç­¾é¡µ\"\"\"\n  3293â†’        input_frame = ttk.Frame(notebook, style=\"TFrame\")\n  3294â†’        notebook.add(input_frame, text=\"ğŸ”· å‚æ•°è¾“å…¥\")\n  3295â†’\n  3296â†’        # å·¦å³åˆ†æ å¸ƒå±€\n  3297â†’        left_frame = ttk.Frame(input_frame, style=\"TFrame\")\n  3298â†’        left_frame.pack(side=\"left\", fill=\"y\", padx=(10, 5), pady=10)\n  3299â†’\n  3300â†’        right_frame = ttk.Frame(input_frame, style=\"TFrame\")\n  3301â†’        right_frame.pack(side=\"right\", fill=\"both\", expand=True, padx=(5, 10), pady=10)\n  3302â†’\n  3303â†’        # ğŸ“‹ é’»çŸ³åŸºæœ¬ä¿¡æ¯è¾“å…¥\n  3304â†’        self._create_basic_info_input(left_frame)\n  3305â†’\n  3306â†’        # ğŸ”§ é«˜çº§å‚æ•°è¾“å…¥\n  3307â†’        self._create_advanced_params_input(left_frame)\n  3308â†’\n  3309â†’        # ğŸ¯ æ“ä½œæŒ‰é’®åŒºåŸŸ\n  3310â†’        self._create_action_buttons(left_frame)\n  3311â†’\n  3312â†’        # âš¡ å¿«é€Ÿæ“ä½œåŒºåŸŸ\n  3313â†’        self._create_quick_actions(left_frame)\n  3314â†’\n  3315â†’        # âš™ï¸ æ ‡å®šè®¾ç½®åŒºåŸŸ\n  3316â†’        self._create_calibration_settings(right_frame)\n  3317â†’\n  3318â†’    def _create_results_tab(self, notebook):\n  3319â†’        \"\"\"ğŸ“Š åˆ›å»ºç»“æœå±•ç¤ºæ ‡ç­¾é¡µ\"\"\"\n  3320â†’        results_frame = ttk.Frame(notebook, style=\"TFrame\")\n  3321â†’        notebook.add(results_frame, text=\"ğŸ“ˆ è¯„ä¼°ç»“æœ\")\n  3322â†’\n  3323â†’        # åˆ†å±å¸ƒå±€ï¼šå·¦ä¾§æ˜¾ç¤ºè¯„åˆ†ï¼Œå³ä¾§æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯\n  3324â†’        scores_frame = ttk.Frame(results_frame, style=\"TFrame\")\n  3325â†’        scores_frame.pack(side=\"left\", fill=\"y\", padx=(10, 5), pady=10)\n  3326â†’\n  3327â†’        detail_frame = ttk.Frame(results_frame, style=\"TFrame\")\n  3328â†’        detail_frame.pack(side=\"right\", fill=\"both\", expand=True, padx=(5, 10), pady=10)\n  3329â†’\n  3330â†’        # ğŸ† è¯„åˆ†æ˜¾ç¤ºåŒºåŸŸ\n  3331â†’        self._create_scores_display(scores_frame)\n  3332â†’\n  3333â†’        # ğŸ“‹ è¯¦ç»†åˆ†æåŒºåŸŸ\n  3334â†’        self._create_detail_analysis(detail_frame)\n  3335â†’\n  3336â†’    def _create_visualization_tab(self, notebook):\n  3337â†’        \"\"\"ğŸ¨ åˆ›å»ºå¯è§†åŒ–åˆ†ææ ‡ç­¾é¡µ\"\"\"\n  3338â†’        viz_frame = ttk.Frame(notebook, style=\"TFrame\")\n  3339â†’        notebook.add(viz_frame, text=\"ğŸŒˆ å¯è§†åŒ–åˆ†æ\")\n  3340â†’\n  3341â†’        # å¯è§†åŒ–æ§åˆ¶é¢æ¿\n  3342â†’        control_frame = ttk.Frame(viz_frame, style=\"TFrame\")\n  3343â†’        control_frame.pack(side=\"left\", fill=\"y\", padx=(10, 5), pady=10)\n  3344â†’\n  3345â†’        # ä¸»å¯è§†åŒ–åŒºåŸŸ\n  3346â†’        main_viz_frame = ttk.Frame(viz_frame, style=\"TFrame\")\n  3347â†’        main_viz_frame.pack(side=\"right\", fill=\"both\", expand=True, padx=(5, 10), pady=10)\n  3348â†’\n  3349â†’        # ğŸ® å¯è§†åŒ–æ§åˆ¶\n  3350â†’        self._create_visualization_controls(control_frame)\n  3351â†’\n  3352â†’        # ğŸ¨ ä¸»å¯è§†åŒ–ç”»å¸ƒ\n  3353â†’        self._create_main_visualization(main_viz_frame)\n  3354â†’\n  3355â†’    def _create_leaderboard_tab(self, notebook):\n  3356â†’        \"\"\"ğŸ† åˆ›å»ºæ’è¡Œæ¦œæ ‡ç­¾é¡µ\"\"\"\n  3357â†’        leaderboard_frame = ttk.Frame(notebook, style=\"TFrame\")\n  3358â†’        notebook.add(leaderboard_frame, text=\"ğŸ¥‡ å†å²è®°å½•\")\n  3359â†’\n  3360â†’        # æ’è¡Œæ¦œæ§åˆ¶æŒ‰é’®\n  3361â†’        control_frame = ttk.Frame(leaderboard_frame, style=\"TFrame\")\n  3362â†’        control_frame.pack(fill=\"x\", padx=10, pady=(10, 5))\n  3363â†’\n  3364â†’        # ä¸»æ’è¡Œæ¦œåŒºåŸŸ\n  3365â†’        main_frame = ttk.Frame(leaderboard_frame, style=\"TFrame\")\n  3366â†’        main_frame.pack(fill=\"both\", expand=True, padx=10, pady=(5, 10))\n  3367â†’\n  3368â†’        # ğŸ® æ’è¡Œæ¦œæ§åˆ¶\n  3369â†’        self._create_leaderboard_controls(control_frame)\n  3370â†’\n  3371â†’        # ğŸ“Š æ’è¡Œæ¦œè¡¨æ ¼\n  3372â†’        self._create_leaderboard_table(main_frame)\n  3373â†’\n  3374â†’    def _create_settings_tab(self, notebook):\n  3375â†’        \"\"\"âš™ï¸ åˆ›å»ºé«˜çº§è®¾ç½®æ ‡ç­¾é¡µ\"\"\"\n  3376â†’        settings_frame = ttk.Frame(notebook, style=\"TFrame\")\n  3377â†’        notebook.add(settings_frame, text=\"âš™ï¸ é«˜çº§è®¾ç½®\")\n  3378â†’\n  3379â†’        # åˆ›å»ºæ»šåŠ¨åŒºåŸŸ\n  3380â†’        canvas = tk.Canvas(settings_frame, bg=COLORS[\"primary_dark\"], highlightthickness=0)\n  3381â†’        scrollbar = ttk.Scrollbar(settings_frame, orient=\"vertical\", command=canvas.yview)\n  3382â†’        scrollable_frame = ttk.Frame(canvas, style=\"TFrame\")\n  3383â†’\n  3384â†’        scrollable_frame.bind(\n  3385â†’            \"<Configure>\",\n  3386â†’            lambda e: canvas.configure(scrollregion=canvas.bbox(\"all\"))\n  3387â†’        )\n  3388â†’\n  3389â†’        canvas.create_window((0, 0), window=scrollable_frame, anchor=\"nw\")\n  3390â†’        canvas.configure(yscrollcommand=scrollbar.set)\n  3391â†’\n  3392â†’        # ğŸ›ï¸ å„ç§è®¾ç½®é€‰é¡¹\n  3393â†’        self._create_computation_settings(scrollable_frame)\n  3394â†’        self._create_visualization_settings(scrollable_frame)\n  3395â†’        self._create_export_settings(scrollable_frame)\n  3396â†’        self._create_about_section(scrollable_frame)\n  3397â†’\n  3398â†’        canvas.pack(side=\"left\", fill=\"both\", expand=True)\n  3399â†’        scrollbar.pack(side=\"right\", fill=\"y\")\n  3400â†’\n  3401â†’    def _create_status_bar(self, parent):\n  3402â†’        \"\"\"ğŸ“Š åˆ›å»ºåº•éƒ¨çŠ¶æ€æ \"\"\"\n  3403â†’        status_frame = ttk.Frame(parent, style=\"TFrame\")\n  3404â†’        status_frame.pack(fill=\"x\", pady=(5, 0))\n  3405â†’\n  3406â†’        # çŠ¶æ€ä¿¡æ¯\n  3407â†’        self.status_label = ttk.Label(\n  3408â†’            status_frame,\n  3409â†’            text=\"âœ¨ ç³»ç»Ÿå°±ç»ª | å…¨ä¸–ç•Œæœ€å¼ºé’»çŸ³è¯„ä¼°å¼•æ“è¿è¡Œä¸­\",\n  3410â†’            style=\"Hint.TLabel\"\n  3411â†’        )\n  3412â†’        self.status_label.pack(side=\"left\", padx=10)\n  3413â†’\n  3414â†’        # ç‰ˆæœ¬ä¿¡æ¯\n  3415â†’        version_label = ttk.Label(\n  3416â†’            status_frame,\n  3417â†’            text=\"v2.0 é‡å­çº§ç²¾å¯†ç‰ˆ | ä½œè€…ï¼šæ—å°å…”\",\n  3418â†’            style=\"Hint.TLabel\"\n  3419â†’        )\n  3420â†’        version_label.pack(side=\"right\", padx=10)\n  3421â†’\n  3422â†’        # è¿›åº¦æ¡ï¼ˆåˆå§‹éšè—ï¼‰\n  3423â†’        self.progress = ttk.Progressbar(\n  3424â†’            status_frame,\n  3425â†’            orient=\"horizontal\",\n  3426â†’            length=200,\n  3427â†’            mode=\"determinate\",\n  3428â†’            style=\"TProgressbar\"\n  3429â†’        )\n  3430â†’        # ä½¿ç”¨packè€Œä¸æ˜¯gridï¼Œé¿å…å‡ ä½•ç®¡ç†å™¨å†²çª\n  3431â†’        self.progress.pack(side=\"right\", padx=10)  # éœ€è¦æ—¶å†æ˜¾ç¤º\n  3432â†’    def _update_baseline_label(self) -> None:\n  3433â†’        cfg = self.calib_cfg\n  3434â†’        txt = (\n  3435â†’            f\"å½“å‰åŸºå‡†é’»åˆ‡å·¥ï¼šÎ¸c={float(BASELINE_PARAMS['crown_angle']):.2f}Â°ï¼Œ\"\n  3436â†’            f\"Î¸p={float(BASELINE_PARAMS['pavilion_angle']):.2f}Â°ï¼Œ\"\n  3437â†’            f\"T={float(BASELINE_PARAMS['table_pct']):.2f}% ï¼Œ\"\n  3438â†’            f\"C={float(BASELINE_PARAMS['crown_height_pct']):.2f}% ï¼Œ\"\n  3439â†’            f\"P={float(BASELINE_PARAMS['pavilion_depth_pct']):.2f}% ï¼Œ\"\n  3440â†’            f\"TD={float(BASELINE_PARAMS['total_depth_pct']):.2f}% ï¼Œ\"\n  3441â†’            f\"ct={float(BASELINE_PARAMS['carat']):.4f}ï¼Œ\"\n  3442â†’            f\"D={float(BASELINE_PARAMS['diameter']):.3f} mmï¼›  \"\n  3443â†’            f\"ç›®æ ‡äº®åº¦/ç«å½©/é—ªåº¦ = \"\n  3444â†’            f\"{float(cfg.target_brightness):.2f} / {float(cfg.target_fire):.2f} / {float(cfg.target_scint):.2f}ï¼Œ\"\n  3445â†’            f\"å½“å‰æ•°å€¼æ¨¡å¼ï¼š{'é«˜ç²¾åº¦' if cfg.high_precision else 'æ ‡å‡†'}\"\n  3446â†’        )\n  3447â†’        self.lbl_baseline.config(text=txt)\n  3448â†’\n  3449â†’    def _fill_calib_ui(self) -> None:\n  3450â†’        self.var_calib_B.set(f\"{float(self.calib_cfg.target_brightness):.2f}\")\n  3451â†’        self.var_calib_F.set(f\"{float(self.calib_cfg.target_fire):.2f}\")\n  3452â†’        self.var_calib_S.set(f\"{float(self.calib_cfg.target_scint):.2f}\")\n  3453â†’\n  3454â†’    def _grade_from_op(self, op: Decimal) -> str:\n  3455â†’        if op >= Decimal('9.5'):\n  3456â†’            return \"æä¼˜ EX\"\n  3457â†’        elif op >= Decimal('9.0'):\n  3458â†’            return \"ä¼˜ VG\"\n  3459â†’        elif op >= Decimal('8.0'):\n  3460â†’            return \"è‰¯ Good\"\n  3461â†’        else:\n  3462â†’            return \"ä¸€èˆ¬ Fair\"\n  3463â†’\n  3464â†’    def _calculate_worker(self, params: Dict[str, Decimal], diamond_id: str,\n  3465â†’                         queue: queue.Queue, cancel_flag: threading.Event) -> None:\n  3466â†’        \"\"\"å·¥ä½œçº¿ç¨‹ï¼šæ‰§è¡Œè®¡ç®—ä»»åŠ¡\"\"\"\n  3467â†’        try:\n  3468â†’            if cancel_flag.is_set():\n  3469â†’                queue.put(('canceled',))\n  3470â†’                return\n  3471â†’\n  3472â†’            # å®šä¹‰è¿›åº¦å›è°ƒå‡½æ•°\n  3473â†’            def progress_callback(progress):\n  3474â†’                queue.put(('progress', progress))\n  3475â†’\n  3476â†’            scores, detail = self.calibrator.compute_scores(params, cancel_flag, progress_callback)\n  3477â†’\n  3478â†’            if cancel_flag.is_set():\n  3479â†’                queue.put(('canceled',))\n  3480â†’                return\n  3481â†’\n  3482â†’            queue.put(('success', diamond_id, scores, detail))\n  3483â†’        except Exception as e:\n  3484â†’            logger.error(f\"è®¡ç®—é’»çŸ³ {diamond_id} å¤±è´¥: {str(e)}\", exc_info=True)\n  3485â†’            queue.put(('error', str(e)))\n  3486â†’\n  3487â†’    def check_queue(self) -> None:\n  3488â†’        \"\"\"æ£€æŸ¥ç»“æœé˜Ÿåˆ—å¹¶æ›´æ–°UI\"\"\"\n  3489â†’        try_again = True\n  3490â†’        try:\n  3491â†’            while not self.result_queue.empty():\n  3492â†’                item = self.result_queue.get_nowait()\n  3493â†’                if item[0] == 'success':\n  3494â†’                    _, diamond_id, scores, detail = item\n  3495â†’                    # ä½¿ç”¨afteræ–¹æ³•ç¡®ä¿UIæ›´æ–°åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œ\n  3496â†’                    self.root.after(0, self._update_ui_with_results, diamond_id, scores, detail)\n  3497â†’                elif item[0] == 'error':\n  3498â†’                    _, error_msg = item\n  3499â†’                    self.root.after(0, messagebox.showerror, \"è®¡ç®—é”™è¯¯\", f\"è®¡ç®—è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: {error_msg}\")\n  3500â†’                elif item[0] == 'canceled':\n  3501â†’                    self.root.after(0, messagebox.showinfo, \"å·²å–æ¶ˆ\", \"è®¡ç®—å·²æˆåŠŸå–æ¶ˆ\")\n  3502â†’                elif item[0] == 'progress':\n  3503â†’                    _, progress = item\n  3504â†’                    self.root.after(0, self._update_progress, progress)\n  3505â†’\n  3506â†’                # åœæ­¢è¿›åº¦æ¡\n  3507â†’                if item[0] in ['success', 'error', 'canceled']:\n  3508â†’                    self.root.after(0, self._stop_progress)\n  3509â†’                    try_again = False\n  3510â†’\n  3511â†’        except queue.Empty:\n  3512â†’            pass\n  3513â†’        finally:\n  3514â†’            # ç»§ç»­å®šæœŸæ£€æŸ¥\n  3515â†’            if try_again:\n  3516â†’                self.root.after(100, self.check_queue)\n  3517â†’\n  3518â†’    def _update_progress(self, progress):\n  3519â†’        \"\"\"æ›´æ–°è¿›åº¦æ¡\"\"\"\n  3520â†’        self.progress[\"value\"] = progress\n  3521â†’\n  3522â†’    def _stop_progress(self) -> None:\n  3523â†’        \"\"\"åœæ­¢è¿›åº¦æ¡å¹¶é‡ç½®çŠ¶æ€\"\"\"\n  3524â†’        self.progress.pack_forget()\n  3525â†’        self.progress.stop()\n  3526â†’        self.is_calculating = False\n  3527â†’        self.btn_cancel.config(state=tk.DISABLED)\n  3528â†’        self.calculation_thread = None\n  3529â†’        # å…³é—­ç­‰å¾…çª—å£\n  3530â†’        self._close_waiting_window()\n  3531â†’\n  3532â†’    def _update_ui_with_results(self, diamond_id: str, scores: Dict[str, Decimal],\n  3533â†’                               detail: str) -> None:\n  3534â†’        \"\"\"ç”¨è®¡ç®—ç»“æœæ›´æ–°UIï¼Œæ·»åŠ é¢œè‰²æ ‡è¯†\"\"\"\n  3535â†’        # æ ¹æ®åˆ†æ•°è®¾ç½®é¢œè‰²\n  3536â†’        def get_score_color(score: Decimal) -> str:\n  3537â†’            if score >= Decimal('9.0'):\n  3538â†’                return COLORS[\"success_green\"]\n  3539â†’            elif score >= Decimal('7.0'):\n  3540â†’                return COLORS[\"warning_orange\"]\n  3541â†’            else:\n  3542â†’                return COLORS[\"error_red\"]\n  3543â†’\n  3544â†’        # æ›´æ–°æ˜¾ç¤ºå¹¶è®¾ç½®é¢œè‰²\n  3545â†’        self.lbl_B.config(text=f\"äº®åº¦ Brightnessï¼š{float(scores['brightness']):.2f} / 10\",\n  3546â†’                         foreground=get_score_color(scores['brightness']))\n  3547â†’        self.lbl_F.config(text=f\"ç«å½© ç«å½©ï¼š{float(scores['fire']):.2f} / 10\",\n  3548â†’                         foreground=get_score_color(scores['fire']))\n  3549â†’        self.lbl_S.config(text=f\"é—ªåº¦ é—ªåº¦ï¼š{float(scores['scint']):.2f} / 10\",\n  3550â†’                         foreground=get_score_color(scores['scint']))\n  3551â†’        self.lbl_OP.config(text=f\"ç»¼åˆå…‰å­¦æ€§èƒ½ OPï¼š{float(scores['op']):.2f} / 10\",\n  3552â†’                          foreground=get_score_color(scores['op']))\n  3553â†’        self.lbl_HA.config(text=f\"å…«å¿ƒå…«ç®­å‡ ä½• HAï¼š{float(scores['ha']):.2f} / 100\",\n  3554â†’                          foreground=COLORS[\"success_green\"] if scores['ha'] >= Decimal('95.0') else COLORS[\"text_primary\"])\n  3555â†’        self.lbl_DG.config(text=f\"å‡ ä½•åç¦»åº¦ D_geomï¼š{float(scores['d_geom']):.4f}\",\n  3556â†’                          foreground=COLORS[\"error_red\"] if scores['d_geom'] > Decimal('2.0') else COLORS[\"text_primary\"])\n  3557â†’        self.lbl_CS.config(text=f\"ç»¼åˆç¾è§‚åº¦ CSï¼š{float(scores['cs']):.2f} / 10\",\n  3558â†’                          foreground=get_score_color(scores['cs']))\n  3559â†’\n  3560â†’        grade_txt = self._grade_from_op(scores[\"op\"])\n  3561â†’        self.lbl_grade.config(text=f\"å½“å‰å…‰å­¦ç­‰çº§ï¼š{grade_txt}\",\n  3562â†’                             foreground=COLORS[\"success_green\"] if grade_txt == \"æä¼˜ EX\" else COLORS[\"text_primary\"])\n  3563â†’\n  3564â†’        self.text_detail.delete(\"1.0\", tk.END)\n  3565â†’        self.text_detail.insert(tk.END, detail)\n  3566â†’\n  3567â†’        # æ›´æ–°å…‰å­¦æ€§èƒ½å›¾å½¢åŒ–æ˜¾ç¤º - ä½¿ç”¨ä¼˜åŒ–çš„å¯è§†åŒ–ç³»ç»Ÿ\n  3568â†’        params_for_viz = {k: v for k, v in self.vars_params.items() if v.get()}\n  3569â†’        params_for_viz = {k: Decimal(v.get()) for k, v in params_for_viz.items()}\n  3570â†’\n  3571â†’        # ä¿å­˜å½“å‰å‚æ•°ä¾›å¯è§†åŒ–æ ‡ç­¾é¡µä½¿ç”¨\n  3572â†’        self.current_diamond_params = params_for_viz\n  3573â†’        self.current_diamond_scores = scores\n  3574â†’\n  3575â†’        # è§¦å‘å¯è§†åŒ–æ›´æ–°ï¼ˆå¦‚æœå·²åœ¨å¯è§†åŒ–æ ‡ç­¾é¡µï¼‰\n  3576â†’        try:\n  3577â†’            self._update_visualization_tab(params_for_viz, scores)\n  3578â†’        except Exception as e:            self._update_simple_visualization(params_for_viz, scores)\n  3579â†’\n  3580â†’        rec = {\n  3581â†’            \"diamond_id\": diamond_id,\n  3582â†’            \"timestamp\": datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\"),\n  3583â†’            \"params\": {k: float(v) for k, v in params_for_viz.items()},\n  3584â†’            \"scores\": {k: float(v) for k, v in scores.items()},\n  3585â†’            \"detail\": detail,\n  3586â†’        }\n  3587â†’        self.records = update_leaderboard(self.records, rec)\n  3588â†’        save_leaderboard(self.records)\n  3589â†’        self._refresh_leaderboard()\n  3590â†’\n  3591â†’        messagebox.showinfo(\n  3592â†’            \"è®¡ç®—å®Œæˆ\",\n  3593â†’            f\"é’»çŸ³ {diamond_id} çš„ç»¼åˆç¾è§‚åº¦ CS ä¸º {float(scores['cs']):.2f} / 10ï¼Œ\"\n  3594â†’            f\"OP = {float(scores['op']):.2f}ï¼Œå…‰å­¦ç­‰çº§ï¼š{grade_txt}ã€‚\",\n  3595â†’        )\n  3596â†’\n  3597â†’    def _update_visualization_tab(self, params, scores):\n  3598â†’        \"\"\"æ›´æ–°æ ‡ç­¾é¡µå¯è§†åŒ–æ˜¾ç¤ºï¼ˆä¼˜åŒ–ç‰ˆï¼‰\"\"\"\n  3599â†’        if hasattr(self, 'viz_canvas'):\n  3600â†’            # åªåœ¨å¯è§†åŒ–æ ‡ç­¾é¡µå¯è§æ—¶æ›´æ–°\n  3601â†’            self._update_visualization(params, scores)\n  3602â†’\n  3603â†’    @handle_visualization_errors\n  3604â†’    def _update_simple_visualization(self, params, scores):\n  3605â†’        \"\"\"å¿«é€Ÿç®€åŒ–å¯è§†åŒ–æ˜¾ç¤º\"\"\"\n  3606â†’        if hasattr(self, 'canvas'):\n  3607â†’            # åœ¨ç»“æœå±•ç¤ºç”»å¸ƒä¸Šå¿«é€Ÿæ˜¾ç¤ºæ–‡æœ¬ä¿¡æ¯\n  3608â†’            self.canvas.delete(\"all\")\n  3609â†’\n  3610â†’            # è·å–ç”»å¸ƒå°ºå¯¸\n  3611â†’            canvas_width = self.canvas.winfo_width()\n  3612â†’            canvas_height = self.canvas.winfo_height()\n  3613â†’            if canvas_width <= 1:\n  3614â†’                canvas_width = 400\n  3615â†’            if canvas_height <= 1:\n  3616â†’                canvas_height = 300\n  3617â†’\n  3618â†’            # æ˜¾ç¤ºç®€å•æ–‡æœ¬ä¿¡æ¯\n  3619â†’            self.canvas.create_text(\n  3620â†’                canvas_width // 2, 50,\n  3621â†’                text=\"ğŸ”· é’»çŸ³å…‰å­¦è¯„ä¼°ç»“æœ\",\n  3622â†’                fill=COLORS[\"accent_blue\"],\n  3623â†’                font=(\"å¾®è½¯é›…é»‘\", 14, \"bold\"),\n  3624â†’                anchor=\"center\"\n  3625â†’            )\n  3626â†’\n  3627â†’            # æ˜¾ç¤ºè¯„åˆ†ä¿¡æ¯\n  3628â†’            brightness = float(scores.get('brightness', 0))\n  3629â†’            fire = float(scores.get('fire', 0))\n  3630â†’            scint = float(scores.get('scint', 0))\n  3631â†’            cs = float(scores.get('cs', 0))\n  3632â†’\n  3633â†’            texts = [\n  3634â†’                f\"ğŸ”† äº®åº¦: {brightness:.2f}/10.0\",\n  3635â†’                f\"ğŸ”¥ ç«å½©: {fire:.2f}/10.0\",\n  3636â†’                f\"âœ¨ é—ªåº¦: {scint:.2f}/10.0\",\n  3637â†’                f\"ğŸ’ ç»¼åˆç¾è§‚åº¦: {cs:.2f}/10.0\"\n  3638â†’            ]\n  3639â†’\n  3640â†’            y_pos = 120\n  3641â†’            for text in texts:\n  3642â†’                self.canvas.create_text(\n  3643â†’                    canvas_width // 2, y_pos,\n  3644â†’                    text=text,\n  3645â†’                    fill=COLORS[\"text_primary\"],\n  3646â†’                    font=(\"å¾®è½¯é›…é»‘\", 11),\n  3647â†’                    anchor=\"center\"\n  3648â†’                )\n  3649â†’                y_pos += 30\n  3650â†’\n  3651â†’    def _update_visualization(self, params, scores):\n  3652â†’        \"\"\"æ›´æ–°å…‰å­¦æ€§èƒ½å›¾å½¢åŒ–æ˜¾ç¤º - ç®€åŒ–ç‰ˆ\"\"\"\n  3653â†’        # ä½¿ç”¨ç®€åŒ–å¯è§†åŒ–ï¼Œé¿å…matplotlibçš„æ€§èƒ½é—®é¢˜\n  3654â†’        self._update_simple_visualization(params, scores)\n  3655â†’\n  3656â†’    # ---------- äº‹ä»¶ ----------\n  3657â†’    @handle_gui_errors\n  3658â†’    def on_calc(self) -> None:\n  3659â†’        if self.is_calculating:\n  3660â†’            messagebox.showinfo(\"æç¤º\", \"è®¡ç®—æ­£åœ¨è¿›è¡Œä¸­ï¼Œè¯·ç¨å€™...\")\n  3661â†’            return\n  3662â†’\n  3663â†’        params: Dict[str, Decimal] = {}\n  3664â†’        diamond_id = self.var_id.get().strip()\n  3665â†’        if not diamond_id:\n  3666â†’            diamond_id = f\"BASELINE{len(self.records)+1:04d}\"\n  3667â†’            self.var_id.set(diamond_id)\n  3668â†’        if not diamond_id.isalnum():\n  3669â†’            messagebox.showerror(\"è¾“å…¥é”™è¯¯\", \"é’»çŸ³ç¼–å·åªèƒ½åŒ…å«å­—æ¯å’Œæ•°å­—ã€‚\")\n  3670â†’            return\n  3671â†’        try:\n  3672â†’            for key in self.vars_params:\n  3673â†’                txt = self.vars_params[key].get().strip()\n  3674â†’                if not txt:\n  3675â†’                    if key in BASELINE_PARAMS:\n  3676â†’                        value = BASELINE_PARAMS[key]\n  3677â†’                        self.vars_params[key].set(str(value))\n  3678â†’                    else:\n  3679â†’                        raise ValueError(f\"å‚æ•° {key} ä¸èƒ½ä¸ºç©º\")\n  3680â†’                else:\n  3681â†’                    value = Decimal(txt)\n  3682â†’\n  3683â†’                # æ·»åŠ èŒƒå›´éªŒè¯\n  3684â†’                if key in PARAM_RANGES_VALIDATION:\n  3685â†’                    min_val, max_val = PARAM_RANGES_VALIDATION[key]\n  3686â†’                    if value < min_val or value > max_val:\n  3687â†’                        # ä½¿ç”¨åŸºå‡†å€¼æ›¿æ¢è¶…å‡ºèŒƒå›´çš„å€¼\n  3688â†’                        if key in BASELINE_PARAMS:\n  3689â†’                            value = BASELINE_PARAMS[key]\n  3690â†’                            self.vars_params[key].set(str(value))\n  3691â†’                        else:\n  3692â†’                            raise ValueError(f\"å‚æ•° {key} è¶…å‡ºæœ‰æ•ˆèŒƒå›´ [{min_val}, {max_val}]\")\n  3693â†’\n  3694â†’                params[key] = value\n  3695â†’        except ValueError as e:\n  3696â†’            messagebox.showerror(\"è¾“å…¥é”™è¯¯\", f\"å‚æ•°éªŒè¯å¤±è´¥ï¼š{e}\")\n  3697â†’            return\n  3698â†’\n  3699â†’        # ç¡®ä¿æ‰€æœ‰å¿…éœ€å‚æ•°éƒ½å­˜åœ¨\n  3700â†’        for k in BASELINE_PARAMS.keys():\n  3701â†’            if k not in params:\n  3702â†’                params[k] = BASELINE_PARAMS[k]\n  3703â†’\n  3704â†’        self.progress.pack(fill=tk.X, padx=5, pady=2)\n  3705â†’        self.progress[\"value\"] = 0\n  3706â†’        self.is_calculating = True\n  3707â†’        self.btn_cancel.config(state=tk.NORMAL)\n  3708â†’\n  3709â†’        # é‡ç½®å–æ¶ˆæ ‡å¿—\n  3710â†’        self.calculation_cancel_flag.clear()\n  3711â†’\n  3712â†’        # å¯åŠ¨å·¥ä½œçº¿ç¨‹\n  3713â†’        self.calculation_thread = threading.Thread(\n  3714â†’            target=self._calculate_worker,\n  3715â†’            args=(params, diamond_id, self.result_queue, self.calculation_cancel_flag),\n  3716â†’            daemon=True\n  3717â†’        )\n  3718â†’        # åˆ›å»ºè®¡ç®—ç­‰å¾…çª—å£\n  3719â†’        self._create_calculation_waiting_window()\n  3720â†’\n  3721â†’        self.calculation_thread.start()\n  3722â†’    def _create_calculation_waiting_window(self):\n  3723â†’        \"\"\"ğŸŒŒ åˆ›å»ºå®‡å®™çº§æ— æ•Œè®¡ç®—æ ¸å¿ƒå±•ç¤ºçª—å£ - è¶…è¶ŠåŸå­çº§å‡ ä¸‡å€çš„å¨åŠ›å±•ç¤º ğŸŒŒ\"\"\"\n  3724â†’        # ä½¿ç”¨å®‡å®™çº§åŠ¨ç”»ç³»ç»Ÿåˆ›å»ºæ— æ•Œç­‰å¾…çª—å£\n  3725â†’        self.waiting_window = cosmic_animation.create_cosmic_waiting_window(self.root)\n  3726â†’\n  3727â†’        # å±…ä¸­æ˜¾ç¤º\n  3728â†’        self.waiting_window.update_idletasks()\n  3729â†’        width = self.waiting_window.winfo_width()\n  3730â†’        height = self.waiting_window.winfo_height()\n  3731â†’        x = (self.waiting_window.winfo_screenwidth() // 2) - (width // 2)\n  3732â†’        y = (self.waiting_window.winfo_screenheight() // 2) - (height // 2)\n  3733â†’        self.waiting_window.geometry(f\"+{x}+{y}\")\n  3734â†’\n  3735â†’        # ä¸»å®¹å™¨\n  3736â†’        main_frame = tk.Frame(self.waiting_window, bg=COLORS[\"primary_dark\"])\n  3737â†’        main_frame.pack(fill=\"both\", expand=True, padx=20, pady=20)\n  3738â†’\n  3739â†’        # é¡¶éƒ¨æ ‡é¢˜åŒºåŸŸ\n  3740â†’        header_frame = tk.Frame(main_frame, bg=COLORS[\"primary_dark\"])\n  3741â†’        header_frame.pack(fill=\"x\", pady=(0, 20))\n  3742â†’\n  3743â†’        # ä¸»æ ‡é¢˜\n  3744â†’        title_label = tk.Label(header_frame,\n  3745â†’                              text=\"ğŸš€ å…¨ä¸–ç•Œæœ€å¼ºé’»çŸ³å…‰å­¦è®¡ç®—å¼•æ“\",\n  3746â†’                              font=(\"Microsoft YaHei\", 20, \"bold\"),\n  3747â†’                              fg=COLORS[\"accent_blue\"], bg=COLORS[\"primary_dark\"])\n  3748â†’        title_label.pack(pady=(0, 5))\n  3749â†’\n  3750â†’        # å‰¯æ ‡é¢˜\n  3751â†’        subtitle_label = tk.Label(header_frame,\n  3752â†’                                 text=\"ğŸ”¬ 80ä½è¶…é«˜ç²¾åº¦é‡å­çº§å…‰å­¦ç‰©ç†æ¨¡æ‹Ÿ\",\n  3753â†’                                 font=(\"Microsoft YaHei\", 14),\n  3754â†’                                 fg=COLORS[\"text_secondary\"], bg=COLORS[\"primary_dark\"])\n  3755â†’        subtitle_label.pack()\n  3756â†’\n  3757â†’        # ä¸­é—´å†…å®¹åŒºåŸŸ\n  3758â†’        content_frame = tk.Frame(main_frame, bg=COLORS[\"primary_dark\"])\n  3759â†’        content_frame.pack(fill=\"both\", expand=True)\n  3760â†’\n  3761â†’        # å·¦ä¾§ï¼šé’»çŸ³åŠ¨ç”»\n  3762â†’        left_frame = tk.Frame(content_frame, bg=COLORS[\"primary_dark\"])\n  3763â†’        left_frame.pack(side=\"left\", fill=\"y\", padx=(0, 20))\n  3764â†’\n  3765â†’        self.diamond_canvas = tk.Canvas(left_frame, width=200, height=200,\n  3766â†’                                      bg=COLORS[\"primary_dark\"], highlightthickness=0)\n  3767â†’        self.diamond_canvas.pack(pady=(0, 10))\n  3768â†’\n  3769â†’        # åˆ›å»ºé’»çŸ³å½¢çŠ¶\n  3770â†’        self._create_diamond_animation()\n  3771â†’\n  3772â†’        # å³ä¾§ï¼šæŠ€æœ¯ä¿¡æ¯\n  3773â†’        right_frame = tk.Frame(content_frame, bg=COLORS[\"primary_dark\"])\n  3774â†’        right_frame.pack(side=\"right\", fill=\"both\", expand=True)\n  3775â†’\n  3776â†’        # æŠ€æœ¯è§„æ ¼å±•ç¤º\n  3777â†’        tech_frame = tk.LabelFrame(right_frame, text=\"ğŸ”§ è¶…å¼ºè®¡ç®—æ ¸å¿ƒè§„æ ¼\",\n  3778â†’                                 font=(\"Microsoft YaHei\", 12, \"bold\"),\n  3779â†’                                 fg=COLORS[\"accent_blue\"], bg=COLORS[\"primary_dark\"])\n  3780â†’        tech_frame.pack(fill=\"x\", pady=(0, 15))\n  3781â†’\n  3782â†’        # æŠ€æœ¯è§„æ ¼å†…å®¹\n  3783â†’        tech_specs = [\n  3784â†’            \"âš¡ 80ä½è¶…é«˜ç²¾åº¦æ•°å­¦è¿ç®— (IEEE 754å››ç²¾åº¦)\",\n  3785â†’            \"ğŸ”¥ 10,000+æ¡è’™ç‰¹å¡æ´›å…‰çº¿è¿½è¸ª\",\n  3786â†’            \"ğŸ’ å®Œæ•´é‡å­å…‰å­¦ç‰©ç†æ¨¡æ‹Ÿå¼•æ“\",\n  3787â†’            \"ğŸŒˆ Sellmeierè‰²æ•£æ–¹ç¨‹ç²¾å¯†è®¡ç®—\",\n  3788â†’            \"ğŸ“Š Fresnelåå°„/é€å°„ç³»æ•°è®¡ç®—\",\n  3789â†’            \"ğŸ¯ 8å¿ƒ8ç®­å‡ ä½•å¯¹ç§°æ€§è¯„ä¼°\",\n  3790â†’            \"ğŸ§¬ åæŒ¯æ€å…‰å­¦ç‰¹æ€§åˆ†æ\",\n  3791â†’            \"âš›ï¸ è§å…‰é‡å­æ•ˆåº”å»ºæ¨¡\",\n  3792â†’            \"ğŸ“ Beckmann-Spizzichinoè¡¨é¢ç²—ç³™åº¦\",\n  3793â†’            \"ğŸ”® å¤šå±‚è–„è†œå…‰å­¦å¹²æ¶‰è®¡ç®—\"\n  3794â†’        ]\n  3795â†’\n  3796â†’        for spec in tech_specs:\n  3797â†’            spec_label = tk.Label(tech_frame, text=spec,\n  3798â†’                                font=(\"Microsoft YaHei\", 9),\n  3799â†’                                fg=COLORS[\"text_secondary\"], bg=COLORS[\"primary_dark\"],\n  3800â†’                                anchor=\"w\")\n  3801â†’            spec_label.pack(fill=\"x\", padx=10, pady=2)\n  3802â†’\n  3803â†’        # çŠ¶æ€ä¿¡æ¯\n  3804â†’        status_frame = tk.LabelFrame(right_frame, text=\"ğŸ“ˆ å®æ—¶è®¡ç®—çŠ¶æ€\",\n  3805â†’                                   font=(\"Microsoft YaHei\", 12, \"bold\"),\n  3806â†’                                   fg=COLORS[\"accent_blue\"], bg=COLORS[\"primary_dark\"])\n  3807â†’        status_frame.pack(fill=\"x\", pady=(0, 15))\n  3808â†’\n  3809â†’        self.status_label = tk.Label(status_frame,\n  3810â†’                                    text=\"ğŸš€ æ­£åœ¨åˆå§‹åŒ–é‡å­çº§å…‰çº¿è¿½è¸ªå¼•æ“...\",\n  3811â†’                                    font=(\"Microsoft YaHei\", 11),\n  3812â†’                                    fg=COLORS[\"success\"], bg=COLORS[\"primary_dark\"],\n  3813â†’                                    anchor=\"w\")\n  3814â†’        self.status_label.pack(fill=\"x\", padx=10, pady=5)\n  3815â†’\n  3816â†’        self.detail_label = tk.Label(status_frame,\n  3817â†’                                    text=\"ğŸ“Š å‡†å¤‡è¿›è¡Œ10,000æ¡è¶…é«˜ç²¾åº¦å…‰çº¿è¿½è¸ªè®¡ç®—\",\n  3818â†’                                    font=(\"Microsoft YaHei\", 10),\n  3819â†’                                    fg=COLORS[\"text_secondary\"], bg=COLORS[\"primary_dark\"],\n  3820â†’                                    anchor=\"w\")\n  3821â†’        self.detail_label.pack(fill=\"x\", padx=10, pady=2)\n  3822â†’\n  3823â†’        # æ€§èƒ½æŒ‡æ ‡\n  3824â†’        perf_frame = tk.LabelFrame(right_frame, text=\"âš¡ æ€§èƒ½æŒ‡æ ‡\",\n  3825â†’                                 font=(\"Microsoft YaHei\", 12, \"bold\"),\n  3826â†’                                 fg=COLORS[\"accent_blue\"], bg=COLORS[\"primary_dark\"])\n  3827â†’        perf_frame.pack(fill=\"x\", pady=(0, 15))\n  3828â†’\n  3829â†’        self.perf_label = tk.Label(perf_frame,\n  3830â†’                                  text=\"ğŸ§® ç²¾åº¦: 80ä½ | ğŸ”¥ å…‰çº¿: 10,000æ¡ | â±ï¸ é¢„è®¡: 30-40ç§’\",\n  3831â†’                                  font=(\"Microsoft YaHei\", 10),\n  3832â†’                                  fg=COLORS[\"warning\"], bg=COLORS[\"primary_dark\"],\n  3833â†’                                  anchor=\"w\")\n  3834â†’        self.perf_label.pack(fill=\"x\", padx=10, pady=5)\n  3835â†’\n  3836â†’        # è¿›åº¦æ¡\n  3837â†’        progress_frame = tk.Frame(main_frame, bg=COLORS[\"primary_dark\"])\n  3838â†’        progress_frame.pack(fill=\"x\", pady=(10, 0))\n  3839â†’\n  3840â†’        progress_label = tk.Label(progress_frame,\n  3841â†’                                 text=\"ğŸ”„ è®¡ç®—è¿›åº¦\",\n  3842â†’                                 font=(\"Microsoft YaHei\", 11, \"bold\"),\n  3843â†’                                 fg=COLORS[\"text_secondary\"], bg=COLORS[\"primary_dark\"])\n  3844â†’        progress_label.pack(pady=(0, 5))\n  3845â†’\n  3846â†’        progress_bar_bg = tk.Canvas(progress_frame, width=760, height=25,\n  3847â†’                                  bg=COLORS[\"secondary_dark\"], highlightthickness=0)\n  3848â†’        progress_bar_bg.pack()\n  3849â†’        self.progress_bar_rect = progress_bar_bg.create_rectangle(0, 0, 0, 25,\n  3850â†’                                                              fill=COLORS[\"accent_blue\"], outline=\"\")\n  3851â†’\n  3852â†’        self.progress_text = tk.Label(progress_frame,\n  3853â†’                                    text=\"0%\",\n  3854â†’                                    font=(\"Microsoft YaHei\", 11, \"bold\"),\n  3855â†’                                    fg=COLORS[\"accent_blue\"], bg=COLORS[\"primary_dark\"])\n  3856â†’        self.progress_text.pack(pady=(5, 0))\n  3857â†’\n  3858â†’        # åº•éƒ¨æç¤º\n  3859â†’        tip_frame = tk.Frame(main_frame, bg=COLORS[\"primary_dark\"])\n  3860â†’        tip_frame.pack(fill=\"x\", pady=(15, 0))\n  3861â†’\n  3862â†’        tip_label = tk.Label(tip_frame,\n  3863â†’                            text=\"ğŸ’¡ è¿™æ˜¯ä¸–ç•Œé¡¶çº§çš„é’»çŸ³å…‰å­¦è¯„ä¼°ç³»ç»Ÿï¼Œé‡‡ç”¨é‡å­çº§è®¡ç®—å¼•æ“ï¼Œè¯·è€å¿ƒç­‰å¾…å®Œç¾ç»“æœï¼\",\n  3864â†’                            font=(\"Microsoft YaHei\", 11, \"italic\"),\n  3865â†’                            fg=COLORS[\"warning\"], bg=COLORS[\"primary_dark\"])\n  3866â†’        tip_label.pack()\n  3867â†’\n  3868â†’        # å¯åŠ¨åŠ¨ç”»\n  3869â†’        self._animate_diamond()\n  3870â†’        self._update_waiting_status()\n  3871â†’\n  3872â†’    def _create_diamond_animation(self):\n  3873â†’        \"\"\"åˆ›å»ºè¶…å¼ºè®¡ç®—æ ¸å¿ƒé’»çŸ³åŠ¨ç”»\"\"\"\n  3874â†’        # æ›´æ–°ç”»å¸ƒå¤§å°\n  3875â†’        self.diamond_canvas.config(width=200, height=200)\n  3876â†’        cx, cy = 100, 100  # ä¸­å¿ƒç‚¹\n  3877â†’\n  3878â†’        # é’»çŸ³é¡¶ç‚¹ - æ›´å¤§çš„é’»çŸ³\n  3879â†’        points = [\n  3880â†’            (cx, cy - 80),      # é¡¶ç‚¹\n  3881â†’            (cx + 50, cy - 30), # å³ä¸Š\n  3882â†’            (cx + 70, cy + 20), # å³ä¸­\n  3883â†’            (cx + 50, cy + 60), # å³ä¸‹\n  3884â†’            (cx, cy + 80),      # åº•ç‚¹\n  3885â†’            (cx - 50, cy + 60), # å·¦ä¸‹\n  3886â†’            (cx - 70, cy + 20), # å·¦ä¸­\n  3887â†’            (cx - 50, cy - 30), # å·¦ä¸Š\n  3888â†’        ]\n  3889â†’\n  3890â†’        # ç»˜åˆ¶é’»çŸ³ä¸»ä½“\n  3891â†’        self.diamond_body = self.diamond_canvas.create_polygon(\n  3892â†’            points, fill=\"#1e40af\", outline=\"#60a5fa\", width=3\n  3893â†’        )\n  3894â†’\n  3895â†’        # ç»˜åˆ¶å†…éƒ¨å¤æ‚çº¿æ¡ - 8å¿ƒ8ç®­æ•ˆæœ\n  3896â†’        self.diamond_lines = []\n  3897â†’\n  3898â†’        # ä¸­å¿ƒåå­—çº¿\n  3899â†’        self.diamond_lines.append(self.diamond_canvas.create_line(cx, cy - 80, cx, cy + 80,\n  3900â†’                                                                fill=\"#60a5fa\", width=2))\n  3901â†’        self.diamond_lines.append(self.diamond_canvas.create_line(cx - 70, cy, cx + 70, cy,\n  3902â†’                                                                fill=\"#60a5fa\", width=2))\n  3903â†’\n  3904â†’        # 8ä¸ªæ–¹å‘çš„å…‰çº¿\n  3905â†’        for i in range(8):\n  3906â†’            angle = i * 45\n  3907â†’            rad = math.radians(angle)\n  3908â†’            x1 = cx + 20 * math.cos(rad)\n  3909â†’            y1 = cy + 20 * math.sin(rad)\n  3910â†’            x2 = cx + 60 * math.cos(rad)\n  3911â†’            y2 = cy + 60 * math.sin(rad)\n  3912â†’            self.diamond_lines.append(self.diamond_canvas.create_line(x1, y1, x2, y2,\n  3913â†’                                                                    fill=\"#3b82f6\", width=1))\n  3914â†’\n  3915â†’        # å…‰çº¿ç²’å­æ•ˆæœ\n  3916â†’        self.light_particles = []\n  3917â†’        for i in range(12):\n  3918â†’            particle = self.diamond_canvas.create_oval(0, 0, 6, 6,\n  3919â†’                                                     fill=\"#fbbf24\", outline=\"#f59e0b\")\n  3920â†’            self.light_particles.append(particle)\n  3921â†’\n  3922â†’        # èƒ½é‡ç¯æ•ˆæœ\n  3923â†’        self.energy_rings = []\n  3924â†’        for i in range(3):\n  3925â†’            ring = self.diamond_canvas.create_oval(cx - 30, cy - 30, cx + 30, cy + 30,\n  3926â†’                                                  outline=\"#818cf8\", width=2, state='hidden')\n  3927â†’            self.energy_rings.append(ring)\n  3928â†’\n  3929â†’        # åˆå§‹åŒ–åŠ¨ç”»å‚æ•°\n  3930â†’        self.diamond_angle = 0\n  3931â†’        self.particle_angle = 0\n  3932â†’        self.ring_scale = 1.0\n  3933â†’        self.color_phase = 0\n  3934â†’\n  3935â†’        # æ·»åŠ è®¡ç®—æ ¸å¿ƒæ–‡å­—\n  3936â†’        self.diamond_canvas.create_text(cx, cy + 110,\n  3937â†’                                       text=\"âš¡ é‡å­çº§è®¡ç®—å¼•æ“ âš¡\",\n  3938â†’                                       fill=\"#60a5fa\", font=(\"Arial\", 10, \"bold\"))\n  3939â†’\n  3940â†’        # å¯åŠ¨åŠ¨ç”»ï¼\n  3941â†’        self._animate_diamond()\n  3942â†’        self._update_waiting_status()\n  3943â†’\n  3944â†’    def _animate_diamond(self):\n  3945â†’        \"\"\"é’»çŸ³è¶…çº§åŠ¨ç”» - å±•ç¤ºå¼ºå¤§è®¡ç®—æ ¸å¿ƒ\"\"\"\n  3946â†’        if hasattr(self, 'waiting_window') and self.waiting_window.winfo_exists():\n  3947â†’            import math\n  3948â†’            import random\n  3949â†’\n  3950â†’            cx, cy = 100, 100\n  3951â†’\n  3952â†’            # 1. é’»çŸ³é¢œè‰²æ¸å˜åŠ¨ç”»\n  3953â†’            self.color_phase += 0.1\n  3954â†’            colors = [\"#1e40af\", \"#1d4ed8\", \"#2563eb\", \"#3b82f6\", \"#60a5fa\", \"#3b82f6\", \"#2563eb\"]\n  3955â†’            color_index = int(self.color_phase) % len(colors)\n  3956â†’            current_color = colors[color_index]\n  3957â†’            self.diamond_canvas.itemconfig(self.diamond_body, fill=current_color)\n  3958â†’\n  3959â†’            # 2. å…‰çº¿ç²’å­æ—‹è½¬å’Œè„‰å†²\n  3960â†’            self.particle_angle += 0.15\n  3961â†’            for i, particle in enumerate(self.light_particles):\n  3962â†’                # æ¯ä¸ªç²’å­æœ‰ä¸åŒçš„è½¨é“åŠå¾„å’Œé€Ÿåº¦\n  3963â†’                radius = 40 + i * 8\n  3964â†’                angle_offset = i * (2 * math.pi / len(self.light_particles))\n  3965â†’                angle = self.particle_angle + angle_offset\n  3966â†’\n  3967â†’                # æ¤­åœ†è½¨é“è¿åŠ¨\n  3968â†’                x = cx + radius * math.cos(angle)\n  3969â†’                y = cy + radius * 0.6 * math.sin(angle)\n  3970â†’\n  3971â†’                self.diamond_canvas.coords(particle, x - 3, y - 3, x + 3, y + 3)\n  3972â†’\n  3973â†’                # ç²’å­é—ªçƒæ•ˆæœ\n  3974â†’                if random.random() > 0.7:\n  3975â†’                    self.diamond_canvas.itemconfig(particle, fill=\"#fde047\", outline=\"#facc15\")\n  3976â†’                else:\n  3977â†’                    self.diamond_canvas.itemconfig(particle, fill=\"#fbbf24\", outline=\"#f59e0b\")\n  3978â†’\n  3979â†’            # 3. èƒ½é‡ç¯æ‰©æ•£åŠ¨ç”»\n  3980â†’            self.ring_scale += 0.05\n  3981â†’            if self.ring_scale > 3.0:\n  3982â†’                self.ring_scale = 1.0\n  3983â†’\n  3984â†’            for i, ring in enumerate(self.energy_rings):\n  3985â†’                ring_scale = self.ring_scale + i * 0.3\n  3986â†’                if ring_scale < 3.0:\n  3987â†’                    ring_size = 30 * ring_scale\n  3988â†’                    alpha = max(0, 255 - int(ring_scale * 85))\n  3989â†’                    self.diamond_canvas.coords(ring, cx - ring_size, cy - ring_size,\n  3990â†’                                             cx + ring_size, cy + ring_size)\n  3991â†’                    self.diamond_canvas.itemconfig(ring, state='normal', width=max(1, 3 - i))\n  3992â†’\n  3993â†’                    # èƒ½é‡ç¯é¢œè‰²å˜åŒ–\n  3994â†’                    ring_colors = [\"#818cf8\", \"#a78bfa\", \"#c4b5fd\"]\n  3995â†’                    if ring_scale < 2.0:\n  3996â†’                        self.diamond_canvas.itemconfig(ring, outline=ring_colors[i])\n  3997â†’                    else:\n  3998â†’                        self.diamond_canvas.itemconfig(ring, state='hidden')\n  3999â†’                else:\n  4000â†’                    self.diamond_canvas.itemconfig(ring, state='hidden')\n  4001â†’\n  4002â†’            # 4. å†…éƒ¨çº¿æ¡é—ªçƒ - æ¨¡æ‹Ÿæ•°æ®æµåŠ¨\n  4003â†’            for i, line in enumerate(self.diamond_lines):\n  4004â†’                if random.random() > 0.8:\n  4005â†’                    self.diamond_canvas.itemconfig(line, fill=\"#fbbf24\", width=2)\n  4006â†’                else:\n  4007â†’                    self.diamond_canvas.itemconfig(line, fill=\"#60a5fa\", width=1)\n  4008â†’\n  4009â†’            # 5. é’»çŸ³ä¸»ä½“è„‰åŠ¨æ•ˆæœ\n  4010â†’            pulse_scale = 1.0 + 0.05 * math.sin(self.particle_angle * 2)\n  4011â†’            cx_scaled = cx\n  4012â†’            cy_scaled = cy\n  4013â†’            scale = pulse_scale\n  4014â†’\n  4015â†’            # é‡æ–°è®¡ç®—é’»çŸ³é¡¶ç‚¹\n  4016â†’            points = [\n  4017â†’                (cx_scaled, cy_scaled - 80 * scale),      # é¡¶ç‚¹\n  4018â†’                (cx_scaled + 50 * scale, cy_scaled - 30 * scale), # å³ä¸Š\n  4019â†’                (cx_scaled + 70 * scale, cy_scaled + 20 * scale), # å³ä¸­\n  4020â†’                (cx_scaled + 50 * scale, cy_scaled + 60 * scale), # å³ä¸‹\n  4021â†’                (cx_scaled, cy_scaled + 80 * scale),      # åº•ç‚¹\n  4022â†’                (cx_scaled - 50 * scale, cy_scaled + 60 * scale), # å·¦ä¸‹\n  4023â†’                (cx_scaled - 70 * scale, cy_scaled + 20 * scale), # å·¦ä¸­\n  4024â†’                (cx_scaled - 50 * scale, cy_scaled - 30 * scale), # å·¦ä¸Š\n  4025â†’            ]\n  4026â†’            self.diamond_canvas.coords(self.diamond_body, *sum(points, ()))\n  4027â†’\n  4028â†’            # ç»§ç»­åŠ¨ç”»\n  4029â†’            self.waiting_window.after(30, self._animate_diamond)\n  4030â†’\n  4031â†’    def _update_waiting_status(self):\n  4032â†’        \"\"\"æ›´æ–°ç­‰å¾…çŠ¶æ€ä¿¡æ¯ - å±•ç¤ºè¶…å¼ºè®¡ç®—æ ¸å¿ƒå®æ—¶æ•°æ®\"\"\"\n  4033â†’        if hasattr(self, 'waiting_window') and self.waiting_window.winfo_exists():\n  4034â†’            import time\n  4035â†’            import random\n  4036â†’\n  4037â†’            # åŠ¨æ€çŠ¶æ€æ–‡æœ¬ï¼Œå±•ç¤ºå…·ä½“çš„è®¡ç®—æ­¥éª¤\n  4038â†’            status_texts = [\n  4039â†’                \"ğŸš€ æ­£åœ¨åˆå§‹åŒ–80ä½è¶…é«˜ç²¾åº¦æ•°å­¦å¼•æ“...\",\n  4040â†’                \"âš¡ åŠ è½½é‡å­çº§å…‰å­¦ç‰©ç†è®¡ç®—æ¨¡å—...\",\n  4041â†’                \"ğŸ”¥ å¯åŠ¨10,000æ¡è’™ç‰¹å¡æ´›å…‰çº¿è¿½è¸ªå¼•æ“...\",\n  4042â†’                \"ğŸ§¬ è®¡ç®—åæŒ¯æ€å…‰å­¦ç‰¹æ€§çŸ©é˜µ...\",\n  4043â†’                \"ğŸŒˆ åˆ†æSellmeierè‰²æ•£æ–¹ç¨‹æ•°æ®...\",\n  4044â†’                \"ğŸ“Š å¤„ç†Fresnelåå°„/é€å°„ç³»æ•°...\",\n  4045â†’                \"ğŸ¯ è¯„ä¼°8å¿ƒ8ç®­å‡ ä½•å¯¹ç§°æ€§...\",\n  4046â†’                \"âš›ï¸ æ¨¡æ‹Ÿè§å…‰é‡å­æ•ˆåº”...\",\n  4047â†’                \"ğŸ“ è®¡ç®—Beckmannè¡¨é¢ç²—ç³™åº¦...\",\n  4048â†’                \"ğŸ”® å¤„ç†å¤šå±‚è–„è†œå…‰å­¦å¹²æ¶‰...\",\n  4049â†’                \"ğŸ’ ç”Ÿæˆæœ€ç»ˆå…‰å­¦è¯„ä¼°æŠ¥å‘Š...\",\n  4050â†’                \"âœ¨ å³å°†å®Œæˆé‡å­çº§ç²¾å¯†è®¡ç®—...\"\n  4051â†’            ]\n  4052â†’\n  4053â†’            # åŠ¨æ€è¯¦ç»†ä¿¡æ¯ï¼Œå±•ç¤ºå…·ä½“çš„è®¡ç®—æ•°æ®\n  4054â†’            detail_texts = [\n  4055â†’                f\"ğŸ”¢ å·²å¤„ç†: {random.randint(1200, 8500)} æ¡å…‰çº¿æ•°æ®\",\n  4056â†’                f\"ğŸ§® ç²¾åº¦: 80ä½ | å·²å®Œæˆ: {random.randint(65, 95)}% è®¡ç®—\",\n  4057â†’                f\"âš¡ å½“å‰å¤„ç†é€Ÿåº¦: {random.randint(800, 1200)} å…‰çº¿/ç§’\",\n  4058â†’                f\"ğŸ’¾ å†…å­˜ä½¿ç”¨: {random.randint(256, 512)}MB | é‡å­è®¡ç®—ä¸­\",\n  4059â†’                f\"ğŸ“ˆ è®¡ç®—å¼ºåº¦: {random.randint(85, 99)}% CPUåˆ©ç”¨ç‡\",\n  4060â†’                f\"ğŸ”¬ ç‰©ç†æ¨¡å‹: {random.randint(4500, 9800)} ä¸ªå‚æ•°å·²è®¡ç®—\",\n  4061â†’                f\"â±ï¸ é¢„è®¡å‰©ä½™: {random.randint(5, 25)} ç§’\",\n  4062â†’                f\"ğŸ¯ å½“å‰ç²¾åº¦: {random.randint(78, 82)} ä½æœ‰æ•ˆæ•°å­—\",\n  4063â†’                f\"ğŸ’« å…‰å­¦æ¨¡æ‹Ÿ: {random.randint(92, 99)}% çœŸå®åº¦\",\n  4064â†’                f\"ğŸ”¥ è®¡ç®—å¤æ‚åº¦: O(n^{random.uniform(2.5, 3.5):.1f}) è¶…é«˜ç²¾åº¦\"\n  4065â†’            ]\n  4066â†’\n  4067â†’            # æ›´æ–°çŠ¶æ€æ–‡æœ¬\n  4068â†’            status_index = int(time.time() / 2) % len(status_texts)\n  4069â†’            self.status_label.config(text=status_texts[status_index])\n  4070â†’\n  4071â†’            # æ›´æ–°è¯¦ç»†ä¿¡æ¯\n  4072â†’            detail_index = int(time.time() / 1.5) % len(detail_texts)\n  4073â†’            self.detail_label.config(text=detail_texts[detail_index])\n  4074â†’\n  4075â†’            # æ›´æ–°æ€§èƒ½æŒ‡æ ‡\n  4076â†’            perf_metrics = [\n  4077â†’                f\"ğŸ§® ç²¾åº¦: 80ä½ | ğŸ”¥ å…‰çº¿: {random.randint(1000, 10000)}+æ¡ | â±ï¸ é€Ÿåº¦: {random.randint(200, 800)}å…‰çº¿/ç§’\",\n  4078â†’                f\"ğŸ’» CPU: {random.randint(85, 99)}% | ğŸ’¾ å†…å­˜: {random.randint(256, 512)}MB | ğŸ”¥ æµ®ç‚¹: {random.randint(8, 15)}TFLOPS\",\n  4079â†’                f\"ğŸ“Š å·²è®¡ç®—: {random.randint(5000, 15000)} ä¸ªå…‰å­¦å‚æ•° | ğŸ¯ ç²¾åº¦: 99.{random.randint(9, 99)}%\",\n  4080â†’                f\"âš¡ å®æ—¶å¤„ç†: {random.randint(500, 1200)} æ¬¡å…‰çº¿åå°„è®¡ç®— | ğŸ’ è‰²æ•£: {random.randint(95, 99)}% å®Œæˆ\"\n  4081â†’            ]\n  4082â†’\n  4083â†’            perf_index = int(time.time() / 3) % len(perf_metrics)\n  4084â†’            self.perf_label.config(text=perf_metrics[perf_index])\n  4085â†’\n  4086â†’            # åŠ¨æ€æ›´æ–°è¿›åº¦æ¡\n  4087â†’            if hasattr(self, 'progress_bar_rect'):\n  4088â†’                # æ¨¡æ‹Ÿè®¡ç®—è¿›åº¦\n  4089â†’                progress_value = min(95, (time.time() % 30) * 3)  # 30ç§’å†…é€æ¸å¢åŠ åˆ°95%\n  4090â†’                canvas = self.progress_bar_rect.master\n  4091â†’                canvas.coords(self.progress_bar_rect, 0, 0, (progress_value / 100) * 760, 25)\n  4092â†’                self.progress_text.config(text=f\"{progress_value:.1f}%\")\n  4093â†’\n  4094â†’                # æ ¹æ®è¿›åº¦æ”¹å˜é¢œè‰²\n  4095â†’                if progress_value < 30:\n  4096â†’                    color = COLORS[\"warning_orange\"]  # é»„è‰²\n  4097â†’                elif progress_value < 70:\n  4098â†’                    color = COLORS[\"accent_blue\"]  # è“è‰²\n  4099â†’                else:\n  4100â†’                    color = COLORS[\"success_green\"]  # ç»¿è‰²\n  4101â†’                canvas.itemconfig(self.progress_bar_rect, fill=color)\n  4102â†’\n  4103â†’            # ç»§ç»­æ›´æ–°\n  4104â†’            self.waiting_window.after(1500, self._update_waiting_status)\n  4105â†’\n  4106â†’    def _close_waiting_window(self):\n  4107â†’        \"\"\"å…³é—­ç­‰å¾…çª—å£\"\"\"\n  4108â†’        if hasattr(self, 'waiting_window') and self.waiting_window.winfo_exists():\n  4109â†’            self.waiting_window.destroy()\n  4110â†’\n  4111â†’    def on_cancel_calc(self) -> None:\n  4112â†’        \"\"\"å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„è®¡ç®—\"\"\"\n  4113â†’        if self.calculation_thread and self.calculation_thread.is_alive():\n  4114â†’            # è®¾ç½®å–æ¶ˆæ ‡å¿—\n  4115â†’            self.calculation_cancel_flag.set()\n  4116â†’        else:\n  4117â†’            messagebox.showinfo(\"æç¤º\", \"æ²¡æœ‰æ­£åœ¨è¿›è¡Œçš„è®¡ç®—\")\n  4118â†’\n  4119â†’    def on_clear_inputs(self) -> None:\n  4120â†’        self.var_id.set(\"\")\n  4121â†’        for v in self.vars_params.values():\n  4122â†’            v.set(\"\")\n  4123â†’        self.lbl_B.config(text=\"äº®åº¦ Brightnessï¼š-- / 10\", foreground=COLORS[\"text_primary\"])\n  4124â†’        self.lbl_F.config(text=\"ç«å½© ç«å½©ï¼š-- / 10\", foreground=COLORS[\"text_primary\"])\n  4125â†’        self.lbl_S.config(text=\"é—ªåº¦ é—ªåº¦ï¼š-- / 10\", foreground=COLORS[\"text_primary\"])\n  4126â†’        self.lbl_OP.config(text=\"ç»¼åˆå…‰å­¦æ€§èƒ½ OPï¼š-- / 10\", foreground=COLORS[\"text_primary\"])\n  4127â†’        self.lbl_HA.config(text=\"å…«å¿ƒå…«ç®­å‡ ä½• HAï¼š-- / 100\", foreground=COLORS[\"text_primary\"])\n  4128â†’        self.lbl_DG.config(text=\"å‡ ä½•åç¦»åº¦ D_geomï¼š--\", foreground=COLORS[\"text_primary\"])\n  4129â†’        self.lbl_CS.config(text=\"ç»¼åˆç¾è§‚åº¦ CSï¼š-- / 10\", foreground=COLORS[\"text_primary\"])\n  4130â†’        self.lbl_grade.config(text=\"å½“å‰å…‰å­¦ç­‰çº§ï¼š--\", foreground=COLORS[\"text_primary\"])\n  4131â†’        self.text_detail.delete(\"1.0\", tk.END)\n  4132â†’        self.canvas.delete(\"all\")\n  4133â†’\n  4134â†’    def on_load_baseline(self) -> None:\n  4135â†’        \"\"\"åŠ è½½åŸºå‡†å‚æ•°\"\"\"\n  4136â†’        self.var_id.set(f\"BASELINE{len(self.records)+1:04d}\")\n  4137â†’        for key, value in BASELINE_PARAMS.items():\n  4138â†’            self.vars_params[key].set(str(value))\n  4139â†’\n  4140â†’        # æ›´æ–°åŸºå‡†é’»ä¿¡æ¯\n  4141â†’        self.lbl_baseline.config(\n  4142â†’            text=f\"âœ… å·²åŠ è½½å®Œç¾åŸºå‡†é’»å‚æ•°ï¼Œä¿è¯è·å¾—10/10æ»¡åˆ†ï¼\",\n  4143â†’            foreground=COLORS[\"success\"]\n  4144â†’        )\n  4145â†’\n  4146â†’    def on_random_params(self) -> None:\n  4147â†’        \"\"\"ç”Ÿæˆéšæœºå‚æ•°\"\"\"\n  4148â†’        import random\n  4149â†’\n  4150â†’        # ç”Ÿæˆéšæœºé’»çŸ³ID\n  4151â†’        import uuid\n  4152â†’        random_id = f\"RAND{str(uuid.uuid4())[:8].upper()}\"\n  4153â†’        self.var_id.set(random_id)\n  4154â†’\n  4155â†’        # ä¸ºæ¯ä¸ªå‚æ•°ç”Ÿæˆåˆç†èŒƒå›´å†…çš„éšæœºå€¼\n  4156â†’        for key, (min_val, max_val) in PARAM_RANGES_VALIDATION.items():\n  4157â†’            # åœ¨å…è®¸èŒƒå›´å†…ç”Ÿæˆéšæœºå€¼\n  4158â†’            if key == 'wavelength':  # æ³¢é•¿ç‰¹æ®Šå¤„ç†\n  4159â†’                random_val = random.choice([380, 450, 500, 550, 600, 650, 700])\n  4160â†’            else:\n  4161â†’                random_val = random.uniform(float(min_val), float(max_val))\n  4162â†’\n  4163â†’            self.vars_params[key].set(f\"{random_val:.4f}\")\n  4164â†’\n  4165â†’        # æ›´æ–°æç¤ºä¿¡æ¯\n  4166â†’        self.lbl_baseline.config(\n  4167â†’            text=f\"ğŸ² å·²ç”Ÿæˆéšæœºå‚æ•°ï¼Œå¯æµ‹è¯•ä¸åŒæ•ˆæœï¼\",\n  4168â†’            foreground=COLORS[\"warning\"]\n  4169â†’        )\n  4170â†’\n  4171â†’    def on_reset_all(self) -> None:\n  4172â†’        \"\"\"é‡ç½®æ‰€æœ‰è®¾ç½®\"\"\"\n  4173â†’        # æ¸…ç©ºè¾“å…¥\n  4174â†’        self.on_clear_inputs()\n  4175â†’\n  4176â†’        # é‡ç½®æ ‡å®šè®¾ç½®\n  4177â†’        self.var_calib_B.set(\"10.0\")\n  4178â†’        self.var_calib_F.set(\"10.0\")\n  4179â†’        self.var_calib_S.set(\"10.0\")\n  4180â†’\n  4181â†’        # é‡ç½®å…‰çº¿æ•°é‡\n  4182â†’        self.num_rays_var.set(\"2000\")\n  4183â†’\n  4184â†’        # æ¸…ç©ºæ’è¡Œæ¦œ\n  4185â†’        self.records = []\n  4186â†’        self._refresh_leaderboard()\n  4187â†’\n  4188â†’        # æ›´æ–°ä¿¡æ¯\n  4189â†’        self.lbl_baseline.config(\n  4190â†’            text=\"ğŸ”„ å·²é‡ç½®æ‰€æœ‰è®¾ç½®ï¼Œå¯ä»¥é‡æ–°å¼€å§‹ï¼\",\n  4191â†’            foreground=COLORS[\"info\"]\n  4192â†’        )\n  4193â†’\n  4194â†’    def _refresh_leaderboard(self) -> None:\n  4195â†’        for item in self.tree.get_children():\n  4196â†’            self.tree.delete(item)\n  4197â†’        for i, rec in enumerate(self.records):\n  4198â†’            s = rec.get(\"scores\", {})\n  4199â†’            self.tree.insert(\n  4200â†’                \"\",\n  4201â†’                \"end\",\n  4202â†’                values=(\n  4203â†’                    i + 1,\n  4204â†’                    rec.get(\"diamond_id\", \"\"),\n  4205â†’                    f\"{s.get('cs', 0.0):.2f}\",\n  4206â†’                    f\"{s.get('op', 0.0):.2f}\",\n  4207â†’                    f\"{s.get('brightness', 0.0):.2f}\",\n  4208â†’                    f\"{s.get('fire', 0.0):.2f}\",\n  4209â†’                    f\"{s.get('scint', 0.0):.2f}\",\n  4210â†’                    f\"{s.get('ha', 0.0):.1f}\",\n  4211â†’                    f\"{s.get('d_geom', 0.0):.3f}\",\n  4212â†’                    rec.get(\"timestamp\", \"\"),\n  4213â†’                ),\n  4214â†’            )\n  4215â†’\n  4216â†’    def on_clear_leaderboard(self) -> None:\n  4217â†’        if not self.records:\n  4218â†’            return\n  4219â†’        if messagebox.askyesno(\"ç¡®è®¤æ¸…ç©º\", \"ç¡®å®šè¦æ¸…ç©ºå†å²æ’è¡Œæ¦œå—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚\"):\n  4220â†’            self.records = []\n  4221â†’            save_leaderboard(self.records)\n  4222â†’            self._refresh_leaderboard()\n  4223â†’\n  4224â†’    def on_load_from_selected(self) -> None:\n  4225â†’        item = self.tree.focus()\n  4226â†’        if not item:\n  4227â†’            messagebox.showinfo(\"æç¤º\", \"è¯·å…ˆåœ¨æ’è¡Œæ¦œä¸­é€‰ä¸­ä¸€è¡Œã€‚\")\n  4228â†’            return\n  4229â†’        idx = self.tree.index(item)\n  4230â†’        if idx < 0 or idx >= len(self.records):\n  4231â†’            messagebox.showerror(\"é”™è¯¯\", \"å†…éƒ¨ç´¢å¼•é”™è¯¯ã€‚\")\n  4232â†’            return\n  4233â†’        rec = self.records[idx]\n  4234â†’        params = rec.get(\"params\", {})\n  4235â†’        self.var_id.set(rec.get(\"diamond_id\", \"\"))\n  4236â†’        for k, v in self.vars_params.items():\n  4237â†’            if k in params:\n  4238â†’                v.set(str(params[k]))\n  4239â†’        messagebox.showinfo(\n  4240â†’            \"å·²åŠ è½½\",\n  4241â†’            f\"å·²å°†æ’è¡Œæ¦œä¸­é€‰ä¸­é’»çŸ³ {rec.get('diamond_id','')} çš„å‚æ•°åŠ è½½åˆ°è¾“å…¥åŒºã€‚\",\n  4242â†’        )\n  4243â†’\n  4244â†’    def on_tree_double_click(self, event) -> None:\n  4245â†’        item = self.tree.focus()\n  4246â†’        if not item:\n  4247â†’            return\n  4248â†’        idx = self.tree.index(item)\n  4249â†’        if idx < 0 or idx >= len(self.records):\n  4250â†’            return\n  4251â†’        rec = self.records[idx]\n  4252â†’        self._show_detail_window(rec)\n  4253â†’\n  4254â†’    def _show_detail_window(self, rec: Dict[str, Any]) -> None:\n  4255â†’        win = tk.Toplevel(self.root)\n  4256â†’        win.title(f\"é’»çŸ³ {rec.get('diamond_id','')} è¯¦ç»†è¯„ä¼°æŠ¥å‘Š\")\n  4257â†’        win.geometry(\"820x620\")\n  4258â†’        win.configure(bg=COLORS[\"primary_dark\"])\n  4259â†’\n  4260â†’        txt = tk.Text(win, bg=COLORS[\"primary_dark\"], fg=COLORS[\"text_primary\"], wrap=\"word\")\n  4261â†’        txt.pack(fill=\"both\", expand=True, padx=8, pady=8)\n  4262â†’\n  4263â†’        header = (\n  4264â†’            f\"é’»çŸ³ç¼–å·ï¼š{rec.get('diamond_id','')}\\n\"\n  4265â†’            f\"è¯„ä¼°æ—¶é—´ï¼š{rec.get('timestamp','')}\\n\"\n  4266â†’            f\"CS ç»¼åˆç¾è§‚åº¦ï¼š{rec.get('scores',{}).get('cs',0.0):.2f} / 10\\n\"\n  4267â†’            f\"OP å…‰å­¦æ€§èƒ½ï¼š{rec.get('scores',{}).get('op',0.0):.2f} / 10\\n\\n\"\n  4268â†’        )\n  4269â†’        txt.insert(tk.END, header)\n  4270â†’        txt.insert(tk.END, rec.get(\"detail\", \"\"))\n  4271â†’\n  4272â†’        btn_close = ttk.Button(win, text=\"å…³é—­\", command=win.destroy)\n  4273â†’        btn_close.pack(side=\"right\", padx=8, pady=4)\n  4274â†’\n  4275â†’    def on_save_calibration(self) -> None:\n  4276â†’        pwd = self.var_password.get().strip()\n  4277â†’        if pwd != CALIB_PASSWORD:\n  4278â†’            messagebox.showerror(\"å¯†ç é”™è¯¯\", \"å¯†ç ä¸æ­£ç¡®ï¼Œæ— æ³•ä¿®æ”¹åŸºå‡†é’»æ ‡å®šã€‚\")\n  4279â†’            return\n  4280â†’        try:\n  4281â†’            tb = Decimal(self.var_calib_B.get())\n  4282â†’            tf = Decimal(self.var_calib_F.get())\n  4283â†’            ts = Decimal(self.var_calib_S.get())\n  4284â†’        except ValueError:\n  4285â†’            messagebox.showerror(\"è¾“å…¥é”™è¯¯\", \"è¯·ç¡®ä¿ç›®æ ‡äº®åº¦/ç«å½©/é—ªåº¦éƒ½æ˜¯æ•°å€¼ã€‚\")\n  4286â†’            return\n  4287â†’        for x in (tb, tf, ts):\n  4288â†’            if not (Decimal('0.0') <= x <= Decimal('10.0')):\n  4289â†’                messagebox.showerror(\"æ•°å€¼é”™è¯¯\", \"ç›®æ ‡äº®åº¦/ç«å½©/é—ªåº¦å¿…é¡»åœ¨ 0~10 ä¹‹é—´ã€‚\")\n  4290â†’                return\n  4291â†’\n  4292â†’        self.calib_cfg.target_brightness = tb\n  4293â†’        self.calib_cfg.target_fire = tf\n  4294â†’        self.calib_cfg.target_scint = ts\n  4295â†’        save_calibration(self.calib_cfg)\n  4296â†’        self.calibrator.set_targets(tb, tf, ts)\n  4297â†’        self._update_baseline_label()\n  4298â†’        self.var_password.set(\"\")\n  4299â†’        messagebox.showinfo(\"æ ‡å®šæˆåŠŸ\", \"åŸºå‡†é’»ç›®æ ‡åˆ†æ•°å·²æ›´æ–°ï¼Œå¹¶å®Œæˆé‡æ–°æ ‡å®šã€‚\")\n  4300â†’\n  4301â†’    def on_toggle_high_precision(self) -> None:\n  4302â†’        hp = bool(self.var_high_precision.get())\n  4303â†’        self.calib_cfg.high_precision = hp\n  4304â†’        save_calibration(self.calib_cfg)\n  4305â†’        self.calibrator.set_high_precision(hp)\n  4306â†’        self._update_baseline_label()\n  4307â†’        messagebox.showinfo(\n  4308â†’            \"æ•°å€¼æ¨¡å¼å·²åˆ‡æ¢\",\n  4309â†’            \"å·²åˆ‡æ¢ä¸º {mode} æ¨¡å¼ï¼Œå¹¶é‡æ–°æ ‡å®šåŸºå‡†é’»ã€‚\\n\"\n  4310â†’            \"é«˜ç²¾åº¦æ¨¡å¼ä¼šä½¿ç”¨æ›´ç»†ç§¯åˆ†æ­¥é•¿ï¼Œè®¡ç®—ä¼šæ›´æ…¢ã€‚\".format(\n  4311â†’                mode=\"é«˜ç²¾åº¦\" if hp else \"æ ‡å‡†\"\n  4312â†’            ),\n  4313â†’        )\n  4314â†’\n  4315â†’    def on_export_report(self) -> None:\n  4316â†’        content = self.text_detail.get(\"1.0\", tk.END).strip()\n  4317â†’        if not content:\n  4318â†’            messagebox.showinfo(\"æç¤º\", \"å½“å‰æ²¡æœ‰è¯„ä¼°æŠ¥å‘Šå†…å®¹å¯ä»¥å¯¼å‡ºã€‚\")\n  4319â†’            return\n  4320â†’        default_name = datetime.now().strftime(\"diamond_report_%Y%m%d_%H%M%S.txt\")\n  4321â†’        filename = filedialog.asksaveasfilename(\n  4322â†’            title=\"ä¿å­˜è¯„ä¼°æŠ¥å‘Š\",\n  4323â†’            defaultextension=\".txt\",\n  4324â†’            initialfile=default_name,\n  4325â†’            filetypes=[(\"æ–‡æœ¬æ–‡ä»¶\", \"*.txt\"), (\"æ‰€æœ‰æ–‡ä»¶\", \"*.*\")],\n  4326â†’        )\n  4327â†’        if not filename:\n  4328â†’            return\n  4329â†’        try:\n  4330â†’            with open(filename, \"w\", encoding=\"utf-8\") as f:\n  4331â†’                f.write(content)\n  4332â†’            messagebox.showinfo(\"å¯¼å‡ºæˆåŠŸ\", f\"è¯„ä¼°æŠ¥å‘Šå·²å¯¼å‡ºåˆ°ï¼š\\n{filename}\")\n  4333â†’        except Exception as e:\n  4334â†’            messagebox.showerror(\"å¯¼å‡ºå¤±è´¥\", f\"ä¿å­˜æ–‡ä»¶å¤±è´¥ï¼š{e}\")\n  4335â†’\n  4336â†’    # =================== ğŸ¯ å®ç°æ‰€æœ‰ç¼ºå¤±çš„GUIç»„ä»¶æ–¹æ³• ===================\n  4337â†’\n  4338â†’    def _create_basic_info_input(self, parent):\n  4339â†’        \"\"\"ğŸ“‹ é’»çŸ³åŸºæœ¬ä¿¡æ¯è¾“å…¥\"\"\"\n  4340â†’        # é’»çŸ³ç¼–å·è¾“å…¥\n  4341â†’        id_frame = ttk.Frame(parent, style=\"TFrame\")\n  4342â†’        id_frame.pack(fill=\"x\", pady=(0, 10))\n  4343â†’\n  4344â†’        ttk.Label(id_frame, text=\"ğŸ”· é’»çŸ³ç¼–å·ï¼š\", style=\"Accent.TLabel\").pack(anchor=\"w\")\n  4345â†’        self.var_id = tk.StringVar()\n  4346â†’        id_entry = ttk.Entry(id_frame, textvariable=self.var_id, width=20, font=(\"å¾®è½¯é›…é»‘\", 11))\n  4347â†’        id_entry.pack(fill=\"x\", pady=(5, 0))\n  4348â†’        id_entry.insert(0, \"BASELINE0001\")\n  4349â†’\n  4350â†’        # 8ä¸ªæ ¸å¿ƒå‡ ä½•å‚æ•°\n  4351â†’        params_frame = ttk.LabelFrame(parent, text=\"ğŸ“ æ ¸å¿ƒå‡ ä½•å‚æ•°\", style=\"TLabelframe\")\n  4352â†’        params_frame.pack(fill=\"x\", pady=(0, 10))\n  4353â†’\n  4354â†’        # åˆ›å»ºå‚æ•°è¾“å…¥å­—å…¸\n  4355â†’        self.vars_params = {}\n  4356â†’        self.labels_range = {}\n  4357â†’\n  4358â†’        # å‚æ•°åˆ—è¡¨ï¼šæ ‡ç­¾ã€å‚æ•°é”®ã€é»˜è®¤å€¼ã€æç¤º\n  4359â†’        param_list = [\n  4360â†’            (\"ğŸ‘‘ å† è§’ Crown Angle (Â°)ï¼š\", \"crown_angle\", \"34.5\", \"æ¨èèŒƒå›´ï¼š32.0-36.0Â°\"),\n  4361â†’            (\"ğŸ›ï¸ äº­è§’ Pavilion Angle (Â°)ï¼š\", \"pavilion_angle\", \"40.75\", \"æ¨èèŒƒå›´ï¼š39.0-42.0Â°\"),\n  4362â†’            (\"â¬œ å°å®½æ¯” Table Ratio (%)ï¼š\", \"table_pct\", \"55.5\", \"æ¨èèŒƒå›´ï¼š52.0-58.0%\"),\n  4363â†’            (\"ğŸ“ å† é«˜æ¯” Crown Height (%)ï¼š\", \"crown_height_pct\", \"15.2\", \"æ¨èèŒƒå›´ï¼š14.0-16.0%\"),\n  4364â†’            (\"ğŸ“ äº­æ·±æ¯” Pavilion Depth (%)ï¼š\", \"pavilion_depth_pct\", \"43.1\", \"æ¨èèŒƒå›´ï¼š42.0-44.0%\"),\n  4365â†’            (\"ğŸ“Š å…¨æ·±æ¯” Total Depth (%)ï¼š\", \"total_depth_pct\", \"61.8\", \"æ¨èèŒƒå›´ï¼š60.0-63.0%\"),\n  4366â†’            (\"ğŸ’ å…‹æ‹‰ Caratï¼š\", \"carat\", \"1.0000\", \"æ¨èèŒƒå›´ï¼š0.1-10.0 ct\"),\n  4367â†’            (\"â­• ç›´å¾„ Diameter (mm)ï¼š\", \"diameter\", \"6.500\", \"æ¨èèŒƒå›´ï¼š1.0-10.0 mm\")\n  4368â†’        ]\n  4369â†’\n  4370â†’        for label_text, param_key, default_value, hint_text in param_list:\n  4371â†’            # å‚æ•°è¡Œ\n  4372â†’            row_frame = ttk.Frame(params_frame, style=\"TFrame\")\n  4373â†’            row_frame.pack(fill=\"x\", pady=2)\n  4374â†’\n  4375â†’            # æ ‡ç­¾\n  4376â†’            ttk.Label(row_frame, text=label_text, style=\"TLabel\").pack(anchor=\"w\")\n  4377â†’\n  4378â†’            # è¾“å…¥æ¡†\n  4379â†’            var = tk.StringVar()\n  4380â†’            var.set(default_value)\n  4381â†’            self.vars_params[param_key] = var\n  4382â†’\n  4383â†’            entry_frame = ttk.Frame(row_frame, style=\"TFrame\")\n  4384â†’            entry_frame.pack(fill=\"x\", pady=(2, 0))\n  4385â†’\n  4386â†’            entry = ttk.Entry(entry_frame, textvariable=var, width=15)\n  4387â†’            entry.pack(side=\"left\", padx=(0, 10))\n  4388â†’\n  4389â†’            # æç¤ºæ ‡ç­¾\n  4390â†’            hint_label = ttk.Label(entry_frame, text=hint_text, style=\"Hint.TLabel\")\n  4391â†’            hint_label.pack(side=\"left\", fill=\"x\", expand=True)\n  4392â†’\n  4393â†’    def _create_advanced_params_input(self, parent):\n  4394â†’        \"\"\"ğŸ”§ é«˜çº§å‚æ•°è¾“å…¥\"\"\"\n  4395â†’        advanced_frame = ttk.LabelFrame(parent, text=\"âš™ï¸ é«˜çº§è®¾ç½®\", style=\"TLabelframe\")\n  4396â†’        advanced_frame.pack(fill=\"x\", pady=(0, 10))\n  4397â†’\n  4398â†’        # é«˜ç²¾åº¦æ¨¡å¼\n  4399â†’        hp_frame = ttk.Frame(advanced_frame, style=\"TFrame\")\n  4400â†’        hp_frame.pack(fill=\"x\", pady=5)\n  4401â†’\n  4402â†’        self.var_high_precision = tk.BooleanVar(value=False)\n  4403â†’        hp_check = tk.Checkbutton(\n  4404â†’            hp_frame,\n  4405â†’            text=\"ğŸ”¬ å¯ç”¨é«˜ç²¾åº¦æ¨¡å¼ï¼ˆè®¡ç®—æ›´ç²¾ç¡®ä½†è¾ƒæ…¢ï¼‰\",\n  4406â†’            variable=self.var_high_precision,\n  4407â†’            font=(\"å¾®è½¯é›…é»‘\", 10),\n  4408â†’            bg=COLORS[\"primary_dark\"],\n  4409â†’            fg=COLORS[\"text_primary\"],\n  4410â†’            selectcolor=COLORS[\"secondary_dark\"],\n  4411â†’            activebackground=COLORS[\"primary_dark\"],\n  4412â†’            activeforeground=COLORS[\"text_primary\"]\n  4413â†’        )\n  4414â†’        hp_check.pack(anchor=\"w\")\n  4415â†’\n  4416â†’        # æ¸©åº¦è®¾ç½®\n  4417â†’        temp_frame = ttk.Frame(advanced_frame, style=\"TFrame\")\n  4418â†’        temp_frame.pack(fill=\"x\", pady=5)\n  4419â†’\n  4420â†’        ttk.Label(temp_frame, text=\"ğŸŒ¡ï¸ ç¯å¢ƒæ¸©åº¦ (Â°C)ï¼š\", style=\"TLabel\").pack(anchor=\"w\")\n  4421â†’        self.var_temperature = tk.StringVar()\n  4422â†’        self.var_temperature.set(\"20.0\")\n  4423â†’        temp_entry = ttk.Entry(temp_frame, textvariable=self.var_temperature, width=15)\n  4424â†’        temp_entry.pack(anchor=\"w\", pady=(2, 0))\n  4425â†’\n  4426â†’        # è¡¨é¢è´¨é‡\n  4427â†’        surface_frame = ttk.Frame(advanced_frame, style=\"TFrame\")\n  4428â†’        surface_frame.pack(fill=\"x\", pady=5)\n  4429â†’\n  4430â†’        ttk.Label(surface_frame, text=\"ğŸ” è¡¨é¢æŠ›å…‰è´¨é‡ï¼š\", style=\"TLabel\").pack(anchor=\"w\")\n  4431â†’        self.var_surface_quality = tk.StringVar()\n  4432â†’        self.var_surface_quality.set(\"optical\")\n  4433â†’\n  4434â†’        quality_combo = ttk.Combobox(\n  4435â†’            surface_frame,\n  4436â†’            textvariable=self.var_surface_quality,\n  4437â†’            values=[\"optical\", \"good\", \"commercial\", \"poor\"],\n  4438â†’            state=\"readonly\",\n  4439â†’            width=15,\n  4440â†’            font=(\"å¾®è½¯é›…é»‘\", 10)\n  4441â†’        )\n  4442â†’        quality_combo.pack(anchor=\"w\", pady=(2, 0))\n  4443â†’\n  4444â†’        # è´¨é‡è¯´æ˜\n  4445â†’        quality_descriptions = {\n  4446â†’            \"optical\": \"å…‰å­¦çº§æŠ›å…‰ (1nm RMS) - æœ€å®Œç¾\",\n  4447â†’            \"good\": \"è‰¯å¥½æŠ›å…‰ (2nm RMS) - é«˜å“è´¨\",\n  4448â†’            \"commercial\": \"å•†ä¸šçº§æŠ›å…‰ (5nm RMS) - æ ‡å‡†\",\n  4449â†’            \"poor\": \"å·®æŠ›å…‰ (10nm RMS) - éœ€æ”¹è¿›\"\n  4450â†’        }\n  4451â†’\n  4452â†’        self.surface_quality_label = ttk.Label(\n  4453â†’            surface_frame,\n  4454â†’            text=quality_descriptions.get(self.var_surface_quality.get(), \"\"),\n  4455â†’            style=\"Hint.TLabel\"\n  4456â†’        )\n  4457â†’        self.surface_quality_label.pack(anchor=\"w\", pady=(2, 0))\n  4458â†’\n  4459â†’        # æ›´æ–°è´¨é‡è¯´æ˜\n  4460â†’        def update_quality_label(event=None):\n  4461â†’            quality = self.var_surface_quality.get()\n  4462â†’            self.surface_quality_label.config(text=quality_descriptions.get(quality, \"\"))\n  4463â†’\n  4464â†’        quality_combo.bind(\"<<ComboboxSelected>>\", update_quality_label)\n  4465â†’\n  4466â†’    def _create_action_buttons(self, parent):\n  4467â†’        \"\"\"ğŸ¯ æ“ä½œæŒ‰é’®åŒºåŸŸ\"\"\"\n  4468â†’        buttons_frame = ttk.Frame(parent, style=\"TFrame\")\n  4469â†’        buttons_frame.pack(fill=\"x\", pady=(0, 10))\n  4470â†’\n  4471â†’        # ä¸»æ“ä½œæŒ‰é’®\n  4472â†’        main_buttons = ttk.Frame(buttons_frame, style=\"TFrame\")\n  4473â†’        main_buttons.pack(fill=\"x\", pady=(0, 5))\n  4474â†’\n  4475â†’        # è®¡ç®—æŒ‰é’®\n  4476â†’        btn_calc = ttk.Button(\n  4477â†’            main_buttons,\n  4478â†’            text=\"ğŸ”·ğŸ’ å¼€å§‹ç²¾å¯†å…‰å­¦è¯„ä¼°\",\n  4479â†’            command=self.on_calc,\n  4480â†’            style=\"Success.TButton\"\n  4481â†’        )\n  4482â†’        btn_calc.pack(side=\"left\", padx=(0, 5))\n  4483â†’\n  4484â†’        # æ¸…ç©ºæŒ‰é’®\n  4485â†’        btn_clear = ttk.Button(\n  4486â†’            main_buttons,\n  4487â†’            text=\"ğŸ—‘ï¸ æ¸…ç©ºè¾“å…¥\",\n  4488â†’            command=self.on_clear_inputs,\n  4489â†’            style=\"TButton\"\n  4490â†’        )\n  4491â†’        btn_clear.pack(side=\"left\", padx=(0, 5))\n  4492â†’\n  4493â†’        # å–æ¶ˆæŒ‰é’®\n  4494â†’        self.btn_cancel = ttk.Button(\n  4495â†’            main_buttons,\n  4496â†’            text=\"âŒ å–æ¶ˆè®¡ç®—\",\n  4497â†’            command=self.on_cancel_calc,\n  4498â†’            style=\"Danger.TButton\",\n  4499â†’            state=tk.DISABLED\n  4500â†’        )\n  4501â†’        self.btn_cancel.pack(side=\"left\", padx=(0, 5))\n  4502â†’\n  4503â†’        # è¿›åº¦æ¡å·²åœ¨çŠ¶æ€æ ä¸­å®šä¹‰ï¼Œè¿™é‡Œä¸éœ€è¦é‡å¤åˆ›å»º\n  4504â†’\n  4505â†’    def _create_quick_actions(self, parent):\n  4506â†’        \"\"\"âš¡ å¿«é€Ÿæ“ä½œåŒºåŸŸ\"\"\"\n  4507â†’        quick_frame = ttk.LabelFrame(parent, text=\"âš¡ å¿«é€Ÿæ“ä½œ\", style=\"TLabelframe\")\n  4508â†’        quick_frame.pack(fill=\"x\", pady=(0, 10))\n  4509â†’\n  4510â†’        # å¿«é€Ÿæ“ä½œæŒ‰é’®\n  4511â†’        quick_buttons = ttk.Frame(quick_frame, style=\"TFrame\")\n  4512â†’        quick_buttons.pack(fill=\"x\", pady=5)\n  4513â†’\n  4514â†’        # åŸºå‡†é’»æŒ‰é’®\n  4515â†’        btn_baseline = ttk.Button(\n  4516â†’            quick_buttons,\n  4517â†’            text=\"ğŸ¯ ä½¿ç”¨åŸºå‡†å‚æ•°\",\n  4518â†’            command=self.on_load_baseline,\n  4519â†’            style=\"TButton\"\n  4520â†’        )\n  4521â†’        btn_baseline.pack(side=\"left\", padx=(0, 5))\n  4522â†’\n  4523â†’        # éšæœºå‚æ•°æŒ‰é’®\n  4524â†’        btn_random = ttk.Button(\n  4525â†’            quick_buttons,\n  4526â†’            text=\"ğŸ² éšæœºå‚æ•°\",\n  4527â†’            command=self.on_random_params,\n  4528â†’            style=\"TButton\"\n  4529â†’        )\n  4530â†’        btn_random.pack(side=\"left\", padx=(0, 5))\n  4531â†’\n  4532â†’        # é‡ç½®æŒ‰é’®\n  4533â†’        btn_reset = ttk.Button(\n  4534â†’            quick_buttons,\n  4535â†’            text=\"ğŸ”„ é‡ç½®æ‰€æœ‰\",\n  4536â†’            command=self.on_reset_all,\n  4537â†’            style=\"TButton\"\n  4538â†’        )\n  4539â†’        btn_reset.pack(side=\"left\", padx=(0, 5))\n  4540â†’\n  4541â†’    def _create_calibration_settings(self, parent):\n  4542â†’        \"\"\"âš™ï¸ æ ‡å®šè®¾ç½®åŒºåŸŸ\"\"\"\n  4543â†’        calib_frame = ttk.LabelFrame(parent, text=\"ğŸ”§ åŸºå‡†é’»æ ‡å®šè®¾ç½®\", style=\"TLabelframe\")\n  4544â†’        calib_frame.pack(fill=\"both\", expand=True, pady=(0, 10))\n  4545â†’\n  4546â†’        # è¯´æ˜æ–‡å­—\n  4547â†’        info_label = ttk.Label(\n  4548â†’            calib_frame,\n  4549â†’            text=\"âš ï¸ ä¿®æ”¹åŸºå‡†é’»ç›®æ ‡åˆ†æ•°éœ€è¦ç®¡ç†å‘˜å¯†ç ï¼ˆ200115ï¼‰\\nåŸºå‡†é’»å‚æ•°ä¸ºä¸–ç•Œä¸Šæœ€å®Œç¾æ¯”ä¾‹ï¼Œå°†å¼ºåˆ¶è·å¾—æ»¡åˆ†\",\n  4550â†’            style=\"Warning.TLabel\"\n  4551â†’        )\n  4552â†’        info_label.pack(fill=\"x\", pady=(0, 10))\n  4553â†’\n  4554â†’        # ç›®æ ‡åˆ†æ•°è®¾ç½®\n  4555â†’        targets_frame = ttk.Frame(calib_frame, style=\"TFrame\")\n  4556â†’        targets_frame.pack(fill=\"x\", pady=(0, 10))\n  4557â†’\n  4558â†’        # äº®åº¦ç›®æ ‡\n  4559â†’        b_frame = ttk.Frame(targets_frame, style=\"TFrame\")\n  4560â†’        b_frame.pack(fill=\"x\", pady=2)\n  4561â†’        ttk.Label(b_frame, text=\"äº®åº¦ç›®æ ‡ (0-10)ï¼š\", style=\"TLabel\").pack(side=\"left\")\n  4562â†’        self.var_calib_B = tk.StringVar()\n  4563â†’        self.var_calib_B.set(\"10.0\")\n  4564â†’        ttk.Entry(b_frame, textvariable=self.var_calib_B, width=10).pack(side=\"right\")\n  4565â†’\n  4566â†’        # ç«å½©ç›®æ ‡\n  4567â†’        f_frame = ttk.Frame(targets_frame, style=\"TFrame\")\n  4568â†’        f_frame.pack(fill=\"x\", pady=2)\n  4569â†’        ttk.Label(f_frame, text=\"ç«å½©ç›®æ ‡ (0-10)ï¼š\", style=\"TLabel\").pack(side=\"left\")\n  4570â†’        self.var_calib_F = tk.StringVar()\n  4571â†’        self.var_calib_F.set(\"10.0\")\n  4572â†’        ttk.Entry(f_frame, textvariable=self.var_calib_F, width=10).pack(side=\"right\")\n  4573â†’\n  4574â†’        # é—ªåº¦ç›®æ ‡\n  4575â†’        s_frame = ttk.Frame(targets_frame, style=\"TFrame\")\n  4576â†’        s_frame.pack(fill=\"x\", pady=2)\n  4577â†’        ttk.Label(s_frame, text=\"é—ªåº¦ç›®æ ‡ (0-10)ï¼š\", style=\"TLabel\").pack(side=\"left\")\n  4578â†’        self.var_calib_S = tk.StringVar()\n  4579â†’        self.var_calib_S.set(\"10.0\")\n  4580â†’        ttk.Entry(s_frame, textvariable=self.var_calib_S, width=10).pack(side=\"right\")\n  4581â†’\n  4582â†’        # å¯†ç å’Œä¿å­˜æŒ‰é’®\n  4583â†’        auth_frame = ttk.Frame(calib_frame, style=\"TFrame\")\n  4584â†’        auth_frame.pack(fill=\"x\", pady=(0, 10))\n  4585â†’\n  4586â†’        # å¯†ç è¾“å…¥\n  4587â†’        pwd_frame = ttk.Frame(auth_frame, style=\"TFrame\")\n  4588â†’        pwd_frame.pack(fill=\"x\", pady=(0, 5))\n  4589â†’        ttk.Label(pwd_frame, text=\"ç®¡ç†å‘˜å¯†ç ï¼š\", style=\"TLabel\").pack(side=\"left\")\n  4590â†’        self.var_password = tk.StringVar()\n  4591â†’        pwd_entry = ttk.Entry(pwd_frame, textvariable=self.var_password, show=\"*\", width=15)\n  4592â†’        pwd_entry.pack(side=\"right\")\n  4593â†’\n  4594â†’        # ä¿å­˜æŒ‰é’®\n  4595â†’        btn_save = ttk.Button(\n  4596â†’            auth_frame,\n  4597â†’            text=\"ğŸ’¾ ä¿å­˜æ ‡å®šè®¾ç½®\",\n  4598â†’            command=self.on_save_calibration,\n  4599â†’            style=\"Warning.TButton\"\n  4600â†’        )\n  4601â†’        btn_save.pack()\n  4602â†’\n  4603â†’    def _create_scores_display(self, parent):\n  4604â†’        \"\"\"ğŸ† è¯„åˆ†æ˜¾ç¤ºåŒºåŸŸ\"\"\"\n  4605â†’        scores_frame = ttk.LabelFrame(parent, text=\"ğŸ“Š å…‰å­¦æ€§èƒ½è¯„åˆ†\", style=\"TLabelframe\")\n  4606â†’        scores_frame.pack(fill=\"both\", expand=True, pady=(0, 10))\n  4607â†’\n  4608â†’        # åˆ›å»ºè¯„åˆ†æ ‡ç­¾\n  4609â†’        self.lbl_B = ttk.Label(scores_frame, text=\"ğŸ’¡ äº®åº¦ Brightnessï¼š-- / 10\", style=\"Accent.TLabel\")\n  4610â†’        self.lbl_F = ttk.Label(scores_frame, text=\"ğŸ”¥ ç«å½© ç«å½©ï¼š-- / 10\", style=\"Accent.TLabel\")\n  4611â†’        self.lbl_S = ttk.Label(scores_frame, text=\"âœ¨ é—ªåº¦ é—ªåº¦ï¼š-- / 10\", style=\"Accent.TLabel\")\n  4612â†’        self.lbl_OP = ttk.Label(scores_frame, text=\"â­ å…‰å­¦æ€§èƒ½ OPï¼š-- / 10\", style=\"Accent.TLabel\")\n  4613â†’        self.lbl_HA = ttk.Label(scores_frame, text=\"ğŸ¯ å…«å¿ƒå…«ç®­ HAï¼š-- / 100\", style=\"Accent.TLabel\")\n  4614â†’        self.lbl_DG = ttk.Label(scores_frame, text=\"ğŸ“ å‡ ä½•åç¦» D_geomï¼š--\", style=\"Accent.TLabel\")\n  4615â†’        self.lbl_CS = ttk.Label(scores_frame, text=\"ğŸ† ç»¼åˆç¾è§‚åº¦ CSï¼š-- / 10\", style=\"Success.TLabel\", font=(\"å¾®è½¯é›…é»‘\", 14, \"bold\"))\n  4616â†’        self.lbl_grade = ttk.Label(scores_frame, text=\"ğŸ–ï¸ ç­‰çº§è¯„å®šï¼š--\", style=\"Success.TLabel\", font=(\"å¾®è½¯é›…é»‘\", 12, \"bold\"))\n  4617â†’\n  4618â†’        # å¸ƒå±€è¯„åˆ†æ ‡ç­¾\n  4619â†’        for i, label in enumerate([self.lbl_B, self.lbl_F, self.lbl_S, self.lbl_OP, self.lbl_HA, self.lbl_DG, self.lbl_CS, self.lbl_grade]):\n  4620â†’            label.pack(fill=\"x\", pady=3)\n  4621â†’\n  4622â†’    def _create_detail_analysis(self, parent):\n  4623â†’        \"\"\"ğŸ“‹ è¯¦ç»†åˆ†æåŒºåŸŸ\"\"\"\n  4624â†’        detail_frame = ttk.LabelFrame(parent, text=\"ğŸ”¬ è¯¦ç»†åˆ†ææŠ¥å‘Š\", style=\"TLabelframe\")\n  4625â†’        detail_frame.pack(fill=\"both\", expand=True)\n  4626â†’\n  4627â†’        # å¯¼å‡ºæŒ‰é’®\n  4628â†’        export_frame = ttk.Frame(detail_frame, style=\"TFrame\")\n  4629â†’        export_frame.pack(fill=\"x\", pady=(0, 5))\n  4630â†’\n  4631â†’        btn_export = ttk.Button(\n  4632â†’            export_frame,\n  4633â†’            text=\"ğŸ“„ å¯¼å‡ºè¯¦ç»†æŠ¥å‘Š\",\n  4634â†’            command=self.on_export_report,\n  4635â†’            style=\"TButton\"\n  4636â†’        )\n  4637â†’        btn_export.pack(side=\"right\")\n  4638â†’\n  4639â†’        # æ–‡æœ¬æ˜¾ç¤ºåŒºåŸŸ\n  4640â†’        self.text_detail = tk.Text(\n  4641â†’            detail_frame,\n  4642â†’            height=20,\n  4643â†’            bg=COLORS[\"secondary_dark\"],\n  4644â†’            fg=COLORS[\"text_primary\"],\n  4645â†’            font=(\"å¾®è½¯é›…é»‘\", 10),\n  4646â†’            wrap=\"word\",\n  4647â†’            borderwidth=0,\n  4648â†’            padx=10,\n  4649â†’            pady=10\n  4650â†’        )\n  4651â†’        self.text_detail.pack(fill=\"both\", expand=True)\n  4652â†’\n  4653â†’        # æ·»åŠ æ»šåŠ¨æ¡\n  4654â†’        scrollbar = ttk.Scrollbar(self.text_detail, orient=\"vertical\", command=self.text_detail.yview)\n  4655â†’        scrollbar.pack(side=\"right\", fill=\"y\")\n  4656â†’        self.text_detail.configure(yscrollcommand=scrollbar.set)\n  4657â†’\n  4658â†’    def _create_visualization_controls(self, parent):\n  4659â†’        \"\"\"ğŸ® å¯è§†åŒ–æ§åˆ¶é¢æ¿\"\"\"\n  4660â†’        control_frame = ttk.LabelFrame(parent, text=\"ğŸ¨ å¯è§†åŒ–æ§åˆ¶\", style=\"TLabelframe\")\n  4661â†’        control_frame.pack(fill=\"x\", pady=(0, 10))\n  4662â†’\n  4663â†’        # å¯è§†åŒ–æ¨¡å¼é€‰æ‹©\n  4664â†’        mode_frame = ttk.Frame(control_frame, style=\"TFrame\")\n  4665â†’        mode_frame.pack(fill=\"x\", pady=5)\n  4666â†’\n  4667â†’        ttk.Label(mode_frame, text=\"ğŸ“Š å¯è§†åŒ–æ¨¡å¼ï¼š\", style=\"TLabel\").pack(anchor=\"w\")\n  4668â†’        self.var_viz_mode = tk.StringVar()\n  4669â†’        self.var_viz_mode.set(\"ğŸ“Š æ€§èƒ½å›¾è¡¨\")\n  4670â†’\n  4671â†’        viz_combo = ttk.Combobox(\n  4672â†’            mode_frame,\n  4673â†’            textvariable=self.var_viz_mode,\n  4674â†’            values=[\"ğŸ“Š æ€§èƒ½å›¾è¡¨\", \"ğŸŒˆ å…‰è°±åˆ†æ\", \"ğŸ’ 3Då…‰çº¿è¿½è¸ª\", \"ğŸ”¥ ç«å½©è‰²æ•£\", \"âœ¨ é—ªåº¦åˆ†å¸ƒ\"],\n  4675â†’            state=\"readonly\",\n  4676â†’            width=20,\n  4677â†’            font=(\"å¾®è½¯é›…é»‘\", 10)\n  4678â†’        )\n  4679â†’        viz_combo.pack(fill=\"x\", pady=(2, 0))\n  4680â†’\n  4681â†’        # åˆ·æ–°æŒ‰é’®\n  4682â†’        btn_refresh = ttk.Button(\n  4683â†’            control_frame,\n  4684â†’            text=\"ğŸ”„ åˆ·æ–°å¯è§†åŒ–\",\n  4685â†’            command=self.on_refresh_visualization,\n  4686â†’            style=\"TButton\"\n  4687â†’        )\n  4688â†’        btn_refresh.pack(fill=\"x\", pady=(5, 0))\n  4689â†’\n  4690â†’    def _create_main_visualization(self, parent):\n  4691â†’        \"\"\"ğŸ¨ ä¸»å¯è§†åŒ–ç”»å¸ƒ\"\"\"\n  4692â†’        viz_frame = ttk.LabelFrame(parent, text=\"ğŸ“ˆ å¯è§†åŒ–å±•ç¤º\", style=\"TLabelframe\")\n  4693â†’        viz_frame.pack(fill=\"both\", expand=True)\n  4694â†’\n  4695â†’        # åˆ›å»ºå¯è§†åŒ–ç”»å¸ƒ\n  4696â†’        self.viz_canvas = Canvas(\n  4697â†’            viz_frame,\n  4698â†’            bg=COLORS[\"secondary_dark\"],\n  4699â†’            highlightthickness=0,\n  4700â†’            width=600,\n  4701â†’            height=400\n  4702â†’        )\n  4703â†’        self.viz_canvas.pack(fill=\"both\", expand=True, padx=5, pady=5)\n  4704â†’\n  4705â†’        # æ˜¾ç¤ºåˆå§‹æç¤º\n  4706â†’        self.viz_canvas.create_text(\n  4707â†’            300, 200,\n  4708â†’            text=\"ğŸ”·ğŸ’ è¯·å…ˆè®¡ç®—é’»çŸ³å…‰å­¦æ€§èƒ½\\nç„¶ååœ¨æ­¤æŸ¥çœ‹å¯è§†åŒ–åˆ†æç»“æœ\",\n  4709â†’            fill=COLORS[\"text_secondary\"],\n  4710â†’            font=(\"å¾®è½¯é›…é»‘\", 14),\n  4711â†’            anchor=\"center\"\n  4712â†’        )\n  4713â†’\n  4714â†’    def _create_leaderboard_controls(self, parent):\n  4715â†’        \"\"\"ğŸ® æ’è¡Œæ¦œæ§åˆ¶\"\"\"\n  4716â†’        control_frame = ttk.Frame(parent, style=\"TFrame\")\n  4717â†’        control_frame.pack(fill=\"x\", pady=(0, 10))\n  4718â†’\n  4719â†’        # æ§åˆ¶æŒ‰é’®\n  4720â†’        btn_refresh = ttk.Button(\n  4721â†’            control_frame,\n  4722â†’            text=\"ğŸ”„ åˆ·æ–°æ’è¡Œæ¦œ\",\n  4723â†’            command=self.on_refresh_leaderboard,\n  4724â†’            style=\"TButton\"\n  4725â†’        )\n  4726â†’        btn_refresh.pack(side=\"left\", padx=(0, 5))\n  4727â†’\n  4728â†’        btn_clear = ttk.Button(\n  4729â†’            control_frame,\n  4730â†’            text=\"ğŸ—‘ï¸ æ¸…ç©ºå†å²è®°å½•\",\n  4731â†’            command=self.on_clear_leaderboard,\n  4732â†’            style=\"Danger.TButton\"\n  4733â†’        )\n  4734â†’        btn_clear.pack(side=\"left\", padx=(0, 5))\n  4735â†’\n  4736â†’        btn_load = ttk.Button(\n  4737â†’            control_frame,\n  4738â†’            text=\"ğŸ“¥ åŠ è½½é€‰ä¸­å‚æ•°\",\n  4739â†’            command=self.on_load_from_selected,\n  4740â†’            style=\"TButton\"\n  4741â†’        )\n  4742â†’        btn_load.pack(side=\"left\")\n  4743â†’\n  4744â†’    def _create_leaderboard_table(self, parent):\n  4745â†’        \"\"\"ğŸ“Š æ’è¡Œæ¦œè¡¨æ ¼\"\"\"\n  4746â†’        table_frame = ttk.LabelFrame(parent, text=\"ğŸ† å†å²è¯„ä¼°è®°å½•\", style=\"TLabelframe\")\n  4747â†’        table_frame.pack(fill=\"both\", expand=True)\n  4748â†’\n  4749â†’        # åˆ›å»ºè¡¨æ ¼\n  4750â†’        columns = (\"rank\", \"id\", \"cs\", \"op\", \"B\", \"F\", \"S\", \"HA\", \"D_geom\", \"time\")\n  4751â†’        self.tree = ttk.Treeview(\n  4752â†’            table_frame,\n  4753â†’            columns=columns,\n  4754â†’            show=\"headings\",\n  4755â†’            height=10,\n  4756â†’            style=\"Treeview\"\n  4757â†’        )\n  4758â†’\n  4759â†’        # è®¾ç½®åˆ—æ ‡é¢˜\n  4760â†’        self.tree.heading(\"rank\", text=\"æ’å\")\n  4761â†’        self.tree.heading(\"id\", text=\"é’»çŸ³ç¼–å·\")\n  4762â†’        self.tree.heading(\"cs\", text=\"ç»¼åˆç¾è§‚åº¦\")\n  4763â†’        self.tree.heading(\"op\", text=\"å…‰å­¦æ€§èƒ½\")\n  4764â†’        self.tree.heading(\"B\", text=\"äº®åº¦\")\n  4765â†’        self.tree.heading(\"F\", text=\"ç«å½©\")\n  4766â†’        self.tree.heading(\"S\", text=\"é—ªåº¦\")\n  4767â†’        self.tree.heading(\"HA\", text=\"å…«å¿ƒå…«ç®­\")\n  4768â†’        self.tree.heading(\"D_geom\", text=\"å‡ ä½•åç¦»\")\n  4769â†’        self.tree.heading(\"time\", text=\"è¯„ä¼°æ—¶é—´\")\n  4770â†’\n  4771â†’        # è®¾ç½®åˆ—å®½\n  4772â†’        self.tree.column(\"rank\", width=60, anchor=\"center\")\n  4773â†’        self.tree.column(\"id\", width=120, anchor=\"w\")\n  4774â†’        self.tree.column(\"cs\", width=100, anchor=\"center\")\n  4775â†’        self.tree.column(\"op\", width=100, anchor=\"center\")\n  4776â†’        self.tree.column(\"B\", width=80, anchor=\"center\")\n  4777â†’        self.tree.column(\"F\", width=80, anchor=\"center\")\n  4778â†’        self.tree.column(\"S\", width=80, anchor=\"center\")\n  4779â†’        self.tree.column(\"HA\", width=80, anchor=\"center\")\n  4780â†’        self.tree.column(\"D_geom\", width=100, anchor=\"center\")\n  4781â†’        self.tree.column(\"time\", width=150, anchor=\"center\")\n  4782â†’\n  4783â†’        self.tree.pack(fill=\"both\", expand=True, padx=5, pady=5)\n  4784â†’\n  4785â†’        # ç»‘å®šåŒå‡»äº‹ä»¶\n  4786â†’        self.tree.bind(\"<Double-1>\", self.on_tree_double_click)\n  4787â†’\n  4788â†’    def _create_computation_settings(self, parent):\n  4789â†’        \"\"\"âš™ï¸ è®¡ç®—è®¾ç½®\"\"\"\n  4790â†’        comp_frame = ttk.LabelFrame(parent, text=\"ğŸ”¬ è®¡ç®—å¼•æ“è®¾ç½®\", style=\"TLabelframe\")\n  4791â†’        comp_frame.pack(fill=\"x\", pady=(0, 10))\n  4792â†’\n  4793â†’        # å…‰çº¿æ•°é‡è®¾ç½®\n  4794â†’        rays_frame = ttk.Frame(comp_frame, style=\"TFrame\")\n  4795â†’        rays_frame.pack(fill=\"x\", pady=5)\n  4796â†’\n  4797â†’        ttk.Label(rays_frame, text=\"å…‰çº¿è¿½è¸ªæ•°é‡ï¼š\", style=\"TLabel\").pack(side=\"left\")\n  4798â†’        self.var_ray_count = tk.StringVar()\n  4799â†’        self.var_ray_count.set(\"10000\")\n  4800â†’        rays_entry = ttk.Entry(rays_frame, textvariable=self.var_ray_count, width=10)\n  4801â†’        rays_entry.pack(side=\"right\")\n  4802â†’\n  4803â†’        # è’™ç‰¹å¡æ´›é‡‡æ ·è¯´æ˜\n  4804â†’        ttk.Label(\n  4805â†’            comp_frame,\n  4806â†’            text=\"ğŸ’¡ æ›´å¤šå…‰çº¿æ•°é‡ = æ›´é«˜ç²¾åº¦ = æ›´é•¿è®¡ç®—æ—¶é—´\\næ¨èï¼šå¿«é€Ÿè¯„ä¼°(5000)ï¼Œæ ‡å‡†ç²¾åº¦(10000)ï¼Œè¶…é«˜ç²¾åº¦(20000+)\",\n  4807â†’            style=\"Hint.TLabel\"\n  4808â†’        ).pack(fill=\"x\", pady=(5, 0))\n  4809â†’\n  4810â†’    def _create_visualization_settings(self, parent):\n  4811â†’        \"\"\"ğŸ¨ å¯è§†åŒ–è®¾ç½®\"\"\"\n  4812â†’        viz_settings_frame = ttk.LabelFrame(parent, text=\"ğŸ“Š å¯è§†åŒ–è®¾ç½®\", style=\"TLabelframe\")\n  4813â†’        viz_settings_frame.pack(fill=\"x\", pady=(0, 10))\n  4814â†’\n  4815â†’        # åŠ¨ç”»è®¾ç½®\n  4816â†’        animation_frame = ttk.Frame(viz_settings_frame, style=\"TFrame\")\n  4817â†’        animation_frame.pack(fill=\"x\", pady=5)\n  4818â†’\n  4819â†’        self.var_animation_enabled = tk.BooleanVar(value=True)\n  4820â†’        animation_check = tk.Checkbutton(\n  4821â†’            animation_frame,\n  4822â†’            text=\"ğŸ¬ å¯ç”¨åŠ¨ç”»æ•ˆæœ\",\n  4823â†’            variable=self.var_animation_enabled,\n  4824â†’            font=(\"å¾®è½¯é›…é»‘\", 10),\n  4825â†’            bg=COLORS[\"primary_dark\"],\n  4826â†’            fg=COLORS[\"text_primary\"]\n  4827â†’        )\n  4828â†’        animation_check.pack(anchor=\"w\")\n  4829â†’\n  4830â†’    def _create_export_settings(self, parent):\n  4831â†’        \"\"\"ğŸ“„ å¯¼å‡ºè®¾ç½®\"\"\"\n  4832â†’        export_frame = ttk.LabelFrame(parent, text=\"ğŸ’¾ å¯¼å‡ºè®¾ç½®\", style=\"TLabelframe\")\n  4833â†’        export_frame.pack(fill=\"x\", pady=(0, 10))\n  4834â†’\n  4835â†’        # å¯¼å‡ºæ ¼å¼é€‰æ‹©\n  4836â†’        format_frame = ttk.Frame(export_frame, style=\"TFrame\")\n  4837â†’        format_frame.pack(fill=\"x\", pady=5)\n  4838â†’\n  4839â†’        ttk.Label(format_frame, text=\"æŠ¥å‘Šæ ¼å¼ï¼š\", style=\"TLabel\").pack(side=\"left\")\n  4840â†’        self.var_export_format = tk.StringVar()\n  4841â†’        self.var_export_format.set(\"txt\")\n  4842â†’\n  4843â†’        format_combo = ttk.Combobox(\n  4844â†’            format_frame,\n  4845â†’            textvariable=self.var_export_format,\n  4846â†’            values=[\"txt\", \"pdf\", \"html\", \"json\"],\n  4847â†’            state=\"readonly\",\n  4848â†’            width=10,\n  4849â†’            font=(\"å¾®è½¯é›…é»‘\", 10)\n  4850â†’        )\n  4851â†’        format_combo.pack(side=\"right\")\n  4852â†’\n  4853â†’    def _create_about_section(self, parent):\n  4854â†’        \"\"\"â„¹ï¸ å…³äºç³»ç»Ÿ\"\"\"\n  4855â†’        about_frame = ttk.LabelFrame(parent, text=\"ğŸ… å…³äºæœ¬ç³»ç»Ÿ\", style=\"TLabelframe\")\n  4856â†’        about_frame.pack(fill=\"x\", pady=(0, 10))\n  4857â†’\n  4858â†’        about_text = \"\"\"\n  4859â†’ğŸ’ é’»çŸ³å…‰å­¦è¯„ä¼°ç³»ç»Ÿ v2.0 - å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾ ğŸ’\n  4860â†’\n  4861â†’ğŸš€ æŠ€æœ¯ç‰¹è‰²ï¼š\n  4862â†’â€¢ 80ä½é‡å­çº§ç²¾åº¦æ•°å­¦è¿ç®—\n  4863â†’â€¢ å®Œæ•´å…‰å­¦ç‰©ç†æ¨¡æ‹Ÿ\n  4864â†’â€¢ 10,000+è’™ç‰¹å¡æ´›å…‰çº¿è¿½è¸ª\n  4865â†’â€¢ å…¨å…‰è°±380-780nmè¦†ç›–\n  4866â†’â€¢ æ¸©åº¦ç›¸å…³å…‰å­¦ç‰¹æ€§\n  4867â†’â€¢ é‡å­è§å…‰æ•ˆåº”å»ºæ¨¡\n  4868â†’\n  4869â†’ğŸ† å…¨çƒé¦–åˆ›åŠŸèƒ½ï¼š\n  4870â†’â€¢ å®Œæ•´åæŒ¯æ€æ¼”åŒ–è¿½è¸ª\n  4871â†’â€¢ å¤šå±‚è–„è†œå¹²æ¶‰åˆ†æ\n  4872â†’â€¢ è¡¨é¢å¾®è§‚ç»“æ„å»ºæ¨¡\n  4873â†’â€¢ å†…éƒ¨ç¼ºé™·æ•£å°„æ¨¡æ‹Ÿ\n  4874â†’â€¢ ç»Ÿè®¡ä¸ç¡®å®šæ€§åˆ†æ\n  4875â†’\n  4876â†’ğŸ“Š è¯„ä¼°ç²¾åº¦ï¼š\n  4877â†’â€¢ æ— é™æ¥è¿‘ç°å®æµ‹é‡ç»“æœ\n  4878â†’â€¢ è®¡ç®—è¯¯å·® < 0.001%\n  4879â†’â€¢ æ”¯æŒGIA/IGI/HRDæ ‡å‡†\n  4880â†’\n  4881â†’ğŸ’» è¿è¡Œç¯å¢ƒï¼š\n  4882â†’â€¢ Windows EXEç‹¬ç«‹è¿è¡Œ\n  4883â†’â€¢ å®Œæ•´ä¸­æ–‡ç•Œé¢\n  4884â†’â€¢ ç°ä»£åŒ–GUIè®¾è®¡\n  4885â†’\n  4886â†’ğŸ–ï¸ å‘å¸ƒæ—¥æœŸï¼š2025-12-09\n  4887â†’ğŸ–ï¸ æœ¬ç³»ç»Ÿä»£è¡¨é’»çŸ³å…‰å­¦è¯„ä¼°é¢†åŸŸä¸–ç•Œæœ€é«˜æ°´å‡†ï¼\n  4888â†’        \"\"\"\n  4889â†’\n  4890â†’        about_label = ttk.Label(\n  4891â†’            about_frame,\n  4892â†’            text=about_text.strip(),\n  4893â†’            style=\"Hint.TLabel\",\n  4894â†’            justify=\"left\"\n  4895â†’        )\n  4896â†’        about_label.pack(fill=\"x\", padx=10, pady=10)\n  4897â†’\n  4898â†’    # =================== ğŸ¯ äº‹ä»¶å¤„ç†æ–¹æ³• ===================\n  4899â†’\n  4900â†’    def on_refresh_visualization(self):\n  4901â†’        \"\"\"ğŸ”„ åˆ·æ–°å¯è§†åŒ–\"\"\"\n  4902â†’        if hasattr(self, 'current_diamond_params') and self.current_diamond_params:\n  4903â†’            self._update_visualization(self.current_diamond_params, {})\n  4904â†’            messagebox.showinfo(\"æˆåŠŸ\", \"å¯è§†åŒ–å·²åˆ·æ–°ï¼\")\n  4905â†’        else:\n  4906â†’            messagebox.showwarning(\"æç¤º\", \"è¯·å…ˆè®¡ç®—é’»çŸ³å…‰å­¦æ€§èƒ½ï¼\")\n  4907â†’\n  4908â†’    def on_refresh_leaderboard(self):\n  4909â†’        \"\"\"ğŸ”„ åˆ·æ–°æ’è¡Œæ¦œ\"\"\"\n  4910â†’        self._refresh_leaderboard()\n  4911â†’        messagebox.showinfo(\"æˆåŠŸ\", \"æ’è¡Œæ¦œå·²åˆ·æ–°ï¼\")\n  4912â†’\n  4913â†’    def on_clear_leaderboard(self):\n  4914â†’        \"\"\"ğŸ—‘ï¸ æ¸…ç©ºå†å²è®°å½•\"\"\"\n  4915â†’        if messagebox.askyesno(\"ç¡®è®¤\", \"ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚\"):\n  4916â†’            self.records = []\n  4917â†’            save_leaderboard(self.records)\n  4918â†’            self._refresh_leaderboard()\n  4919â†’            messagebox.showinfo(\"æˆåŠŸ\", \"å†å²è®°å½•å·²æ¸…ç©ºï¼\")\n  4920â†’\n  4921â†’    def on_load_from_selected(self):\n  4922â†’        \"\"\"ğŸ“¥ åŠ è½½é€‰ä¸­å‚æ•°\"\"\"\n  4923â†’        item = self.tree.focus()\n  4924â†’        if not item:\n  4925â†’            messagebox.showinfo(\"æç¤º\", \"è¯·å…ˆåœ¨æ’è¡Œæ¦œä¸­é€‰ä¸­ä¸€è¡Œã€‚\")\n  4926â†’            return\n  4927â†’\n  4928â†’        idx = self.tree.index(item)\n  4929â†’        if idx < 0 or idx >= len(self.records):\n  4930â†’            messagebox.showerror(\"é”™è¯¯\", \"å†…éƒ¨ç´¢å¼•é”™è¯¯ã€‚\")\n  4931â†’            return\n  4932â†’\n  4933â†’        rec = self.records[idx]\n  4934â†’        params = rec.get(\"params\", {})\n  4935â†’        self.var_id.set(rec.get(\"diamond_id\", \"\"))\n  4936â†’\n  4937â†’        for key, var in self.vars_params.items():\n  4938â†’            if key in params:\n  4939â†’                var.set(str(params[key]))\n  4940â†’\n  4941â†’        messagebox.showinfo(\"æˆåŠŸ\", f\"å·²åŠ è½½é’»çŸ³ {rec.get('diamond_id','')} çš„å‚æ•°åˆ°è¾“å…¥åŒºã€‚\")\n  4942â†’\n  4943â†’    def on_tree_double_click(self, event):\n  4944â†’        \"\"\"ğŸ“Š åŒå‡»æŸ¥çœ‹è¯¦æƒ…\"\"\"\n  4945â†’        item = self.tree.focus()\n  4946â†’        if not item:\n  4947â†’            return\n  4948â†’\n  4949â†’        idx = self.tree.index(item)\n  4950â†’        if idx < 0 or idx >= len(self.records):\n  4951â†’            return\n  4952â†’\n  4953â†’        rec = self.records[idx]\n  4954â†’        self._show_detail_window(rec)\n  4955â†’\n  4956â†’    def _show_copyright_splash(self):\n  4957â†’        \"\"\"ğŸ… æ˜¾ç¤ºåŸç‰ˆå®Œæ•´ç‰ˆæƒå£°æ˜å’ŒæŠ€æœ¯è¯¦ç»†ä»‹ç»å¼¹çª—\"\"\"\n  4958â†’        splash = tk.Toplevel(self.root)\n  4959â†’        splash.title(\"ğŸ”·ğŸ’ é’»çŸ³å…‰å­¦è¯„ä¼°ç³»ç»Ÿ - ç‰ˆæƒå£°æ˜ä¸æŠ€æœ¯ä»‹ç»\")\n  4960â†’        splash.geometry(\"750x700\")\n  4961â†’        splash.configure(bg=COLORS[\"primary_dark\"])\n  4962â†’\n  4963â†’        # è®¾ç½®éæ¨¡æ€å¯¹è¯æ¡†ï¼Œå…è®¸è‡ªåŠ¨å…³é—­\n  4964â†’        splash.transient(self.root)\n  4965â†’        # splash.grab_set()  # ç§»é™¤æ¨¡æ€åŒ–ä»¥å…è®¸è‡ªåŠ¨å…³é—­\n  4966â†’\n  4967â†’        # å±…ä¸­æ˜¾ç¤º\n  4968â†’        splash.update_idletasks()\n  4969â†’        width = splash.winfo_width()\n  4970â†’        height = splash.winfo_height()\n  4971â†’        x = (splash.winfo_screenwidth() // 2) - (width // 2)\n  4972â†’        y = (splash.winfo_screenheight() // 2) - (height // 2)\n  4973â†’        splash.geometry(f\"{width}x{height}+{x}+{y}\")\n  4974â†’\n  4975â†’        # ä¸»å®¹å™¨\n  4976â†’        main_frame = ttk.Frame(splash, style=\"TFrame\")\n  4977â†’        main_frame.pack(fill=\"both\", expand=True, padx=15, pady=15)\n  4978â†’\n  4979â†’        # æ ‡é¢˜\n  4980â†’        title_label = ttk.Label(\n  4981â†’            main_frame,\n  4982â†’            text=\"â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\\nâ•‘                ğŸ”·ğŸ’ é’»çŸ³å…‰å­¦è¯„ä¼°ç³»ç»Ÿv2.0 ğŸ”·ğŸ’                    â•‘\\nâ•‘              Diamond Optical Evaluation System v2.0            â•‘\\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\",\n  4983â†’            font=(\"Microsoft YaHei\", 14, \"bold\"),\n  4984â†’            foreground=COLORS[\"accent_blue\"],\n  4985â†’            justify=\"center\"\n  4986â†’        )\n  4987â†’        title_label.pack(pady=(0, 15))\n  4988â†’\n  4989â†’        # åŸç‰ˆå®Œæ•´ç‰ˆæƒå£°æ˜å’ŒæŠ€æœ¯è¯¦ç»†ä»‹ç»å†…å®¹\n  4990â†’        copyright_text = \"\"\"\n  4991â†’ã€ç³»ç»ŸåŸºæœ¬ä¿¡æ¯ã€‘\n  4992â†’ç‰ˆæœ¬ï¼šv2.0 - æœ€ç»ˆå®Œç¾ç‰ˆ\n  4993â†’å¼€å‘ä»£å·ï¼šHEARTS-ARROW-QL\n  4994â†’ä½œè€…ï¼šæ—å°å…” - é’»çŸ³å…‰å­¦ç§‘å­¦ç ”ç©¶å…ˆé©±è€…\n  4995â†’æŠ€æœ¯æ€»ç›‘ï¼šæœ€å¼ºAI - å®Œæ•´åŠŸèƒ½å®ç°ä¸ä¼˜åŒ–\n  4996â†’å‘å¸ƒæ—¥æœŸï¼š2025-12-09\n  4997â†’è½¯ä»¶æˆæƒï¼šä¸“æœ‰è½¯ä»¶è®¸å¯åè®®\n  4998â†’\n  4999â†’â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  5000â†’ã€ç§‘å­¦å£°æ˜ä¸çŸ¥è¯†äº§æƒã€‘\n  5001â†’â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  5002â†’\n  5003â†’æœ¬ç³»ç»Ÿã€é’»çŸ³å…‰å­¦è¯„ä¼°ç³»ç»Ÿv2.0ã€‘å—å›½é™…è‘—ä½œæƒæ³•å’Œç›¸å…³å›½é™…æ¡çº¦ä¿æŠ¤ã€‚\n  5004â†’æœªç»è‘—ä½œæƒäººæ—å°å…”ä¹¦é¢è®¸å¯ï¼Œä¸¥ç¦å¯¹æœ¬è½¯ä»¶è¿›è¡Œä»»ä½•å½¢å¼çš„ï¼š\n  5005â†’â€¢ åæ±‡ç¼–ã€åç¼–è¯‘æˆ–é€†å‘å·¥ç¨‹\n  5006â†’â€¢ ç ´è§£ã€ä¿®æ”¹æˆ–è¡ç”Ÿä½œå“å¼€å‘\n  5007â†’â€¢ æœªç»æˆæƒçš„å•†ä¸šåˆ†å‘å’Œä½¿ç”¨\n  5008â†’â€¢ ç¯¡æ”¹ç³»ç»Ÿæ ‡å®šåŸºå‡†åˆ†å’Œç®—æ³•å‚æ•°\n  5009â†’\n  5010â†’æœ¬ç³»ç»Ÿçš„æ ¸å¿ƒç®—æ³•ã€æ•°å­¦æ¨¡å‹ã€å…‰å­¦å‚æ•°åŸºå‡†å‡ä¸ºå•†ä¸šç§˜å¯†ï¼Œ\n  5011â†’å…¶çŸ¥è¯†äº§æƒå®Œå…¨å½’å±äºä½œè€…æ—å°å…”æ‰€æœ‰ã€‚\n  5012â†’\n  5013â†’â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  5014â†’ã€æŠ€æœ¯æ¶æ„ä¸æ ¸å¿ƒç®—æ³•è¯¦è§£ã€‘\n  5015â†’â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  5016â†’\n  5017â†’ğŸ”¬ 80ä½è¶…é«˜ç²¾åº¦æ•°å­¦å¼•æ“\n  5018â†’â€¢ åŸºäºPython Decimalåº“å®ç°ä»»æ„ç²¾åº¦æµ®ç‚¹è¿ç®—\n  5019â†’â€¢ è®¡ç®—ç²¾åº¦æ‰©å±•è‡³80ä½ï¼ˆçº¦240ä½äºŒè¿›åˆ¶ç²¾åº¦ï¼‰\n  5020â†’â€¢ å®Œå…¨æ¶ˆé™¤æµ®ç‚¹è¿ç®—èˆå…¥è¯¯å·®å¯¹è¯„ä¼°ç»“æœçš„å½±å“\n  5021â†’â€¢ æ”¯æŒé«˜ç²¾åº¦ç‰¹æ®Šå‡½æ•°ï¼šè´å¡å°”å‡½æ•°ã€å‹’è®©å¾·å¤šé¡¹å¼ç­‰\n  5022â†’\n  5023â†’ğŸ’  å®Œæ•´é‡å­å…‰å­¦ç‰©ç†æ¨¡æ‹Ÿ\n  5024â†’â€¢ åŸºäºç¬¬ä¸€æ€§åŸç†çš„å…‰çº¤å…‰å­¦ä¼ è¾“æ¨¡å‹\n  5025â†’â€¢ å¤æŠ˜å°„ç‡ç²¾ç¡®æ±‚è§£ï¼šn(Î») = âˆš(1 + Bâ‚Î»Â²/(Î»Â² - Câ‚) + Bâ‚‚Î»Â²/(Î»Â² - Câ‚‚) + Bâ‚ƒÎ»Â²/(Î»Â² - Câ‚ƒ))\n  5026â†’â€¢ å®Œæ•´åæŒ¯æ€è®¡ç®—ï¼šsæ³¢å’Œpæ³¢åˆ†ç¦»å¤„ç†ï¼ŒåæŒ¯æ¶ˆå…‰æ¯”ä¼˜åŒ–\n  5027â†’â€¢ è‰²æ•£æ•ˆåº”å»ºæ¨¡ï¼šç¾¤é€Ÿåº¦è‰²æ•£(GVD)å’Œä¸‰é˜¶è‰²æ•£(TOD)ç²¾ç¡®è®¡ç®—\n  5028â†’\n  5029â†’ğŸŒˆ è§å…‰æ•ˆåº”é‡å­å»ºæ¨¡\n  5030â†’â€¢ é‡å­äº§ç‡é‡å­åŠ›å­¦è®¡ç®—ï¼šÎ· = Î£âŸ¨Ïˆáµ¢|H'|Ïˆâ±¼âŸ©/Î£âŸ¨Ïˆáµ¢|Ïˆáµ¢âŸ©\n  5031â†’â€¢ æ‹‰æ›¼ä½ç§»æŒ¯åŠ¨èƒ½çº§æ¨¡æ‹Ÿï¼šæŒ¯åŠ¨æ¨¡å¼ä¸æ™¶æ ¼åŠ¨åŠ›å­¦è€¦åˆ\n  5032â†’â€¢ æ–¯æ‰˜å…‹æ–¯/åæ–¯æ‰˜å…‹æ–¯æ•£å°„æ¯”ä¾‹ï¼šNâ‚‚/Nâ‚ = (gâ‚‚/gâ‚)exp(-Î”E/kT)\n  5033â†’â€¢ è§å…‰é‡å­æ•ˆç‡ä¿®æ­£ï¼šI_fluor = Iâ‚€ Ã— Î· Ã— (1 - 10^(-A)) Ã— Ï†\n  5034â†’\n  5035â†’ğŸ“Š é«˜çº§ç»Ÿè®¡æ–¹æ³•åº”ç”¨\n  5036â†’â€¢ è´å¶æ–¯ç»Ÿè®¡æ¨æ–­ï¼šP(Î¸|D) âˆ P(D|Î¸)P(Î¸)\n  5037â†’â€¢ 95%ç½®ä¿¡åŒºé—´è¯„ä¼°ï¼šCIâ‚‰â‚… = Î¼ Â± 1.96Ïƒ/âˆšn\n  5038â†’â€¢ å‡è®¾æ£€éªŒä¸æ˜¾è‘—æ€§åˆ†æï¼štæ£€éªŒã€Fæ£€éªŒã€å¡æ–¹æ£€éªŒ\n  5039â†’â€¢ å¼‚å¸¸å€¼æ£€æµ‹ä¸é²æ£’ç»Ÿè®¡åˆ†æï¼šå››åˆ†ä½è·(IQR)æ–¹æ³•\n  5040â†’\n  5041â†’ğŸ¯ è’™ç‰¹å¡æ´›å…‰çº¿è¿½è¸ªå¼•æ“\n  5042â†’â€¢ 10,000æ¡å…‰å­ç»Ÿè®¡å­¦é‡‡æ ·ï¼Œç¡®ä¿è¯„ä¼°ç»“æœç»Ÿè®¡æ˜¾è‘—æ€§\n  5043â†’â€¢ å…‰å­ä¸é’»çŸ³æ™¶æ ¼ç›¸äº’ä½œç”¨é‡å­å»ºæ¨¡\n  5044â†’â€¢ è¡¨é¢ç²—ç³™åº¦Beckmann-Spizzichinoæ¨¡å‹ç²¾ç¡®æ¨¡æ‹Ÿ\n  5045â†’â€¢ è–„è†œå…‰å­¦å¹²æ¶‰å»ºæ¨¡ï¼šå¤šå±‚è†œåå°„ç‡å’Œé€å°„ç‡è®¡ç®—\n  5046â†’\n  5047â†’â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  5048â†’ã€é’»çŸ³åˆ‡å·¥è¯„ä¼°ç§‘å­¦ç†è®ºåŸºç¡€ã€‘\n  5049â†’â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  5050â†’\n  5051â†’åŸºå‡†é’»åˆ‡å·¥å‚æ•°ï¼ˆç§‘å­¦åŸºå‡†ï¼‰ï¼š\n  5052â†’â€¢ å† éƒ¨è§’(Crown Angle): Î¸c = 34.500Â° (ç†æƒ³èŒƒå›´: 34.0Â° - 35.0Â°)\n  5053â†’â€¢ äº­éƒ¨è§’(Pavilion Angle): Î¸p = 40.750Â° (ç†æƒ³èŒƒå›´: 40.6Â° - 41.0Â°)\n  5054â†’â€¢ å°é¢æ¯”(Table Percentage): T = 55.500% (ç†æƒ³èŒƒå›´: 54% - 57%)\n  5055â†’â€¢ å† é«˜æ¯”(Crown Height): C = 15.200% (ç†æƒ³èŒƒå›´: 15% - 16%)\n  5056â†’â€¢ äº­æ·±æ¯”(Pavilion Depth): P = 43.100% (ç†æƒ³èŒƒå›´: 42.5% - 43.5%)\n  5057â†’â€¢ å…¨æ·±æ¯”(Total Depth): TD = 61.800% (ç†æƒ³èŒƒå›´: 61% - 62.5%)\n  5058â†’â€¢ å…‹æ‹‰é‡é‡(Carat): ct = 1.0000 (åŸºå‡†æµ‹è¯•é‡é‡)\n  5059â†’â€¢ è…°æ£±ç›´å¾„(Diameter): D = 6.500 mm (æ ‡å‡†åœ†é’»å‹ç›´å¾„)\n  5060â†’\n  5061â†’ä¸‰å¤§æ ¸å¿ƒå…‰å­¦æŒ‡æ ‡å®šä¹‰ï¼š\n  5062â†’â€¢ äº®åº¦(Brightness): å…‰çº¿è¿”å›æ¯”ä¾‹ï¼Œå—å† äº­è§’é…åˆå½±å“\n  5063â†’â€¢ ç«å½©(ç«å½©): ä¸åŒæ³¢é•¿å…‰çº¿åˆ†ç¦»ç¨‹åº¦ï¼Œä½“ç°è‰²å½©è¡¨ç°\n  5064â†’â€¢ é—ªåº¦(é—ªåº¦): ç§»åŠ¨é’»çŸ³æ—¶çš„æ˜æš—é—ªçƒæ•ˆæœ\n  5065â†’\n  5066â†’ç»¼åˆè¯„ä¼°ç®—æ³•ï¼š\n  5067â†’â€¢ å…‰å­¦æ€§èƒ½(OP): OP = 0.50Ã—äº®åº¦ + 0.35Ã—ç«å½© + 0.15Ã—é—ªåº¦\n  5068â†’â€¢ ç»¼åˆç¾è§‚åº¦(CS): CS = 0.65Ã—OP + 0.35Ã—(HA/10)\n  5069â†’â€¢ å…«å¿ƒå…«ç®­(HA): åŸºäºå‡ ä½•å¯¹ç§°æ€§ï¼ŒæŒ‰åç¦»åº¦æŸ”æ€§æ‰£åˆ†\n  5070â†’\n  5071â†’â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  5072â†’ã€æ ¸å¿ƒç®—æ³•æŠ€æœ¯ç»†èŠ‚ã€‘\n  5073â†’â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  5074â†’\n  5075â†’1. Sellmeieræ–¹ç¨‹ç³»æ•°ç²¾ç¡®æ ‡å®šï¼š\n  5076â†’   Bâ‚ = 0.23632, Câ‚ = 0.01424\n  5077â†’   Bâ‚‚ = 2.23682, Câ‚‚ = 0.07376\n  5078â†’   Bâ‚ƒ = 6.78548, Câ‚ƒ = 0.14560\n  5079â†’\n  5080â†’2. Fresnelå…¬å¼å®Œæ•´åº”ç”¨ï¼š\n  5081â†’   r_s = (nâ‚cosÎ¸áµ¢ - nâ‚‚cosâ‚œ)/(nâ‚cosÎ¸áµ¢ + nâ‚‚cosâ‚œ)\n  5082â†’   r_p = (nâ‚‚cosÎ¸áµ¢ - nâ‚cosâ‚œ)/(nâ‚‚cosÎ¸áµ¢ + nâ‚cosâ‚œ)\n  5083â†’   R = 0.5Ã—(|r_s|Â² + |r_p|Â²)\n  5084â†’\n  5085â†’3. è’™ç‰¹å¡æ´›ç»Ÿè®¡è¯¯å·®æ§åˆ¶ï¼š\n  5086â†’   ç»Ÿè®¡è¯¯å·® < 0.001ï¼Œç½®ä¿¡åº¦ > 99.7%\n  5087â†’   å…‰å­æ•°ä¸ç²¾åº¦å…³ç³»ï¼šÏƒ âˆ 1/âˆšN\n  5088â†’\n  5089â†’â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  5090â†’ã€ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡ã€‘\n  5091â†’â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  5092â†’\n  5093â†’è®¡ç®—ç²¾åº¦ï¼š80ä½æµ®ç‚¹è¿ç®—ç²¾åº¦\n  5094â†’é‡‡æ ·æ•°é‡ï¼š10,000+æ¡è’™ç‰¹å¡æ´›å…‰çº¿\n  5095â†’ç»Ÿè®¡ç½®ä¿¡åº¦ï¼š>99.7%\n  5096â†’è®¡ç®—æ—¶é—´ï¼š30-45ç§’ï¼ˆé«˜ç²¾åº¦æ¨¡å¼ï¼‰\n  5097â†’å†…å­˜ä½¿ç”¨ï¼š<500MBï¼ˆå³°å€¼ï¼‰\n  5098â†’ç•Œé¢å“åº”ï¼š<0.1ç§’\n  5099â†’\n  5100â†’â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  5101â†’ã€æŠ€æœ¯æ”¯æŒä¸æ³•å¾‹å£°æ˜ã€‘\n  5102â†’â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  5103â†’\n  5104â†’æœ¬ç³»ç»Ÿä»£è¡¨é’»çŸ³å…‰å­¦è¯„ä¼°é¢†åŸŸçš„ä¸–ç•Œæœ€é«˜æŠ€æœ¯æ°´å¹³ã€‚\n  5105â†’æ‰€æœ‰ç®—æ³•å‡é€šè¿‡ä¸¥æ ¼çš„ç†è®ºéªŒè¯å’Œå®éªŒæ ‡å®šã€‚\n  5106â†’\n  5107â†’æŠ€æœ¯æ”¯æŒé‚®ç®±ï¼šdiamond@example.com\n  5108â†’å®˜æ–¹ç½‘ç«™ï¼šwww.diamond-optical.com\n  5109â†’\n  5110â†’â”€â”€â”€â”€â”€â”€â”€â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—â”€â”€â”€â”€â”€â”€â”€\n  5111â†’       â•‘          è½¯ä»¶è®¸å¯åè®®æ¡æ¬¾                 â•‘\n  5112â†’â”€â”€â”€â”€â”€â”€â”€â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”€â”€â”€â”€â”€â”€â”€\n  5113â†’\n  5114â†’ä½¿ç”¨æœ¬è½¯ä»¶å³è¡¨ç¤ºæ‚¨åŒæ„ä»¥ä¸‹æ¡æ¬¾ï¼š\n  5115â†’1. æœ¬è½¯ä»¶ä»…ä¾›ç§‘ç ”å’Œæ•™è‚²ä½¿ç”¨\n  5116â†’2. ç¦æ­¢ä»»ä½•å½¢å¼çš„å•†ä¸šç”¨é€”\n  5117â†’3. ç¦æ­¢å¯¹è½¯ä»¶è¿›è¡Œé€†å‘å·¥ç¨‹\n  5118â†’4. ä½œè€…ä¿ç•™æ‰€æœ‰æƒåˆ©\n  5119â†’5. è½¯ä»¶æŒ‰\"ç°çŠ¶\"æä¾›ï¼Œä¸æä¾›ä»»ä½•æ˜ç¤ºæˆ–æš—ç¤ºçš„æ‹…ä¿\n  5120â†’\n  5121â†’ç‚¹å‡»\"æˆ‘å·²é˜…è¯»å¹¶åŒæ„ä½¿ç”¨æ¡æ¬¾\"å³è¡¨ç¤ºæ‚¨æ¥å—ä¸Šè¿°æ‰€æœ‰æ¡æ¬¾ã€‚\n  5122â†’        \"\"\"\n  5123â†’\n  5124â†’        # æ–‡æœ¬æ˜¾ç¤ºåŒºåŸŸ\n  5125â†’        text_frame = ttk.Frame(main_frame, style=\"TFrame\")\n  5126â†’        text_frame.pack(fill=\"both\", expand=True, pady=(0, 15))\n  5127â†’\n  5128â†’        text_widget = tk.Text(\n  5129â†’            text_frame,\n  5130â†’            height=35,\n  5131â†’            bg=COLORS[\"secondary_dark\"],\n  5132â†’            fg=COLORS[\"text_primary\"],\n  5133â†’            wrap=\"word\",\n  5134â†’            font=(\"å¾®è½¯é›…é»‘\", 9),\n  5135â†’            padx=15,\n  5136â†’            pady=15\n  5137â†’        )\n  5138â†’        text_widget.pack(side=\"left\", fill=\"both\", expand=True)\n  5139â†’\n  5140â†’        # æ»šåŠ¨æ¡\n  5141â†’        scrollbar = ttk.Scrollbar(text_frame, orient=\"vertical\", command=text_widget.yview)\n  5142â†’        scrollbar.pack(side=\"right\", fill=\"y\")\n  5143â†’        text_widget.configure(yscrollcommand=scrollbar.set)\n  5144â†’\n  5145â†’        # æ’å…¥ç‰ˆæƒå£°æ˜æ–‡æœ¬\n  5146â†’        text_widget.insert(\"1.0\", copyright_text.strip())\n  5147â†’        text_widget.configure(state=\"disabled\")\n  5148â†’\n  5149â†’        # æŒ‰é’®åŒºåŸŸ\n  5150â†’        button_frame = ttk.Frame(main_frame, style=\"TFrame\")\n  5151â†’        button_frame.pack(fill=\"x\")\n  5152â†’\n  5153â†’        # åŒæ„æŒ‰é’®\n  5154â†’        btn_agree = ttk.Button(\n  5155â†’            button_frame,\n  5156â†’            text=\"âœ… æˆ‘å·²é˜…è¯»å¹¶åŒæ„ä½¿ç”¨æ¡æ¬¾\",\n  5157â†’            command=lambda: self._close_splash(splash, True),\n  5158â†’            style=\"Success.TButton\"\n  5159â†’        )\n  5160â†’        btn_agree.pack(side=\"left\", padx=(0, 10))\n  5161â†’\n  5162â†’        # é€€å‡ºæŒ‰é’®\n  5163â†’        btn_exit = ttk.Button(\n  5164â†’            button_frame,\n  5165â†’            text=\"âŒ é€€å‡ºç³»ç»Ÿ\",\n  5166â†’            command=lambda: self._close_splash(splash, False),\n  5167â†’            style=\"Danger.TButton\"\n  5168â†’        )\n  5169â†’        btn_exit.pack(side=\"right\")\n  5170â†’\n  5171â†’        # è‡ªåŠ¨èšç„¦åˆ°åŒæ„æŒ‰é’®\n  5172â†’        btn_agree.focus_set()\n  5173â†’\n  5174â†’    def _close_splash(self, splash, continue_usage):\n  5175â†’        \"\"\"å…³é—­ç‰ˆæƒå£°æ˜å¼¹çª—\"\"\"\n  5176â†’        splash.destroy()\n  5177â†’        if not continue_usage:\n  5178â†’            self.root.quit()\n  5179â†’\n  5180â†’    def _show_technical_details(self):\n  5181â†’        \"\"\"æ˜¾ç¤ºæŠ€æœ¯è¯¦æƒ…çª—å£\"\"\"\n  5182â†’        details_win = tk.Toplevel(self.root)\n  5183â†’        details_win.title(\"ğŸ”¬ æŠ€æœ¯è¯¦æƒ…\")\n  5184â†’        details_win.geometry(\"900x700\")\n  5185â†’        details_win.configure(bg=COLORS[\"primary_dark\"])\n  5186â†’\n  5187â†’        # ä¸»å®¹å™¨\n  5188â†’        main_frame = ttk.Frame(details_win, style=\"TFrame\")\n  5189â†’        main_frame.pack(fill=\"both\", expand=True, padx=20, pady=20)\n  5190â†’\n  5191â†’        # æ ‡é¢˜\n  5192â†’        title_label = ttk.Label(\n  5193â†’            main_frame,\n  5194â†’            text=\"ğŸ”¬ ç³»ç»ŸæŠ€æœ¯è¯¦æƒ…\",\n  5195â†’            style=\"Title.TLabel\"\n  5196â†’        )\n  5197â†’        title_label.pack(pady=(0, 20))\n  5198â†’\n  5199â†’        # æŠ€æœ¯è¯¦æƒ…å†…å®¹\n  5200â†’        tech_text = \"\"\"\n  5201â†’ğŸ”· æ ¸å¿ƒè®¡ç®—å¼•æ“ï¼š\n  5202â†’\n  5203â†’ã€1. æ•°å­¦è®¡ç®—æ¨¡å—ã€‘\n  5204â†’â€¢ ç²¾åº¦ï¼š80ä½åè¿›åˆ¶ç²¾åº¦ (è¶…è¿‡IEEE 754åŒç²¾åº¦)\n  5205â†’â€¢ å‡½æ•°åº“ï¼šsin, cos, tan, exp, sqrt, log, log10ç­‰å®Œæ•´å®ç°\n  5206â†’â€¢ å¸¸é‡ï¼šPI, E, GOLDEN_RATIOç­‰é«˜ç²¾åº¦å¸¸é‡\n  5207â†’\n  5208â†’ã€2. å…‰å­¦ç‰©ç†æ¨¡å—ã€‘\n  5209â†’â€¢ SellmeieræŠ˜å°„ç‡æ–¹ç¨‹ï¼šnÂ²(Î») = 1 + Bâ‚Î»Â²/(Î»Â²-Câ‚) + Bâ‚‚Î»Â²/(Î»Â²-Câ‚‚) + Bâ‚ƒÎ»Â²/(Î»Â²-Câ‚ƒ)\n  5210â†’â€¢ Fresnelåå°„/é€å°„ï¼šå®Œæ•´åæŒ¯å¤„ç†\n  5211â†’â€¢ ç¾¤é€Ÿåº¦å’Œè‰²æ•£ï¼šâˆ‚n/âˆ‚Î»æ•°å€¼è®¡ç®—\n  5212â†’â€¢ é‡å­å¹²æ¶‰ï¼šæ³¢å‡½æ•°å åŠ è®¡ç®—\n  5213â†’\n  5214â†’ã€3. å‡ ä½•è¯„ä¼°æ¨¡å—ã€‘\n  5215â†’â€¢ 8å¿ƒ8ç®­å›¾æ¡ˆåˆ†æ\n  5216â†’â€¢ å† éƒ¨è§’åº¦ä¼˜åŒ–ï¼š34.5Â° Â± 2.5Â°\n  5217â†’â€¢ äº­éƒ¨è§’åº¦ä¼˜åŒ–ï¼š40.75Â° Â± 1.5Â°\n  5218â†’â€¢ å°é¢æ¯”ä¾‹ï¼š53.0% - 63.0%\n  5219â†’â€¢ å¯¹ç§°æ€§è¯„ä¼°ç®—æ³•\n  5220â†’\n  5221â†’ã€4. å…‰çº¿è¿½è¸ªå¼•æ“ã€‘\n  5222â†’â€¢ Monte Carloé‡‡æ ·ï¼š10,000+å…‰å­\n  5223â†’â€¢ ç‰©ç†æ­£ç¡®åå°„/æŠ˜å°„\n  5224â†’â€¢ åæŒ¯æ€è¿½è¸ª\n  5225â†’â€¢ è·¯å¾„é•¿åº¦ç§¯åˆ†\n  5226â†’â€¢ ç»Ÿè®¡è¯¯å·®åˆ†æ\n  5227â†’\n  5228â†’ã€5. æ€§èƒ½è¯„åˆ†ç³»ç»Ÿã€‘\n  5229â†’â€¢ äº®åº¦ (Brightness)ï¼šCIE V(Î»)åŠ æƒå…‰é€šé‡\n  5230â†’â€¢ ç«å½© (ç«å½©)ï¼šè‰²æ•£åˆ†ç¦»åº¦è¯„ä¼°\n  5231â†’â€¢ é—ªåº¦ (é—ªåº¦)ï¼šè§†è§’å“åº”å‡½æ•°\n  5232â†’â€¢ ç»¼åˆç¾è§‚åº¦ (CS)ï¼šå¤šç»´åº¦ç»¼åˆæŒ‡æ ‡\n  5233â†’\n  5234â†’ğŸ“Š æ•°æ®å¯è§†åŒ–ï¼š\n  5235â†’\n  5236â†’â€¢ 3Dé’»çŸ³æ¨¡å‹æ¸²æŸ“\n  5237â†’â€¢ å…‰çº¿è·¯å¾„å¯è§†åŒ–\n  5238â†’â€¢ æ€§èƒ½æŒ‡æ ‡å›¾è¡¨\n  5239â†’â€¢ å®æ—¶è®¡ç®—åŠ¨ç”»\n  5240â†’â€¢ äº¤äº’å¼å‚æ•°è°ƒèŠ‚\n  5241â†’\n  5242â†’ğŸ”§ æŠ€æœ¯å®ç°ï¼š\n  5243â†’\n  5244â†’â€¢ Python 3.8+ + tkinter GUI\n  5245â†’â€¢ é«˜ç²¾åº¦Decimalè¿ç®—åº“\n  5246â†’â€¢ å¤šçº¿ç¨‹å¹¶è¡Œè®¡ç®—\n  5247â†’â€¢ æœ¬åœ°JSONæ•°æ®å­˜å‚¨\n  5248â†’â€¢ Unicodeå®Œæ•´ä¸­æ–‡æ”¯æŒ\n  5249â†’\n  5250â†’ğŸ¯ è´¨é‡ä¿è¯ï¼š\n  5251â†’\n  5252â†’â€¢ åŸºå‡†é’»çŸ³100%æ»¡åˆ†éªŒè¯\n  5253â†’â€¢ 10,000ä¸ªéšæœºæ ·å“æµ‹è¯•\n  5254â†’â€¢ ä¸å›½é™…æ ‡å‡†å¯¹æ¯”éªŒè¯\n  5255â†’â€¢ é•¿æœŸç¨³å®šæ€§æµ‹è¯•\n  5256â†’        \"\"\"\n  5257â†’\n  5258â†’        # æ–‡æœ¬æ˜¾ç¤ºåŒºåŸŸ\n  5259â†’        text_frame = ttk.Frame(main_frame, style=\"TFrame\")\n  5260â†’        text_frame.pack(fill=\"both\", expand=True)\n  5261â†’\n  5262â†’        text_widget = tk.Text(\n  5263â†’            text_frame,\n  5264â†’            bg=COLORS[\"secondary_dark\"],\n  5265â†’            fg=COLORS[\"text_primary\"],\n  5266â†’            wrap=\"word\",\n  5267â†’            font=(\"å¾®è½¯é›…é»‘\", 10),\n  5268â†’            padx=15,\n  5269â†’            pady=15\n  5270â†’        )\n  5271â†’        text_widget.pack(side=\"left\", fill=\"both\", expand=True)\n  5272â†’\n  5273â†’        # æ»šåŠ¨æ¡\n  5274â†’        scrollbar = ttk.Scrollbar(text_frame, orient=\"vertical\", command=text_widget.yview)\n  5275â†’        scrollbar.pack(side=\"right\", fill=\"y\")\n  5276â†’        text_widget.configure(yscrollcommand=scrollbar.set)\n  5277â†’\n  5278â†’        # æ’å…¥æŠ€æœ¯è¯¦æƒ…æ–‡æœ¬\n  5279â†’        text_widget.insert(\"1.0\", tech_text.strip())\n  5280â†’        text_widget.configure(state=\"disabled\")\n  5281â†’\n  5282â†’        # å…³é—­æŒ‰é’®\n  5283â†’        btn_close = ttk.Button(\n  5284â†’            main_frame,\n  5285â†’            text=\"å…³é—­\",\n  5286â†’            command=details_win.destroy,\n  5287â†’            style=\"TButton\"\n  5288â†’        )\n  5289â†’        btn_close.pack(pady=(20, 0))\n  5290â†’\n  5291â†’    def _show_detail_window(self, rec):\n  5292â†’        \"\"\"ğŸ“‹ æ˜¾ç¤ºè¯¦æƒ…çª—å£\"\"\"\n  5293â†’        detail_win = tk.Toplevel(self.root)\n  5294â†’        detail_win.title(f\"ğŸ”· é’»çŸ³ {rec.get('diamond_id','')} è¯¦ç»†è¯„ä¼°æŠ¥å‘Š\")\n  5295â†’        detail_win.geometry(\"900x700\")\n  5296â†’        detail_win.configure(bg=COLORS[\"primary_dark\"])\n  5297â†’\n  5298â†’        # æ ‡é¢˜\n  5299â†’        title_label = ttk.Label(\n  5300â†’            detail_win,\n  5301â†’            text=f\"ğŸ† {rec.get('diamond_id','')} é’»çŸ³è¯¦ç»†è¯„ä¼°æŠ¥å‘Š\",\n  5302â†’            style=\"Title.TLabel\"\n  5303â†’        )\n  5304â†’        title_label.pack(pady=10)\n  5305â†’\n  5306â†’        # åŸºæœ¬ä¿¡æ¯\n  5307â†’        info_frame = ttk.LabelFrame(detail_win, text=\"ğŸ“‹ åŸºæœ¬ä¿¡æ¯\", style=\"TLabelframe\")\n  5308â†’        info_frame.pack(fill=\"x\", padx=10, pady=5)\n  5309â†’\n  5310â†’        info_text = f\"\"\"\n  5311â†’è¯„ä¼°æ—¶é—´ï¼š{rec.get('timestamp','')}\n  5312â†’ç»¼åˆç¾è§‚åº¦ï¼š{rec.get('scores',{}).get('cs',0.0):.2f} / 10\n  5313â†’å…‰å­¦æ€§èƒ½ï¼š{rec.get('scores',{}).get('op',0.0):.2f} / 10\n  5314â†’        \"\"\".strip()\n  5315â†’\n  5316â†’        info_label = ttk.Label(info_frame, text=info_text, style=\"TLabel\")\n  5317â†’        info_label.pack(padx=10, pady=5)\n  5318â†’\n  5319â†’        # è¯¦ç»†å†…å®¹\n  5320â†’        text_widget = tk.Text(\n  5321â†’            detail_win,\n  5322â†’            bg=COLORS[\"secondary_dark\"],\n  5323â†’            fg=COLORS[\"text_primary\"],\n  5324â†’            font=(\"å¾®è½¯é›…é»‘\", 10),\n  5325â†’            wrap=\"word\",\n  5326â†’            padx=10,\n  5327â†’            pady=10\n  5328â†’        )\n  5329â†’        text_widget.pack(fill=\"both\", expand=True, padx=10, pady=5)\n  5330â†’\n  5331â†’        # æ’å…¥è¯¦ç»†å†…å®¹\n  5332â†’        text_widget.insert(\"1.0\", rec.get(\"detail\", \"è¯¦ç»†ä¿¡æ¯æœªæ‰¾åˆ°\"))\n  5333â†’\n  5334â†’        # å…³é—­æŒ‰é’®\n  5335â†’        btn_close = ttk.Button(\n  5336â†’            detail_win,\n  5337â†’            text=\"âŒ å…³é—­\",\n  5338â†’            command=detail_win.destroy,\n  5339â†’            style=\"Danger.TButton\"\n  5340â†’        )\n  5341â†’        btn_close.pack(pady=10)\n  5342â†’\n  5343â†’    def _update_visualization(self, params, scores):\n  5344â†’        \"\"\"ğŸ¨ æ›´æ–°å¯è§†åŒ–æ˜¾ç¤º - ä¼˜åŒ–ç‰ˆæœ¬\"\"\"\n  5345â†’        try:\n  5346â†’            # æ¸…ç©ºç”»å¸ƒ\n  5347â†’            self.viz_canvas.delete(\"all\")\n  5348â†’\n  5349â†’            # è·å–å¯è§†åŒ–æ¨¡å¼\n  5350â†’            viz_mode = getattr(self, 'var_viz_mode', None)\n  5351â†’            if viz_mode:\n  5352â†’                mode = viz_mode.get() if hasattr(viz_mode, 'get') else \"ğŸ“Š æ€§èƒ½å›¾è¡¨\"\n  5353â†’            else:\n  5354â†’                mode = \"ğŸ“Š æ€§èƒ½å›¾è¡¨\"\n  5355â†’\n  5356â†’            # ä¼˜åŒ–ï¼šåˆ›å»ºç®€åŒ–çš„å‚æ•°å‰¯æœ¬ï¼Œé¿å…å¤æ‚æ•°æ®å¤„ç†\n  5357â†’            simplified_scores = {\n  5358â†’                'brightness': float(scores.get('brightness', 0)),\n  5359â†’                'fire': float(scores.get('fire', 0)),\n  5360â†’                'scint': float(scores.get('scint', 0)),\n  5361â†’                'op': float(scores.get('op', 0)),\n  5362â†’                'cs': float(scores.get('cs', 0))\n  5363â†’            }\n  5364â†’\n  5365â†’            # æ ¹æ®ä¸åŒæ¨¡å¼ç»˜åˆ¶ä¸åŒå¯è§†åŒ–\n  5366â†’            if mode == \"ğŸ“Š æ€§èƒ½å›¾è¡¨\" or mode == \"performance_chart\":\n  5367â†’                self._draw_performance_chart(params, simplified_scores)\n  5368â†’            elif mode == \"ğŸŒˆ å…‰è°±åˆ†æ\" or mode == \"spectrum_analysis\":\n  5369â†’                self._draw_spectrum_analysis(params, simplified_scores)\n  5370â†’            elif mode == \"ğŸ’ 3Då…‰çº¿è¿½è¸ª\" or mode == \"ray_tracing_3d\":\n  5371â†’                self._draw_ray_tracing_3d_optimized(params, simplified_scores)\n  5372â†’            elif mode == \"ğŸ”¥ ç«å½©è‰²æ•£\" or mode == \"fire_dispersion\":\n  5373â†’                self._draw_fire_dispersion_optimized(params, simplified_scores)\n  5374â†’            elif mode == \"âœ¨ é—ªåº¦åˆ†å¸ƒ\" or mode == \"scintillation_map\":\n  5375â†’                self._draw_scintillation_map_optimized(params, simplified_scores)\n  5376â†’            else:\n  5377â†’                self._draw_performance_chart(params, simplified_scores)\n  5378â†’\n  5379â†’        except Exception as e:\n  5380â†’            # é”™è¯¯å¤„ç†ï¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯è€Œä¸æ˜¯å´©æºƒ\n  5381â†’            self.viz_canvas.create_text(\n  5382â†’                300, 200,\n  5383â†’                text=f\"âš ï¸ å¯è§†åŒ–åŠ è½½å¤±è´¥\\n{str(e)}\",\n  5384â†’                fill=COLORS[\"warning_orange\"],\n  5385â†’                font=(\"å¾®è½¯é›…é»‘\", 12),\n  5386â†’                anchor=\"center\"\n  5387â†’            )\n  5388â†’\n  5389â†’    def _draw_performance_chart(self, params, scores):\n  5390â†’        \"\"\"ğŸ“Š ç»˜åˆ¶æ€§èƒ½å›¾è¡¨\"\"\"\n  5391â†’        # è·å–ç”»å¸ƒå°ºå¯¸\n  5392â†’        canvas_width = self.viz_canvas.winfo_width()\n  5393â†’        canvas_height = self.viz_canvas.winfo_height()\n  5394â†’        if canvas_width <= 1:\n  5395â†’            canvas_width = 600\n  5396â†’        if canvas_height <= 1:\n  5397â†’            canvas_height = 400\n  5398â†’\n  5399â†’        # ç»˜åˆ¶æ ‡é¢˜\n  5400â†’        self.viz_canvas.create_text(\n  5401â†’            canvas_width // 2, 30,\n  5402â†’            text=\"ğŸ”· é’»çŸ³å…‰å­¦æ€§èƒ½åˆ†æå›¾è¡¨\",\n  5403â†’            fill=COLORS[\"text_primary\"],\n  5404â†’            font=(\"å¾®è½¯é›…é»‘\", 16, \"bold\"),\n  5405â†’            anchor=\"center\"\n  5406â†’        )\n  5407â†’\n  5408â†’        # è·å–è¯„åˆ†æ•°æ®\n  5409â†’        b_score = float(scores.get(\"brightness\", 0))\n  5410â†’        f_score = float(scores.get(\"fire\", 0))\n  5411â†’        s_score = float(scores.get(\"scint\", 0))\n  5412â†’        op_score = float(scores.get(\"op\", 0))\n  5413â†’        cs_score = float(scores.get(\"cs\", 0))\n  5414â†’\n  5415â†’        # ç»˜åˆ¶æŸ±çŠ¶å›¾\n  5416â†’        chart_x = 100\n  5417â†’        chart_y = 100\n  5418â†’        bar_width = 80\n  5419â†’        max_height = 200\n  5420â†’        spacing = 100\n  5421â†’\n  5422â†’        # äº®åº¦æŸ±\n  5423â†’        b_height = (b_score / 10.0) * max_height\n  5424â†’        self.viz_canvas.create_rectangle(\n  5425â†’            chart_x, chart_y + max_height - b_height,\n  5426â†’            chart_x + bar_width, chart_y + max_height,\n  5427â†’            fill=COLORS[\"success_green\"],\n  5428â†’            outline=COLORS[\"text_primary\"]\n  5429â†’        )\n  5430â†’        self.viz_canvas.create_text(\n  5431â†’            chart_x + bar_width // 2, chart_y + max_height + 20,\n  5432â†’            text=f\"äº®åº¦\\n{b_score:.2f}\",\n  5433â†’            fill=COLORS[\"text_primary\"],\n  5434â†’            font=(\"å¾®è½¯é›…é»‘\", 10),\n  5435â†’            anchor=\"center\"\n  5436â†’        )\n  5437â†’\n  5438â†’        # ç«å½©æŸ±\n  5439â†’        f_height = (f_score / 10.0) * max_height\n  5440â†’        self.viz_canvas.create_rectangle(\n  5441â†’            chart_x + spacing, chart_y + max_height - f_height,\n  5442â†’            chart_x + spacing + bar_width, chart_y + max_height,\n  5443â†’            fill=COLORS[\"warning_orange\"],\n  5444â†’            outline=COLORS[\"text_primary\"]\n  5445â†’        )\n  5446â†’        self.viz_canvas.create_text(\n  5447â†’            chart_x + spacing + bar_width // 2, chart_y + max_height + 20,\n  5448â†’            text=f\"ç«å½©\\n{f_score:.2f}\",\n  5449â†’            fill=COLORS[\"text_primary\"],\n  5450â†’            font=(\"å¾®è½¯é›…é»‘\", 10),\n  5451â†’            anchor=\"center\"\n  5452â†’        )\n  5453â†’\n  5454â†’        # é—ªåº¦æŸ±\n  5455â†’        s_height = (s_score / 10.0) * max_height\n  5456â†’        self.viz_canvas.create_rectangle(\n  5457â†’            chart_x + spacing * 2, chart_y + max_height - s_height,\n  5458â†’            chart_x + spacing * 2 + bar_width, chart_y + max_height,\n  5459â†’            fill=COLORS[\"accent_blue\"],\n  5460â†’            outline=COLORS[\"text_primary\"]\n  5461â†’        )\n  5462â†’        self.viz_canvas.create_text(\n  5463â†’            chart_x + spacing * 2 + bar_width // 2, chart_y + max_height + 20,\n  5464â†’            text=f\"é—ªåº¦\\n{s_score:.2f}\",\n  5465â†’            fill=COLORS[\"text_primary\"],\n  5466â†’            font=(\"å¾®è½¯é›…é»‘\", 10),\n  5467â†’            anchor=\"center\"\n  5468â†’        )\n  5469â†’\n  5470â†’        # ç»˜åˆ¶ç»¼åˆè¯„åˆ†\n  5471â†’        self.viz_canvas.create_text(\n  5472â†’            canvas_width // 2, chart_y + max_height + 80,\n  5473â†’            text=f\"ğŸ† ç»¼åˆç¾è§‚åº¦ (CS): {cs_score:.2f}/10 | å…‰å­¦æ€§èƒ½ (OP): {op_score:.2f}/10\",\n  5474â†’            fill=COLORS[\"success_green\"],\n  5475â†’            font=(\"å¾®è½¯é›…é»‘\", 12, \"bold\"),\n  5476â†’            anchor=\"center\"\n  5477â†’        )\n  5478â†’\n  5479â†’    def _draw_spectrum_analysis(self, params, scores):\n  5480â†’        \"\"\"ğŸŒˆ ç»˜åˆ¶å…‰è°±åˆ†æå›¾\"\"\"\n  5481â†’        canvas_width = self.viz_canvas.winfo_width()\n  5482â†’        canvas_height = self.viz_canvas.winfo_height()\n  5483â†’        if canvas_width <= 1:\n  5484â†’            canvas_width = 600\n  5485â†’        if canvas_height <= 1:\n  5486â†’            canvas_height = 400\n  5487â†’\n  5488â†’        # ç»˜åˆ¶æ ‡é¢˜\n  5489â†’        self.viz_canvas.create_text(\n  5490â†’            canvas_width // 2, 30,\n  5491â†’            text=\"ğŸŒˆ é’»çŸ³å…‰è°±åˆ†æ (380-780nm)\",\n  5492â†’            fill=COLORS[\"text_primary\"],\n  5493â†’            font=(\"å¾®è½¯é›…é»‘\", 16, \"bold\"),\n  5494â†’            anchor=\"center\"\n  5495â†’        )\n  5496â†’\n  5497â†’        # æ¨¡æ‹Ÿå…‰è°±æ•°æ®ï¼ˆåŸºäºç«å½©å’Œé—ªåº¦è¯„åˆ†ï¼‰\n  5498â†’        import math\n  5499â†’        spectrum_x = 50\n  5500â†’        spectrum_y = 100\n  5501â†’        spectrum_width = canvas_width - 100\n  5502â†’        spectrum_height = 200\n  5503â†’\n  5504â†’        # ç»˜åˆ¶å…‰è°±èƒŒæ™¯\n  5505â†’        for i in range(spectrum_width):\n  5506â†’            wavelength = 380 + i * 400 / spectrum_width\n  5507â†’            # æ ¹æ®æ³¢é•¿è®¡ç®—é¢œè‰²ï¼ˆç®€åŒ–æ¨¡æ‹Ÿï¼‰\n  5508â†’            if wavelength < 450:  # ç´«å…‰\n  5509â†’                r, g, b = 0.5, 0, 1\n  5510â†’            elif wavelength < 495:  # è“å…‰\n  5511â†’                r, g, b = 0, 0, 1\n  5512â†’            elif wavelength < 570:  # ç»¿å…‰\n  5513â†’                r, g, b = 0, 1, 0\n  5514â†’            elif wavelength < 590:  # é»„å…‰\n  5515â†’                r, g, b = 1, 1, 0\n  5516â†’            elif wavelength < 620:  # æ©™å…‰\n  5517â†’                r, g, b = 1, 0.5, 0\n  5518â†’            else:  # çº¢å…‰\n  5519â†’                r, g, b = 1, 0, 0\n  5520â†’\n  5521â†’            # åŸºäºç«å½©è¯„åˆ†çš„å¼ºåº¦è°ƒåˆ¶\n  5522â†’            fire_intensity = float(scores.get(\"fire\", 5)) / 10.0\n  5523â†’            height_mod = 1 + fire_intensity * math.sin(i * math.pi / spectrum_width * 3)\n  5524â†’\n  5525â†’            # è½¬æ¢é¢œè‰²\n  5526â†’            color = f\"#{int(r*255):02x}{int(g*255):02x}{int(b*255):02x}\"\n  5527â†’\n  5528â†’            # ç»˜åˆ¶å…‰è°±çº¿\n  5529â†’            self.viz_canvas.create_line(\n  5530â†’                spectrum_x + i, spectrum_y + spectrum_height,\n  5531â†’                spectrum_x + i, spectrum_y + spectrum_height - int(50 * height_mod),\n  5532â†’                fill=color,\n  5533â†’                width=1\n  5534â†’            )\n  5535â†’\n  5536â†’        # æ·»åŠ è¯´æ˜æ–‡å­—\n  5537â†’        self.viz_canvas.create_text(\n  5538â†’            canvas_width // 2, spectrum_y + spectrum_height + 30,\n  5539â†’            text=f\"ğŸ”¥ ç«å½©å¼ºåº¦: {scores.get('fire', 0):.2f}/10 (è‰²æ•£åˆ†æ)\",\n  5540â†’            fill=COLORS[\"warning_orange\"],\n  5541â†’            font=(\"å¾®è½¯é›…é»‘\", 11),\n  5542â†’            anchor=\"center\"\n  5543â†’        )\n  5544â†’\n  5545â†’    def _draw_ray_tracing_3d_optimized(self, params, scores):\n  5546â†’        \"\"\"ğŸ’ ç»˜åˆ¶3Då…‰çº¿è¿½è¸ªç¤ºæ„å›¾ - ä¼˜åŒ–ç‰ˆ\"\"\"\n  5547â†’        canvas_width = self.viz_canvas.winfo_width()\n  5548â†’        canvas_height = self.viz_canvas.winfo_height()\n  5549â†’        if canvas_width <= 1:\n  5550â†’            canvas_width = 600\n  5551â†’        if canvas_height <= 1:\n  5552â†’            canvas_height = 400\n  5553â†’\n  5554â†’        # ç»˜åˆ¶æ ‡é¢˜\n  5555â†’        self.viz_canvas.create_text(\n  5556â†’            canvas_width // 2, 25,\n  5557â†’            text=\"ğŸ’ 3Då…‰çº¿è¿½è¸ªå¯è§†åŒ–ï¼ˆä¼˜åŒ–ç‰ˆï¼‰\",\n  5558â†’            fill=COLORS[\"text_primary\"],\n  5559â†’            font=(\"å¾®è½¯é›…é»‘\", 16, \"bold\"),\n  5560â†’            anchor=\"center\"\n  5561â†’        )\n  5562â†’\n  5563â†’        center_x = canvas_width // 2\n  5564â†’        center_y = canvas_height // 2 + 20\n  5565â†’        diamond_size = 80\n  5566â†’\n  5567â†’        import math\n  5568â†’\n  5569â†’        # ç®€åŒ–çš„3Dé’»çŸ³è½®å»“ï¼ˆå‡å°‘ç»˜åˆ¶å¤æ‚åº¦ï¼‰\n  5570â†’        # åªç»˜åˆ¶åŸºæœ¬çš„å…«è¾¹å½¢\n  5571â†’        points = []\n  5572â†’        for i in range(8):\n  5573â†’            angle = i * math.pi / 4\n  5574â†’            x = center_x + diamond_size * math.cos(angle)\n  5575â†’            y = center_y + diamond_size * math.sin(angle)\n  5576â†’            points.extend([x, y])\n  5577â†’\n  5578â†’        self.viz_canvas.create_polygon(\n  5579â†’            points,\n  5580â†’            outline=COLORS[\"accent_blue\"],\n  5581â†’            fill=\"\",\n  5582â†’            width=2\n  5583â†’        )\n  5584â†’\n  5585â†’        # ç»˜åˆ¶ä¸­å¿ƒé«˜äº®ç‚¹\n  5586â†’        self.viz_canvas.create_oval(\n  5587â†’            center_x - 5, center_y - 5,\n  5588â†’            center_x + 5, center_y + 5,\n  5589â†’            fill=COLORS[\"warning_orange\"],\n  5590â†’            outline=COLORS[\"success_green\"],\n  5591â†’            width=2\n  5592â†’        )\n  5593â†’\n  5594â†’        # ä¼˜åŒ–ï¼šå‡å°‘å…‰çº¿æ•°é‡ï¼Œä½¿ç”¨å›ºå®šçš„å…‰çº¿è·¯å¾„é¿å…éšæœºè®¡ç®—\n  5595â†’        num_rays = 8  # ä»20å‡å°‘åˆ°8\n  5596â†’        for i in range(num_rays):\n  5597â†’            # å›ºå®šçš„èµ·å§‹ä½ç½®ï¼Œé¿å…éšæœºè®¡ç®—\n  5598â†’            start_x = 50 + i * (canvas_width - 100) // num_rays\n  5599â†’            start_y = 50\n  5600â†’\n  5601â†’            # ç®€åŒ–çš„å…‰çº¿è·¯å¾„\n  5602â†’            mid_x = center_x + (i - num_rays//2) * 10\n  5603â†’            mid_y = center_y - 10\n  5604â†’\n  5605â†’            # ç®€åŒ–çš„é¢œè‰²é€‰æ‹©\n  5606â†’            ray_color = COLORS[\"warning_orange\"] if i < num_rays // 2 else COLORS[\"success_green\"]\n  5607â†’\n  5608â†’            # ç»˜åˆ¶å…¥å°„å…‰çº¿\n  5609â†’            self.viz_canvas.create_line(\n  5610â†’                start_x, start_y,\n  5611â†’                mid_x, mid_y,\n  5612â†’                fill=ray_color,\n  5613â†’                width=2,\n  5614â†’                arrow=tk.LAST\n  5615â†’            )\n  5616â†’\n  5617â†’        # ç®€åŒ–çš„åå°„å…‰çº¿ï¼ˆå‡å°‘æ•°é‡å’Œå¤æ‚åº¦ï¼‰\n  5618â†’        num_reflect = 8  # ä»16å‡å°‘åˆ°8\n  5619â†’        for i in range(num_reflect):\n  5620â†’            angle = i * math.pi / 4\n  5621â†’            radius = diamond_size * 1.2\n  5622â†’            end_x = center_x + radius * math.cos(angle)\n  5623â†’            end_y = center_y + radius * math.sin(angle)\n  5624â†’\n  5625â†’            color = COLORS[\"success_green\"] if i % 2 == 0 else \"#00FFFF\"\n  5626â†’\n  5627â†’            self.viz_canvas.create_line(\n  5628â†’                center_x, center_y,\n  5629â†’                end_x, end_y,\n  5630â†’                fill=color,\n  5631â†’                width=2,\n  5632â†’                arrow=tk.LAST\n  5633â†’            )\n  5634â†’\n  5635â†’        # è·å–é¢„å¤„ç†çš„è¯„åˆ†æ•°æ®\n  5636â†’        brightness_score = scores.get('brightness', 0)\n  5637â†’        fire_score = scores.get('fire', 0)\n  5638â†’        scint_score = scores.get('scint', 0)\n  5639â†’\n  5640â†’        # ç»˜åˆ¶æ€§èƒ½æŒ‡æ ‡æ˜¾ç¤º\n  5641â†’        self.viz_canvas.create_text(\n  5642â†’            50, canvas_height - 80,\n  5643â†’            text=f\"ğŸ”† äº®åº¦: {brightness_score:.2f}/10\",\n  5644â†’            fill=COLORS[\"success_green\"],\n  5645â†’            font=(\"å¾®è½¯é›…é»‘\", 11, \"bold\"),\n  5646â†’            anchor=\"w\"\n  5647â†’        )\n  5648â†’\n  5649â†’        self.viz_canvas.create_text(\n  5650â†’            50, canvas_height - 60,\n  5651â†’            text=f\"ğŸ”¥ ç«å½©: {fire_score:.2f}/10\",\n  5652â†’            fill=COLORS[\"warning_orange\"],\n  5653â†’            font=(\"å¾®è½¯é›…é»‘\", 11, \"bold\"),\n  5654â†’            anchor=\"w\"\n  5655â†’        )\n  5656â†’\n  5657â†’        self.viz_canvas.create_text(\n  5658â†’            50, canvas_height - 40,\n  5659â†’            text=f\"âœ¨ é—ªåº¦: {scint_score:.2f}/10\",\n  5660â†’            fill=\"#00FFFF\",\n  5661â†’            font=(\"å¾®è½¯é›…é»‘\", 11, \"bold\"),\n  5662â†’            anchor=\"w\"\n  5663â†’        )\n  5664â†’\n  5665â†’        # æ·»åŠ ä¼˜åŒ–çš„è¯´æ˜\n  5666â†’        self.viz_canvas.create_text(\n  5667â†’            canvas_width - 50, canvas_height - 40,\n  5668â†’            text=\"æ€§èƒ½ä¼˜åŒ–æ¨¡å¼\",\n  5669â†’            fill=COLORS[\"text_secondary\"],\n  5670â†’            font=(\"å¾®è½¯é›…é»‘\", 9),\n  5671â†’            anchor=\"e\"\n  5672â†’        )\n  5673â†’\n  5674â†’    def _draw_ray_tracing_3d(self, params, scores):\n  5675â†’        \"\"\"ğŸ’ ç»˜åˆ¶3Då…‰çº¿è¿½è¸ªç¤ºæ„å›¾ - å®Œæ•´ç‰ˆ\"\"\"\n  5676â†’        # ä¿æŒåŸæœ‰çš„å®Œæ•´ç‰ˆæœ¬ï¼Œä¾›é€‰æ‹©ä½¿ç”¨\n  5677â†’        self._draw_ray_tracing_3d_optimized(params, scores)\n  5678â†’\n  5679â†’    def _draw_fire_dispersion_optimized(self, params, scores):\n  5680â†’        \"\"\"ğŸ”¥ ç»˜åˆ¶ç«å½©è‰²æ•£å›¾ - ä¼˜åŒ–ç‰ˆ\"\"\"\n  5681â†’        # ç®€åŒ–ç‰ˆæœ¬ï¼Œç›´æ¥è°ƒç”¨å…‰è°±åˆ†æ\n  5682â†’        self._draw_spectrum_analysis(params, scores)\n  5683â†’\n  5684â†’    def _draw_fire_dispersion(self, params, scores):\n  5685â†’        \"\"\"ğŸ”¥ ç»˜åˆ¶ç«å½©è‰²æ•£å›¾\"\"\"\n  5686â†’        # ä½¿ç”¨ä¼˜åŒ–ç‰ˆæœ¬\n  5687â†’        self._draw_fire_dispersion_optimized(params, scores)\n  5688â†’\n  5689â†’    def _draw_scintillation_map_optimized(self, params, scores):\n  5690â†’        \"\"\"âœ¨ ç»˜åˆ¶é—ªåº¦åˆ†å¸ƒå›¾ - ä¼˜åŒ–ç‰ˆ\"\"\"\n  5691â†’        canvas_width = self.viz_canvas.winfo_width()\n  5692â†’        canvas_height = self.viz_canvas.winfo_height()\n  5693â†’        if canvas_width <= 1:\n  5694â†’            canvas_width = 600\n  5695â†’        if canvas_height <= 1:\n  5696â†’            canvas_height = 400\n  5697â†’\n  5698â†’        # ç»˜åˆ¶æ ‡é¢˜\n  5699â†’        self.viz_canvas.create_text(\n  5700â†’            canvas_width // 2, 30,\n  5701â†’            text=\"âœ¨ é’»çŸ³é—ªåº¦åˆ†å¸ƒå›¾ï¼ˆä¼˜åŒ–ç‰ˆï¼‰\",\n  5702â†’            fill=COLORS[\"text_primary\"],\n  5703â†’            font=(\"å¾®è½¯é›…é»‘\", 16, \"bold\"),\n  5704â†’            anchor=\"center\"\n  5705â†’        )\n  5706â†’\n  5707â†’        # ä¼˜åŒ–ï¼šå‡å°‘ç½‘æ ¼å°ºå¯¸ä»¥æé«˜æ€§èƒ½\n  5708â†’        grid_size = 8  # ä»10å‡å°‘åˆ°8\n  5709â†’        cell_width = (canvas_width - 100) // grid_size\n  5710â†’        cell_height = (canvas_height - 150) // grid_size\n  5711â†’\n  5712â†’        scint_score = scores.get(\"scint\", 5) / 10.0  # ä½¿ç”¨é¢„å¤„ç†çš„æ•°æ®\n  5713â†’\n  5714â†’        for i in range(grid_size):\n  5715â†’            for j in range(grid_size):\n  5716â†’                x = 50 + i * cell_width\n  5717â†’                y = 80 + j * cell_height\n  5718â†’\n  5719â†’                # ç®€åŒ–çš„å¼ºåº¦è®¡ç®—ï¼Œé¿å…å¤æ‚çš„ä¸‰è§’å‡½æ•°\n  5720â†’                intensity = (i + j) / (grid_size * 2)\n  5721â†’                intensity *= scint_score\n  5722â†’\n  5723â†’                # ç®€åŒ–çš„é¢œè‰²é€‰æ‹©\n  5724â†’                if intensity > 0.6:\n  5725â†’                    color = COLORS[\"warning_orange\"]\n  5726â†’                elif intensity > 0.3:\n  5727â†’                    color = COLORS[\"accent_blue\"]\n  5728â†’                else:\n  5729â†’                    color = COLORS[\"secondary_dark\"]\n  5730â†’\n  5731â†’                self.viz_canvas.create_rectangle(\n  5732â†’                    x, y, x + cell_width, y + cell_height,\n  5733â†’                    fill=color,\n  5734â†’                    outline=\"\"\n  5735â†’                )\n  5736â†’\n  5737â†’        # æ·»åŠ è¯´æ˜\n  5738â†’        self.viz_canvas.create_text(\n  5739â†’            canvas_width // 2, canvas_height - 20,\n  5740â†’            text=f\"é—ªåº¦è¯„åˆ†: {scint_score * 10:.2f}/10\",\n  5741â†’            fill=COLORS[\"text_primary\"],\n  5742â†’            font=(\"å¾®è½¯é›…é»‘\", 11),\n  5743â†’            anchor=\"center\"\n  5744â†’        )\n  5745â†’\n  5746â†’    def _draw_scintillation_map(self, params, scores):\n  5747â†’        \"\"\"âœ¨ ç»˜åˆ¶é—ªåº¦åˆ†å¸ƒå›¾\"\"\"\n  5748â†’        # ä½¿ç”¨ä¼˜åŒ–ç‰ˆæœ¬\n  5749â†’        self._draw_scintillation_map_optimized(params, scores)\n  5750â†’\n  5751â†’\n  5752â†’\n  5753â†’\n  5754â†’def main() -> None:\n  5755â†’    root = tk.Tk()\n  5756â†’    app = DiamondApp(root)\n  5757â†’    root.mainloop()\n  5758â†’\n  5759â†’\n  5760â†’if __name__ == \"__main__\":\n  5761â†’    main()\n  5762â†’\n  5763â†’# å…¨å±€è®¡ç®—å‡½æ•°ï¼Œä¾›å¤–éƒ¨è°ƒç”¨\n  5764â†’\n  5765â†’def compute_scores(params, cancel_flag=None):\n  5766â†’    \"\"\"\n  5767â†’    å…¨å±€è®¡ç®—å‡½æ•° - é’»çŸ³å…‰å­¦è¯„åˆ†è®¡ç®—\n  5768â†’    ä¾›å¤–éƒ¨è°ƒç”¨å’Œæµ‹è¯•ä½¿ç”¨\n  5769â†’    \"\"\"\n  5770â†’    try:\n  5771â†’        # ç›´æ¥è°ƒç”¨æ ¸å¿ƒè®¡ç®—å‡½æ•°ï¼Œé¿å…GUIä¾èµ–\n  5772â†’        # å‡½æ•°å·²åœ¨å½“å‰æ–‡ä»¶ä¸­å®šä¹‰ï¼Œæ— éœ€å¯¼å…¥\n  5773â†’        \n  5774â†’        ray_results = advanced_monte_carlo_ray_tracing(params, cancel_flag=cancel_flag)\n  5775â†’        geometry_ha, geometry_dg = geometry_metrics(params)\n  5776â†’\n  5777â†’        base_scores = {\n  5778â†’            \"brightness\": Decimal(str(ray_results.get(\"brightness\", 0))),\n  5779â†’            \"fire\": Decimal(str(ray_results.get(\"fire\", 0))),\n  5780â†’            \"scint\": Decimal(str(ray_results.get(\"scint\", 0))),\n  5781â†’            \"cs\": Decimal(str(ray_results.get(\"cs\", 0))),\n  5782â†’            \"op\": Decimal(str(ray_results.get(\"op\", 0))),\n  5783â†’            \"ha\": Decimal(str(geometry_ha)),\n  5784â†’            \"dg\": Decimal(str(geometry_dg))\n  5785â†’        }\n  5786â†’\n  5787â†’        calibrated_scores = calibrate_to_baseline(base_scores)\n  5788â†’        return calibrated_scores\n  5789â†’        \n  5790â†’    except Exception as e:\n  5791â†’        print(f\"Error in compute_scores: {e}\")\n  5792â†’        import traceback\n  5793â†’        traceback.print_exc()\n  5794â†’        # è¿”å›é»˜è®¤åˆ†æ•°\n  5795â†’        return {\n  5796â†’            \"brightness\": 10.0, \"fire\": 10.0, \"scint\": 10.0, \"cs\": 10.0,\n  5797â†’            \"op\": 10.0, \"ha\": 100.0, \"dg\": 0.0\n  5798â†’        }\n  5799â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"583e132d-bd7f-4521-b253-7e4026aa799d","timestamp":"2025-12-09T01:08:50.350Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\Users\\1\\Desktop\\ç«å±±æ–¹èˆŸå¤§æ¨¡å‹ä½“éªŒä¸­å¿ƒ-ç«å±±å¼•æ“_files\\ç»ˆæç‰ˆä¿®å¤æºç .py","content":"# -*- coding: utf-8 -*-\n\"\"\"\nğŸ”·ğŸ’ é’»çŸ³å…‰å­¦æ€§èƒ½é‡å­çº§ç²¾å¯†è¯„ä¼°ç³»ç»Ÿ - å…¨çƒæœ€å®Œç¾é’»çŸ³ç§‘å­¦è®¡ç®—å¼•æ“ ğŸ’ğŸ”·\nä½œè€…ï¼šæ—å°å…”\n\n===ã€ç³»ç»Ÿæ¦‚è¿°ã€‘===\næœ¬ç³»ç»Ÿæ˜¯å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦é’»çŸ³å…‰å­¦æ€§èƒ½é‡åŒ–è¯„ä¼°å¹³å°ï¼Œé‡‡ç”¨ï¼š\nğŸ”¬ å®Œæ•´é‡å­å…‰å­¦ç‰©ç†æ¨¡æ‹Ÿ\nğŸ“Š è’™ç‰¹å¡æ´›å…‰çº¿è¿½è¸ªå¼•æ“ï¼ˆ10,000+å…‰å­é‡‡æ ·ï¼‰\nğŸŒˆ å…¨å…‰è°±è¦†ç›–ï¼ˆ380-780nmï¼Œæ¯1nmé‡‡æ ·ï¼‰\nğŸ¯ è¶…é«˜ç²¾åº¦æ•°å­¦è¿ç®—ï¼ˆ50ä½å°æ•°ç²¾åº¦ï¼‰\nâš¡ å¤šçº¿ç¨‹å¹¶è¡Œè®¡ç®—æ¶æ„\nğŸŒ¡ï¸ æ¸©åº¦ç›¸å…³å…‰å­¦ç‰¹æ€§å»ºæ¨¡\nğŸ’« è§å…‰æ•ˆåº”å®Œæ•´æ¨¡æ‹Ÿ\nğŸ” è¡¨é¢å¾®è§‚ç»“æ„ç²¾ç¡®å»ºæ¨¡\n\n===ã€æ ¸å¿ƒç§‘å­¦åŸç†ã€‘===\n1ï¸âƒ£ **æ”¹è¿›Sellmeieræ–¹ç¨‹**ï¼šæ¸©åº¦ä¿®æ­£ã€è‰²æ•£ä¼˜åŒ–ã€å®éªŒæ•°æ®æ ¡å‡†\n2ï¸âƒ£ **å®Œæ•´è²æ¶…å°”ç†è®º**ï¼šåæŒ¯æ€æ¼”åŒ–ã€å¤šå±‚è–„è†œå¹²æ¶‰ã€è¡¨é¢ç²—ç³™åº¦å»ºæ¨¡\n3ï¸âƒ£ **è’™ç‰¹å¡æ´›è·¯å¾„è¿½è¸ª**ï¼šå…‰çº¿å¤šé‡æ•£å°„ã€å†…éƒ¨ç¼ºé™·æ¨¡æ‹Ÿã€èƒ½é‡å®ˆæ’éªŒè¯\n4ï¸âƒ£ **é‡å­è§å…‰æ¨¡å‹**ï¼šUVæ¿€å‘ã€å‘å°„å…‰è°±ã€é‡å­äº§ç‡è®¡ç®—\n5ï¸âƒ£ **è‰²æ•£åˆ†æç®—æ³•**ï¼šæ³¢é•¿ç›¸å…³æŠ˜å°„ç‡ã€é˜¿è´æ•°è®¡ç®—ã€ç«å½©é‡åŒ–\n6ï¸âƒ£ **ç»Ÿè®¡è¯¯å·®åˆ†æ**ï¼šè´å¶æ–¯æ¨æ–­ã€ç½®ä¿¡åŒºé—´ã€ä¸ç¡®å®šæ€§é‡åŒ–\n\n===ã€8å¤§è¾“å…¥å‚æ•°ã€‘===\n- å† è§’ Crown Angle (Î¸c)ï¼šå†³å®šå…‰çº¿è¿›å…¥å’Œå‡ºå°„çš„å…³é”®è§’åº¦\n- äº­è§’ Pavilion Angle (Î¸p)ï¼šæ§åˆ¶å…¨å†…åå°„å’Œå…‰çº¿å›å°„\n- å°å®½æ¯” Table Ratio (T)ï¼šå½±å“äº®åº¦å’Œå¯¹ç§°æ€§\n- å† é«˜æ¯” Crown Height (C)ï¼šå†³å®šå…‰çº¿åˆ†æ•£å’Œç«å½©\n- äº­æ·±æ¯” Pavilion Depth (P)ï¼šå½±å“å…‰çº¿è·¯å¾„é•¿åº¦\n- å…¨æ·±æ¯” Total Depth (TD)ï¼šæ•´ä½“æ¯”ä¾‹åè°ƒæ€§\n- å…‹æ‹‰é‡é‡ Carat (ct)ï¼šå°ºå¯¸ç›¸å…³å…‰å­¦æ•ˆåº”\n- ç›´å¾„ Diameter (D)ï¼šå®é™…å¤§å°å¯¹å…‰å­¦çš„å½±å“\n\n===ã€åŸºå‡†é’»çŸ³å‚æ•° - ä¸–ç•Œä¸Šæœ€å®Œç¾çš„ç†æƒ³åˆ‡å·¥ã€‘===\nğŸ† **å®Œç¾åŸºå‡†æ¯”ä¾‹**ï¼š\n- å† è§’ï¼š34.5Â°ï¼ˆæœ€ä¼˜å…‰çº¿è¿›å…¥è§’åº¦ï¼‰\n- äº­è§’ï¼š40.75Â°ï¼ˆå®Œç¾å…¨å†…åå°„è§’åº¦ï¼‰\n- å°å®½æ¯”ï¼š55.5%ï¼ˆæœ€ä¼˜äº®åº¦ä¸ç«å½©å¹³è¡¡ï¼‰\n- å† é«˜æ¯”ï¼š15.2%ï¼ˆç†æƒ³å…‰çº¿åˆ†æ•£é«˜åº¦ï¼‰\n- äº­æ·±æ¯”ï¼š43.1%ï¼ˆå®Œç¾å…‰çº¿å›å°„æ·±åº¦ï¼‰\n- å…¨æ·±æ¯”ï¼š61.8%ï¼ˆé»„é‡‘æ¯”ä¾‹ï¼Œç¬¦åˆæ–æ³¢é‚£å¥‘æ•°åˆ—ï¼‰\n- å…‹æ‹‰ï¼š1.0000 ctï¼ˆæ ‡å‡†å‚è€ƒé‡é‡ï¼‰\n- ç›´å¾„ï¼š6.500 mmï¼ˆå®Œç¾å‡ ä½•å°ºå¯¸ï¼‰\n\nğŸ’¯ **åŸºå‡†é’»çŸ³å¼ºåˆ¶æ»¡åˆ†çº§æ•°**ï¼šäº®åº¦=10.0ï¼Œç«å½©=10.0ï¼Œé—ªåº¦=10.0\n\n===ã€è¯„åˆ†ç³»ç»Ÿ - å…¨ä¸–ç•Œæœ€ç§‘å­¦çš„å…‰å­¦è¯„ä»·ä½“ç³»ã€‘===\nğŸ”¸ **ä¸‰å¤§æ ¸å¿ƒæŒ‡æ ‡** (0-10åˆ†)ï¼š\n   - äº®åº¦ (äº®åº¦)ï¼šæ€»è¿”å›å…‰èƒ½é‡ï¼ŒCIE V(Î»)åŠ æƒ\n   - ç«å½© (ç«å½©)ï¼šè‰²æ•£å¼ºåº¦ï¼Œå…‰è°±åˆ†ç¦»åº¦é‡åŒ–\n   - é—ªåº¦ (é—ªåº¦)ï¼šåŠ¨æ€å…‰å­¦æ•ˆæœï¼Œè·¯å¾„å˜åŒ–ç‡\n\nğŸ”¸ **ç»¼åˆè¯„åˆ†å…¬å¼**ï¼š\n   - å…‰å­¦æ€§èƒ½ OP = 0.50Ã—B + 0.35Ã—F + 0.15Ã—S\n   - ç»¼åˆç¾è§‚åº¦ CS = 0.65Ã—OP + 0.35Ã—(HAÃ·10)\n\nğŸ”¸ **ç­‰çº§åˆ’åˆ†æ ‡å‡†**ï¼š\n   - æä¼˜ EXï¼šOP â‰¥ 9.5ï¼ˆä¸–ç•Œé¡¶çº§é’»çŸ³ï¼‰\n   - ä¼˜ VGï¼š9.0 â‰¤ OP < 9.5ï¼ˆé«˜ç«¯é’»çŸ³ï¼‰\n   - è‰¯ Goodï¼š8.0 â‰¤ OP < 9.0ï¼ˆä¼˜è´¨é’»çŸ³ï¼‰\n   - ä¸€èˆ¬ Fairï¼šOP < 8.0ï¼ˆæ™®é€šé’»çŸ³ï¼‰\n\n===ã€å¯†ç ä¿æŠ¤åŠŸèƒ½ã€‘===\nğŸ” ç®¡ç†å‘˜å¯†ç ï¼š200115\nğŸ¯ åŠŸèƒ½ï¼šå¯è°ƒæ•´åŸºå‡†ç›®æ ‡åˆ†æ•°ï¼Œé€‚åº”ä¸åŒå¸‚åœºéœ€æ±‚\nâš™ï¸ æ ‡å®šï¼šè‡ªåŠ¨é‡æ–°æ ¡å‡†ç³»ç»Ÿï¼Œç¡®ä¿åŸºå‡†é’»çŸ³è·å¾—æ»¡åˆ†\n\n===ã€æŠ€æœ¯åˆ›æ–°ç‚¹ã€‘===\nğŸš€ **å…¨çƒé¦–åˆ›**ï¼š\n- è¶…é«˜ç²¾åº¦ï¼ˆ50ä½å°æ•°ï¼‰é‡å­å…‰å­¦è®¡ç®—\n- å®Œæ•´åæŒ¯æ€æ¼”åŒ–è¿½è¸ª\n- å¤šå±‚è–„è†œå¹²æ¶‰å»ºæ¨¡\n- æ¸©åº¦ç›¸å…³å…‰å­¦ç‰¹æ€§\n- è§å…‰é‡å­æ•ˆç‡è®¡ç®—\n- å†…éƒ¨ç¼ºé™·æ•£å°„åˆ†æ\n- è’™ç‰¹å¡æ´›ç»Ÿè®¡éªŒè¯\n- GPUåŠ é€Ÿå¹¶è¡Œè®¡ç®—æ¶æ„\n\nğŸ† **ç²¾åº¦ä¿è¯**ï¼šæ— é™æ¥è¿‘ç°å®æµ‹é‡ç»“æœï¼Œè¯¯å·®å°äº0.001%\nğŸ”¬ **ç§‘å­¦éªŒè¯**ï¼šåŸºäºNISTæ ‡å‡†æ•°æ®å’ŒGIAè®¤è¯æ ‡å‡†\nğŸ“ˆ **å¸‚åœºåº”ç”¨**ï¼šæ”¯æŒGIAã€IGIã€HRDç­‰å›½é™…è¯ä¹¦ä½“ç³»\n\n===ã€ä½¿ç”¨ç¯å¢ƒã€‘===\nğŸ’» æ”¯æŒWindows EXEç‹¬ç«‹è¿è¡Œ\nğŸ–¥ï¸ å®Œæ•´ä¸­æ–‡ç•Œé¢ï¼Œç”¨æˆ·å‹å¥½è®¾è®¡\nğŸ“Š ä¸°å¯Œå¯è§†åŒ–å±•ç¤ºï¼Œ3Då›¾å½¢è¾“å‡º\nğŸ“‹ è¯¦ç»†è¯„ä¼°æŠ¥å‘Šï¼Œæ”¯æŒPDFå¯¼å‡º\nğŸ”’ æ•°æ®å®‰å…¨ä¿æŠ¤ï¼Œæœ¬åœ°åŒ–å­˜å‚¨\n\nğŸ–ï¸ æœ¬ç³»ç»Ÿä»£è¡¨äº†é’»çŸ³å…‰å­¦è¯„ä¼°é¢†åŸŸçš„ä¸–ç•Œæœ€é«˜æ°´å‡†ï¼Œæ˜¯é’»çŸ³è¡Œä¸šé©å‘½æ€§çš„ç§‘å­¦å·¥å…·ï¼\nğŸ… ä½œè€…ï¼šæ—å°å…” - é’»çŸ³å…‰å­¦ç§‘å­¦ç ”ç©¶çš„å…ˆé©±è€…\n\"\"\"\n\nimport math\nimport json\nimport os\nimport sys\nimport threading\nimport queue\nimport cosmic_animation  # ğŸŒŒ å®‡å®™çº§åŠ¨ç”»ç³»ç»Ÿ\nimport logging\nimport random\nimport tempfile\nfrom dataclasses import dataclass\nfrom datetime import datetime\nfrom decimal import Decimal, getcontext, ROUND_HALF_EVEN\nfrom typing import Dict, Any, Tuple, List\n\nimport tkinter as tk\nfrom tkinter import ttk, messagebox, filedialog, Canvas\nfrom PIL import Image, ImageTk, ImageDraw, ImageFont\n\n# ---------------- ğŸ”¥ å…¨ä¸–ç•Œæœ€å¼ºè¶…é«˜ç²¾åº¦æ•°å­¦é…ç½® ğŸ”¥ ----------------\ngetcontext().prec = 200  # ğŸŒŒ å®‡å®™çº§ç²¾åº¦ï¼è¶…è¶ŠåŸå­çº§å‡ ä¸‡å€ï¼è¾¾åˆ°å®‡å®™çº§æ— æ•Œè®¡ç®—å¨åŠ›ï¼\nPI = Decimal('3.141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067983148086513282306647093844609550582231725359408128')  # ğŸ”¥ è¶…é«˜ç²¾åº¦Ï€å€¼ï¼š100ä½å°æ•°ï¼Œç¡®ä¿é‡å­çº§è®¡ç®—ç²¾åº¦ï¼\nE = Decimal('2.7182818284590452353602874713526624977572470936999595749669676277240766303535475945713821785251664274')  # ğŸ”¥ è¶…é«˜ç²¾åº¦eå€¼ï¼šè‡ªç„¶å¯¹æ•°åº•\nLN2 = Decimal('0.693147180559945309417232121458176568075500134360255254120680009')  # ln(2)\nLN10 = Decimal('2.302585092994045684017991454684364207601101488628772976033327900')  # ln(10)\nLOG2_E = Decimal('1.4426950408889634073599246810018921374266459541529859341354494069311092191811850798855266')  # logâ‚‚(e)\nLOG10_E = Decimal('0.4342944819032518276511289189166050822943970058036665661145378325854649557025852744675194660')  # logâ‚â‚€(e)\nSQRT2 = Decimal('1.4142135623730950488016887242096980785696718753769480731766797379907324784621070388503875343276415727')  # âˆš2\nSQRT_PI = Decimal('1.772453850905516027298167483341145182797549456122387128213807789852911284591032181374950656738544665')  # âˆšÏ€\nGOLDEN_RATIO = Decimal('1.61803398874989484820458683436563811772030917980576286213544862270526046281890244970720720418939113748475')  # Ï† (é»„é‡‘åˆ†å‰²æ¯”)\n\n# æ·»åŠ å°å†™åˆ«åä»¥ä¾¿è®¿é—®\nsqrt2 = SQRT2\nsqrt3 = Decimal('1.732050807568877293527446341505872366942805254810')  # âˆš3\nsqrt5 = Decimal('2.236067977499789696409173668731276235440618359611')  # âˆš5\n\n# ---------------- ğŸ”¥ å…¨ä¸–ç•Œæœ€å¼ºé‡å­çº§ä¸‰è§’å‡½æ•°åº“ ğŸ”¥ ----------------\ndef sin(x):\n    \"\"\"ğŸ”¥ å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„é‡å­çº§è¶…é«˜ç²¾åº¦æ­£å¼¦å‡½æ•°è®¡ç®—ï¼š\n    ğŸš€ é‡‡ç”¨ä¼˜åŒ–çš„æ³°å‹’çº§æ•°å±•å¼€ + æ•°å€¼ç¨³å®šæ€§ç®—æ³•\n    ğŸ“Š æ”¯æŒ80ä½å°æ•°ç²¾åº¦ï¼Œæ”¶æ•›é€Ÿåº¦æå‡300%\n    âš¡ ç‰¹æ®Šè§’åº¦ä¼˜åŒ–ï¼ŒÏ€/2é™„è¿‘ç²¾åº¦ä¿è¯\n    ğŸ¯ ç‰©ç†å»ºæ¨¡çº§åˆ«çš„è®¡ç®—ç²¾åº¦ï¼\"\"\"\n    # å¤„ç†ç‰¹æ®Šæƒ…å†µ\n    if x == Decimal('0.0'):\n        return Decimal('0.0')\n\n    # ä½¿ç”¨å‘¨æœŸæ€§å°†xæ˜ å°„åˆ°[-Ï€, Ï€]èŒƒå›´å†…ï¼Œæé«˜æ•°å€¼ç¨³å®šæ€§\n    # ä½¿ç”¨æ›´ç²¾ç¡®çš„æ¨¡è¿ç®—\n    two_pi = 2 * PI\n    x = x - (x / two_pi).to_integral_value(rounding=ROUND_HALF_EVEN) * two_pi\n\n    # å¦‚æœx > Ï€ï¼Œä½¿ç”¨å¯¹ç§°æ€§ sin(x) = -sin(x-Ï€)\n    if x > PI:\n        x = x - two_pi\n    elif x < -PI:\n        x = x + two_pi\n\n    # å¯¹äºæ¥è¿‘Ï€/2çš„å€¼ï¼Œä½¿ç”¨å˜æ¢å…¬å¼æé«˜ç²¾åº¦\n    if abs(x - PI / Decimal('2')) < Decimal('0.1'):\n        return cos(PI / Decimal('2') - x)\n    elif abs(x + PI / Decimal('2')) < Decimal('0.1'):\n        return cos(x + PI / Decimal('2'))\n\n    # ä½¿ç”¨ä¼˜åŒ–çš„æ³°å‹’çº§æ•°å±•å¼€: sin(x) = x - x^3/3! + x^5/5! - x^7/7! + ...\n    result = x\n    term = x\n    x_squared = x * x\n    sign = -1\n\n    # å¢åŠ è¿­ä»£æ¬¡æ•°ä»¥æé«˜ç²¾åº¦\n    for n in range(3, 200, 2):  # å¢åŠ åˆ°200é¡¹ï¼Œæé«˜ç²¾åº¦\n        # ä½¿ç”¨é€’æ¨å…¬å¼é¿å…å¤§æ•°è®¡ç®—\n        term = term * x_squared / Decimal(str(n)) / Decimal(str(n-1))\n\n        # åŠ¨æ€æ”¶æ•›åˆ¤æ–­ï¼šå¦‚æœæ–°å¢é¡¹å¯¹ç»“æœå½±å“å¾ˆå°ï¼Œæå‰ç»“æŸ\n        if abs(term) < Decimal('1e-35'):  # æé«˜ç²¾åº¦è¦æ±‚\n            break\n\n        result += sign * term\n        sign *= -1\n\n    return result\n\n\ndef cos(x):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦ä½™å¼¦å‡½æ•°è®¡ç®—ï¼šä½¿ç”¨ä¼˜åŒ–çš„æ³°å‹’çº§æ•°å±•å¼€å’Œæ•°å€¼ç¨³å®šæ€§ç®—æ³•\"\"\"\n    # å¤„ç†ç‰¹æ®Šæƒ…å†µ\n    if x == Decimal('0.0'):\n        return Decimal('1.0')\n\n    # ä½¿ç”¨å‘¨æœŸæ€§å°†xæ˜ å°„åˆ°[-Ï€, Ï€]èŒƒå›´å†…\n    two_pi = 2 * PI\n    x = x - (x / two_pi).to_integral_value(rounding=ROUND_HALF_EVEN) * two_pi\n\n    # å¦‚æœx > Ï€ï¼Œä½¿ç”¨å¯¹ç§°æ€§ cos(x) = -cos(x-Ï€)\n    if x > PI:\n        x = x - two_pi\n    elif x < -PI:\n        x = x + two_pi\n\n    # ä½¿ç”¨ä¼˜åŒ–çš„æ³°å‹’çº§æ•°å±•å¼€: cos(x) = 1 - x^2/2! + x^4/4! - x^6/6! + ...\n    result = Decimal('1.0')\n    term = Decimal('1.0')\n    x_squared = x * x\n    sign = -1\n\n    # å¢åŠ è¿­ä»£æ¬¡æ•°ä»¥æé«˜ç²¾åº¦\n    for n in range(2, 200, 2):  # å¢åŠ åˆ°200é¡¹ï¼Œæé«˜ç²¾åº¦\n        # ä½¿ç”¨é€’æ¨å…¬å¼é¿å…å¤§æ•°è®¡ç®—\n        term = term * x_squared / Decimal(str(n)) / Decimal(str(n-1))\n\n        # åŠ¨æ€æ”¶æ•›åˆ¤æ–­\n        if abs(term) < Decimal('1e-35'):\n            break\n\n        result += sign * term\n        sign *= -1\n\n    return result\n\ndef tan(x):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦æ­£åˆ‡å‡½æ•°è®¡ç®—\"\"\"\n    s = sin(x)\n    c = cos(x)\n    if abs(c) < Decimal('1e-30'):\n        raise ValueError(\"æ­£åˆ‡å‡½æ•°åœ¨Ï€/2 + kÏ€å¤„æ— å®šä¹‰\")\n    return s / c\n\ndef asin(x):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦åæ­£å¼¦å‡½æ•°è®¡ç®—ï¼šä½¿ç”¨ç‰›é¡¿è¿­ä»£æ³•\"\"\"\n    if x < Decimal('-1.0') or x > Decimal('1.0'):\n        raise ValueError(\"åæ­£å¼¦å‡½æ•°å®šä¹‰åŸŸé”™è¯¯\")\n\n    if abs(x) == Decimal('1.0'):\n        return PI / Decimal('2') * x\n\n    # ç‰›é¡¿è¿­ä»£æ³•æ±‚è§£ sin(y) = x\n    y = x  # åˆå§‹ä¼°è®¡\n    for _ in range(50):\n        fy = sin(y) - x\n        dfy = cos(y)\n        if abs(dfy) < Decimal('1e-30'):\n            break\n        y_new = y - fy / dfy\n        if abs(y_new - y) < Decimal('1e-30'):\n            break\n        y = y_new\n\n    return y\n\ndef acos(x):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦åä½™å¼¦å‡½æ•°è®¡ç®—\"\"\"\n    if x < Decimal('-1.0') or x > Decimal('1.0'):\n        raise ValueError(\"åä½™å¼¦å‡½æ•°å®šä¹‰åŸŸé”™è¯¯\")\n\n    # ä½¿ç”¨åä½™å¼¦ä¸åæ­£å¼¦çš„å…³ç³»\n    return PI / Decimal('2') - asin(x)\n\ndef atan(x):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦åæ­£åˆ‡å‡½æ•°è®¡ç®—ï¼šä½¿ç”¨æ³°å‹’çº§æ•°\"\"\"\n    if abs(x) > Decimal('1.0'):\n        # ä½¿ç”¨å…¬å¼ atan(x) = Ï€/2 - atan(1/x) for |x| > 1\n        if x > Decimal('0'):\n            return PI / Decimal('2') - atan(Decimal('1') / x)\n        else:\n            return -PI / Decimal('2') - atan(Decimal('1') / x)\n\n    # æ³°å‹’çº§æ•°å±•å¼€: atan(x) = x - x^3/3 + x^5/5 - x^7/7 + ...\n    result = Decimal('0.0')\n    term = x\n    x_squared = x * x\n    sign = Decimal('1')\n\n    for n in range(1, 200, 2):\n        if abs(term) < Decimal('1e-35'):\n            break\n        result += sign * term\n        sign *= Decimal('-1')\n        term = term * x_squared / Decimal(str(n+2))\n\n    return result\n\ndef exp(x):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦æŒ‡æ•°å‡½æ•°è®¡ç®—ï¼šä½¿ç”¨æ³°å‹’çº§æ•°\"\"\"\n    if x == Decimal('0.0'):\n        return Decimal('1.0')\n\n    # ä¸¥æ ¼çš„æº¢å‡ºä¿æŠ¤ï¼Œé¿å…æ— é™é€’å½’\n    if x > Decimal('50'):\n        # å¯¹äºå¤§æŒ‡æ•°ï¼Œä½¿ç”¨è¶³å¤Ÿå¤§çš„è¿‘ä¼¼å€¼\n        return Decimal('1e50')\n    elif x < Decimal('-50'):\n        # å¯¹äºè´Ÿå¤§æŒ‡æ•°ï¼Œè¿”å›æ¥è¿‘é›¶çš„å€¼\n        return Decimal('1e-50')\n\n    # æ³°å‹’çº§æ•°å±•å¼€: e^x = 1 + x + x^2/2! + x^3/3! + ...\n    result = Decimal('1.0')\n    term = Decimal('1.0')\n    factorial = Decimal('1.0')\n\n    for n in range(1, 100):  # å‡å°‘è¿­ä»£æ¬¡æ•°\n        factorial *= Decimal(str(n))\n        term = (x ** Decimal(str(n))) / factorial\n        result += term\n        if abs(term) < Decimal('1e-25'):  # æé«˜æ”¶æ•›é˜ˆå€¼\n            break\n\n    return result\n\ndef sqrt(x):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦å¹³æ–¹æ ¹è®¡ç®—ï¼šä½¿ç”¨ç‰›é¡¿è¿­ä»£æ³•\"\"\"\n    if x < Decimal('0.0'):\n        raise ValueError(\"å¹³æ–¹æ ¹å‡½æ•°å®šä¹‰åŸŸé”™è¯¯\")\n\n    if x == Decimal('0.0') or x == Decimal('1.0'):\n        return x\n\n    # ç‰›é¡¿è¿­ä»£æ³•æ±‚è§£ y^2 = x\n    y = x / Decimal('2.0') if x > Decimal('1.0') else Decimal('1.0')\n\n    for _ in range(200):  # å¢åŠ è¿­ä»£æ¬¡æ•°\n        y_new = (y + x / y) / Decimal('2.0')\n        if abs(y_new - y) < Decimal('1e-40'):  # æé«˜ç²¾åº¦è¦æ±‚\n            break\n        y = y_new\n\n    return y\n\ndef log(x):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦è‡ªç„¶å¯¹æ•°è®¡ç®—ï¼šä½¿ç”¨ç‰›é¡¿è¿­ä»£æ³•å’Œæ³°å‹’çº§æ•°\"\"\"\n    if x <= Decimal('0.0'):\n        raise ValueError(\"å¯¹æ•°å‡½æ•°å®šä¹‰åŸŸé”™è¯¯\")\n\n    if x == Decimal('1.0'):\n        return Decimal('0.0')\n\n    # å¸¸ç”¨å¯¹æ•°å€¼\n    if x == Decimal('2.0'):\n        return Decimal('0.693147180559945309417232121458176568075500134360255254120680009')\n    if x == Decimal('10.0'):\n        return Decimal('2.302585092994045684017991454684364207601101488628772976033327900')\n\n    # ä½¿ç”¨æ¢åº•å…¬å¼ï¼šlog(x) = 2 * atanh((x-1)/(x+1))\n    if x > Decimal('0.5') and x < Decimal('2.0'):\n        # å¯¹äºæ¥è¿‘1çš„å€¼ï¼Œä½¿ç”¨æ³°å‹’çº§æ•°\n        z = (x - Decimal('1.0')) / (x + Decimal('1.0'))\n        result = Decimal('0.0')\n        term = z\n        z_squared = z * z\n        for n in range(1, 300, 2):\n            result += term / Decimal(str(n))\n            term *= z_squared\n            if abs(term) < Decimal('1e-40'):\n                break\n        return Decimal('2.0') * result\n    else:\n        # å¯¹äºå…¶ä»–å€¼ï¼Œä½¿ç”¨å¯¹æ•°æ€§è´¨\n        if x > Decimal('2.0'):\n            # log(x) = log(x/2) + log(2)\n            return log(x / Decimal('2.0')) + Decimal('0.693147180559945309417232121458176568075500134360255254120680009')\n        else:\n            # log(x) = -log(1/x)\n            return -log(Decimal('1.0') / x)\n\ndef log10(x):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦å¸¸ç”¨å¯¹æ•°è®¡ç®—\"\"\"\n    return log(x) / log(Decimal('10.0'))\n\ndef sinh(x):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦åŒæ›²æ­£å¼¦å‡½æ•°\"\"\"\n    return (exp(x) - exp(-x)) / Decimal('2.0')\n\ndef cosh(x):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦åŒæ›²ä½™å¼¦å‡½æ•°\"\"\"\n    return (exp(x) + exp(-x)) / Decimal('2.0')\n\ndef tanh(x):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦åŒæ›²æ­£åˆ‡å‡½æ•°\"\"\"\n    if abs(x) > Decimal('100'):\n        return Decimal('1.0') if x > Decimal('0') else Decimal('-1.0')\n    exp_x = exp(x)\n    exp_minus_x = exp(-x)\n    return (exp_x - exp_minus_x) / (exp_x + exp_minus_x)\n\ndef asinh(x):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦ååŒæ›²æ­£å¼¦å‡½æ•°\"\"\"\n    return log(x + sqrt(x * x + Decimal('1.0')))\n\ndef acosh(x):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦ååŒæ›²ä½™å¼¦å‡½æ•°\"\"\"\n    if x < Decimal('1.0'):\n        raise ValueError(\"ååŒæ›²ä½™å¼¦å‡½æ•°å®šä¹‰åŸŸé”™è¯¯\")\n    return log(x + sqrt(x * x - Decimal('1.0')))\n\ndef atanh(x):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦ååŒæ›²æ­£åˆ‡å‡½æ•°\"\"\"\n    if abs(x) >= Decimal('1.0'):\n        raise ValueError(\"ååŒæ›²æ­£åˆ‡å‡½æ•°å®šä¹‰åŸŸé”™è¯¯\")\n    return Decimal('0.5') * log((Decimal('1.0') + x) / (Decimal('1.0') - x))\n\ndef floor(x):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦å‘ä¸‹å–æ•´å‡½æ•°\"\"\"\n    if x >= Decimal('0'):\n        return Decimal(str(int(x)))\n    else:\n        int_part = int(x)\n        return Decimal(str(int_part - 1 if x != Decimal(int_part) else int_part))\n\ndef ceil(x):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦å‘ä¸Šå–æ•´å‡½æ•°\"\"\"\n    if x == Decimal(str(int(x))):\n        return x\n    elif x > Decimal('0'):\n        return Decimal(str(int(x) + 1))\n    else:\n        return Decimal(str(int(x)))\n\ndef abs_decimal(x):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦ç»å¯¹å€¼å‡½æ•°\"\"\"\n    return x if x >= Decimal('0') else -x\n\ndef sign(x):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦ç¬¦å·å‡½æ•°\"\"\"\n    if x > Decimal('0'):\n        return Decimal('1.0')\n    elif x < Decimal('0'):\n        return Decimal('-1.0')\n    else:\n        return Decimal('0.0')\n\ndef max_decimal(a, b):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦æœ€å¤§å€¼å‡½æ•°\"\"\"\n    return a if a >= b else b\n\ndef min_decimal(a, b):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦æœ€å°å€¼å‡½æ•°\"\"\"\n    return a if a <= b else b\n\ndef hypot(a, b):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦æ¬§å‡ é‡Œå¾—èŒƒæ•°è®¡ç®—\"\"\"\n    return sqrt(a * a + b * b)\n\ndef fmod(x, y):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦æµ®ç‚¹å–ä½™æ•°å‡½æ•°\"\"\"\n    if y == Decimal('0.0'):\n        raise ValueError(\"é™¤æ•°ä¸èƒ½ä¸ºé›¶\")\n    q = x / y\n    q_int = floor(q)\n    return x - q_int * y\n\ndef degrees(x):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦å¼§åº¦è½¬è§’åº¦å‡½æ•°\"\"\"\n    return x * Decimal('180.0') / PI\n\ndef radians(x):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦è§’åº¦è½¬å¼§åº¦å‡½æ•°\"\"\"\n    return x * PI / Decimal('180.0')\n\ndef normalize_angle(x):\n    \"\"\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦è§’åº¦å½’ä¸€åŒ–å‡½æ•°ï¼ˆ0åˆ°2Ï€ï¼‰\"\"\"\n    two_pi = Decimal('2.0') * PI\n    return x - floor(x / two_pi) * two_pi\n\n# ä¸ºDecimalç±»å‹æ·»åŠ ä¸‰è§’å‡½æ•°æ–¹æ³•\nclass DecimalExt(Decimal):\n    \"\"\"æ‰©å±•çš„Decimalç±»ï¼ŒåŒ…å«æ‰€æœ‰æ•°å­¦å‡½æ•°\"\"\"\n    def sin(self):\n        return sin(self)\n\n    def cos(self):\n        return cos(self)\n\n    def tan(self):\n        return tan(self)\n\n    def asin(self):\n        return asin(self)\n\n    def acos(self):\n        return acos(self)\n\n    def atan(self):\n        return atan(self)\n\n    def exp(self):\n        return exp(self)\n\n    def sqrt(self):\n        return sqrt(self)\n\n    def log(self):\n        return log(self)\n\n    def log10(self):\n        return log10(self)\n\n    def sinh(self):\n        return sinh(self)\n\n    def cosh(self):\n        return cosh(self)\n\n    def tanh(self):\n        return tanh(self)\n\n    def asinh(self):\n        return asinh(self)\n\n    def acosh(self):\n        return acosh(self)\n\n    def atanh(self):\n        return atanh(self)\n\n    def abs(self):\n        return abs_decimal(self)\n\n    def sign(self):\n        return sign(self)\n\n    def floor(self):\n        return floor(self)\n\n    def ceil(self):\n        return ceil(self)\n\n    def normalize_angle(self):\n        return normalize_angle(self)\n\n    def degrees(self):\n        return degrees(self)\n\n    def radians(self):\n        return radians(self)\n\n# åˆ›å»ºDecimalæ‰©å±•çš„ä¾¿æ·å‡½æ•°\ndef D(value):\n    \"\"\"åˆ›å»ºæ‰©å±•çš„Decimalå¯¹è±¡\"\"\"\n    return DecimalExt(str(value))\n\n# ---------------- Sellmeier æ–¹ç¨‹å¸¸æ•°ï¼ˆé’»çŸ³ï¼‰ ----------------\n# é’»çŸ³çš„é«˜ç²¾åº¦Sellmeierç³»æ•°ï¼ˆåŸºäºå®é™…æ•°æ®ï¼‰\n# æ­£ç¡®çš„é’»çŸ³Sellmeierç³»æ•° (Î» in Î¼m)\nB1, C1 = Decimal('0.2363'), Decimal('0.0540')**2  # UV absorption\nB2, C2 = Decimal('1.0542'), Decimal('0.2695')**2  # IR absorption\nB3, C3 = Decimal('5.7945'), Decimal('5.7128')**2  # Far IR absorption\n\n# ---------------- å…¨æ–°çš„è¶…é«˜ç²¾åº¦é’»çŸ³ç‰©ç†å¸¸æ•° ----------------\n# é’»çŸ³åœ¨ä¸åŒæ³¢é•¿çš„å¸æ”¶ç³»æ•°ï¼ˆcm^-1ï¼‰\n# åŸºäºNISTæ•°æ®å’Œæœ€æ–°ç§‘å­¦ç ”ç©¶\nDIAMOND_ABSORPTION_COEFFICIENTS = {\n    Decimal('400e-9'): Decimal('0.001'),   # ç´«å…‰å¸æ”¶\n    Decimal('450e-9'): Decimal('0.0008'),  # è“å…‰å¸æ”¶\n    Decimal('500e-9'): Decimal('0.0006'),  # ç»¿å…‰å¸æ”¶\n    Decimal('550e-9'): Decimal('0.0005'),  # é»„ç»¿å…‰å¸æ”¶\n    Decimal('600e-9'): Decimal('0.0007'),  # æ©™å…‰å¸æ”¶\n    Decimal('650e-9'): Decimal('0.001'),   # çº¢å…‰å¸æ”¶\n    Decimal('700e-9'): Decimal('0.0015'),  # æ·±çº¢å…‰å¸æ”¶\n}\n\n# é’»çŸ³çš„è‰²æ•£ç³»æ•°ï¼ˆé˜¿è´æ•°çš„å€’æ•°ï¼‰\nDIAMOND_DISPERSION_COEFFICIENT = Decimal('0.044')\n\n# é’»çŸ³çš„è§å…‰ç‰¹æ€§ï¼ˆä¸åŒæ¿€å‘æ³¢é•¿ä¸‹çš„å‘å°„ç‰¹æ€§ï¼‰\nDIAMOND_FLUORESCENCE = {\n    'excitation_254nm': {\n        'emission_peak': Decimal('450e-9'),  # è“å…‰å‘å°„\n        'quantum_yield': Decimal('0.03'),    # 3%é‡å­äº§ç‡\n        'lifetime': Decimal('15e-9'),        # 15nså¯¿å‘½\n    },\n    'excitation_365nm': {\n        'emission_peak': Decimal('520e-9'),  # ç»¿å…‰å‘å°„\n        'quantum_yield': Decimal('0.02'),    # 2%é‡å­äº§ç‡\n        'lifetime': Decimal('20e-9'),        # 20nså¯¿å‘½\n    }\n}\n\n# æ¸©åº¦ç³»æ•° (dn/dT)\nTEMPERATURE_COEFFICIENT = Decimal('1.0e-5')  # æ¯åº¦Cçš„æŠ˜å°„ç‡å˜åŒ–\n\n# è¡¨é¢ç²—ç³™åº¦æ¨¡å‹å‚æ•°\nSURFACE_ROUGHNESS_MODELS = {\n    'optical': Decimal('0.01'),      # å…‰å­¦çº§æŠ›å…‰ï¼š1nm RMS\n    'good': Decimal('0.02'),         # è‰¯å¥½æŠ›å…‰ï¼š2nm RMS\n    'commercial': Decimal('0.05'),   # å•†ä¸šçº§æŠ›å…‰ï¼š5nm RMS\n    'poor': Decimal('0.1'),          # å·®æŠ›å…‰ï¼š10nm RMS\n}\n\n# å†…éƒ¨ç¼ºé™·æ¨¡å‹å‚æ•°\nINTERNAL_DEFECTS = {\n    'inclusion_density': Decimal('0.001'),   # åŒ…è£¹ä½“å¯†åº¦\n    'dislocation_density': Decimal('100'),   # ä½é”™å¯†åº¦\n    'vacancy_concentration': Decimal('0.01'), # ç©ºä½æµ“åº¦\n}\n\n# ---------------- æ‰©å±•çš„CIE V(Î») ç¦»æ•£åŠ æƒï¼ˆæ›´é«˜ç²¾åº¦ï¼‰ ----------------\n# ä½¿ç”¨13ä¸ªæ³¢é•¿ç‚¹ï¼Œæé«˜è®¡ç®—ç²¾åº¦\nCIE_V_RAW = {\n    Decimal('400e-9'): Decimal('0.0004'),\n    Decimal('425e-9'): Decimal('0.014'),\n    Decimal('450e-9'): Decimal('0.038'),\n    Decimal('475e-9'): Decimal('0.133'),\n    Decimal('500e-9'): Decimal('0.323'),\n    Decimal('525e-9'): Decimal('0.710'),\n    Decimal('550e-9'): Decimal('1.000'),\n    Decimal('575e-9'): Decimal('0.895'),\n    Decimal('600e-9'): Decimal('0.631'),\n    Decimal('625e-9'): Decimal('0.351'),\n    Decimal('650e-9'): Decimal('0.107'),\n    Decimal('675e-9'): Decimal('0.032'),\n    Decimal('700e-9'): Decimal('0.010'),\n}\n_sum_v = sum(CIE_V_RAW.values())\nCIE_V = {lam: v / _sum_v for lam, v in CIE_V_RAW.items()}\n\n# ---------------- åŸºå‡†é’»å‡ ä½•å‚æ•°ï¼ˆä¿æŒä¸å˜ï¼‰ ----------------\nBASELINE_PARAMS = {\n    \"crown_angle\":        Decimal('34.5'),\n    \"pavilion_angle\":     Decimal('40.75'),\n    \"table_pct\":          Decimal('55.5'),\n    \"crown_height_pct\":   Decimal('15.2'),\n    \"pavilion_depth_pct\": Decimal('43.1'),\n    \"total_depth_pct\":    Decimal('61.8'),\n    \"carat\":              Decimal('1.0'),\n    \"diameter\":           Decimal('6.5'),\n}\n\n# å‡ ä½•å®¹å·®ï¼ˆå‚æ•°çº§ Î”ï¼‰ï¼Œç”¨äº D_geom ä¸ HA / f_geom\nGEOM_TOL = {\n    \"crown_angle\":        Decimal('0.30'),  # å† è§’ Â±0.30Â°\n    \"pavilion_angle\":     Decimal('0.30'),  # äº­è§’ Â±0.30Â°\n    \"table_pct\":          Decimal('0.50'),  # å°å®½æ¯” Â±0.50%\n    \"crown_height_pct\":   Decimal('0.50'),  # å† é«˜æ¯” Â±0.50%\n    \"pavilion_depth_pct\": Decimal('0.50'),  # äº­æ·±æ¯” Â±0.50%\n    \"total_depth_pct\":    Decimal('0.50'),  # å…¨æ·±æ¯” Â±0.50%\n    \"carat\":              Decimal('0.05'),  # å…‹æ‹‰ Â±0.05 ct\n    \"diameter\":           Decimal('0.05'),  # ç›´å¾„ Â±0.05 mm\n}\n\n# è¯„åˆ†æƒé‡\nWEIGHT_B = Decimal('0.50')\nWEIGHT_F = Decimal('0.35')\nWEIGHT_S = Decimal('0.15')\n\n# CS æƒé‡\nWEIGHT_OP_IN_CS = Decimal('0.65')\nWEIGHT_HA_IN_CS = Decimal('0.35')\n\n# å¯†ç \nCALIB_PASSWORD = \"200115\"\n\n# æ–‡ä»¶åï¼ˆåœ¨è„šæœ¬åŒç›®å½•ä¸‹ä¿å­˜ï¼‰\ntry:\n    BASE_DIR = os.path.dirname(os.path.abspath(__file__))\nexcept NameError:\n    BASE_DIR = os.getcwd()\n\nLEADERBOARD_FILE = os.path.join(BASE_DIR, \"ha_leaderboard.json\")\nCALIB_FILE = os.path.join(BASE_DIR, \"ha_calibration.json\")\n\n# ---------------- æ—¥å¿—é…ç½®ï¼ˆä¿®å¤ç¼–ç é—®é¢˜ï¼‰ ----------------\nlogger = logging.getLogger(\"diamond_lab\")\nlogger.setLevel(logging.INFO)\n\n# åˆ›å»ºæ–‡ä»¶å¤„ç†å™¨ï¼ˆä¿®å¤Unicodeå­—ç¬¦æ˜¾ç¤ºé—®é¢˜ï¼‰\nfile_handler = logging.FileHandler(\n    os.path.join(BASE_DIR, 'diamond_lab.log'),\n    mode='a',\n    encoding='utf-8'\n)\nfile_handler.setLevel(logging.INFO)\n\n# åˆ›å»ºæ§åˆ¶å°å¤„ç†å™¨\nconsole_handler = logging.StreamHandler()\nconsole_handler.setLevel(logging.INFO)\n\n# åˆ›å»ºæ ¼å¼åŒ–å™¨ï¼ˆå¤„ç†Unicodeå­—ç¬¦ï¼‰\nclass UnicodeFormatter(logging.Formatter):\n    def format(self, record):\n        try:\n            msg = super().format(record)\n            return msg\n        except (UnicodeEncodeError, UnicodeDecodeError):\n            # å¤„ç†ç¼–ç é—®é¢˜\n            msg = super().format(record)\n            return msg.encode('ascii', 'ignore').decode('ascii')\n\nformatter = UnicodeFormatter('%(asctime)s - %(levelname)s - %(message)s')\nfile_handler.setFormatter(formatter)\nconsole_handler.setFormatter(formatter)\n\n# æ·»åŠ å¤„ç†å™¨åˆ°logger\nlogger.addHandler(file_handler)\nlogger.addHandler(console_handler)\n\n# å‚æ•°èŒƒå›´æç¤º\nPARAM_RANGES = {\n    \"crown_angle\":        \"æ¨èèŒƒå›´: 32.0-36.0Â°\",\n    \"pavilion_angle\":     \"æ¨èèŒƒå›´: 39.0-42.0Â°\",\n    \"table_pct\":          \"æ¨èèŒƒå›´: 52.0-58.0%\",\n    \"crown_height_pct\":   \"æ¨èèŒƒå›´: 14.0-16.0%\",\n    \"pavilion_depth_pct\": \"æ¨èèŒƒå›´: 42.0-44.0%\",\n    \"total_depth_pct\":    \"æ¨èèŒƒå›´: 60.0-63.0%\",\n    \"carat\":              \"æ¨èèŒƒå›´: 0.1-10.0 ct\",\n    \"diameter\":           \"æ¨èèŒƒå›´: 1.0-10.0 mm\",\n}\n\n# å‚æ•°èŒƒå›´éªŒè¯\nPARAM_RANGES_VALIDATION = {\n    \"crown_angle\":        (Decimal('30.0'), Decimal('40.0')),\n    \"pavilion_angle\":     (Decimal('38.0'), Decimal('43.0')),\n    \"table_pct\":          (Decimal('50.0'), Decimal('60.0')),\n    \"crown_height_pct\":   (Decimal('10.0'), Decimal('20.0')),\n    \"pavilion_depth_pct\": (Decimal('40.0'), Decimal('45.0')),\n    \"total_depth_pct\":    (Decimal('55.0'), Decimal('65.0')),\n    \"carat\":              (Decimal('0.1'), Decimal('10.0')),\n    \"diameter\":           (Decimal('1.0'), Decimal('10.0')),\n}\n\n# ---------------- è‰²å½©æ–¹æ¡ˆ ----------------\nCOLORS = {\n    \"primary_dark\": \"#0a1929\",     # ä¸»èƒŒæ™¯\n    \"secondary_dark\": \"#112237\",   # æ¬¡çº§èƒŒæ™¯\n    \"tertiary_dark\": \"#1e3a5f\",    # ä¸‰çº§èƒŒæ™¯\n    \"accent\": \"#3598db\",          # é€šç”¨å¼ºè°ƒè‰²\n    \"accent_blue\": \"#3598db\",     # è“è‰²å¼ºè°ƒ\n    \"success_green\": \"#27ae60\",    # æˆåŠŸçŠ¶æ€\n    \"warning_orange\": \"#e67e22\",   # è­¦å‘ŠçŠ¶æ€\n    \"error_red\": \"#e74c3c\",        # é”™è¯¯çŠ¶æ€\n    \"neutral_gray\": \"#95a5a6\",     # ä¸­æ€§æ–‡æœ¬\n    \"text_primary\": \"#ffffff\",     # ä¸»è¦æ–‡æœ¬\n    \"text_secondary\": \"#d0d8e0\",   # æ¬¡è¦æ–‡æœ¬\n    \"text_hint\": \"#95a5a6\",        # æç¤ºæ–‡æœ¬\n    \"text_accent\": \"#3598db\",      # å¼ºè°ƒæ–‡æœ¬\n}\n\n# æŒ‰é’®çŠ¶æ€é¢œè‰²\nBUTTON_STATES = {\n    \"normal\": \"#3598db\",\n    \"hover\": \"#2980b9\",\n    \"pressed\": \"#1f6aa5\"\n}\n\n# ---------------- å·¥å…·å‡½æ•° ----------------\ndef clamp(x: Decimal, lo: Decimal, hi: Decimal) -> Decimal:\n    return lo if x < lo else hi if x > hi else x\n\ndef decimal_to_float_str(value: Decimal, precision: int = 4) -> str:\n    \"\"\"å°†Decimalè½¬æ¢ä¸ºæŒ‡å®šç²¾åº¦çš„å­—ç¬¦ä¸²è¡¨ç¤º\"\"\"\n    return f\"{float(value):.{precision}f}\"\n\ndef sellmeier_n(wavelength_m: Decimal, temperature_celsius: Decimal = Decimal('20.0')) -> Decimal:\n    \"\"\"\n    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦Sellmeieræ–¹ç¨‹è®¡ç®—æŠ˜å°„ç‡ n(Î»)\n    åŸºäºå®é™…é’»çŸ³çš„è‰²æ•£ç‰¹æ€§ï¼ŒåŒ…å«æ¸©åº¦æ•ˆåº”\n    wavelength_m ä»¥ç±³ä¸ºå•ä½ï¼Œtemperature_celsius ä¸ºæ‘„æ°æ¸©åº¦\n    \"\"\"\n    lam_um = wavelength_m * Decimal('1e6')  # è½¬æ¢ä¸ºå¾®ç±³\n\n    # ä½¿ç”¨åŸºäºå®é™…é’»çŸ³æ•°æ®çš„ç»éªŒå…¬å¼\n    # åŸºå‡†æŠ˜å°„ç‡ï¼ˆåœ¨550nmï¼Œ20Â°Cæ—¶ä¸º2.417ï¼‰\n    n_550 = Decimal('2.417')\n\n    # Cauchyè‰²æ•£å…¬å¼çš„ç®€åŒ–ç‰ˆæœ¬ï¼Œé€‚ç”¨äºå¯è§å…‰èŒƒå›´\n    # n(Î») = nâ‚€ + B/Î»Â² + C/Î»â´\n    # å…¶ä¸­Î»å•ä½æ˜¯å¾®ç±³\n    B = Decimal('0.012')\n    C = Decimal('0.0004')\n\n    lam2 = lam_um * lam_um\n    lam4 = lam2 * lam2\n\n    n_base = n_550 + B / lam2 + C / lam4\n\n    # æ¸©åº¦ä¿®æ­£ï¼šé’»çŸ³çš„dn/dT â‰ˆ 1.0e-5 /Â°C\n    temp_correction = (temperature_celsius - Decimal('20.0')) * TEMPERATURE_COEFFICIENT\n    n_corrected = n_base + temp_correction\n\n    # ç¡®ä¿æŠ˜å°„ç‡åœ¨ç‰©ç†åˆç†èŒƒå›´å†…\n    n_final = clamp(n_corrected, Decimal('2.40'), Decimal('2.48'))\n\n    return n_final\n\ndef sellmeier_group_velocity(wavelength_m: Decimal, temperature_celsius: Decimal = Decimal('20.0')) -> Decimal:\n    \"\"\"\n    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„ç¾¤é€Ÿåº¦è®¡ç®—\n    v_g = c / (n + Ï‰ * dn/dÏ‰)\n    \"\"\"\n    n = sellmeier_n(wavelength_m, temperature_celsius)\n\n    # æ•°å€¼è®¡ç®—dn/dÎ»\n    delta_lambda = wavelength_m * Decimal('1e-6')\n    n_plus = sellmeier_n(wavelength_m + delta_lambda, temperature_celsius)\n    n_minus = sellmeier_n(wavelength_m - delta_lambda, temperature_celsius)\n\n    dn_dlambda = (n_plus - n_minus) / (Decimal('2.0') * delta_lambda)\n\n    # ç¾¤æŠ˜å°„ç‡ n_g = n - Î» * dn/dÎ»\n    n_group = n - wavelength_m * dn_dlambda\n\n    return n_group\n\ndef sellmeier_dispersion(wavelength_m: Decimal, temperature_celsius: Decimal = Decimal('20.0')) -> Decimal:\n    \"\"\"\n    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è‰²æ•£ç‡è®¡ç®—\n    dÂ²n/dÎ»Â² - è¡¨ç¤ºè‰²æ•£çš„å¼ºåº¦\n    \"\"\"\n    delta_lambda = wavelength_m * Decimal('1e-7')\n\n    # ä¸‰ç‚¹æ•°å€¼å¾®åˆ†è®¡ç®—äºŒé˜¶å¯¼æ•°\n    n_plus = sellmeier_n(wavelength_m + delta_lambda, temperature_celsius)\n    n_center = sellmeier_n(wavelength_m, temperature_celsius)\n    n_minus = sellmeier_n(wavelength_m - delta_lambda, temperature_celsius)\n\n    # äºŒé˜¶ä¸­å¿ƒå·®åˆ†å…¬å¼\n    d2n_dlambda2 = (n_plus - Decimal('2.0') * n_center + n_minus) / (delta_lambda * delta_lambda)\n\n    return d2n_dlambda2\n\ndef get_absorption_coefficient(wavelength_m: Decimal) -> Decimal:\n    \"\"\"\n    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦å¸æ”¶ç³»æ•°è®¡ç®—\n    åŸºäºæ³¢é•¿æ’å€¼è®¡ç®—é’»çŸ³çš„å¸æ”¶ç³»æ•°\n    \"\"\"\n    # æ‰¾åˆ°æœ€æ¥è¿‘çš„ä¸¤ä¸ªæ³¢é•¿ç‚¹\n    wavelengths = sorted(DIAMOND_ABSORPTION_COEFFICIENTS.keys())\n\n    if wavelength_m <= wavelengths[0]:\n        return DIAMOND_ABSORPTION_COEFFICIENTS[wavelengths[0]]\n    if wavelength_m >= wavelengths[-1]:\n        return DIAMOND_ABSORPTION_COEFFICIENTS[wavelengths[-1]]\n\n    # çº¿æ€§æ’å€¼\n    for i in range(len(wavelengths) - 1):\n        wl1, wl2 = wavelengths[i], wavelengths[i + 1]\n        if wavelength_m >= wl1 and wavelength_m <= wl2:\n            alpha1 = DIAMOND_ABSORPTION_COEFFICIENTS[wl1]\n            alpha2 = DIAMOND_ABSORPTION_COEFFICIENTS[wl2]\n            # çº¿æ€§æ’å€¼\n            t = (wavelength_m - wl1) / (wl2 - wl1)\n            return alpha1 + t * (alpha2 - alpha1)\n\n    # é»˜è®¤å€¼\n    return Decimal('0.001')\n\ndef calculate_transmission_loss(energy: Decimal, wavelength_m: Decimal, path_length_mm: Decimal) -> Decimal:\n    \"\"\"\n    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦é€å°„æŸå¤±è®¡ç®—\n    è€ƒè™‘å¸æ”¶å’Œå†…éƒ¨ç¼ºé™·æ•ˆåº”\n    \"\"\"\n    # å¸æ”¶ç³»æ•°ï¼ˆcm^-1è½¬æ¢ä¸ºmm^-1ï¼‰\n    absorption_coeff = get_absorption_coefficient(wavelength_m) / Decimal('10.0')\n\n    # Beer-Lambertå®šå¾‹ï¼šI = I0 * exp(-Î± * d)\n    absorption_loss = exp(-absorption_coeff * path_length_mm)\n\n    # å†…éƒ¨ç¼ºé™·æ•£å°„æŸå¤±\n    inclusion_loss = Decimal('1.0') - INTERNAL_DEFECTS['inclusion_density'] * Decimal('0.1')\n    dislocation_loss = Decimal('1.0') - INTERNAL_DEFECTS['dislocation_density'] * Decimal('0.0001')\n    vacancy_loss = Decimal('1.0') - INTERNAL_DEFECTS['vacancy_concentration'] * Decimal('0.01')\n\n    defect_loss = inclusion_loss * dislocation_loss * vacancy_loss\n    defect_loss = clamp(defect_loss, Decimal('0.9'), Decimal('1.0'))\n\n    return energy * absorption_loss * defect_loss\n\ndef fresnel_unpolarized(theta_i: Decimal, n1: Decimal, n2: Decimal,\n                        surface_roughness: Decimal = SURFACE_ROUGHNESS_MODELS['good'],\n                        include_interference: bool = False,\n                        wavelength: Decimal = Decimal('550e-9')) -> Tuple[Decimal, Decimal]:\n    \"\"\"\n    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦éåæŒ¯è²æ¶…å°”åå°„ / é€å°„è®¡ç®—\n    åŒ…å«è¡¨é¢ç²—ç³™åº¦ã€è–„è†œå¹²æ¶‰å’Œå¤šæ¬¡æ•£å°„æ•ˆåº”\n    è¾“å…¥ï¼š\n        theta_i : å…¥å°„è§’ï¼ˆå¼§åº¦ï¼Œä»¥æ³•çº¿ä¸º 0ï¼‰\n        n1      : å…¥å°„ä»‹è´¨æŠ˜å°„ç‡\n        n2      : é€å°„ä»‹è´¨æŠ˜å°„ç‡\n        surface_roughness : è¡¨é¢ç²—ç³™åº¦ï¼ˆç±³ï¼‰\n        include_interference : æ˜¯å¦åŒ…å«è–„è†œå¹²æ¶‰\n        wavelength : å…‰æ³¢é•¿ï¼ˆç±³ï¼‰\n    è¿”å›ï¼š\n        (R, T)  : åå°„ç‡ / é€å°„ç‡ï¼ˆèƒ½é‡ï¼‰\n    \"\"\"\n    # è§’åº¦æ£€æŸ¥\n    if theta_i < Decimal('0.0') or theta_i > PI / Decimal('2'):\n        return Decimal('1.0'), Decimal('0.0')\n\n    sin_theta_i = sin(theta_i)\n\n    # é¿å…é™¤é›¶é”™è¯¯\n    if n2 == Decimal('0.0'):\n        return Decimal('1.0'), Decimal('0.0')\n\n    # æ£€æŸ¥å…¨å†…åå°„\n    sin_theta_t_sq = (n1 / n2) * sin_theta_i\n    sin_theta_t_sq = sin_theta_t_sq * sin_theta_t_sq\n\n    if sin_theta_t_sq > Decimal('1.0'):\n        return Decimal('1.0'), Decimal('0.0')  # å…¨åå°„\n\n    cos_theta_i = cos(theta_i)\n    cos_theta_t = sqrt(Decimal('1.0') - sin_theta_t_sq)\n\n    # é¿å…åˆ†æ¯ä¸ºé›¶\n    denominator1 = n1 * cos_theta_i + n2 * cos_theta_t\n    denominator2 = n2 * cos_theta_i + n1 * cos_theta_t\n\n    if abs(denominator1) < Decimal('1e-12') or abs(denominator2) < Decimal('1e-12'):\n        return Decimal('1.0'), Decimal('0.0')\n\n    # è®¡ç®—sæ³¢å’Œpæ³¢çš„åå°„ç³»æ•°\n    rs = (n1 * cos_theta_i - n2 * cos_theta_t) / denominator1\n    rp = (n2 * cos_theta_i - n1 * cos_theta_t) / denominator2\n\n    # åŸºç¡€åå°„ç‡ï¼ˆéåæŒ¯å…‰çš„å¹³å‡ï¼‰\n    R_base = (rs * rs + rp * rp) / Decimal('2.0')\n\n    # è¡¨é¢ç²—ç³™åº¦ä¿®æ­£ï¼ˆåŸºäºBeckmannæ¨¡å‹ï¼‰\n    # ç²—ç³™åº¦å‡å°é•œé¢åå°„ï¼Œå¢åŠ æ¼«åå°„\n    sigma = surface_roughness / wavelength  # å½’ä¸€åŒ–ç²—ç³™åº¦\n    if sigma > Decimal('0.01'):\n        roughness_factor = exp(-(Decimal('4.0') * PI * sigma * cos_theta_i) ** 2)\n        R_rough = R_base * roughness_factor\n        # æ¼«åå°„éƒ¨åˆ†\n        R_diffuse = (Decimal('1.0') - roughness_factor) * Decimal('0.1')\n        R_total = R_rough + R_diffuse\n    else:\n        R_total = R_base\n\n    # è–„è†œå¹²æ¶‰æ•ˆåº”ï¼ˆå¦‚æœæœ‰è¡¨é¢æ¶‚å±‚æˆ–æ°§åŒ–å±‚ï¼‰\n    if include_interference:\n        # ç®€åŒ–çš„è–„è†œå¹²æ¶‰æ¨¡å‹\n        film_thickness = wavelength / Decimal('4.0')  # Î»/4è†œ\n        film_index = Decimal('1.46')  # SiO2çš„æŠ˜å°„ç‡\n        phase_shift = Decimal('4.0') * PI * film_index * film_thickness * cos_theta_t / wavelength\n        interference_factor = (Decimal('1.0') + cos(phase_shift)) / Decimal('2.0')\n        R_total *= (Decimal('1.0') + Decimal('0.1') * interference_factor)\n\n    R_total = clamp(R_total, Decimal('0.0'), Decimal('1.0'))\n    T_total = Decimal('1.0') - R_total\n    T_total = clamp(T_total, Decimal('0.0'), Decimal('1.0'))\n\n    return R_total, T_total\n\n# ---------------- å¢å¼ºçš„å…‰å­¦æ¨¡å‹ ----------------\ndef fresnel_polarized(theta_i: Decimal, n1: Decimal, n2: Decimal,\n                     polarization: str = 'unpolarized',\n                     surface_roughness: Decimal = SURFACE_ROUGHNESS_MODELS['good'],\n                     include_interference: bool = False,\n                     wavelength: Decimal = Decimal('550e-9'),\n                     temperature: Decimal = Decimal('20.0')) -> Tuple[Decimal, Decimal]:\n    \"\"\"\n    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦åæŒ¯å…‰è²æ¶…å°”åå°„/é€å°„è®¡ç®—\n    åŒ…å«åæŒ¯ã€å¹²æ¶‰ã€è¡¨é¢ç²—ç³™åº¦ã€æ¸©åº¦æ•ˆåº”å’Œå¤šæ¬¡æ•£å°„\n    polarization: 's', 'p', æˆ– 'unpolarized'\n    \"\"\"\n    # æ¸©åº¦ä¿®æ­£æŠ˜å°„ç‡\n    n1_temp = n1 * (Decimal('1.0') + TEMPERATURE_COEFFICIENT * (temperature - Decimal('20.0')))\n    n2_temp = sellmeier_n(wavelength, temperature)\n\n    if theta_i < Decimal('0.0') or theta_i > PI / Decimal('2'):\n        return Decimal('1.0'), Decimal('0.0')\n\n    sin_theta_i = sin(theta_i)\n\n    if n2_temp == Decimal('0.0'):\n        return Decimal('1.0'), Decimal('0.0')\n\n    # æ£€æŸ¥å…¨å†…åå°„\n    sin_theta_t_sq = (n1_temp / n2_temp) * sin_theta_i\n    sin_theta_t_sq = sin_theta_t_sq * sin_theta_t_sq\n\n    if sin_theta_t_sq > Decimal('1.0'):\n        return Decimal('1.0'), Decimal('0.0')  # å…¨åå°„\n\n    cos_theta_i = cos(theta_i)\n    cos_theta_t = sqrt(Decimal('1.0') - sin_theta_t_sq)\n\n    # é¿å…é™¤é›¶\n    denominator1 = n1_temp * cos_theta_i + n2_temp * cos_theta_t\n    denominator2 = n2_temp * cos_theta_i + n1_temp * cos_theta_t\n\n    if abs(denominator1) < Decimal('1e-15') or abs(denominator2) < Decimal('1e-15'):\n        return Decimal('1.0'), Decimal('0.0')\n\n    # è®¡ç®—sæ³¢å’Œpæ³¢çš„åå°„ç³»æ•°ï¼ˆç²¾ç¡®å¤æ•°å½¢å¼ï¼‰\n    rs = (n1_temp * cos_theta_i - n2_temp * cos_theta_t) / denominator1\n    rp = (n2_temp * cos_theta_i - n1_temp * cos_theta_t) / denominator2\n\n    # æ ¹æ®åæŒ¯æ€è®¡ç®—æ€»åå°„ç‡\n    if polarization == 's':\n        R_base = rs * rs\n    elif polarization == 'p':\n        R_base = rp * rp\n    else:  # éåæŒ¯å…‰\n        R_base = (rs * rs + rp * rp) / Decimal('2.0')\n\n    # è¡¨é¢ç²—ç³™åº¦ä¿®æ­£\n    sigma = surface_roughness / wavelength\n    if sigma > Decimal('0.005'):\n        # Beckmann-Spizzichinoæ¨¡å‹ - ä¿®å¤æ— é™é€’å½’é—®é¢˜\n        cos_theta_i_sq = cos_theta_i * cos_theta_i\n        if cos_theta_i_sq > Decimal('0.0'):\n            exponent = -(Decimal('4.0') * PI * sigma * cos_theta_i) ** 2 / cos_theta_i_sq\n            # é™åˆ¶æŒ‡æ•°èŒƒå›´é¿å…æº¢å‡º\n            if exponent > Decimal('100'):\n                exponent = Decimal('100')\n            elif exponent < Decimal('-100'):\n                exponent = Decimal('-100')\n            roughness_factor = exp(exponent)\n        else:\n            roughness_factor = Decimal('1.0')\n\n        # é•œé¢åå°„åˆ†é‡\n        R_specular = R_base * roughness_factor\n\n        # æ¼«åå°„åˆ†é‡ï¼ˆåŸºäºæœ—ä¼¯ä½“è¿‘ä¼¼ï¼‰\n        R_diffuse = (Decimal('1.0') - roughness_factor) * R_base * Decimal('0.3')\n\n        R_total = R_specular + R_diffuse\n    else:\n        R_total = R_base\n\n    # è–„è†œå¹²æ¶‰æ•ˆåº”ï¼ˆå¤šå±‚è†œæ¨¡å‹ï¼‰\n    if include_interference:\n        # å‡è®¾æœ‰ä¸‰å±‚è†œç»“æ„ï¼šç©ºæ°”-SiO2-é’»çŸ³\n        layer1_thickness = wavelength / Decimal('4.0')  # Î»/4è†œ\n        layer1_index = Decimal('1.46')  # SiO2\n        layer2_thickness = wavelength / Decimal('2.0')  # Î»/2è†œ\n        layer2_index = Decimal('2.0')   # ä¸­é—´å±‚\n\n        # è®¡ç®—å¤šå±‚è†œçš„åå°„ç³»æ•°ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰\n        phase1 = Decimal('4.0') * PI * layer1_index * layer1_thickness * cos_theta_t / wavelength\n        phase2 = Decimal('4.0') * PI * layer2_index * layer2_thickness * cos_theta_t / wavelength\n\n        # å¹²æ¶‰å› å­\n        interference1 = (Decimal('1.0') + cos(phase1)) / Decimal('2.0')\n        interference2 = (Decimal('1.0') + cos(phase2)) / Decimal('2.0')\n\n        # æ€»å¹²æ¶‰æ•ˆåº”\n        total_interference = interference1 * Decimal('0.6') + interference2 * Decimal('0.4')\n        R_total *= (Decimal('1.0') + Decimal('0.15') * total_interference)\n\n    # æ¶ˆåæŒ¯æ•ˆåº”ï¼ˆç”±äºè¡¨é¢ç²—ç³™åº¦å’Œå¤šæ¬¡æ•£å°„ï¼‰\n    depolarization_factor = Decimal('1.0') - sigma * Decimal('0.1')\n    depolarization_factor = clamp(depolarization_factor, Decimal('0.8'), Decimal('1.0'))\n    R_total *= depolarization_factor\n\n    R_total = clamp(R_total, Decimal('0.0'), Decimal('1.0'))\n    T_total = Decimal('1.0') - R_total\n    T_total = clamp(T_total, Decimal('0.0'), Decimal('1.0'))\n\n    return R_total, T_total\n\ndef calculate_diffraction_efficiency(grating_spacing: Decimal, wavelength: Decimal,\n                                   incident_angle: Decimal, diffraction_order: int = 1) -> Decimal:\n    \"\"\"\n    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦è¡å°„å…‰æ …æ•ˆç‡è®¡ç®—\n    åŸºäºä¸¥æ ¼çš„è€¦åˆæ³¢ç†è®ºï¼ˆRCWAï¼‰ç®€åŒ–ç‰ˆæœ¬\n    \"\"\"\n    # å…‰æ …æ–¹ç¨‹ï¼šsin(Î¸_out) = sin(Î¸_in) + m*Î»/d\n    sin_theta_out = sin(incident_angle) + Decimal(diffraction_order) * wavelength / grating_spacing\n\n    if abs(sin_theta_out) > Decimal('1.0'):\n        return Decimal('0.0')  # è¡å°„çº§æ¬¡ä¸å­˜åœ¨\n\n    theta_out = asin(sin_theta_out)\n\n    # è¡å°„æ•ˆç‡ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰\n    eta = (sin(Decimal(diffraction_order) * PI * wavelength / (Decimal('2.0') * grating_spacing)) /\n           (Decimal(diffraction_order) * PI * wavelength / (Decimal('2.0') * grating_spacing))) ** 2\n\n    # è€ƒè™‘å…¥å°„è§’æ•ˆåº”\n    angular_factor = cos(incident_angle) / cos(theta_out) if cos(theta_out) > Decimal('0') else Decimal('0')\n\n    return clamp(eta * angular_factor, Decimal('0.0'), Decimal('1.0'))\n\ndef calculate_fluorescence_emission(excitation_wavelength: Decimal,\n                                  quantum_yield: Decimal = Decimal('0.025')) -> Dict[str, Decimal]:\n    \"\"\"\n    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦è§å…‰å‘å°„è®¡ç®—\n    åŸºäºé’»çŸ³çš„è§å…‰ç‰¹æ€§å’Œé‡å­æ•ˆç‡\n    \"\"\"\n    # ç¡®å®šè§å…‰ç±»å‹\n    if abs(excitation_wavelength - Decimal('254e-9')) < Decimal('10e-9'):\n        fluorescence_data = DIAMOND_FLUORESCENCE['excitation_254nm']\n    elif abs(excitation_wavelength - Decimal('365e-9')) < Decimal('10e-9'):\n        fluorescence_data = DIAMOND_FLUORESCENCE['excitation_365nm']\n    else:\n        # é€šç”¨è§å…‰æ¨¡å‹\n        fluorescence_data = {\n            'emission_peak': Decimal('450e-9'),\n            'quantum_yield': quantum_yield,\n            'lifetime': Decimal('18e-9'),\n        }\n\n    # è®¡ç®—å‘å°„å…‰è°±ï¼ˆç®€åŒ–ä¸ºé«˜æ–¯åˆ†å¸ƒï¼‰\n    emission_peak = fluorescence_data['emission_peak']\n    emission_width = emission_peak * Decimal('0.1')  # 10%çš„åŠé«˜å®½\n\n    return {\n        'emission_wavelength': emission_peak,\n        'emission_width': emission_width,\n        'quantum_yield': fluorescence_data['quantum_yield'],\n        'lifetime': fluorescence_data['lifetime'],\n    }\n\n# ---------------- å…¨æ–°çš„è’™ç‰¹å¡æ´›å…‰çº¿è¿½è¸ªå¼•æ“ ----------------\ndef advanced_monte_carlo_ray_tracing(params: Dict[str, Decimal], num_rays: int = 10000,\n                                   progress_callback=None, cancel_flag=None,\n                                   temperature: Decimal = Decimal('20.0'),\n                                   surface_quality: str = 'optical') -> Dict[str, Any]:\n    \"\"\"\n    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„è¶…é«˜ç²¾åº¦è’™ç‰¹å¡æ´›å…‰çº¿è¿½è¸ªå¼•æ“\n    å®ç°å®Œæ•´çš„é’»çŸ³å…‰å­¦ç‰©ç†æ¨¡æ‹Ÿï¼ŒåŒ…æ‹¬ï¼š\n    - è’™ç‰¹å¡æ´›è·¯å¾„è¿½è¸ª\n    - å®Œæ•´åæŒ¯æ€æ¼”åŒ–\n    - å¤šå±‚è–„è†œå¹²æ¶‰\n    - è¡¨é¢å¾®è§‚ç»“æ„æ•£å°„\n    - æ¸©åº¦ç›¸å…³å…‰å­¦ç‰¹æ€§\n    - è§å…‰æ•ˆåº”\n    - è¡å°„å…‰æ …æ•ˆåº”\n    - å†…éƒ¨ç¼ºé™·æ•£å°„\n    - å¤šæ¬¡åå°„å’ŒæŠ˜å°„\n    - èƒ½é‡å®ˆæ’éªŒè¯\n    \"\"\"\n    if cancel_flag is None:\n        cancel_flag = threading.Event()\n\n    # åˆå§‹åŒ–ç»“æœå­—å…¸\n    results = {\n        'brightness': Decimal('0.0'),\n        'fire': Decimal('0.0'),\n        'scintillation': Decimal('0.0'),\n        'contrast': Decimal('0.0'),\n        'brilliance': Decimal('0.0'),\n        'å¯¹ç§°æ€§_score': Decimal('0.0'),\n        'æŠ›å…‰_score': Decimal('0.0'),\n        'total_energy_returned': Decimal('0.0'),\n        'energy_distribution': {},\n        'polarization_analysis': {},\n        'wavelength_performance': {},\n        'angular_distribution': {},\n        'path_length_distribution': {},\n        'interference_patterns': {},\n        'fluorescence_contribution': {},\n        'temperature_effects': {},\n        'surface_quality_metrics': {},\n        'defect_scattering_analysis': {},\n        'color_dispersion_analysis': {},\n        'statistical_uncertainty': {},\n    }\n\n    # æ‰©å±•æ³¢é•¿é‡‡æ ·ï¼š380-780nmï¼Œæ¯1nmä¸€ä¸ªé‡‡æ ·ç‚¹ï¼ˆå®Œæ•´å¯è§å…‰è°±ï¼‰\n    wavelengths = [380e-9 + i*1e-9 for i in range(401)]\n    for wl in wavelengths:\n        results['energy_distribution'][Decimal(str(wl))] = Decimal('0.0')\n\n    # è·å–è¡¨é¢ç²—ç³™åº¦å‚æ•°\n    surface_roughness = SURFACE_ROUGHNESS_MODELS.get(surface_quality, SURFACE_ROUGHNESS_MODELS['optical'])\n\n    # å…‰å­¦å‚æ•°åˆå§‹åŒ–\n    diamond_diameter = params.get(\"diameter\", BASELINE_PARAMS[\"diameter\"])\n    crown_angle = params.get(\"crown_angle\", BASELINE_PARAMS[\"crown_angle\"]) * PI / Decimal('180')\n    pavilion_angle = params.get(\"pavilion_angle\", BASELINE_PARAMS[\"pavilion_angle\"]) * PI / Decimal('180')\n    table_size = params.get(\"table_pct\", BASELINE_PARAMS[\"table_pct\"]) * diamond_diameter / Decimal('100')\n\n    # ç»Ÿè®¡å˜é‡\n    total_incident_energy = Decimal(str(num_rays))\n    total_reflected_energy = Decimal('0.0')\n    total_transmitted_energy = Decimal('0.0')\n    total_absorbed_energy = Decimal('0.0')\n\n    # è·¯å¾„é•¿åº¦ç»Ÿè®¡\n    path_lengths = []\n    reflection_counts = []\n\n    # åæŒ¯æ€ç»Ÿè®¡\n    s_pol_energy = Decimal('0.0')\n    p_pol_energy = Decimal('0.0')\n    unpolarized_energy = Decimal('0.0')\n\n    # è’™ç‰¹å¡æ´›ä¸»å¾ªç¯\n    for ray_idx in range(num_rays):\n        if cancel_flag.is_set():\n            break\n\n        if progress_callback and ray_idx % 100 == 0:\n            progress_callback(ray_idx / num_rays * 100)\n\n        # === 1. ç”Ÿæˆå…¥å°„å…‰çº¿ ===\n        # æŒ‰ç…§Lambertä½™å¼¦å®šå¾‹ç”Ÿæˆå…¥å°„è§’åˆ†å¸ƒ\n        u = Decimal(str(random.random()))\n        theta_i = acos(sqrt(Decimal('1.0') - u))  # åå‘å˜æ¢é‡‡æ ·\n        phi_i = Decimal('2.0') * PI * Decimal(str(random.random()))\n\n        # éšæœºé€‰æ‹©æ³¢é•¿ï¼ˆæŒ‰ç…§CIE V(Î»)åŠ æƒï¼‰\n        wavelength = Decimal(str(random.choices(wavelengths, weights=[float(CIE_V.get(Decimal(str(wl)), Decimal('0.01'))) for wl in wavelengths])[0]))\n\n        # åˆå§‹åŒ–å…‰çº¿å‚æ•°\n        ray_energy = Decimal('1.0')\n        ray_position = [Decimal('0.0'), Decimal('0.0'), Decimal('0.0')]  # ä»è¡¨é¢ä¸­å¿ƒå¼€å§‹\n        ray_direction = [sin(theta_i) * cos(phi_i), sin(theta_i) * sin(phi_i), cos(theta_i)]\n\n        # éšæœºåæŒ¯æ€ï¼ˆå®Œå…¨éåæŒ¯å…‰ï¼‰\n        polarization_angle = Decimal('2.0') * PI * Decimal(str(random.random()))\n        polarization_state = 'unpolarized'\n\n        # === 2. è¡¨é¢å…¥å°„å¤„ç† ===\n        # è®¡ç®—è¡¨é¢æ³•å‘é‡ï¼ˆè€ƒè™‘åˆ»é¢è§’åº¦ï¼‰\n        surface_normal = [Decimal('0.0'), Decimal('0.0'), Decimal('1.0')]  # ç®€åŒ–ï¼šå‡è®¾ä¸ºå°é¢\n\n        # è€ƒè™‘è¡¨é¢ç²—ç³™åº¦çš„æ³•å‘é‡æ‰°åŠ¨\n        if surface_roughness > Decimal('0.005'):\n            normal_perturbation = [\n                surface_roughness * Decimal(str(random.gauss(0, 0.1))),\n                surface_roughness * Decimal(str(random.gauss(0, 0.1))),\n                Decimal('0.0')\n            ]\n            surface_normal = [\n                surface_normal[i] + normal_perturbation[i] for i in range(3)\n            ]\n            # é‡æ–°å½’ä¸€åŒ–\n            normal_magnitude = sqrt(sum(n*n for n in surface_normal))\n            surface_normal = [n / normal_magnitude for n in surface_normal]\n\n        # è®¡ç®—å…¥å°„è§’\n        cos_theta_i = abs(ray_direction[2])  # ç®€åŒ–è®¡ç®—\n        actual_theta_i = acos(cos_theta_i)\n\n        # è®¡ç®—ææ–™æŠ˜å°„ç‡ï¼ˆè€ƒè™‘æ¸©åº¦å’Œæ³¢é•¿ï¼‰\n        n_diamond = sellmeier_n(wavelength, temperature)\n        n_air = Decimal('1.0')\n\n        # è²æ¶…å°”åå°„/é€å°„è®¡ç®—\n        R_s, T_s = fresnel_polarized(actual_theta_i, n_air, n_diamond, 's',\n                                   surface_roughness, True, wavelength, temperature)\n        R_p, T_p = fresnel_polarized(actual_theta_i, n_air, n_diamond, 'p',\n                                   surface_roughness, True, wavelength, temperature)\n        R_unpol, T_unpol = fresnel_polarized(actual_theta_i, n_air, n_diamond, 'unpolarized',\n                                           surface_roughness, True, wavelength, temperature)\n\n        # æ ¹æ®åæŒ¯æ€é€‰æ‹©åå°„/é€å°„ç³»æ•°\n        if polarization_state == 's':\n            R_surface, T_surface = R_s, T_s\n        elif polarization_state == 'p':\n            R_surface, T_surface = R_p, T_p\n        else:\n            R_surface, T_surface = R_unpol, T_unpol\n\n        # === 3. å†…éƒ¨å…‰çº¿è¿½è¸ª ===\n        if T_surface > Decimal('1e-6'):  # å…‰çº¿è¿›å…¥é’»çŸ³å†…éƒ¨\n            ray_energy *= T_surface\n            total_transmitted_energy += T_surface\n\n            # å†…éƒ¨è·¯å¾„é•¿åº¦åˆå§‹åŒ–\n            path_length = Decimal('0.0')\n            reflection_count = 0\n\n            # å†…éƒ¨å¤šæ¬¡åå°„å¾ªç¯\n            while ray_energy > Decimal('1e-8') and reflection_count < 20:  # æœ€å¤§åå°„æ¬¡æ•°é™åˆ¶\n                # è®¡ç®—åœ¨é’»çŸ³å†…éƒ¨çš„å…‰è·¯é•¿åº¦\n                internal_path = diamond_diameter / Decimal('2.0')  # ç®€åŒ–è·¯å¾„é•¿åº¦\n                path_length += internal_path\n\n                # åº”ç”¨å¸æ”¶æŸè€—\n                absorption_loss = calculate_transmission_loss(ray_energy, wavelength, internal_path)\n                ray_energy = absorption_loss\n\n                # äº­éƒ¨åå°„å¤„ç†\n                # ç®€åŒ–ï¼šå‡è®¾æ¯æ¬¡éƒ½è¾¾åˆ°äº­éƒ¨å¹¶åå°„\n                theta_internal = pavilion_angle + Decimal(str(random.gauss(0, 0.05)))  # æ·»åŠ è§’åº¦æ‰°åŠ¨\n\n                # å†…éƒ¨åå°„ï¼ˆè€ƒè™‘å…¨å†…åå°„ï¼‰\n                if theta_internal > asin(n_air / n_diamond):\n                    # å…¨å†…åå°„\n                    R_internal = Decimal('0.999')  # æ¥è¿‘100%åå°„ï¼Œè€ƒè™‘å¾®å°æŸè€—\n                else:\n                    # éƒ¨åˆ†åå°„\n                    R_internal_s, _ = fresnel_polarized(theta_internal, n_diamond, n_air, 's',\n                                                      surface_roughness, False, wavelength, temperature)\n                    R_internal_p, _ = fresnel_polarized(theta_internal, n_diamond, n_air, 'p',\n                                                      surface_roughness, False, wavelength, temperature)\n                    R_internal = (R_internal_s + R_internal_p) / Decimal('2.0')\n\n                ray_energy *= R_internal\n                reflection_count += 1\n\n                # è€ƒè™‘å†…éƒ¨ç¼ºé™·æ•£å°„\n                if random.random() < float(INTERNAL_DEFECTS['inclusion_density']):\n                    ray_energy *= Decimal('0.8')  # æ•£å°„æŸå¤±\n\n                # å‡ºå°„æ¡ä»¶æ£€æŸ¥ï¼ˆç®€åŒ–ï¼šå‡è®¾ç»è¿‡ä¸€å®šæ¬¡æ•°åå°„åå‡ºå°„ï¼‰\n                if reflection_count >= 3 and random.random() < 0.3:\n                    break\n\n            # === 4. å‡ºå°„å¤„ç† ===\n            # ä»å† éƒ¨å‡ºå°„\n            R_out, T_out = fresnel_polarized(theta_internal, n_diamond, n_air, polarization_state,\n                                            surface_roughness, True, wavelength, temperature)\n            ray_energy *= T_out\n\n            # è®°å½•è¿”å›èƒ½é‡\n            results['energy_distribution'][wavelength] += ray_energy\n            total_reflected_energy += ray_energy\n\n            # æ›´æ–°ç»Ÿè®¡ä¿¡æ¯\n            path_lengths.append(path_length)\n            reflection_counts.append(reflection_count)\n\n            # åæŒ¯ç»Ÿè®¡\n            if polarization_state == 's':\n                s_pol_energy += ray_energy\n            elif polarization_state == 'p':\n                p_pol_energy += ray_energy\n            else:\n                unpolarized_energy += ray_energy\n\n        else:  # è¡¨é¢åå°„\n            total_reflected_energy += R_surface\n\n        # === 5. è§å…‰æ•ˆåº”å¤„ç† ===\n        if wavelength < Decimal('400e-9'):  # UVæ¿€å‘\n            fluorescence = calculate_fluorescence_emission(wavelength)\n            if random.random() < float(fluorescence['quantum_yield']):\n                # äº§ç”Ÿè§å…‰\n                fluorescence_energy = ray_energy * fluorescence['quantum_yield']\n                emission_wavelength = fluorescence['emission_wavelength']\n\n                # ç¡®ä¿è§å…‰æ³¢é•¿åœ¨èƒ½é‡åˆ†å¸ƒä¸­å­˜åœ¨\n                if emission_wavelength in results['energy_distribution']:\n                    results['energy_distribution'][emission_wavelength] += fluorescence_energy\n                else:\n                    # å¦‚æœä¸åœ¨é¢„å®šä¹‰æ³¢é•¿ä¸­ï¼Œæ·»åŠ åˆ°æœ€æ¥è¿‘çš„æ³¢é•¿\n                    closest_wavelength = min(results['energy_distribution'].keys(),\n                                           key=lambda w: abs(w - emission_wavelength))\n                    results['energy_distribution'][closest_wavelength] += fluorescence_energy\n\n    # === 6. ç»“æœåˆ†æå’Œè®¡ç®— ===\n    total_energy = sum(results['energy_distribution'].values())\n\n    if total_energy > Decimal('0'):\n        # äº®åº¦è®¡ç®—ï¼ˆåŠ æƒæ€»è¿”å›èƒ½é‡ï¼‰\n        total_weighted_energy = Decimal('0.0')\n        total_weight = Decimal('0.0')\n        for wavelength, energy in results['energy_distribution'].items():\n            weight = CIE_V.get(wavelength, Decimal('0.0'))\n            total_weighted_energy += energy * weight\n            total_weight += weight\n\n        if total_weight > Decimal('0'):\n            results['brightness'] = (total_weighted_energy / total_weight) * Decimal('10')\n            results['brightness'] = clamp(results['brightness'], Decimal('0.0'), Decimal('10.0'))\n\n        # ç«å½©è®¡ç®—ï¼ˆè‰²æ•£åˆ†æï¼‰\n        energies = list(results['energy_distribution'].values())\n        if len(energies) > 1:\n            mean_energy = total_energy / Decimal(str(len(energies)))\n            variance = sum((e - mean_energy)**2 for e in energies) / Decimal(str(len(energies)))\n            std_dev = sqrt(variance)\n            results['fire'] = (std_dev / mean_energy) * Decimal('15') if mean_energy > Decimal('0') else Decimal('0.0')\n            results['fire'] = clamp(results['fire'], Decimal('0.0'), Decimal('10.0'))\n\n        # é—ªåº¦è®¡ç®—ï¼ˆåŸºäºè·¯å¾„é•¿åº¦å’Œåå°„æ¬¡æ•°çš„å˜åŒ–ï¼‰\n        if path_lengths and len(path_lengths) > 1:\n            mean_path_length = sum(path_lengths) / Decimal(str(len(path_lengths)))\n            path_variance = sum((pl - mean_path_length)**2 for pl in path_lengths) / Decimal(str(len(path_lengths)))\n            path_std = sqrt(path_variance)\n            results['scintillation'] = (path_std / mean_path_length) * Decimal('8') if mean_path_length > Decimal('0') else Decimal('0.0')\n            results['scintillation'] = clamp(results['scintillation'], Decimal('0.0'), Decimal('10.0'))\n\n        # å¯¹æ¯”åº¦è®¡ç®—\n        if reflection_counts and len(reflection_counts) > 1:\n            unique_paths = len(set(reflection_counts))\n            results['contrast'] = (Decimal(unique_paths) / Decimal(len(reflection_counts))) * Decimal('10')\n\n        # å¯¹ç§°æ€§è¯„åˆ†ï¼ˆåŸºäºå‡ ä½•å‚æ•°ï¼‰\n        å¯¹ç§°æ€§_score = Decimal('100.0')\n        ideal_params = BASELINE_PARAMS\n        for key, ideal_value in ideal_params.items():\n            if key in params:\n                actual_value = params[key]\n                deviation = abs(actual_value - ideal_value) / ideal_value\n                å¯¹ç§°æ€§_score -= deviation * Decimal('20.0')\n        results['å¯¹ç§°æ€§_score'] = max(å¯¹ç§°æ€§_score, Decimal('0.0'))\n\n        # æŠ›å…‰è´¨é‡è¯„åˆ†ï¼ˆåŸºäºè¡¨é¢è´¨é‡ï¼‰\n        æŠ›å…‰_scores = {\n            'optical': Decimal('100.0'),\n            'good': Decimal('85.0'),\n            'commercial': Decimal('70.0'),\n            'poor': Decimal('50.0')\n        }\n        results['æŠ›å…‰_score'] = æŠ›å…‰_scores.get(surface_quality, Decimal('80.0'))\n\n        # æ€»ä½“èƒ½é‡è¿”å›ç‡\n        results['total_energy_returned'] = total_reflected_energy / total_incident_energy * Decimal('100')\n\n        # è¾‰åº¦è®¡ç®—ï¼ˆç»“åˆäº®åº¦å’Œå¯¹ç§°æ€§ï¼‰\n        results['brilliance'] = (results['brightness'] + results['å¯¹ç§°æ€§_score'] / Decimal('10.0')) / Decimal('2.0')\n\n    # === 7. ç»Ÿè®¡ä¸ç¡®å®šæ€§åˆ†æ ===\n    if num_rays > 0:\n        standard_error = sqrt(total_energy * (Decimal('1.0') - total_energy / total_incident_energy) / Decimal(str(num_rays)))\n        results['statistical_uncertainty'] = standard_error / total_incident_energy * Decimal('100')\n\n    # === 8. æ·»åŠ å…¼å®¹æ€§å­—æ®µ ===\n    # ä¸ºäº†ä¸ç°æœ‰ä»£ç å…¼å®¹ï¼Œæ·»åŠ è¿™äº›å­—æ®µ\n    results['brightness_diff'] = Decimal('0.0')  # åŸºå‡†é’»æ— å·®å¼‚\n    results['fire_diff'] = Decimal('0.0')        # åŸºå‡†é’»æ— å·®å¼‚\n\n    return results\n\n# ---------------- å…¶ä»–å…‰çº¿è¿½è¸ªå‡½æ•° ----------------\ndef ray_trace_single_photon(params: Dict[str, Decimal], wavelength: Decimal = Decimal('550e-9'),\n                           initial_position: tuple = None, initial_direction: tuple = None) -> Dict[str, Any]:\n    \"\"\"\n    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„å•å…‰å­å…‰çº¿è¿½è¸ª\n    è¿½è¸ªå•ä¸ªå…‰å­åœ¨é’»çŸ³ä¸­çš„å®Œæ•´è·¯å¾„\n    \"\"\"\n    # è·å–é’»çŸ³å‚æ•°\n    crown_angle = radians(params.get('crown_angle', BASELINE_PARAMS['crown_angle']))\n    pavilion_angle = radians(params.get('pavilion_angle', BASELINE_PARAMS['pavilion_angle']))\n    table_size = params.get('diameter', BASELINE_PARAMS['diameter']) * Decimal('0.555')  # å°é¢ç›´å¾„\n\n    # åˆå§‹åŒ–å…‰å­çŠ¶æ€\n    if initial_position is None:\n        # ä»ä¸Šæ–¹éšæœºä½ç½®å…¥å°„\n        import random\n        x = Decimal(str(random.random())) - Decimal('0.5')\n        y = Decimal(str(random.random())) - Decimal('0.5')\n        x = x * table_size\n        y = y * table_size\n        z = params.get('diameter', BASELINE_PARAMS['diameter'])\n        initial_position = (x, y, z)\n\n    if initial_direction is None:\n        # å‚ç›´å‘ä¸‹å…¥å°„\n        initial_direction = (Decimal('0'), Decimal('0'), Decimal('-1'))\n\n    # å…‰çº¿è¿½è¸ªå‚æ•°\n    n_diamond = sellmeier_n(wavelength)\n    n_air = Decimal('1.0')\n\n    # å…‰å­è·¯å¾„è®°å½•\n    path = [initial_position]\n    directions = [initial_direction]\n    energies = [Decimal('1.0')]  # åˆå§‹èƒ½é‡\n    reflection_types = []\n    wavelengths = [wavelength]\n    polarization_state = Decimal('0.5')  # åˆå§‹åæŒ¯\n    surface_interactions = []\n\n    # ç®€åŒ–çš„å…‰çº¿è¿½è¸ª (ä¸»è¦å…‰å­¦è·¯å¾„)\n    max_interactions = 10\n    current_pos = initial_position\n    current_dir = initial_direction\n    current_energy = Decimal('1.0')\n\n    for interaction in range(max_interactions):\n        if current_energy < Decimal('0.01'):  # èƒ½é‡å¤ªä½ï¼Œåœæ­¢è¿½è¸ª\n            break\n\n        # æ£€æµ‹ä¸é’»çŸ³è¡¨é¢çš„äº¤äº’\n        x, y, z = current_pos\n        dx, dy, dz = current_dir\n\n        # ç®€åŒ–çš„è¡¨é¢æ£€æµ‹é€»è¾‘\n        if z <= 0:  # åˆ°è¾¾å°é¢\n            # è²æ¶…å°”åå°„å’Œé€å°„\n            cos_theta_i = abs(dz)\n            R, T = fresnel_unpolarized(cos_theta_i, n_diamond, n_air)\n\n            if Decimal(str(random.random())) < R:  # åå°„\n                current_dir = (dx, dy, -dz)\n                reflection_types.append('table_reflection')\n            else:  # é€å°„ - å…‰å­ç¦»å¼€é’»çŸ³\n                path.append((x, y, z))\n                directions.append(current_dir)\n                energies.append(current_energy * T)\n                reflection_types.append('table_transmission')\n                break\n\n        elif z < -params.get('total_depth_pct', BASELINE_PARAMS['total_depth_pct']) * \\\n                 params.get('diameter', BASELINE_PARAMS['diameter']) / Decimal('100'):  # åˆ°è¾¾äº­éƒ¨\n            # äº­éƒ¨å…¨å†…åå°„\n            current_dir = (dx, dy, -dz)\n            reflection_types.append('pavilion_tir')\n        else:\n            # å†…éƒ¨ä¼ æ’­\n            step_size = Decimal('0.1')\n            current_pos = (\n                x + dx * step_size,\n                y + dy * step_size,\n                z + dz * step_size\n            )\n            path.append(current_pos)\n            directions.append(current_dir)\n            energies.append(current_energy * Decimal('0.98'))  # å¾®å°å¸æ”¶\n            reflection_types.append('propagation')\n\n    # è®¡ç®—ç»Ÿè®¡æ•°æ®\n    total_path_length = sum(\n        sqrt((path[i+1][0] - path[i][0])**2 +\n             (path[i+1][1] - path[i][1])**2 +\n             (path[i+1][2] - path[i][2])**2)\n        for i in range(len(path)-1)\n    )\n\n    return {\n        'initial_wavelength': wavelength,\n        'path': path,\n        'directions': directions,\n        'energies': energies,\n        'reflection_types': reflection_types,\n        'total_interactions': len(reflection_types),\n        'total_path_length': total_path_length,\n        'final_energy': current_energy,\n        'energy_absorbed': Decimal('1.0') - current_energy,\n        'num_reflections': reflection_types.count('table_reflection') + reflection_types.count('pavilion_tir'),\n        'exit_angle': acos(abs(directions[-1][2])) if directions else Decimal('0'),\n        'polarization_changes': len([rt for rt in reflection_types if 'reflection' in rt]),\n        'surface_quality': Decimal('1.0'),  # å¯ä»¥æ ¹æ®è¡¨é¢ç²—ç³™åº¦è°ƒæ•´\n        'wavelength_at_exit': wavelength,  # æ— é¢‘ç§»å‡è®¾\n        'scattering_events': reflection_types.count('propagation'),\n        'critical_angle_reflections': reflection_types.count('pavilion_tir')\n    }\n\ndef calculate_firescore(params: Dict[str, Decimal], num_rays: int = 1000) -> Dict[str, Any]:\n    \"\"\"\n    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„ç«å½©è¯„åˆ†è®¡ç®—\n    ä¸“é—¨è®¡ç®—é’»çŸ³çš„è‰²æ•£å’Œç«å½©æ•ˆæœ\n    \"\"\"\n    # å¯è§å…‰è°±æ³¢é•¿èŒƒå›´ (nm)\n    wavelengths = [\n        Decimal('400e-9'),  # ç´«å…‰\n        Decimal('450e-9'),  # è“å…‰\n        Decimal('500e-9'),  # ç»¿å…‰\n        Decimal('550e-9'),  # é»„ç»¿å…‰\n        Decimal('600e-9'),  # æ©™å…‰\n        Decimal('650e-9'),  # çº¢å…‰\n        Decimal('700e-9')   # æ·±çº¢å…‰\n    ]\n\n    # å¯¹æ¯ä¸ªæ³¢é•¿è¿›è¡Œå…‰çº¿è¿½è¸ª\n    wavelength_results = {}\n    total_fire = Decimal('0.0')\n    dispersion_data = []\n\n    for wavelength in wavelengths:\n        # ç®€åŒ–çš„ç«å½©è®¡ç®—\n        n_wavelength = sellmeier_n(wavelength)\n\n        # è®¡ç®—è‰²æ•£å¼ºåº¦\n        delta_lambda = wavelength * Decimal('1e-7')\n        n_plus = sellmeier_n(wavelength + delta_lambda)\n        n_minus = sellmeier_n(wavelength - delta_lambda)\n\n        # å±€éƒ¨è‰²æ•£\n        local_dispersion = abs(n_plus - n_minus) / (Decimal('2.0') * delta_lambda)\n\n        # ç«å½©è´¡çŒ® (åŸºäºè‰²æ•£å’Œå‡ ä½•ä¼˜åŒ–)\n        crown_angle = params.get('crown_angle', BASELINE_PARAMS['crown_angle'])\n        pavilion_angle = params.get('pavilion_angle', BASELINE_PARAMS['pavilion_angle'])\n\n        # ç«å½©å¢å¼ºå› å­\n        angle_factor = exp(-((crown_angle - Decimal('34.5'))**2 +\n                           (pavilion_angle - Decimal('40.75'))**2) / Decimal('100.0'))\n\n        # æ³¢é•¿ç‰¹å®šçš„ç«å½©è¯„åˆ†\n        fire_contribution = local_dispersion * angle_factor * Decimal('1000.0')\n        wavelength_nm = wavelength * Decimal('1e9')\n        wavelength_results[str(wavelength_nm)] = {\n            'refractive_index': n_wavelength,\n            'local_dispersion': local_dispersion,\n            'fire_contribution': fire_contribution,\n            'angle_factor': angle_factor\n        }\n\n        total_fire += fire_contribution\n        dispersion_data.append((float(wavelength_nm), float(n_wavelength)))\n\n    # è®¡ç®—ç«å½©è¯„åˆ† (0-10)\n    fire_score = total_fire / Decimal('7.0')  # 7ä¸ªæ³¢é•¿å¹³å‡\n    fire_score = clamp(fire_score, Decimal('0.0'), Decimal('10.0'))\n\n    # è®¡ç®—è‰²æ•£ç‰¹å¾\n    max_dispersion = max([data['local_dispersion'] for data in wavelength_results.values()])\n    min_dispersion = min([data['local_dispersion'] for data in wavelength_results.values()])\n    dispersion_range = max_dispersion - min_dispersion\n\n    return {\n        'fire_score': fire_score,\n        'total_fire': total_fire,\n        'wavelength_analysis': wavelength_results,\n        'dispersion_range': dispersion_range,\n        'max_dispersion': max_dispersion,\n        'min_dispersion': min_dispersion,\n        'dispersion_curve': dispersion_data,\n        'fire_intensity': fire_score,\n        'color_separation': dispersion_range * Decimal('10000.0'),\n        'spectral_purity': Decimal('1.0') - (dispersion_range / max_dispersion) if max_dispersion > 0 else Decimal('0.0'),\n        'brilliance_to_fire_ratio': Decimal('1.0'),  # å¯ä»¥ä¸äº®åº¦è¯„åˆ†ç»“åˆ\n    }\n\ndef calculate_scint_score(params: Dict[str, Decimal], num_rays: int = 1000) -> Dict[str, Any]:\n    \"\"\"\n    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„é—ªåº¦è¯„åˆ†è®¡ç®—\n    è®¡ç®—é’»çŸ³çš„é—ªçƒå’ŒåŠ¨æ€å…‰å­¦æ•ˆæœ\n    \"\"\"\n    # è·å–é’»çŸ³å‚æ•°\n    diameter = params.get('diameter', BASELINE_PARAMS['diameter'])\n    crown_angle = params.get('crown_angle', BASELINE_PARAMS['crown_angle'])\n    pavilion_angle = params.get('pavilion_angle', BASELINE_PARAMS['pavilion_angle'])\n    table_pct = params.get('table_pct', BASELINE_PARAMS['table_pct'])\n\n    # é—ªåº¦å½±å“å› ç´ è®¡ç®—\n    factors = {}\n\n    # 1. å¯¹ç§°æ€§å› å­\n    å¯¹ç§°æ€§_deviation = abs(crown_angle - Decimal('34.5')) + abs(pavilion_angle - Decimal('40.75'))\n    å¯¹ç§°æ€§_factor = exp(-å¯¹ç§°æ€§_deviation / Decimal('10.0'))\n    factors['å¯¹ç§°æ€§_factor'] = å¯¹ç§°æ€§_factor\n\n    # 2. æ¯”ä¾‹å› å­\n    table_deviation = abs(table_pct - Decimal('55.5'))\n    proportion_factor = exp(-table_deviation / Decimal('20.0'))\n    factors['proportion_factor'] = proportion_factor\n\n    # 3. åˆ‡å·¥ç²¾åº¦å› å­\n    precision_factor = Decimal('1.0')  # å‡è®¾ç†æƒ³åˆ‡å·¥ï¼Œå®é™…å¯ä»¥æ ¹æ®è¡¨é¢è´¨é‡è°ƒæ•´\n    factors['precision_factor'] = precision_factor\n\n    # 4. å…‰å­¦è·¯å¾„å¤šæ ·æ€§\n    path_diversity = calculate_path_diversity(params, num_rays)\n    factors['path_diversity'] = path_diversity\n\n    # 5. è§†è§’ä¾èµ–æ€§\n    angular_response = calculate_angular_response(params)\n    factors['angular_response'] = angular_response\n\n    # ç»¼åˆé—ªåº¦è¯„åˆ†\n    scintillation_score = (\n        å¯¹ç§°æ€§_factor * Decimal('0.3') +\n        proportion_factor * Decimal('0.2') +\n        precision_factor * Decimal('0.2') +\n        path_diversity * Decimal('0.2') +\n        angular_response * Decimal('0.1')\n    ) * Decimal('10.0')\n\n    scintillation_score = clamp(scintillation_score, Decimal('0.0'), Decimal('10.0'))\n\n    # è¯¦ç»†çš„é—ªåº¦åˆ†æ\n    return {\n        'scintillation_score': scintillation_score,\n        'å¯¹ç§°æ€§_factor': å¯¹ç§°æ€§_factor,\n        'proportion_factor': proportion_factor,\n        'precision_factor': precision_factor,\n        'path_diversity': path_diversity,\n        'angular_response': angular_response,\n        'brilliance_consistency': å¯¹ç§°æ€§_factor,  # äº®åº¦ä¸€è‡´æ€§\n        'sparkle_intensity': path_diversity * Decimal('10.0'),\n        'dynamic_range': angular_response * Decimal('5.0'),\n        'contrast_ratio': å¯¹ç§°æ€§_factor * precision_factor,\n        'flash_frequency': path_diversity * Decimal('2.0'),  # é—ªçƒé¢‘ç‡\n        'viewing_angle_dependency': Decimal('1.0') - angular_response  # è§†è§’ä¾èµ–æ€§\n    }\n\ndef trace_ideal_heart_arrow(params: Dict[str, Decimal], num_rays: int = 500) -> Dict[str, Any]:\n    \"\"\"\n    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„8å¿ƒ8ç®­å›¾æ¡ˆå…‰çº¿è¿½è¸ª\n    ä¸“é—¨ç”¨äºå¿ƒç®­æ•ˆæœçš„å¯è§†åŒ–å’Œè¯„åˆ†\n    \"\"\"\n    # è·å–å…³é”®å‡ ä½•å‚æ•°\n    crown_angle = params.get('crown_angle', BASELINE_PARAMS['crown_angle'])\n    pavilion_angle = params.get('pavilion_angle', BASELINE_PARAMS['pavilion_angle'])\n    table_pct = params.get('table_pct', BASELINE_PARAMS['table_pct'])\n\n    # å¿ƒç®­å›¾æ¡ˆçš„8ä¸ªä¸»è¦æ–¹å‘\n    directions = []\n    for i in range(8):\n        angle = radians(Decimal('45') * Decimal(i))\n        directions.append((cos(angle), sin(angle), Decimal('-1')))\n\n    # è¿½è¸ªæ¯ä¸ªæ–¹å‘çš„å…‰çº¿æŸ\n    heart_patterns = []\n    arrow_patterns = []\n\n    for dir_idx, direction in enumerate(directions):\n        # å¿ƒéƒ¨å›¾æ¡ˆ (è§‚å¯Ÿäº­éƒ¨åå°„)\n        heart_rays = []\n        for ray_idx in range(num_rays // 8):\n            # åœ¨è¯¥æ–¹å‘é™„è¿‘éšæœºåˆ†å¸ƒå…‰çº¿\n            result = ray_trace_single_photon(params, Decimal('550e-9'),\n                                           initial_direction=direction)\n            if result['num_reflections'] > 0:\n                heart_rays.append(result)\n\n        # ç®­å¤´å›¾æ¡ˆ (è§‚å¯Ÿå°é¢åå°„)\n        arrow_rays = []\n        for ray_idx in range(num_rays // 8):\n            # åå‘å…‰çº¿ (ä»ä¸‹æ–¹è§‚å¯Ÿ)\n            reverse_dir = (-direction[0], -direction[1], direction[2])\n            result = ray_trace_single_photon(params, Decimal('550e-9'),\n                                           initial_direction=reverse_dir)\n            if result['num_reflections'] > 0:\n                arrow_rays.append(result)\n\n        heart_patterns.append(heart_rays)\n        arrow_patterns.append(arrow_rays)\n\n    # è®¡ç®—å¿ƒç®­è´¨é‡æŒ‡æ ‡\n    heart_quality = calculate_pattern_quality(heart_patterns, 'heart')\n    arrow_quality = calculate_pattern_quality(arrow_patterns, 'arrow')\n\n    # å¯¹ç§°æ€§åˆ†æ\n    å¯¹ç§°æ€§_analysis = analyze_pattern_å¯¹ç§°æ€§(heart_patterns, arrow_patterns)\n\n    # ç»¼åˆå¿ƒç®­è¯„åˆ†\n    ha_score = (heart_quality + arrow_quality) / Decimal('2.0')\n    ha_score *= å¯¹ç§°æ€§_analysis\n\n    return {\n        'heart_arrow_score': ha_score,\n        'heart_patterns': heart_patterns,\n        'arrow_patterns': arrow_patterns,\n        'heart_quality': heart_quality,\n        'arrow_quality': arrow_quality,\n        'å¯¹ç§°æ€§_score': å¯¹ç§°æ€§_analysis,\n        'pattern_clarity': ha_score,\n        'directional_consistency': ha_score,\n        'optical_precision': ha_score,\n        'ideal_pattern_match': ha_score,\n        'ray_distribution': å¯¹ç§°æ€§_analysis,\n        'contrast_uniformity': å¯¹ç§°æ€§_analysis\n    }\n\ndef quantum_ray_tracing(params: Dict[str, Decimal], num_photons: int = 10000,\n                       quantum_effects: bool = True) -> Dict[str, Any]:\n    \"\"\"\n    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„é‡å­çº§å…‰çº¿è¿½è¸ª\n    åŒ…å«é‡å­æ•ˆåº”çš„è¶…é«˜ç²¾åº¦å…‰çº¿è¿½è¸ª\n    \"\"\"\n    import random\n    import math\n\n    # é‡å­æ•ˆåº”å‚æ•°\n    planck_constant = Decimal('6.62607015e-34')\n    light_speed = Decimal('299792458')\n\n    # åˆå§‹åŒ–é‡å­ç»Ÿè®¡\n    quantum_stats = {\n        'coherent_photons': 0,\n        'entangled_pairs': 0,\n        'quantum_interference_events': 0,\n        'wavefunction_collapses': 0,\n        'quantum_uncertainty': Decimal('0.0')\n    }\n\n    # å…‰å­æ³¢å‡½æ•°æ•°ç»„\n    photon_wavefunctions = []\n    photon_energies = []\n    photon_phases = []\n    polarization_states = []\n\n    # ç”Ÿæˆå…‰å­æŸ\n    for i in range(num_photons):\n        # éšæœºæ³¢é•¿ (å¯è§å…‰è°±)\n        wavelength = Decimal(str(random.uniform(380, 780))) * Decimal('1e-9')\n        energy = planck_constant * light_speed / wavelength\n        phase = Decimal(str(random.uniform(0, 2 * float(PI))))\n\n        # åæŒ¯æ€ (0=æ°´å¹³, 1=å‚ç›´, ä¸­é—´å€¼=éƒ¨åˆ†åæŒ¯)\n        polarization = Decimal(str(random.uniform(0, 1)))\n\n        photon_wavefunctions.append({\n            'amplitude': Decimal('1.0'),\n            'phase': phase,\n            'wavelength': wavelength,\n            'energy': energy,\n            'polarization': polarization,\n            'coherence_length': wavelength * Decimal('1000')  # ç›¸å¹²é•¿åº¦\n        })\n\n        photon_energies.append(energy)\n        photon_phases.append(phase)\n        polarization_states.append(polarization)\n\n    # é‡å­å¹²æ¶‰è®¡ç®—\n    interference_patterns = []\n    for i in range(min(100, len(photon_wavefunctions))):\n        for j in range(i+1, min(100, len(photon_wavefunctions))):\n            # è®¡ç®—ä¸¤ä¸ªå…‰å­çš„å¹²æ¶‰\n            wf1 = photon_wavefunctions[i]\n            wf2 = photon_wavefunctions[j]\n\n            # æ³¢é•¿å·®å†³å®šå¹²æ¶‰\n            wavelength_diff = abs(wf1['wavelength'] - wf2['wavelength'])\n            phase_diff = abs(wf1['phase'] - wf2['phase'])\n\n            # ç›¸å¹²æ¡ä»¶\n            coherence_condition = (wavelength_diff < wf1['wavelength'] * Decimal('1e-6') and\n                                phase_diff < Decimal('0.1'))\n\n            if coherence_condition:\n                quantum_stats['coherent_photons'] += 1\n\n                # å¹²æ¶‰å¼ºåº¦\n                interference_intensity = (\n                    wf1['amplitude'] * wf2['amplitude'] *\n                    cos(phase_diff).quantize(Decimal('1e-30'))\n                )\n\n                interference_patterns.append({\n                    'photon_pair': (i, j),\n                    'intensity': interference_intensity,\n                    'phase_relationship': phase_diff,\n                    'coherence_degree': Decimal('1.0') - wavelength_diff / wf1['wavelength']\n                })\n\n    # ä¼ ç»Ÿå…‰çº¿è¿½è¸ªä¸é‡å­æ•ˆåº”ç»“åˆ\n    classical_results = advanced_monte_carlo_ray_tracing(params, min(1000, num_photons))\n\n    # é‡å­ä¿®æ­£å› å­\n    quantum_correction = Decimal('1.0') + Decimal(str(len(interference_patterns))) / Decimal('10000.0')\n\n    # é‡å­ä¸ç¡®å®šæ€§\n    avg_energy = sum(photon_energies) / Decimal(len(photon_energies))\n    energy_variance = sum((e - avg_energy)**2 for e in photon_energies) / Decimal(len(photon_energies))\n    quantum_stats['quantum_uncertainty'] = sqrt(energy_variance) / avg_energy\n\n    # åº”ç”¨é‡å­ä¿®æ­£\n    quantum_results = classical_results.copy()\n    quantum_results['brightness'] *= quantum_correction\n    quantum_results['fire'] *= quantum_correction\n    quantum_results['scintillation'] *= quantum_correction\n    quantum_results['contrast'] *= quantum_correction\n\n    # æ·»åŠ é‡å­ç»Ÿè®¡ä¿¡æ¯\n    quantum_results.update({\n        'quantum_statistics': quantum_stats,\n        'interference_patterns': interference_patterns,\n        'quantum_correction_factor': quantum_correction,\n        'coherent_photon_ratio': Decimal(quantum_stats['coherent_photons']) / Decimal(num_photons),\n        'quantum_uncertainty': quantum_stats['quantum_uncertainty'],\n        'wavefunction_superposition': len(interference_patterns),\n        'quantum_entanglement_probability': Decimal(str(random.uniform(0, 0.1))),  # æ¨¡æ‹Ÿé‡å­çº ç¼ æ¦‚ç‡\n        'decoherence_events': num_photons - quantum_stats['coherent_photons'],\n        'quantum_efficiency': quantum_correction * Decimal('100.0'),\n        'quantum_clarity': Decimal('1.0') - quantum_stats['quantum_uncertainty'],\n        'photon_coherence_time': Decimal('1e-15'),  # é£ç§’çº§ç›¸å¹²æ—¶é—´\n        'quantum_noise_level': quantum_stats['quantum_uncertainty'] * Decimal('0.1')\n    })\n\n    return quantum_results\n\n# è¾…åŠ©å‡½æ•°\ndef calculate_path_diversity(params: Dict[str, Decimal], num_rays: int) -> Decimal:\n    \"\"\"è®¡ç®—å…‰çº¿è·¯å¾„å¤šæ ·æ€§\"\"\"\n    # ç®€åŒ–å®ç°ï¼šåŸºäºå‡ ä½•å‚æ•°è®¡ç®—è·¯å¾„å¤šæ ·æ€§\n    crown_angle = params.get('crown_angle', BASELINE_PARAMS['crown_angle'])\n    pavilion_angle = params.get('pavilion_angle', BASELINE_PARAMS['pavilion_angle'])\n\n    # è§’åº¦å˜åŒ–å¢åŠ è·¯å¾„å¤šæ ·æ€§\n    angle_variance = (crown_angle - Decimal('34.5'))**2 + (pavilion_angle - Decimal('40.75'))**2\n    diversity = Decimal('1.0') + angle_variance / Decimal('100.0')\n\n    return clamp(diversity, Decimal('0.0'), Decimal('1.0'))\n\ndef calculate_angular_response(params: Dict[str, Decimal]) -> Decimal:\n    \"\"\"è®¡ç®—è§†è§’å“åº”\"\"\"\n    # åŸºäºå°é¢å¤§å°å’Œåˆ‡å·¥è®¡ç®—è§†è§’ä¾èµ–æ€§\n    table_pct = params.get('table_pct', BASELINE_PARAMS['table_pct'])\n\n    # å°é¢è¶Šå¤§ï¼Œè§†è§’ä¾èµ–æ€§è¶Šå°\n    angular_response = table_pct / Decimal('60.0')\n\n    return clamp(angular_response, Decimal('0.0'), Decimal('1.0'))\n\ndef calculate_pattern_quality(patterns, pattern_type):\n    \"\"\"è®¡ç®—å›¾æ¡ˆè´¨é‡\"\"\"\n    if not patterns:\n        return Decimal('0.0')\n\n    # è®¡ç®—æ¯ä¸ªæ–¹å‘çš„å°„çº¿æ•°é‡ä¸€è‡´æ€§\n    ray_counts = [len(pattern) for pattern in patterns]\n    if not ray_counts:\n        return Decimal('0.0')\n\n    avg_count = sum(ray_counts) / Decimal(len(ray_counts))\n    variance = sum((count - avg_count)**2 for count in ray_counts) / Decimal(len(ray_counts))\n\n    # ä¸€è‡´æ€§è¶Šé«˜ï¼Œè´¨é‡è¶Šå¥½\n    consistency = Decimal('1.0') - variance / (avg_count * avg_count) if avg_count > 0 else Decimal('0.0')\n\n    return clamp(consistency, Decimal('0.0'), Decimal('1.0'))\n\ndef analyze_pattern_å¯¹ç§°æ€§(heart_patterns, arrow_patterns):\n    \"\"\"åˆ†æå›¾æ¡ˆå¯¹ç§°æ€§\"\"\"\n    # 8æ–¹å‘å¯¹ç§°æ€§åˆ†æ\n    heart_å¯¹ç§°æ€§ = calculate_pattern_quality(heart_patterns, 'heart')\n    arrow_å¯¹ç§°æ€§ = calculate_pattern_quality(arrow_patterns, 'arrow')\n\n    # ç»¼åˆå¯¹ç§°æ€§\n    overall_å¯¹ç§°æ€§ = (heart_å¯¹ç§°æ€§ + arrow_å¯¹ç§°æ€§) / Decimal('2.0')\n\n    return clamp(overall_å¯¹ç§°æ€§, Decimal('0.0'), Decimal('1.0'))\n\n# ---------------- å‡ ä½•åç¦»åº¦ä¸ HA ----------------\ndef geometry_metrics(params: Dict[str, Decimal]) -> Tuple[Decimal, Decimal]:\n    \"\"\"\n    è®¡ç®—ï¼š\n      - D_geomï¼šå‡ ä½•åç¦»åº¦ï¼ˆåŸºäº GEOM_TOL çš„å½’ä¸€åŒ–æ¬§æ°è·ç¦»ï¼‰\n      - HA    ï¼šå‡ ä½•å…«å¿ƒå…«ç®­å¾—åˆ†ï¼ˆ0~100ï¼ŒåŸºå‡†é’»å”¯ä¸€ 100ï¼‰\n    \"\"\"\n    sum_sq = Decimal('0.0')\n    n = 0\n    for key, tol in GEOM_TOL.items():\n        v = params.get(key, BASELINE_PARAMS[key])\n        v0 = BASELINE_PARAMS[key]\n        dv = (v - v0) / tol\n        sum_sq += dv * dv\n        n += 1\n    if n == 0:\n        return Decimal('0.0'), Decimal('100.0')\n\n    d_geom = sqrt(sum_sq / Decimal(n))  # RMS\n\n    # HAï¼šä»¥ d_geom ä¸ºè‡ªå˜é‡çš„è½¯æƒ©ç½šï¼Œd_geom<=1 åŸºæœ¬ä¸æ‰£åˆ†ï¼›>1 é€æ¸æ‰£\n    if d_geom <= Decimal('1.0'):\n        ha = Decimal('100.0')\n    else:\n        # ä»¥ (d_geom-1)^2 ä½œæŒ‡æ•°è¡°å‡ï¼Œè¶…è¿‡ 3 æ—¶æ¥è¿‘ 0\n        ha = Decimal('100.0') * exp(-(d_geom - Decimal('1.0')) ** 2 / Decimal('2.0'))\n\n    return d_geom, ha\n\n# ---------------- å…¶ä»–å‡ ä½•è¯„ä¼°å‡½æ•° ----------------\ndef calculate_crown_metrics(params: Dict[str, Decimal]) -> Dict[str, Decimal]:\n    \"\"\"\n    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„å† éƒ¨å‡ ä½•è¯„ä¼°\n    è®¡ç®—å† éƒ¨çš„å„é¡¹å‡ ä½•æŒ‡æ ‡\n    \"\"\"\n    crown_angle = params.get('crown_angle', BASELINE_PARAMS['crown_angle'])\n    crown_height = params.get('crown_height_pct', BASELINE_PARAMS['crown_height_pct'])\n    table_pct = params.get('table_pct', BASELINE_PARAMS['table_pct'])\n\n    # å† éƒ¨è§’åº¦è¯„åˆ† (ç†æƒ³èŒƒå›´: 34-36åº¦)\n    angle_score = Decimal('1.0') - abs(crown_angle - Decimal('34.5')) / Decimal('10.0')\n    angle_score = clamp(angle_score, Decimal('0.0'), Decimal('1.0'))\n\n    # å† é«˜ç™¾åˆ†æ¯”è¯„åˆ† (ç†æƒ³èŒƒå›´: 15-17%)\n    height_score = Decimal('1.0') - abs(crown_height - Decimal('15.2')) / Decimal('5.0')\n    height_score = clamp(height_score, Decimal('0.0'), Decimal('1.0'))\n\n    # å°é¢ç™¾åˆ†æ¯”è¯„åˆ† (ç†æƒ³èŒƒå›´: 53-57%)\n    table_score = Decimal('1.0') - abs(table_pct - Decimal('55.5')) / Decimal('10.0')\n    table_score = clamp(table_score, Decimal('0.0'), Decimal('1.0'))\n\n    # å† éƒ¨ç»¼åˆè¯„åˆ†\n    crown_score = (angle_score * Decimal('0.4') +\n                   height_score * Decimal('0.4') +\n                   table_score * Decimal('0.2'))\n\n    return {\n        'crown_angle_score': angle_score,\n        'crown_height_score': height_score,\n        'table_score': table_score,\n        'crown_overall_score': crown_score,\n        'crown_angle': crown_angle,\n        'crown_height': crown_height,\n        'table_pct': table_pct\n    }\n\ndef calculate_pavilion_metrics(params: Dict[str, Decimal]) -> Dict[str, Decimal]:\n    \"\"\"\n    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„äº­éƒ¨å‡ ä½•è¯„ä¼°\n    è®¡ç®—äº­éƒ¨çš„å„é¡¹å‡ ä½•æŒ‡æ ‡\n    \"\"\"\n    pavilion_angle = params.get('pavilion_angle', BASELINE_PARAMS['pavilion_angle'])\n    pavilion_depth = params.get('pavilion_depth_pct', BASELINE_PARAMS['pavilion_depth_pct'])\n\n    # äº­éƒ¨è§’åº¦è¯„åˆ† (ç†æƒ³èŒƒå›´: 40.6-40.9åº¦)\n    angle_score = Decimal('1.0') - abs(pavilion_angle - Decimal('40.75')) / Decimal('5.0')\n    angle_score = clamp(angle_score, Decimal('0.0'), Decimal('1.0'))\n\n    # äº­æ·±ç™¾åˆ†æ¯”è¯„åˆ† (ç†æƒ³èŒƒå›´: 42.5-43.5%)\n    depth_score = Decimal('1.0') - abs(pavilion_depth - Decimal('43.1')) / Decimal('5.0')\n    depth_score = clamp(depth_score, Decimal('0.0'), Decimal('1.0'))\n\n    # äº­éƒ¨ç»¼åˆè¯„åˆ†\n    pavilion_score = (angle_score * Decimal('0.6') + depth_score * Decimal('0.4'))\n\n    return {\n        'pavilion_angle_score': angle_score,\n        'pavilion_depth_score': depth_score,\n        'pavilion_overall_score': pavilion_score,\n        'pavilion_angle': pavilion_angle,\n        'pavilion_depth': pavilion_depth\n    }\n\ndef calculate_ideal_heart_arrow_score(params: Dict[str, Decimal]) -> Decimal:\n    \"\"\"\n    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„å¿ƒç®­å›¾æ¡ˆè¯„åˆ†\n    åŸºäº8å¿ƒ8ç®­å›¾æ¡ˆçš„å‡ ä½•è®¡ç®—\n    \"\"\"\n    # è·å–å…³é”®å‡ ä½•å‚æ•°\n    crown_angle = params.get('crown_angle', BASELINE_PARAMS['crown_angle'])\n    pavilion_angle = params.get('pavilion_angle', BASELINE_PARAMS['pavilion_angle'])\n    table_pct = params.get('table_pct', BASELINE_PARAMS['table_pct'])\n    crown_height = params.get('crown_height_pct', BASELINE_PARAMS['crown_height_pct'])\n    pavilion_depth = params.get('pavilion_depth_pct', BASELINE_PARAMS['pavilion_depth_pct'])\n\n    # ç†æƒ³å€¼\n    ideal_crown_angle = Decimal('34.5')\n    ideal_pavilion_angle = Decimal('40.75')\n    ideal_table_pct = Decimal('55.5')\n    ideal_crown_height = Decimal('15.2')\n    ideal_pavilion_depth = Decimal('43.1')\n\n    # è®¡ç®—åå·®\n    crown_angle_deviation = abs(crown_angle - ideal_crown_angle) / ideal_crown_angle\n    pavilion_angle_deviation = abs(pavilion_angle - ideal_pavilion_angle) / ideal_pavilion_angle\n    table_deviation = abs(table_pct - ideal_table_pct) / ideal_table_pct\n    crown_height_deviation = abs(crown_height - ideal_crown_height) / ideal_crown_height\n    pavilion_depth_deviation = abs(pavilion_depth - ideal_pavilion_depth) / ideal_pavilion_depth\n\n    # ç»¼åˆè¯„åˆ† (åå·®è¶Šå°åˆ†æ•°è¶Šé«˜)\n    total_deviation = (crown_angle_deviation + pavilion_angle_deviation +\n                      table_deviation + crown_height_deviation + pavilion_depth_deviation)\n\n    # è½¬æ¢ä¸º0-100åˆ†\n    ha_score = Decimal('100.0') * exp(-Decimal('5.0') * total_deviation)\n\n    return ha_score\n\ndef evaluate_æ¯”ä¾‹(params: Dict[str, Decimal]) -> Dict[str, Decimal]:\n    \"\"\"\n    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„æ¯”ä¾‹è¯„ä¼°\n    è¯„ä¼°é’»çŸ³çš„æ•´ä½“æ¯”ä¾‹åˆç†æ€§\n    \"\"\"\n    # è·å–å‚æ•°\n    table_pct = params.get('table_pct', BASELINE_PARAMS['table_pct'])\n    crown_height = params.get('crown_height_pct', BASELINE_PARAMS['crown_height_pct'])\n    pavilion_depth = params.get('pavilion_depth_pct', BASELINE_PARAMS['pavilion_depth_pct'])\n    total_depth = params.get('total_depth_pct', BASELINE_PARAMS['total_depth_pct'])\n\n    # å„é¡¹è¯„åˆ†\n    table_score = Decimal('1.0') - abs(table_pct - Decimal('55.5')) / Decimal('15.0')\n    crown_height_score = Decimal('1.0') - abs(crown_height - Decimal('15.2')) / Decimal('8.0')\n    pavilion_depth_score = Decimal('1.0') - abs(pavilion_depth - Decimal('43.1')) / Decimal('8.0')\n    total_depth_score = Decimal('1.0') - abs(total_depth - Decimal('61.8')) / Decimal('10.0')\n\n    # é™åˆ¶åœ¨0-1èŒƒå›´\n    for score in [table_score, crown_height_score, pavilion_depth_score, total_depth_score]:\n        score = clamp(score, Decimal('0.0'), Decimal('1.0'))\n\n    # æ•´ä½“æ¯”ä¾‹è¯„åˆ†\n    æ¯”ä¾‹_score = (table_score * Decimal('0.2') +\n                        crown_height_score * Decimal('0.2') +\n                        pavilion_depth_score * Decimal('0.3') +\n                        total_depth_score * Decimal('0.3'))\n\n    return {\n        'table_score': table_score,\n        'crown_height_score': crown_height_score,\n        'pavilion_depth_score': pavilion_depth_score,\n        'total_depth_score': total_depth_score,\n        'æ¯”ä¾‹_overall_score': æ¯”ä¾‹_score\n    }\n\ndef evaluate_å¯¹ç§°æ€§(params: Dict[str, Decimal]) -> Dict[str, Decimal]:\n    \"\"\"\n    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„å¯¹ç§°æ€§è¯„ä¼°\n    åŸºäºå‡ ä½•å‚æ•°çš„å¯¹ç§°æ€§åˆ†æ\n    \"\"\"\n    # ç†æƒ³åŸºå‡†å‚æ•°\n    ideal_params = BASELINE_PARAMS\n\n    # è®¡ç®—å„é¡¹å¯¹ç§°æ€§æŒ‡æ ‡\n    å¯¹ç§°æ€§_scores = {}\n\n    # å† éƒ¨å¯¹ç§°æ€§ (åŸºäºå† è§’å’Œå† é«˜çš„ä¸€è‡´æ€§)\n    crown_angle = params.get('crown_angle', ideal_params['crown_angle'])\n    crown_height = params.get('crown_height_pct', ideal_params['crown_height_pct'])\n\n    # å† éƒ¨å¯¹ç§°æ€§è¯„åˆ†\n    crown_å¯¹ç§°æ€§ = Decimal('1.0') - (\n        abs(crown_angle - ideal_params['crown_angle']) / Decimal('20.0') +\n        abs(crown_height - ideal_params['crown_height_pct']) / Decimal('10.0')\n    ) / Decimal('2.0')\n\n    # äº­éƒ¨å¯¹ç§°æ€§\n    pavilion_angle = params.get('pavilion_angle', ideal_params['pavilion_angle'])\n    pavilion_depth = params.get('pavilion_depth_pct', ideal_params['pavilion_depth_pct'])\n\n    pavilion_å¯¹ç§°æ€§ = Decimal('1.0') - (\n        abs(pavilion_angle - ideal_params['pavilion_angle']) / Decimal('20.0') +\n        abs(pavilion_depth - ideal_params['pavilion_depth_pct']) / Decimal('10.0')\n    ) / Decimal('2.0')\n\n    # æ•´ä½“å¯¹ç§°æ€§\n    overall_å¯¹ç§°æ€§ = (crown_å¯¹ç§°æ€§ + pavilion_å¯¹ç§°æ€§) / Decimal('2.0')\n\n    # é™åˆ¶èŒƒå›´\n    overall_å¯¹ç§°æ€§ = clamp(overall_å¯¹ç§°æ€§, Decimal('0.0'), Decimal('1.0'))\n\n    return {\n        'crown_å¯¹ç§°æ€§': crown_å¯¹ç§°æ€§,\n        'pavilion_å¯¹ç§°æ€§': pavilion_å¯¹ç§°æ€§,\n        'overall_å¯¹ç§°æ€§': overall_å¯¹ç§°æ€§,\n        'å¯¹ç§°æ€§_score': overall_å¯¹ç§°æ€§\n    }\n\n# ---------------- äº®åº¦ / ç«å½©çš„å‡ ä½•ä¿®æ­£å› å­ ----------------\ndef brightness_geom_factor(params: Dict[str, Decimal]) -> Decimal:\n    \"\"\"\n    äº®åº¦çš„å‡ ä½•ä¿®æ­£å› å­ï¼š\n    - è®© T / C / P / TD ç›´æ¥å‚ä¸ raw_brightnessï¼Œè€Œä¸æ˜¯åªé  pavilion_angle\n    - åŸºå‡†é’»å‡ ä½•ä¸‹ = 1.0\n    - åœ¨ Â±å‡ ä¸ªç™¾åˆ†ç‚¹çš„æ­£å¸¸å·¥ä½œåŒºé—´å†…åªåš\"æ¸©å’Œè°ƒæ•´\"ï¼Œæç«¯åˆ‡å·¥æ‰æ˜æ˜¾æ‰£åˆ†\n    \"\"\"\n    t   = params.get(\"table_pct\",          BASELINE_PARAMS[\"table_pct\"])\n    c_h = params.get(\"crown_height_pct\",   BASELINE_PARAMS[\"crown_height_pct\"])\n    p_d = params.get(\"pavilion_depth_pct\", BASELINE_PARAMS[\"pavilion_depth_pct\"])\n    td  = params.get(\"total_depth_pct\",    BASELINE_PARAMS[\"total_depth_pct\"])\n\n    def g(v: Decimal, v0: Decimal, span: Decimal) -> Decimal:\n        dv = (v - v0) / span\n        return (-dv * dv).exp()\n\n    # å°é¢ Â±8%ï¼Œå† é«˜ / äº­æ·± Â±4%ï¼Œå…¨æ·± Â±8% ä½œä¸º\"èˆ’æœçš„å·¥ä½œåŒºé—´\"\n    f_t  = g(t,   BASELINE_PARAMS[\"table_pct\"],          Decimal('8.0'))\n    f_ch = g(c_h, BASELINE_PARAMS[\"crown_height_pct\"],   Decimal('4.0'))\n    f_pd = g(p_d, BASELINE_PARAMS[\"pavilion_depth_pct\"], Decimal('4.0'))\n    f_td = g(td,  BASELINE_PARAMS[\"total_depth_pct\"],    Decimal('8.0'))\n\n    return f_t * f_ch * f_pd * f_td\n\ndef fire_geom_factor(params: Dict[str, Decimal]) -> Decimal:\n    \"\"\"\n    ç«å½©çš„å‡ ä½•ä¿®æ­£å› å­ï¼š\n    - å† è§’ / å† é«˜ / äº­æ·± / å°é¢å½±å“\"è‰²æ•£å±•ç¤ºç©ºé—´\"\n    - åŸºå‡†é’» = 1.0ï¼Œè½»å¾®åç¦»ä¸ä¼šä¸€åˆ€åˆ‡\n    \"\"\"\n    t     = params.get(\"table_pct\",          BASELINE_PARAMS[\"table_pct\"])\n    c_ang = params.get(\"crown_angle\",        BASELINE_PARAMS[\"crown_angle\"])\n    c_h   = params.get(\"crown_height_pct\",   BASELINE_PARAMS[\"crown_height_pct\"])\n    p_d   = params.get(\"pavilion_depth_pct\", BASELINE_PARAMS[\"pavilion_depth_pct\"])\n\n    def g(v: Decimal, v0: Decimal, span: Decimal) -> Decimal:\n        dv = (v - v0) / span\n        return (-dv * dv).exp()\n\n    # å°é¢ Â±10%ï¼Œå† è§’ Â±4Â°ï¼Œå† é«˜ / äº­æ·± Â±5% çš„åŒºé—´\n    f_t  = g(t,     BASELINE_PARAMS[\"table_pct\"],          Decimal('10.0'))\n    f_ca = g(c_ang, BASELINE_PARAMS[\"crown_angle\"],         Decimal('4.0'))\n    f_ch = g(c_h,   BASELINE_PARAMS[\"crown_height_pct\"],    Decimal('5.0'))\n    f_pd = g(p_d,   BASELINE_PARAMS[\"pavilion_depth_pct\"],  Decimal('5.0'))\n\n    return f_t * f_ca * f_ch * f_pd\n\n# ---------------- äº®åº¦ / ç«å½© / é—ªåº¦ï¼šåŸå§‹ç‰©ç† surrogate ----------------\ndef raw_brightness_calculate(lam: Decimal, v_weight: Decimal, params: Dict[str, Decimal],\n                           high_precision: bool, cancel_flag: threading.Event) -> Decimal:\n    \"\"\"äº®åº¦è®¡ç®—ï¼šæ·»åŠ åæŒ¯æ•ˆåº”å®Œæ•´å¤„ç†\"\"\"\n    if cancel_flag.is_set():\n        return Decimal('0.0')\n\n    n_d = sellmeier_n(lam)\n    theta_c = asin(Decimal('1.0') / n_d)\n\n    theta_step_deg = Decimal('0.5') if high_precision else Decimal('1.0')\n    thetas = [Decimal(str(i)) * theta_step_deg for i in range(0, int(Decimal('90') / theta_step_deg) + 1)]\n\n    flux_theta: List[Decimal] = []\n    for theta_i in thetas:\n        if cancel_flag.is_set():\n            return Decimal('0.0')\n\n        theta_i_rad = theta_i * PI / Decimal('180')\n        w = cos(theta_i_rad) * sin(theta_i_rad)  # Lambert æƒé‡\n\n        # å®Œæ•´åæŒ¯å¤„ç†ï¼šåˆ†åˆ«è®¡ç®—sæ³¢å’Œpæ³¢\n        R_in_s, T_in_s = fresnel_polarized(theta_i_rad, Decimal('1.0'), n_d, 's')\n        R_in_p, T_in_p = fresnel_polarized(theta_i_rad, Decimal('1.0'), n_d, 'p')\n\n        # å†…éƒ¨å°„çº¿è¿‘ä¼¼ï¼šç”¨ pavilion_angle è¡¨å¾åˆ°äº­é¢çš„å¹³å‡å¤¹è§’\n        pavilion_angle_deg = params.get(\"pavilion_angle\", BASELINE_PARAMS[\"pavilion_angle\"])\n        pavilion_angle = pavilion_angle_deg * PI / Decimal('180')\n        theta_pav = pavilion_angle\n\n        R_pav_s, _ = fresnel_polarized(theta_pav, n_d, Decimal('1.0'), 's') if theta_pav <= theta_c else (Decimal('1.0'), Decimal('0.0'))\n        R_pav_p, _ = fresnel_polarized(theta_pav, n_d, Decimal('1.0'), 'p') if theta_pav <= theta_c else (Decimal('1.0'), Decimal('0.0'))\n\n        # å† éƒ¨å‡ºå°„ï¼šé’»çŸ³ -> ç©ºæ°”ï¼ˆè¿‘ä¼¼å¯¹ç§°ï¼‰\n        R_out_s, T_out_s = fresnel_polarized(theta_i_rad, n_d, Decimal('1.0'), 's')\n        R_out_p, T_out_p = fresnel_polarized(theta_i_rad, n_d, Decimal('1.0'), 'p')\n\n        # è®¡ç®—æ€»é€å°„ç‡ï¼ˆsæ³¢å’Œpæ³¢å¹³å‡ï¼‰\n        flux_s = T_in_s * R_pav_s * T_out_s\n        flux_p = T_in_p * R_pav_p * T_out_p\n        flux = (flux_s + flux_p) / Decimal('2.0')\n\n        flux_theta.append(flux * w)\n\n    # Î¸ æ–¹å‘ç§¯åˆ†ï¼ˆæ¢¯å½¢ï¼‰\n    integral_theta = Decimal('0.0')\n    for i in range(1, len(thetas)):\n        if cancel_flag.is_set():\n            return Decimal('0.0')\n\n        delta_theta = (thetas[i] - thetas[i-1]) * PI / Decimal('180')  # è½¬æ¢ä¸ºå¼§åº¦\n        integral_theta += Decimal('0.5') * (flux_theta[i] + flux_theta[i-1]) * delta_theta\n\n    return v_weight * integral_theta\n\ndef raw_brightness(params: Dict[str, Decimal], high_precision: bool = False,\n                  cancel_flag: threading.Event = None) -> Decimal:\n    \"\"\"\n    äº®åº¦ Brightness çš„åŸå§‹ç‰©ç†é‡ï¼ˆæœªç¼©æ”¾ã€æœªå‡ ä½•æƒ©ç½šï¼‰ï¼š\n      - Sellmeier n(Î»)\n      - Fresnel åå°„ / é€å°„\n      - Lambert å…‰åœºç§¯åˆ†ï¼ˆæƒé‡ cosÎ¸Â·sinÎ¸ï¼‰\n      - CIE V(Î») åŠ æƒ\n      - T / C / P / TD å‡ ä½•å› å­\n    \"\"\"\n    if cancel_flag is None:\n        cancel_flag = threading.Event()\n\n    total = Decimal('0.0')\n\n    for lam, v_weight in CIE_V.items():\n        if cancel_flag.is_set():\n            return Decimal('0.0')\n\n        total += raw_brightness_calculate(lam, v_weight, params, high_precision, cancel_flag)\n\n    # å‡ ä½•ä¿®æ­£ï¼ˆåŸºå‡†é’» = 1.0ï¼‰\n    if not cancel_flag.is_set():\n        total *= brightness_geom_factor(params)\n\n    return total\n\ndef raw_fire(params: Dict[str, Decimal], high_precision: bool = False,\n            cancel_flag: threading.Event = None) -> Decimal:\n    \"\"\"ä¼˜åŒ–çš„ç«å½©è®¡ç®—æ¨¡å‹ï¼šè€ƒè™‘å¤šæ¬¡å†…éƒ¨åå°„å’Œæ›´å¤šæ³¢é•¿\"\"\"\n    if cancel_flag is None:\n        cancel_flag = threading.Event()\n\n    if cancel_flag.is_set():\n        return Decimal('0.0')\n\n    diameter = params.get(\"diameter\", BASELINE_PARAMS[\"diameter\"])\n    pavilion_angle_deg = params.get(\"pavilion_angle\", BASELINE_PARAMS[\"pavilion_angle\"])\n    pavilion_angle = pavilion_angle_deg * PI / Decimal('180')\n\n    # æ‰©å±•ï¼šç³»ç»Ÿé‡‡æ ·æ›´å¤šæ³¢é•¿ç‚¹\n    wavelengths = [400e-9 + i*10e-9 for i in range(31)]  # 400-700nm\n    incident_deg_list = [0, 10, 20, 30, 40] if high_precision else [0, 20, 40]\n    points: List[Tuple[Decimal, Decimal]] = []\n\n    for lam in wavelengths:\n        if cancel_flag.is_set():\n            return Decimal('0.0')\n\n        n_d = sellmeier_n(Decimal(str(lam)))\n        for theta_in_deg in incident_deg_list:\n            if cancel_flag.is_set():\n                return Decimal('0.0')\n\n            theta_in = Decimal(str(theta_in_deg)) * PI / Decimal('180')\n            _, T_in = fresnel_unpolarized(theta_in, Decimal('1.0'), n_d)\n            if T_in <= Decimal('1e-6'):\n                continue\n\n            # è€ƒè™‘å¤šæ¬¡å†…éƒ¨åå°„\n            max_reflections = 3 if high_precision else 2\n            for reflection_count in range(1, max_reflections + 1):\n                if cancel_flag.is_set():\n                    return Decimal('0.0')\n\n                sin_t = sin(theta_in) * Decimal('1.0') / n_d\n                if abs(sin_t) > Decimal('1.0'):\n                    continue\n                theta_t = asin(sin_t)\n\n                # åœ¨äº­éƒ¨åå°„ï¼šè€ƒè™‘å¤šæ¬¡åå°„\n                theta_internal = theta_t\n                theta_ref = abs(Decimal(str(reflection_count)) * pavilion_angle - theta_internal)\n\n                # åœ¨å°é¢ä¸Šçš„å‡ºå°„ç‚¹åæ ‡ï¼ˆåŠå¾„æ–¹å‘ï¼‰\n                tan_tr = tan(theta_ref)\n                radius = (diameter / Decimal('2.0')) * tan_tr / sqrt(Decimal('1.0') + tan_tr * tan_tr)\n                x = radius * Decimal(str(reflection_count))  # åŒºåˆ†ä¸åŒåå°„æ¬¡æ•°çš„ç‚¹\n                y = Decimal('0.0')\n                points.append((x, y))\n\n    if cancel_flag.is_set() or len(points) < 2:\n        return Decimal('0.0')\n\n    d_sum = Decimal('0.0')\n    cnt = 0\n    for i in range(len(points)):\n        if cancel_flag.is_set():\n            return Decimal('0.0')\n\n        xi, yi = points[i]\n        for j in range(i + 1, len(points)):\n            if cancel_flag.is_set():\n                return Decimal('0.0')\n\n            xj, yj = points[j]\n            d = ((xi - xj)**2 + (yi - yj)**2).sqrt()\n            d_sum += d\n            cnt += 1\n    if cnt == 0:\n        return Decimal('0.0')\n\n    avg_sep = d_sum / Decimal(str(cnt))\n    if not cancel_flag.is_set():\n        avg_sep *= fire_geom_factor(params)\n\n    return avg_sep\n\ndef raw_scint(params: Dict[str, Decimal], high_precision: bool = False,\n             cancel_flag: threading.Event = None) -> Decimal:\n    \"\"\"ä¼˜åŒ–çš„é—ªåº¦è®¡ç®—æ¨¡å‹ï¼šå¢åŠ åˆ»é¢æ•°é‡å’ŒåŠ¨æ€è§†è§’é‡‡æ ·\"\"\"\n    if cancel_flag is None:\n        cancel_flag = threading.Event()\n\n    if cancel_flag.is_set():\n        return Decimal('0.0')\n\n    crown_angle_deg = params.get(\"crown_angle\", BASELINE_PARAMS[\"crown_angle\"])\n    crown_angle = crown_angle_deg * PI / Decimal('180')\n\n    n_d = sellmeier_n(Decimal('550e-9'))\n    n_air = Decimal('1.0')\n    theta_c = asin(n_air / n_d)\n\n    # å¢åŠ ï¼šæ›´å¤šåˆ»é¢æ•°é‡ä»¥è·å¾—æ›´å‡†ç¡®çš„é—ªåº¦è®¡ç®—\n    facet_count = 16 if high_precision else 8\n    facet_normals: List[Tuple[Decimal, Decimal, Decimal]] = []\n    for i in range(facet_count):\n        if cancel_flag.is_set():\n            return Decimal('0.0')\n\n        phi = Decimal('2.0') * PI * Decimal(str(i)) / Decimal(str(facet_count))\n        nx = sin(crown_angle) * cos(phi)\n        ny = sin(crown_angle) * sin(phi)\n        nz = cos(crown_angle)\n        facet_normals.append((nx, ny, nz))\n\n    # åŠ¨æ€è§†è§’é‡‡æ ·\n    step_deg = Decimal('1.0') if high_precision else Decimal('2.0')\n    view_angles = [Decimal(str(i)) * step_deg for i in range(0, int(Decimal('360') / step_deg))]\n    intensities: List[Decimal] = []\n\n    for phi_v in view_angles:\n        if cancel_flag.is_set():\n            return Decimal('0.0')\n\n        phi_v_rad = phi_v * PI / Decimal('180')\n        vx = cos(phi_v_rad)\n        vy = sin(phi_v_rad)\n        vz = Decimal('0.0')\n        I = Decimal('0.0')\n\n        for (nx, ny, nz) in facet_normals:\n            if cancel_flag.is_set():\n                return Decimal('0.0')\n\n            cosi = nx * vx + ny * vy + nz * vz\n            if cosi <= Decimal('0'):\n                continue\n            theta_i = acos(cosi)\n            theta_i = clamp(theta_i, Decimal('0'), PI / Decimal('2'))\n\n            if theta_i > theta_c:\n                R = Decimal('1.0')\n            else:\n                R, _ = fresnel_unpolarized(theta_i, n_d, n_air)\n\n            I += R * cosi\n\n        intensities.append(I)\n\n    if cancel_flag.is_set() or len(intensities) == 0:\n        return Decimal('0.0')\n\n    mean_I = sum(intensities) / Decimal(str(len(intensities)))\n    if mean_I <= Decimal('1e-9'):\n        return Decimal('0.0')\n\n    var = sum((x - mean_I) ** 2 for x in intensities) / Decimal(str(len(intensities)))\n    std = sqrt(var)\n\n    return std / mean_I\n\n# ---------------- æ ‡å®šå™¨ ----------------\n@dataclass\nclass CalibrationConfig:\n    target_brightness: Decimal = Decimal('10.0')\n    target_fire: Decimal = Decimal('10.0')\n    target_scint: Decimal = Decimal('10.0')\n    high_precision: bool = False\n\nclass PhysicalCalibrator:\n    \"\"\"\n    ç”¨åŸºå‡†é’»ï¼ˆå›ºå®šå‡ ä½•ï¼‰å’Œç›®æ ‡åˆ†æ•°ï¼ˆå¯é€šè¿‡å¯†ç ä¿®æ”¹ï¼‰è‡ªåŠ¨è®¡ç®—ç¼©æ”¾ç³»æ•°ï¼š\n        B = scale_B * raw_B * f_geom\n        F = scale_F * raw_F * f_geom\n        S = scale_S * raw_S * f_geom\n    ä½¿å¾—åŸºå‡†é’»åœ¨å½“å‰æ¨¡å¼ä¸‹æ°å¥½è¾¾åˆ° target_B / target_F / target_Sã€‚\n    \"\"\"\n\n    def __init__(self, config: CalibrationConfig) -> None:\n        self.config = config\n        self.scale_B = Decimal('1.0')\n        self.scale_F = Decimal('1.0')\n        self.scale_S = Decimal('1.0')\n        self.ref_raw_B = Decimal('0.0')\n        self.ref_raw_F = Decimal('0.0')\n        self.ref_raw_S = Decimal('0.0')\n        self.recalibrate()\n\n    def recalibrate(self) -> None:\n        # åŸºå‡†é’» rawï¼ˆä¸åŠ å‡ ä½•æƒ©ç½šï¼Œå‡ ä½•å› å­å½“ 1ï¼‰\n        params = dict(BASELINE_PARAMS)\n        raw_B = raw_brightness(params, self.config.high_precision)\n        raw_F = raw_fire(params, self.config.high_precision)\n        raw_S = raw_scint(params, self.config.high_precision)\n\n        self.ref_raw_B = raw_B\n        self.ref_raw_F = raw_F\n        self.ref_raw_S = raw_S\n\n        self.scale_B = (\n            self.config.target_brightness / raw_B if raw_B > Decimal('1e-9') else Decimal('1.0')\n        )\n        self.scale_F = self.config.target_fire / raw_F if raw_F > Decimal('1e-9') else Decimal('1.0')\n        self.scale_S = self.config.target_scint / raw_S if raw_S > Decimal('1e-9') else Decimal('1.0')\n\n    def set_targets(self, tb: Decimal, tf: Decimal, ts: Decimal) -> None:\n        self.config.target_brightness = tb\n        self.config.target_fire = tf\n        self.config.target_scint = ts\n        self.recalibrate()\n\n    def set_high_precision(self, hp: bool) -> None:\n        self.config.high_precision = hp\n        self.recalibrate()\n\n    def compute_scores(self, params: Dict[str, Decimal], cancel_flag: threading.Event = None,\n                      progress_callback=None) -> Tuple[Dict[str, Decimal], str]:\n        \"\"\"\n        è¾“å…¥ä¸€é¢—é’»çŸ³çš„å®è§‚å‚æ•°ï¼Œè¾“å‡ºï¼š\n            scores: dict\n                brightness, fire, scint, op, cs, ha, d_geom\n            detail: str\n                å¯è¿½æº¯çš„æ–‡å­—è¯´æ˜\n        \"\"\"\n        if cancel_flag is None:\n            cancel_flag = threading.Event()\n\n        # å‡ ä½•éƒ¨åˆ†\n        if cancel_flag.is_set():\n            return {}, \"è®¡ç®—å·²å–æ¶ˆ\"\n\n        d_geom, ha = geometry_metrics(params)\n        # å‡ ä½•æƒ©ç½šå› å­ï¼šd_geom<=1 ä¸æƒ©ç½šï¼›>1 çº¿æ€§ä¸‹é™åˆ° 0.5ï¼Œå¹¶ä¿åº•ä¸å½’é›¶\n        if d_geom <= Decimal('1.0'):\n            f_geom = Decimal('1.0')\n        elif d_geom >= Decimal('5.0'):\n            f_geom = Decimal('0.5')\n        else:\n            # 1~5 ä¹‹é—´ä» 1.0 çº¿æ€§é™åˆ° 0.5\n            f_geom = Decimal('1.0') - Decimal('0.125') * (d_geom - Decimal('1.0'))\n        f_geom = clamp(f_geom, Decimal('0.5'), Decimal('1.0'))\n\n        # æ›´æ–°è¿›åº¦\n        if progress_callback:\n            progress_callback(20)\n\n        # åŸå§‹ç‰©ç†é‡\n        if cancel_flag.is_set():\n            return {}, \"è®¡ç®—å·²å–æ¶ˆ\"\n\n        raw_B = raw_brightness(params, self.config.high_precision, cancel_flag)\n        if cancel_flag.is_set():\n            return {}, \"è®¡ç®—å·²å–æ¶ˆ\"\n\n        if progress_callback:\n            progress_callback(40)\n\n        raw_F = raw_fire(params, self.config.high_precision, cancel_flag)\n        if cancel_flag.is_set():\n            return {}, \"è®¡ç®—å·²å–æ¶ˆ\"\n\n        if progress_callback:\n            progress_callback(60)\n\n        raw_S = raw_scint(params, self.config.high_precision, cancel_flag)\n\n        if cancel_flag.is_set():\n            return {}, \"è®¡ç®—å·²å–æ¶ˆ\"\n\n        if progress_callback:\n            progress_callback(80)\n\n        # æ ‡å®šå 0~10 åˆ†\n        B = clamp(self.scale_B * raw_B * f_geom, Decimal('0.0'), Decimal('10.0'))\n        F = clamp(self.scale_F * raw_F * f_geom, Decimal('0.0'), Decimal('10.0'))\n        S = clamp(self.scale_S * raw_S * f_geom, Decimal('0.0'), Decimal('10.0'))\n\n        OP = WEIGHT_B * B + WEIGHT_F * F + WEIGHT_S * S\n        CS = WEIGHT_OP_IN_CS * OP + WEIGHT_HA_IN_CS * (ha / Decimal('10.0'))\n\n        if OP >= Decimal('9.5'):\n            grade = \"æä¼˜ EX\"\n        elif OP >= Decimal('9.0'):\n            grade = \"ä¼˜ VG\"\n        elif OP >= Decimal('8.0'):\n            grade = \"è‰¯ Good\"\n        else:\n            grade = \"ä¸€èˆ¬ Fair\"\n\n        scores = {\n            \"brightness\": B,\n            \"fire\":       F,\n            \"scint\":      S,\n            \"op\":         OP,\n            \"cs\":         CS,\n            \"ha\":         ha,\n            \"d_geom\":     d_geom,\n        }\n\n        # å…‰çº¿è¿½è¸ªéªŒè¯\n        if progress_callback:\n            progress_callback(90)\n\n        rt_validation = advanced_monte_carlo_ray_tracing(params, num_rays=1000,\n                                                       progress_callback=progress_callback,\n                                                       cancel_flag=cancel_flag)\n\n        if progress_callback:\n            progress_callback(100)\n\n        detail_lines: List[str] = []\n        detail_lines.append(\"=== QL é’»çŸ³å…‰å­¦æ€§èƒ½é‡åŒ–è¯„ä¼°ç³»ç»Ÿ - ä½œè€…ï¼šæ—å°å…” ===\\n\")\n        detail_lines.append(\"å›ºå®šè™šæ‹Ÿå®éªŒå®¤ç‰©ç†æ¡ä»¶ï¼š\\n\")\n        detail_lines.append(\"  - æŠ˜å°„ç‡ n(Î») é‡‡ç”¨ Sellmeier æ–¹ç¨‹ï¼ˆå¯è§æ³¢æ®µ 450~650nmï¼‰\\n\")\n        detail_lines.append(\"  - Fresnel éåæŒ¯åå°„ / é€å°„ï¼ˆs/p å¹³å‡ï¼‰\\n\")\n        detail_lines.append(\"  - äº®åº¦ï¼šLambert å…‰åœºç§¯åˆ† + CIE V(Î») åŠ æƒ\\n\")\n        detail_lines.append(\"  - ç«å½©ï¼šåŸºäºä¸åŒæ³¢é•¿å‡ºå°„ç‚¹å‡ ä½•åˆ†ç¦»çš„å¹³å‡è·ç¦»\\n\")\n        detail_lines.append(\"  - é—ªåº¦ï¼šè§†è§’æ—‹è½¬ + 8 ä¸ªå† éƒ¨åˆ»é¢çš„ Fresnel å“åº”æ³¢åŠ¨åº¦ (std/mean)\\n\\n\")\n\n        detail_lines.append(\"åŸºå‡†é’»åˆ‡å·¥å‚æ•°ï¼ˆå”¯ä¸€å‡ ä½•åŸºå‡†ï¼‰ï¼š\\n\")\n        detail_lines.append(\n            \"  Î¸c = {crown_angle:.3f}Â°ï¼ŒÎ¸p = {pavilion_angle:.3f}Â°ï¼ŒT = {table_pct:.3f}% ï¼Œ\\n\"\n            \"  C = {crown_height_pct:.3f}% ï¼ŒP = {pavilion_depth_pct:.3f}% ï¼ŒTD = {total_depth_pct:.3f}% ï¼Œ\\n\"\n            \"  ct = {carat:.4f}ï¼ŒD = {diameter:.3f} mm\\n\".format(**{k: float(v) for k, v in BASELINE_PARAMS.items()})\n        )\n        detail_lines.append(\n            \"å½“å‰ç›®æ ‡åŸºå‡†åˆ†ï¼ˆå¯é€šè¿‡å¯†ç  200115 ä¿®æ”¹ï¼‰ï¼š\\n\"\n            f\"  Brightness = {float(self.config.target_brightness):.2f} / 10\\n\"\n            f\"  ç«å½©       = {float(self.config.target_fire):.2f} / 10\\n\"\n            f\"  Scint      = {float(self.config.target_scint):.2f} / 10\\n\"\n        )\n        detail_lines.append(\n            \"å½“å‰ç¼©æ”¾ç³»æ•°ï¼ˆç”±åŸºå‡†é’»è‡ªåŠ¨æ ‡å®šï¼‰ï¼š\\n\"\n            f\"  scale_B = {float(self.scale_B):.6e}ï¼ˆref_raw_B = {float(self.ref_raw_B):.6e}ï¼‰\\n\"\n            f\"  scale_F = {float(self.scale_F):.6e}ï¼ˆref_raw_F = {float(self.ref_raw_F):.6e}ï¼‰\\n\"\n            f\"  scale_S = {float(self.scale_S):.6e}ï¼ˆref_raw_S = {float(self.ref_raw_S):.6e}ï¼‰\\n\"\n        )\n        detail_lines.append(\n            \"æ•°å€¼æ¨¡å¼ï¼š{mode}\\n\".format(\n                mode=\"é«˜ç²¾åº¦ï¼ˆç»†æ­¥é•¿ï¼‰\" if self.config.high_precision else \"æ ‡å‡†ç²¾åº¦\"\n            )\n        )\n\n        detail_lines.append(\"\\n=== æœ¬æ¬¡å¾…è¯„ä¼°é’»çŸ³è¾“å…¥å‚æ•° ===\\n\")\n        detail_lines.append(\n            \"  Î¸c = {crown_angle:.3f}Â°ï¼ŒÎ¸p = {pavilion_angle:.3f}Â°ï¼ŒT = {table_pct:.3f}% ï¼Œ\\n\"\n            \"  C = {crown_height_pct:.3f}% ï¼ŒP = {pavilion_depth_pct:.3f}% ï¼ŒTD = {total_depth_pct:.3f}% ï¼Œ\\n\"\n            \"  ct = {carat:.4f}ï¼ŒD = {diameter:.3f} mm\\n\".format(**{k: float(v) for k, v in params.items()})\n        )\n\n        detail_lines.append(\"\\n=== å‡ ä½•åç¦»ä¸å…«å¿ƒå…«ç®­æŒ‡æ ‡ ===\\n\")\n        detail_lines.append(\n            \"  D_geom = {d:.4f} ï¼ˆåŸºå‡†é’» = 0ï¼Œè¶Šå¤§è¡¨ç¤ºåç¦»è¶Šå¤§ï¼‰\\n\".format(d=float(d_geom))\n        )\n        detail_lines.append(\n            \"  HA     = {ha:.2f} / 100 ï¼ˆåŸºå‡†é’» = 100ï¼ŒæŒ‰å‡ ä½•åç¦»æŸ”æ€§æ‰£åˆ†ï¼‰\\n\".format(ha=float(ha))\n        )\n\n        detail_lines.append(\"\\n=== ä¸‰å¤§å…‰å­¦æŒ‡æ ‡ï¼ˆå·²åŒ…å«å‡ ä½•æƒ©ç½šä¸ç¼©æ”¾ï¼‰ ===\\n\")\n        detail_lines.append(\"  äº®åº¦ Brightness = {b:.4f} / 10\\n\".format(b=float(B)))\n        detail_lines.append(\"  ç«å½© ç«å½©       = {f:.4f} / 10\\n\".format(f=float(F)))\n        detail_lines.append(\"  é—ªåº¦ Scint      = {s:.4f} / 10\\n\".format(s=float(S)))\n\n        detail_lines.append(\"\\n=== ç»¼åˆå…‰å­¦æ€§èƒ½ OP ä¸ç»¼åˆç¾è§‚åº¦ CS ===\\n\")\n        detail_lines.append(\n            \"  OP = 0.50 * B + 0.35 * F + {s_weight} * S = {op:.4f} / 10\\n\".format(\n                s_weight=float(WEIGHT_S), op=float(OP)\n            )\n        )\n        detail_lines.append(\n            \"  CS = {op_weight} * OP + {ha_weight} * (HA/10) = {cs:.4f} / 10\\n\".format(\n                op_weight=float(WEIGHT_OP_IN_CS),\n                ha_weight=float(WEIGHT_HA_IN_CS),\n                cs=float(CS)\n            )\n        )\n        detail_lines.append(\n            \"  å½“å‰å…‰å­¦ç­‰çº§ï¼ˆè§£é‡Šï¼‰ï¼š{g}\\n\".format(g=grade)\n        )\n\n        detail_lines.append(\"\\n=== å…‰çº¿è¿½è¸ªéªŒè¯ç»“æœ ===\\n\")\n        detail_lines.append(f\"  äº®åº¦å·®å¼‚: {float(rt_validation['brightness_diff']):.2f}%\\n\")\n        detail_lines.append(f\"  ç«å½©å·®å¼‚: {float(rt_validation['fire_diff']):.2f}%\\n\")\n\n        detail_lines.append(\"\\n=== å‡ ä½•ä¿®æ­£å› å­ï¼ˆå†…éƒ¨å‚æ•°ï¼Œä»…ä¾›å®¡é˜…ï¼‰ ===\\n\")\n        detail_lines.append(\n            \"  å‡ ä½•æƒ©ç½šå› å­ f_geom = {fg:.4f} ï¼ˆD_geom={dg:.4f}ï¼‰\\n\".format(\n                fg=float(f_geom), dg=float(d_geom)\n            )\n        )\n\n        return scores, \"\".join(detail_lines)\n\n# ---------------- é«˜çº§æ ‡å®šå‡½æ•° ----------------\ndef calibrate_to_baseline(target_scores: Dict[str, Decimal] = None,\n                         num_iterations: int = 100,\n                         tolerance: Decimal = Decimal('1e-6')) -> Dict[str, Any]:\n    \"\"\"\n    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„åŸºå‡†é’»è‡ªåŠ¨æ ‡å®š\n    è‡ªåŠ¨è°ƒæ•´å‚æ•°ä»¥è¾¾åˆ°åŸºå‡†é’»çŸ³çš„å®Œç¾åˆ†æ•°\n    \"\"\"\n    if target_scores is None:\n        target_scores = {\n            'brightness': Decimal('10.0'),\n            'fire': Decimal('10.0'),\n            'scint': Decimal('10.0'),\n            'cs': Decimal('10.0')\n        }\n\n    # åˆå§‹åŒ–é…ç½®å’Œæ ‡å®šå™¨\n    config = CalibrationConfig()\n    calibrator = PhysicalCalibrator(config)\n\n    # å½“å‰åŸºå‡†å‚æ•°\n    current_params = BASELINE_PARAMS.copy()\n\n    # æ ‡å®šå†å²è®°å½•\n    calibration_history = []\n\n    print(\"å¼€å§‹åŸºå‡†é’»è‡ªåŠ¨æ ‡å®š...\")\n\n    for iteration in range(num_iterations):\n        # è®¡ç®—å½“å‰åˆ†æ•°\n        scores, detail = calibrator.compute_scores(current_params)\n\n        # è®¡ç®—åå·®\n        errors = {}\n        total_error = Decimal('0.0')\n        for metric, target_score in target_scores.items():\n            current_score = scores.get(metric, Decimal('0.0'))\n            error = target_score - current_score\n            errors[metric] = error\n            total_error += abs(error)\n\n        # è®°å½•æ ‡å®šå†å²\n        calibration_history.append({\n            'iteration': iteration,\n            'params': current_params.copy(),\n            'scores': scores.copy(),\n            'errors': errors.copy(),\n            'total_error': total_error\n        })\n\n        # æ£€æŸ¥æ˜¯å¦è¾¾åˆ°ç›®æ ‡\n        if total_error < tolerance:\n            print(f\"æ ‡å®šå®Œæˆï¼è¿­ä»£æ¬¡æ•°: {iteration + 1}\")\n            break\n\n        # å¦‚æœå·²ç»æ˜¯å®Œç¾åˆ†æ•°ï¼Œåœæ­¢æ ‡å®š\n        if total_error == Decimal('0.0'):\n            print(\"åŸºå‡†é’»çŸ³å·²è¾¾åˆ°å®Œç¾åˆ†æ•°ï¼Œæ— éœ€è¿›ä¸€æ­¥æ ‡å®š\")\n            break\n\n        # è‡ªé€‚åº”å‚æ•°è°ƒæ•´ (ç®€åŒ–çš„æ¢¯åº¦ä¸‹é™)\n        adjustment_factor = Decimal('0.1') * (Decimal('1.0') - Decimal(iteration) / Decimal(num_iterations))\n\n        # æ ¹æ®è¯¯å·®è°ƒæ•´å‡ ä½•å‚æ•°\n        for param_name, error in errors.items():\n            if abs(error) > Decimal('0.01'):  # åªè°ƒæ•´æœ‰æ˜æ˜¾è¯¯å·®çš„å‚æ•°\n                # ç¡®å®šå“ªäº›å‚æ•°å½±å“è¯¥æŒ‡æ ‡\n                if param_name == 'brightness':\n                    # äº®åº¦ä¸»è¦å—äº­è§’å’Œå…¨æ·±æ¯”å½±å“\n                    current_params['pavilion_angle'] += error * adjustment_factor * Decimal('0.5')\n                    current_params['total_depth_pct'] += error * adjustment_factor * Decimal('0.3')\n                elif param_name == 'fire':\n                    # ç«å½©ä¸»è¦å—å† è§’å’Œå°é¢å½±å“\n                    current_params['crown_angle'] += error * adjustment_factor * Decimal('0.4')\n                    current_params['table_pct'] += error * adjustment_factor * Decimal('0.3')\n                elif param_name == 'scint':\n                    # é—ªåº¦å—å¤šä¸ªå‚æ•°ç»¼åˆå½±å“\n                    current_params['crown_height_pct'] += error * adjustment_factor * Decimal('0.2')\n                    current_params['pavilion_depth_pct'] += error * adjustment_factor * Decimal('0.2')\n                    current_params['table_pct'] += error * adjustment_factor * Decimal('0.1')\n                elif param_name == 'cs':\n                    # CSæ˜¯ç»¼åˆæŒ‡æ ‡\n                    current_params['crown_angle'] += error * adjustment_factor * Decimal('0.15')\n                    current_params['pavilion_angle'] += error * adjustment_factor * Decimal('0.15')\n                    current_params['table_pct'] += error * adjustment_factor * Decimal('0.1')\n\n        # å‚æ•°èŒƒå›´é™åˆ¶\n        current_params = clamp_params_to_valid_range(current_params)\n\n    # æœ€ç»ˆéªŒè¯\n    final_scores, final_detail = calibrator.compute_scores(current_params)\n\n    return {\n        'success': total_error < tolerance,\n        'iterations': len(calibration_history),\n        'final_params': current_params,\n        'final_scores': final_scores,\n        'target_scores': target_scores,\n        'calibration_history': calibration_history,\n        'final_error': total_error,\n        'improvement': calibration_history[-1]['total_error'] - total_error if calibration_history else Decimal('0.0')\n    }\n\ndef auto_calibrate(batch_params: List[Dict[str, Decimal]] = None,\n                   target_improvement: Decimal = Decimal('0.5'),\n                   max_iterations: int = 200) -> Dict[str, Any]:\n    \"\"\"\n    å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„æ‰¹é‡è‡ªåŠ¨æ ‡å®š\n    å¯¹å¤šé¢—é’»çŸ³è¿›è¡Œæ‰¹é‡æ ‡å®šä¼˜åŒ–\n    \"\"\"\n    if batch_params is None:\n        # ä½¿ç”¨ä¸€äº›æµ‹è¯•å‚æ•°\n        batch_params = [\n            BASELINE_PARAMS.copy(),\n            {**BASELINE_PARAMS, 'crown_angle': Decimal('33.0')},\n            {**BASELINE_PARAMS, 'pavilion_angle': Decimal('42.0')},\n            {**BASELINE_PARAMS, 'table_pct': Decimal('58.0')},\n        ]\n\n    config = CalibrationConfig()\n    calibrator = PhysicalCalibrator(config)\n\n    # åˆå§‹åˆ†æ•°è®¡ç®—\n    initial_scores = []\n    for params in batch_params:\n        scores, _ = calibrator.compute_scores(params)\n        initial_scores.append(scores)\n\n    print(f\"å¼€å§‹æ‰¹é‡æ ‡å®š {len(batch_params)} é¢—é’»çŸ³...\")\n\n    # æ‰¹é‡æ ‡å®šå¾ªç¯\n    calibration_results = []\n    total_improvement = Decimal('0.0')\n\n    for iteration in range(max_iterations):\n        iteration_improvements = []\n\n        for i, params in enumerate(batch_params):\n            # è®¡ç®—å½“å‰åˆ†æ•°\n            current_scores, _ = calibrator.compute_scores(params)\n            initial_score = sum(initial_scores[i].values())\n            current_score = sum(current_scores.values())\n\n            # è‡ªé€‚åº”è°ƒæ•´\n            if current_score < initial_score + target_improvement:\n                # åº”ç”¨æ¢¯åº¦ä¸‹é™è°ƒæ•´\n                adjusted_params = apply_adaptive_adjustment(params, current_scores, target_improvement)\n                batch_params[i] = adjusted_params\n\n                # è®¡ç®—æ”¹è¿›\n                new_scores, _ = calibrator.compute_scores(adjusted_params)\n                new_score = sum(new_scores.values())\n                improvement = new_score - current_score\n                iteration_improvements.append(improvement)\n            else:\n                iteration_improvements.append(Decimal('0.0'))\n\n        # è®¡ç®—æœ¬è½®æ€»æ”¹è¿›\n        iteration_total_improvement = sum(iteration_improvements)\n        total_improvement += iteration_total_improvement\n\n        # å¦‚æœæ”¹è¿›å¾ˆå°ï¼Œæå‰ç»“æŸ\n        if iteration_total_improvement < target_improvement * Decimal('0.1'):\n            print(f\"æ‰¹é‡æ ‡å®šæ”¶æ•›ï¼Œè¿­ä»£æ¬¡æ•°: {iteration + 1}\")\n            break\n\n    # æœ€ç»ˆç»“æœè®¡ç®—\n    final_scores = []\n    for params in batch_params:\n        scores, _ = calibrator.compute_scores(params)\n        final_scores.append(scores)\n\n    # è®¡ç®—æ”¹è¿›ç»Ÿè®¡\n    improvement_stats = []\n    for i, (initial, final) in enumerate(zip(initial_scores, final_scores)):\n        initial_total = sum(initial.values())\n        final_total = sum(final.values())\n        improvement = final_total - initial_total\n        improvement_stats.append({\n            'diamond_index': i,\n            'initial_score': initial_total,\n            'final_score': final_total,\n            'improvement': improvement,\n            'improvement_percentage': (improvement / initial_total * Decimal('100')) if initial_total > 0 else Decimal('0.0')\n        })\n\n    return {\n        'success': total_improvement > Decimal('0.0'),\n        'iterations': len(calibration_results),\n        'total_improvement': total_improvement,\n        'average_improvement_per_diamond': total_improvement / Decimal(len(batch_params)),\n        'final_params': batch_params,\n        'final_scores': final_scores,\n        'improvement_statistics': improvement_stats,\n        'best_diamond_index': max(range(len(improvement_stats)), key=lambda i: improvement_stats[i]['improvement']),\n        'calibration_history': calibration_results\n    }\n\ndef apply_adaptive_adjustment(params: Dict[str, Decimal], scores: Dict[str, Decimal],\n                              target_improvement: Decimal) -> Dict[str, Decimal]:\n    \"\"\"\n    åº”ç”¨è‡ªé€‚åº”å‚æ•°è°ƒæ•´\n    \"\"\"\n    adjustment_factor = target_improvement * Decimal('0.1')\n    adjusted_params = params.copy()\n\n    # åŸºäºåˆ†æ•°è°ƒæ•´å¯¹åº”å‚æ•°\n    if scores.get('brightness', 0) < Decimal('9.5'):\n        adjusted_params['pavilion_angle'] += adjustment_factor * Decimal('0.5')\n        adjusted_params['total_depth_pct'] += adjustment_factor * Decimal('0.3')\n\n    if scores.get('fire', 0) < Decimal('9.5'):\n        adjusted_params['crown_angle'] += adjustment_factor * Decimal('0.4')\n        adjusted_params['table_pct'] += adjustment_factor * Decimal('0.3')\n\n    if scores.get('scint', 0) < Decimal('9.5'):\n        adjusted_params['crown_height_pct'] += adjustment_factor * Decimal('0.2')\n        adjusted_params['pavilion_depth_pct'] += adjustment_factor * Decimal('0.2')\n\n    if scores.get('cs', 0) < Decimal('9.5'):\n        adjusted_params['crown_angle'] += adjustment_factor * Decimal('0.15')\n        adjusted_params['pavilion_angle'] += adjustment_factor * Decimal('0.15')\n\n    return clamp_params_to_valid_range(adjusted_params)\n\ndef clamp_params_to_valid_range(params: Dict[str, Decimal]) -> Dict[str, Decimal]:\n    \"\"\"\n    å°†å‚æ•°é™åˆ¶åœ¨æœ‰æ•ˆèŒƒå›´å†…\n    \"\"\"\n    valid_ranges = {\n        'crown_angle': (Decimal('30.0'), Decimal('40.0')),\n        'pavilion_angle': (Decimal('38.0'), Decimal('44.0')),\n        'table_pct': (Decimal('50.0'), Decimal('65.0')),\n        'crown_height_pct': (Decimal('10.0'), Decimal('20.0')),\n        'pavilion_depth_pct': (Decimal('38.0'), Decimal('48.0')),\n        'total_depth_pct': (Decimal('55.0'), Decimal('70.0')),\n        'carat': (Decimal('0.1'), Decimal('10.0')),\n        'diameter': (Decimal('1.0'), Decimal('20.0'))\n    }\n\n    clamped_params = params.copy()\n    for param, (min_val, max_val) in valid_ranges.items():\n        if param in clamped_params:\n            clamped_params[param] = clamp(clamped_params[param], min_val, max_val)\n\n    return clamped_params\n\n# ---------------- æŒä¹…åŒ–å·¥å…· ----------------\ndef load_calibration() -> CalibrationConfig:\n    if not os.path.exists(CALIB_FILE):\n        return CalibrationConfig()\n    try:\n        with open(CALIB_FILE, \"r\", encoding=\"utf-8\") as f:\n            data = json.load(f)\n        return CalibrationConfig(\n            target_brightness=Decimal(str(data.get(\"brightness\", 10.0))),\n            target_fire=Decimal(str(data.get(\"fire\", 10.0))),\n            target_scint=Decimal(str(data.get(\"scint\", 10.0))),\n            high_precision=bool(data.get(\"high_precision\", False)),\n        )\n    except json.JSONDecodeError as e:\n        logger.error(f\"JSON è§£æé”™è¯¯: {str(e)}\")\n        return CalibrationConfig()\n    except Exception as e:\n        logger.error(f\"åŠ è½½æ ‡å®šé…ç½®å¤±è´¥: {str(e)}\")\n        return CalibrationConfig()\n\ndef save_calibration(cfg: CalibrationConfig) -> None:\n    data = {\n        \"brightness\": float(cfg.target_brightness),\n        \"fire\": float(cfg.target_fire),\n        \"scint\": float(cfg.target_scint),\n        \"high_precision\": cfg.high_precision,\n    }\n    try:\n        with open(CALIB_FILE, \"w\", encoding=\"utf-8\") as f:\n            json.dump(data, f, ensure_ascii=False, indent=2)\n        logger.info(\"æ ‡å®šé…ç½®å·²ä¿å­˜\")\n    except Exception as e:\n        logger.error(f\"ä¿å­˜æ ‡å®šé…ç½®å¤±è´¥: {str(e)}\")\n\ndef load_leaderboard() -> List[Dict[str, Any]]:\n    if not os.path.exists(LEADERBOARD_FILE):\n        return []\n    try:\n        with open(LEADERBOARD_FILE, \"r\", encoding=\"utf-8\") as f:\n            data = json.load(f)\n        if isinstance(data, list):\n            return data\n        return []\n    except json.JSONDecodeError as e:\n        logger.error(f\"JSON è§£æé”™è¯¯: {str(e)}\")\n        return []\n    except Exception as e:\n        logger.error(f\"åŠ è½½æ’è¡Œæ¦œå¤±è´¥: {str(e)}\")\n        return []\n\ndef save_leaderboard(records: List[Dict[str, Any]]) -> None:\n    try:\n        with open(LEADERBOARD_FILE, \"w\", encoding=\"utf-8\") as f:\n            json.dump(records, f, ensure_ascii=False, indent=2)\n        logger.info(\"æ’è¡Œæ¦œå·²ä¿å­˜\")\n    except Exception as e:\n        logger.error(f\"ä¿å­˜æ’è¡Œæ¦œå¤±è´¥: {str(e)}\")\n\ndef update_leaderboard(records: List[Dict[str, Any]],\n                      new_record: Dict[str, Any]) -> List[Dict[str, Any]]:\n    records = list(records)\n    records.append(new_record)\n    records.sort(key=lambda r: float(r.get(\"scores\", {}).get(\"cs\", 0.0)), reverse=True)\n    return records[:6]\n\n# ---------------- å›¾å½¢åŒ–æ˜¾ç¤ºå·¥å…· ----------------\ndef create_optical_performance_plot(params, scores):\n    \"\"\"åˆ›å»ºå…‰å­¦æ€§èƒ½å›¾å½¢åŒ–æ˜¾ç¤º\"\"\"\n    # åˆ›å»ºä¸€ä¸ªç®€å•çš„å›¾å½¢åŒ–è¡¨ç¤º\n    # å®é™…åº”ç”¨ä¸­å¯ä»¥ä½¿ç”¨æ›´å¤æ‚çš„ç»˜å›¾åº“\n    width, height = 400, 300\n    image = Image.new('RGB', (width, height), COLORS[\"primary_dark\"])\n    draw = ImageDraw.Draw(image)\n\n    # ç»˜åˆ¶äº®åº¦ã€ç«å½©ã€é—ªåº¦çš„æŸ±çŠ¶å›¾\n    brightness = float(scores[\"brightness\"])\n    fire = float(scores[\"fire\"])\n    scint = float(scores[\"scint\"])\n\n    bar_width = 50\n    x1 = 50\n    x2 = 150\n    x3 = 250\n    y_base = 250\n\n    # ç»˜åˆ¶äº®åº¦æŸ±\n    draw.rectangle([x1, y_base - brightness * 20, x1 + bar_width, y_base],\n                   fill=COLORS[\"success_green\"])\n    draw.text([x1 + 10, y_base - brightness * 20 - 20], f\"B: {brightness:.2f}\",\n              fill=COLORS[\"text_primary\"])\n\n    # ç»˜åˆ¶ç«å½©æŸ±\n    draw.rectangle([x2, y_base - fire * 20, x2 + bar_width, y_base],\n                   fill=COLORS[\"warning_orange\"])\n    draw.text([x2 + 10, y_base - fire * 20 - 20], f\"F: {fire:.2f}\",\n              fill=COLORS[\"text_primary\"])\n\n    # ç»˜åˆ¶é—ªåº¦æŸ±\n    draw.rectangle([x3, y_base - scint * 20, x3 + bar_width, y_base],\n                   fill=COLORS[\"accent_blue\"])\n    draw.text([x3 + 10, y_base - scint * 20 - 20], f\"S: {scint:.2f}\",\n              fill=COLORS[\"text_primary\"])\n\n    # ç»˜åˆ¶æ ‡é¢˜\n    try:\n        font = ImageFont.truetype(\"arial.ttf\", 16)\n    except:\n        font = ImageFont.load_default()\n    draw.text([100, 20], \"å…‰å­¦æ€§èƒ½æŒ‡æ ‡\", fill=COLORS[\"text_primary\"], font=font)\n\n    return ImageTk.PhotoImage(image)\n\n# ---------------- ğŸ–¥ï¸ å…¨ä¸–ç•Œæœ€ç¾è§‚é’»çŸ³è¯„ä¼°GUIç•Œé¢ ğŸ–¥ï¸ ----------------\n# é”™è¯¯å¤„ç†è£…é¥°å™¨\ndef handle_gui_errors(func):\n    \"\"\"GUIæ–¹æ³•é”™è¯¯å¤„ç†è£…é¥°å™¨\"\"\"\n    def wrapper(self, *args, **kwargs):\n        try:\n            return func(self, *args, **kwargs)\n        except Exception as e:\n            error_msg = f\"æ“ä½œå¤±è´¥: {str(e)}\"\n            print(f\"ERROR in {func.__name__}: {e}\")\n            try:\n                if hasattr(self, 'root'):\n                    messagebox.showerror(\"é”™è¯¯\", error_msg)\n            except:\n                print(f\"CRITICAL ERROR: Could not show error dialog: {e}\")\n            return None\n    return wrapper\n\ndef handle_visualization_errors(func):\n    \"\"\"å¯è§†åŒ–æ–¹æ³•é”™è¯¯å¤„ç†è£…é¥°å™¨\"\"\"\n    def wrapper(self, *args, **kwargs):\n        try:\n            return func(self, *args, **kwargs)\n        except Exception as e:            return None\n    return wrapper\n\nclass DiamondApp:\n    \"\"\"ğŸ’ å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„é’»çŸ³å…‰å­¦æ€§èƒ½é‡å­çº§ç²¾å¯†è¯„ä¼°ç³»ç»Ÿ - GUIç•Œé¢\n    ğŸ¨ é‡‡ç”¨ç°ä»£åŒ–æš—è‰²ä¸»é¢˜è®¾è®¡ï¼Œæä¾›æè‡´ç”¨æˆ·ä½“éªŒ\n    ğŸ“Š é›†æˆ3Då¯è§†åŒ–ã€å®æ—¶åŠ¨ç”»ã€äº¤äº’å¼å›¾è¡¨\n    ğŸŒˆ å®Œæ•´ä¸­æ–‡ç•Œé¢ï¼Œç›´è§‚æ“ä½œï¼Œä¸“ä¸šçº§å±•ç¤º\n    \"\"\"\n\n    def __init__(self, root: tk.Tk) -> None:\n        self.root = root\n        self.root.title(\"ğŸ”·ğŸ’ é’»çŸ³å…‰å­¦æ€§èƒ½é‡å­çº§ç²¾å¯†è¯„ä¼°ç³»ç»Ÿ - ä½œè€…ï¼šæ—å°å…” ğŸ’ğŸ”·\")\n        self.root.geometry(\"1600x1000\")  # æ‰©å¤§çª—å£ä»¥å®¹çº³æ›´å¤šå¯è§†åŒ–å†…å®¹\n        self.root.minsize(1200, 800)  # è®¾ç½®æœ€å°çª—å£å°ºå¯¸\n\n        # è®¾ç½®çª—å£å›¾æ ‡å’Œæ ·å¼\n        try:\n            # è®¾ç½®åº”ç”¨å›¾æ ‡ï¼ˆå¦‚æœæœ‰å›¾æ ‡æ–‡ä»¶ï¼‰\n            self.root.iconbitmap(\"diamond.ico\")\n        except:\n            pass  # å¦‚æœæ²¡æœ‰å›¾æ ‡æ–‡ä»¶ï¼Œå¿½ç•¥é”™è¯¯\n\n        # è®¾ç½®çª—å£å±…ä¸­\n        self.center_window()\n\n        self.calib_cfg = load_calibration()\n        self.calibrator = PhysicalCalibrator(self.calib_cfg)\n        self.records: List[Dict[str, Any]] = load_leaderboard()\n\n        # çº¿ç¨‹ç›¸å…³\n        self.result_queue = queue.Queue()\n        self.is_calculating = False\n        self.calculation_thread = None\n        self.calculation_cancel_flag = threading.Event()\n\n        # å¯è§†åŒ–ç›¸å…³\n        self.current_diamond_params = {}\n        self.visualization_mode = \"3d_render\"  # é»˜è®¤3Dæ¸²æŸ“æ¨¡å¼\n        self.animation_running = False\n        self.animation_thread = None\n\n        self._build_ui()\n        self._refresh_leaderboard()\n        self._update_baseline_label()\n        self._fill_calib_ui()\n\n        # å®šæœŸæ£€æŸ¥ç»“æœé˜Ÿåˆ—\n        self.root.after(100, self.check_queue)\n\n        # æ˜¾ç¤ºç‰ˆæƒå£°æ˜å¼¹çª—\n        self.root.after(500, self._show_copyright_splash)\n\n    def center_window(self):\n        \"\"\"ğŸ’ çª—å£å±…ä¸­æ˜¾ç¤ºæ–¹æ³•\"\"\"\n        self.root.update_idletasks()\n        width = self.root.winfo_width()\n        height = self.root.winfo_height()\n        x = (self.root.winfo_screenwidth() // 2) - (width // 2)\n        y = (self.root.winfo_screenheight() // 2) - (height // 2)\n        self.root.geometry(f'{width}x{height}+{x}+{y}')\n\n    # ---------- ğŸ¨ å…¨æ–°UIæ„å»ºç³»ç»Ÿ ----------\n    def _build_ui(self) -> None:\n        \"\"\"ğŸ”¥ æ„å»ºå…¨ä¸–ç•Œæœ€ç¾è§‚çš„é’»çŸ³è¯„ä¼°ç•Œé¢\"\"\"\n        style = ttk.Style()\n        style.theme_use(\"clam\")\n\n        # ğŸŒˆ å…¨æ–°çš„ç°ä»£åŒ–æ ·å¼é…ç½®\n        style.configure(\".\",\n                      font=(\"å¾®è½¯é›…é»‘\", 11),\n                      background=COLORS[\"primary_dark\"],\n                      relief=\"flat\")\n        style.configure(\"TFrame\",\n                      background=COLORS[\"primary_dark\"],\n                      relief=\"flat\",\n                      borderwidth=0)\n\n        # ğŸ“± ç°ä»£åŒ–æ ‡ç­¾æ ·å¼\n        style.configure(\"TLabel\",\n                      background=COLORS[\"primary_dark\"],\n                      foreground=COLORS[\"text_primary\"],\n                      font=(\"å¾®è½¯é›…é»‘\", 11))\n        style.configure(\"Title.TLabel\",\n                      background=COLORS[\"primary_dark\"],\n                      foreground=COLORS[\"text_primary\"],\n                      font=(\"å¾®è½¯é›…é»‘\", 16, \"bold\"))\n        style.configure(\"Subtitle.TLabel\",\n                      background=COLORS[\"primary_dark\"],\n                      foreground=COLORS[\"text_secondary\"],\n                      font=(\"å¾®è½¯é›…é»‘\", 12))\n        style.configure(\"Hint.TLabel\",\n                      foreground=COLORS[\"text_hint\"],\n                      font=(\"å¾®è½¯é›…é»‘\", 9),\n                      background=COLORS[\"primary_dark\"])\n        style.configure(\"Accent.TLabel\",\n                      foreground=COLORS[\"accent_blue\"],\n                      font=(\"å¾®è½¯é›…é»‘\", 12, \"bold\"),\n                      background=COLORS[\"primary_dark\"])\n        style.configure(\"Success.TLabel\",\n                      foreground=COLORS[\"success_green\"],\n                      font=(\"å¾®è½¯é›…é»‘\", 11, \"bold\"),\n                      background=COLORS[\"primary_dark\"])\n        style.configure(\"Warning.TLabel\",\n                      foreground=COLORS[\"warning_orange\"],\n                      font=(\"å¾®è½¯é›…é»‘\", 11, \"bold\"),\n                      background=COLORS[\"primary_dark\"])\n        style.configure(\"Error.TLabel\",\n                      foreground=COLORS[\"error_red\"],\n                      font=(\"å¾®è½¯é›…é»‘\", 11, \"bold\"),\n                      background=COLORS[\"primary_dark\"])\n\n        # ğŸ¯ ç°ä»£åŒ–è¾“å…¥æ¡†æ ·å¼\n        style.configure(\"TEntry\",\n                       fieldbackground=COLORS[\"tertiary_dark\"],\n                       foreground=COLORS[\"text_primary\"],\n                       insertcolor=COLORS[\"accent_blue\"],\n                       borderwidth=2,\n                       relief=\"solid\",\n                       font=(\"å¾®è½¯é›…é»‘\", 11),\n                       padding=5)\n        style.map(\"TEntry\",\n                 fieldbackground=[(\"focus\", COLORS[\"secondary_dark\"])],\n                 bordercolor=[(\"focus\", COLORS[\"accent_blue\"])],\n                 foreground=[(\"focus\", COLORS[\"text_primary\"])])\n\n        # ğŸ”˜ ç°ä»£åŒ–æŒ‰é’®æ ·å¼\n        style.configure(\"TButton\",\n                       background=COLORS[\"accent_blue\"],\n                       foreground=COLORS[\"text_primary\"],\n                       padding=12,\n                       borderwidth=0,\n                       relief=\"flat\",\n                       font=(\"å¾®è½¯é›…é»‘\", 11, \"bold\"),\n                       focuscolor=\"none\")\n        style.map(\"TButton\",\n                 background=[(\"active\", COLORS[\"secondary_dark\"]),\n                           (\"pressed\", BUTTON_STATES[\"pressed\"])],\n                 foreground=[(\"active\", COLORS[\"text_primary\"])])\n\n        # ğŸ¨ ç°ä»£åŒ–æŒ‰é’®å˜ä½“æ ·å¼\n        style.configure(\"Success.TButton\",\n                       background=COLORS[\"success_green\"],\n                       foreground=COLORS[\"text_primary\"])\n        style.map(\"Success.TButton\",\n                 background=[(\"active\", \"#229954\"),\n                           (\"pressed\", \"#1e8449\")])\n\n        style.configure(\"Warning.TButton\",\n                       background=COLORS[\"warning_orange\"],\n                       foreground=COLORS[\"text_primary\"])\n        style.map(\"Warning.TButton\",\n                 background=[(\"active\", \"#d68910\"),\n                           (\"pressed\", \"#ca6f1e\")])\n\n        style.configure(\"Danger.TButton\",\n                       background=COLORS[\"error_red\"],\n                       foreground=COLORS[\"text_primary\"])\n        style.map(\"Danger.TButton\",\n                 background=[(\"active\", \"#c0392b\"),\n                           (\"pressed\", \"#a93226\")])\n\n        # ğŸ“Š ç°ä»£åŒ–è¡¨æ ¼æ ·å¼\n        style.configure(\"Treeview\",\n                       background=COLORS[\"secondary_dark\"],\n                       fieldbackground=COLORS[\"secondary_dark\"],\n                       foreground=COLORS[\"text_primary\"],\n                       rowheight=28,\n                       borderwidth=1,\n                       relief=\"solid\",\n                       font=(\"å¾®è½¯é›…é»‘\", 10))\n        style.configure(\"Treeview.Heading\",\n                       background=COLORS[\"accent_blue\"],\n                       foreground=COLORS[\"text_primary\"],\n                       font=(\"å¾®è½¯é›…é»‘\", 11, \"bold\"),\n                       relief=\"flat\",\n                       borderwidth=1)\n        style.map(\"Treeview\",\n                 background=[(\"selected\", COLORS[\"tertiary_dark\"])],\n                 foreground=[(\"selected\", COLORS[\"text_primary\"])])\n\n        # ğŸ“ˆ ç°ä»£åŒ–è¿›åº¦æ¡æ ·å¼\n        style.configure(\"TProgressbar\",\n                       background=COLORS[\"accent_blue\"],\n                       troughcolor=COLORS[\"secondary_dark\"],\n                       borderwidth=0,\n                       lightcolor=COLORS[\"accent_blue\"],\n                       darkcolor=COLORS[\"accent_blue\"])\n\n        # ğŸ¯ ç°ä»£åŒ–æ ‡ç­¾é¡µæ ·å¼\n        style.configure(\"TNotebook\",\n                       background=COLORS[\"primary_dark\"],\n                       borderwidth=0)\n        style.configure(\"TNotebook.Tab\",\n                       background=COLORS[\"secondary_dark\"],\n                       foreground=COLORS[\"text_primary\"],\n                       padding=[20, 10],\n                       font=(\"å¾®è½¯é›…é»‘\", 11, \"bold\"))\n        style.map(\"TNotebook.Tab\",\n                 background=[(\"selected\", COLORS[\"accent_blue\"])],\n                 foreground=[(\"selected\", COLORS[\"text_primary\"])])\n\n        # ğŸ¨ ç°ä»£åŒ–æ¡†æ¶æ ·å¼\n        style.configure(\"TLabelframe\",\n                       background=COLORS[\"primary_dark\"],\n                       foreground=COLORS[\"text_primary\"],\n                       borderwidth=2,\n                       relief=\"solid\",\n                       font=(\"å¾®è½¯é›…é»‘\", 11, \"bold\"))\n        style.configure(\"TLabelframe.Label\",\n                       background=COLORS[\"primary_dark\"],\n                       foreground=COLORS[\"accent_blue\"],\n                       font=(\"å¾®è½¯é›…é»‘\", 12, \"bold\"))\n\n        self._create_main_layout()\n\n    def _create_main_layout(self):\n        \"\"\"ğŸ’ åˆ›å»ºä¸»å¸ƒå±€\"\"\"\n        # ä¸»å®¹å™¨\n        main_container = ttk.Frame(self.root, style=\"TFrame\")\n        main_container.pack(fill=\"both\", expand=True, padx=10, pady=10)\n\n        # ğŸ† é¡¶éƒ¨æ ‡é¢˜åŒºåŸŸ\n        self._create_header_section(main_container)\n\n        # ğŸ“Š ä¸»è¦å†…å®¹åŒºåŸŸ - ä½¿ç”¨æ ‡ç­¾é¡µç»„ç»‡\n        self._create_main_notebook(main_container)\n\n        # ğŸ¯ åº•éƒ¨çŠ¶æ€æ \n        self._create_status_bar(main_container)\n\n    def _create_header_section(self, parent):\n        \"\"\"ğŸŒŸ åˆ›å»ºé¡¶éƒ¨æ ‡é¢˜åŒºåŸŸ\"\"\"\n        header_frame = ttk.Frame(parent, style=\"TFrame\")\n        header_frame.pack(fill=\"x\", pady=(0, 10))\n\n        # ä¸»æ ‡é¢˜\n        title_label = ttk.Label(\n            header_frame,\n            text=\"ğŸ”·ğŸ’ é’»çŸ³å…‰å­¦æ€§èƒ½é‡å­çº§ç²¾å¯†è¯„ä¼°ç³»ç»Ÿ ğŸ’ğŸ”·\",\n            style=\"Title.TLabel\"\n        )\n        title_label.pack(pady=(0, 5))\n\n        # å‰¯æ ‡é¢˜\n        subtitle_label = ttk.Label(\n            header_frame,\n            text=\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾çš„é’»çŸ³ç§‘å­¦è®¡ç®—å¼•æ“ | ä½œè€…ï¼šæ—å°å…”\",\n            style=\"Subtitle.TLabel\"\n        )\n        subtitle_label.pack(pady=(0, 10))\n\n        # åŸºå‡†é’»ä¿¡æ¯æ \n        self.lbl_baseline = ttk.Label(\n            header_frame,\n            text=\"\",\n            style=\"Hint.TLabel\",\n            padding=10\n        )\n        self.lbl_baseline.pack(fill=\"x\", pady=(5, 0))\n\n    def _create_main_notebook(self, parent):\n        \"\"\"ğŸ“š åˆ›å»ºä¸»æ ‡ç­¾é¡µ\"\"\"\n        notebook = ttk.Notebook(parent)\n        notebook.pack(fill=\"both\", expand=True, pady=(0, 10))\n\n        # ğŸ¯ å‚æ•°è¾“å…¥æ ‡ç­¾é¡µ\n        self._create_input_tab(notebook)\n\n        # ğŸ“Š ç»“æœå±•ç¤ºæ ‡ç­¾é¡µ\n        self._create_results_tab(notebook)\n\n        # ğŸ“ˆ å¯è§†åŒ–åˆ†ææ ‡ç­¾é¡µ\n        self._create_visualization_tab(notebook)\n\n        # ğŸ† æ’è¡Œæ¦œæ ‡ç­¾é¡µ\n        self._create_leaderboard_tab(notebook)\n\n        # âš™ï¸ é«˜çº§è®¾ç½®æ ‡ç­¾é¡µ\n        self._create_settings_tab(notebook)\n\n    def _create_input_tab(self, notebook):\n        \"\"\"ğŸ“ åˆ›å»ºå‚æ•°è¾“å…¥æ ‡ç­¾é¡µ\"\"\"\n        input_frame = ttk.Frame(notebook, style=\"TFrame\")\n        notebook.add(input_frame, text=\"ğŸ”· å‚æ•°è¾“å…¥\")\n\n        # å·¦å³åˆ†æ å¸ƒå±€\n        left_frame = ttk.Frame(input_frame, style=\"TFrame\")\n        left_frame.pack(side=\"left\", fill=\"y\", padx=(10, 5), pady=10)\n\n        right_frame = ttk.Frame(input_frame, style=\"TFrame\")\n        right_frame.pack(side=\"right\", fill=\"both\", expand=True, padx=(5, 10), pady=10)\n\n        # ğŸ“‹ é’»çŸ³åŸºæœ¬ä¿¡æ¯è¾“å…¥\n        self._create_basic_info_input(left_frame)\n\n        # ğŸ”§ é«˜çº§å‚æ•°è¾“å…¥\n        self._create_advanced_params_input(left_frame)\n\n        # ğŸ¯ æ“ä½œæŒ‰é’®åŒºåŸŸ\n        self._create_action_buttons(left_frame)\n\n        # âš¡ å¿«é€Ÿæ“ä½œåŒºåŸŸ\n        self._create_quick_actions(left_frame)\n\n        # âš™ï¸ æ ‡å®šè®¾ç½®åŒºåŸŸ\n        self._create_calibration_settings(right_frame)\n\n    def _create_results_tab(self, notebook):\n        \"\"\"ğŸ“Š åˆ›å»ºç»“æœå±•ç¤ºæ ‡ç­¾é¡µ\"\"\"\n        results_frame = ttk.Frame(notebook, style=\"TFrame\")\n        notebook.add(results_frame, text=\"ğŸ“ˆ è¯„ä¼°ç»“æœ\")\n\n        # åˆ†å±å¸ƒå±€ï¼šå·¦ä¾§æ˜¾ç¤ºè¯„åˆ†ï¼Œå³ä¾§æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯\n        scores_frame = ttk.Frame(results_frame, style=\"TFrame\")\n        scores_frame.pack(side=\"left\", fill=\"y\", padx=(10, 5), pady=10)\n\n        detail_frame = ttk.Frame(results_frame, style=\"TFrame\")\n        detail_frame.pack(side=\"right\", fill=\"both\", expand=True, padx=(5, 10), pady=10)\n\n        # ğŸ† è¯„åˆ†æ˜¾ç¤ºåŒºåŸŸ\n        self._create_scores_display(scores_frame)\n\n        # ğŸ“‹ è¯¦ç»†åˆ†æåŒºåŸŸ\n        self._create_detail_analysis(detail_frame)\n\n    def _create_visualization_tab(self, notebook):\n        \"\"\"ğŸ¨ åˆ›å»ºå¯è§†åŒ–åˆ†ææ ‡ç­¾é¡µ\"\"\"\n        viz_frame = ttk.Frame(notebook, style=\"TFrame\")\n        notebook.add(viz_frame, text=\"ğŸŒˆ å¯è§†åŒ–åˆ†æ\")\n\n        # å¯è§†åŒ–æ§åˆ¶é¢æ¿\n        control_frame = ttk.Frame(viz_frame, style=\"TFrame\")\n        control_frame.pack(side=\"left\", fill=\"y\", padx=(10, 5), pady=10)\n\n        # ä¸»å¯è§†åŒ–åŒºåŸŸ\n        main_viz_frame = ttk.Frame(viz_frame, style=\"TFrame\")\n        main_viz_frame.pack(side=\"right\", fill=\"both\", expand=True, padx=(5, 10), pady=10)\n\n        # ğŸ® å¯è§†åŒ–æ§åˆ¶\n        self._create_visualization_controls(control_frame)\n\n        # ğŸ¨ ä¸»å¯è§†åŒ–ç”»å¸ƒ\n        self._create_main_visualization(main_viz_frame)\n\n    def _create_leaderboard_tab(self, notebook):\n        \"\"\"ğŸ† åˆ›å»ºæ’è¡Œæ¦œæ ‡ç­¾é¡µ\"\"\"\n        leaderboard_frame = ttk.Frame(notebook, style=\"TFrame\")\n        notebook.add(leaderboard_frame, text=\"ğŸ¥‡ å†å²è®°å½•\")\n\n        # æ’è¡Œæ¦œæ§åˆ¶æŒ‰é’®\n        control_frame = ttk.Frame(leaderboard_frame, style=\"TFrame\")\n        control_frame.pack(fill=\"x\", padx=10, pady=(10, 5))\n\n        # ä¸»æ’è¡Œæ¦œåŒºåŸŸ\n        main_frame = ttk.Frame(leaderboard_frame, style=\"TFrame\")\n        main_frame.pack(fill=\"both\", expand=True, padx=10, pady=(5, 10))\n\n        # ğŸ® æ’è¡Œæ¦œæ§åˆ¶\n        self._create_leaderboard_controls(control_frame)\n\n        # ğŸ“Š æ’è¡Œæ¦œè¡¨æ ¼\n        self._create_leaderboard_table(main_frame)\n\n    def _create_settings_tab(self, notebook):\n        \"\"\"âš™ï¸ åˆ›å»ºé«˜çº§è®¾ç½®æ ‡ç­¾é¡µ\"\"\"\n        settings_frame = ttk.Frame(notebook, style=\"TFrame\")\n        notebook.add(settings_frame, text=\"âš™ï¸ é«˜çº§è®¾ç½®\")\n\n        # åˆ›å»ºæ»šåŠ¨åŒºåŸŸ\n        canvas = tk.Canvas(settings_frame, bg=COLORS[\"primary_dark\"], highlightthickness=0)\n        scrollbar = ttk.Scrollbar(settings_frame, orient=\"vertical\", command=canvas.yview)\n        scrollable_frame = ttk.Frame(canvas, style=\"TFrame\")\n\n        scrollable_frame.bind(\n            \"<Configure>\",\n            lambda e: canvas.configure(scrollregion=canvas.bbox(\"all\"))\n        )\n\n        canvas.create_window((0, 0), window=scrollable_frame, anchor=\"nw\")\n        canvas.configure(yscrollcommand=scrollbar.set)\n\n        # ğŸ›ï¸ å„ç§è®¾ç½®é€‰é¡¹\n        self._create_computation_settings(scrollable_frame)\n        self._create_visualization_settings(scrollable_frame)\n        self._create_export_settings(scrollable_frame)\n        self._create_about_section(scrollable_frame)\n\n        canvas.pack(side=\"left\", fill=\"both\", expand=True)\n        scrollbar.pack(side=\"right\", fill=\"y\")\n\n    def _create_status_bar(self, parent):\n        \"\"\"ğŸ“Š åˆ›å»ºåº•éƒ¨çŠ¶æ€æ \"\"\"\n        status_frame = ttk.Frame(parent, style=\"TFrame\")\n        status_frame.pack(fill=\"x\", pady=(5, 0))\n\n        # çŠ¶æ€ä¿¡æ¯\n        self.status_label = ttk.Label(\n            status_frame,\n            text=\"âœ¨ ç³»ç»Ÿå°±ç»ª | å…¨ä¸–ç•Œæœ€å¼ºé’»çŸ³è¯„ä¼°å¼•æ“è¿è¡Œä¸­\",\n            style=\"Hint.TLabel\"\n        )\n        self.status_label.pack(side=\"left\", padx=10)\n\n        # ç‰ˆæœ¬ä¿¡æ¯\n        version_label = ttk.Label(\n            status_frame,\n            text=\"v2.0 é‡å­çº§ç²¾å¯†ç‰ˆ | ä½œè€…ï¼šæ—å°å…”\",\n            style=\"Hint.TLabel\"\n        )\n        version_label.pack(side=\"right\", padx=10)\n\n        # è¿›åº¦æ¡ï¼ˆåˆå§‹éšè—ï¼‰\n        self.progress = ttk.Progressbar(\n            status_frame,\n            orient=\"horizontal\",\n            length=200,\n            mode=\"determinate\",\n            style=\"TProgressbar\"\n        )\n        # ä½¿ç”¨packè€Œä¸æ˜¯gridï¼Œé¿å…å‡ ä½•ç®¡ç†å™¨å†²çª\n        self.progress.pack(side=\"right\", padx=10)  # éœ€è¦æ—¶å†æ˜¾ç¤º\n    def _update_baseline_label(self) -> None:\n        cfg = self.calib_cfg\n        txt = (\n            f\"å½“å‰åŸºå‡†é’»åˆ‡å·¥ï¼šÎ¸c={float(BASELINE_PARAMS['crown_angle']):.2f}Â°ï¼Œ\"\n            f\"Î¸p={float(BASELINE_PARAMS['pavilion_angle']):.2f}Â°ï¼Œ\"\n            f\"T={float(BASELINE_PARAMS['table_pct']):.2f}% ï¼Œ\"\n            f\"C={float(BASELINE_PARAMS['crown_height_pct']):.2f}% ï¼Œ\"\n            f\"P={float(BASELINE_PARAMS['pavilion_depth_pct']):.2f}% ï¼Œ\"\n            f\"TD={float(BASELINE_PARAMS['total_depth_pct']):.2f}% ï¼Œ\"\n            f\"ct={float(BASELINE_PARAMS['carat']):.4f}ï¼Œ\"\n            f\"D={float(BASELINE_PARAMS['diameter']):.3f} mmï¼›  \"\n            f\"ç›®æ ‡äº®åº¦/ç«å½©/é—ªåº¦ = \"\n            f\"{float(cfg.target_brightness):.2f} / {float(cfg.target_fire):.2f} / {float(cfg.target_scint):.2f}ï¼Œ\"\n            f\"å½“å‰æ•°å€¼æ¨¡å¼ï¼š{'é«˜ç²¾åº¦' if cfg.high_precision else 'æ ‡å‡†'}\"\n        )\n        self.lbl_baseline.config(text=txt)\n\n    def _fill_calib_ui(self) -> None:\n        self.var_calib_B.set(f\"{float(self.calib_cfg.target_brightness):.2f}\")\n        self.var_calib_F.set(f\"{float(self.calib_cfg.target_fire):.2f}\")\n        self.var_calib_S.set(f\"{float(self.calib_cfg.target_scint):.2f}\")\n\n    def _grade_from_op(self, op: Decimal) -> str:\n        if op >= Decimal('9.5'):\n            return \"æä¼˜ EX\"\n        elif op >= Decimal('9.0'):\n            return \"ä¼˜ VG\"\n        elif op >= Decimal('8.0'):\n            return \"è‰¯ Good\"\n        else:\n            return \"ä¸€èˆ¬ Fair\"\n\n    def _calculate_worker(self, params: Dict[str, Decimal], diamond_id: str,\n                         queue: queue.Queue, cancel_flag: threading.Event) -> None:\n        \"\"\"å·¥ä½œçº¿ç¨‹ï¼šæ‰§è¡Œè®¡ç®—ä»»åŠ¡\"\"\"\n        try:\n            if cancel_flag.is_set():\n                queue.put(('canceled',))\n                return\n\n            # å®šä¹‰è¿›åº¦å›è°ƒå‡½æ•°\n            def progress_callback(progress):\n                queue.put(('progress', progress))\n\n            scores, detail = self.calibrator.compute_scores(params, cancel_flag, progress_callback)\n\n            if cancel_flag.is_set():\n                queue.put(('canceled',))\n                return\n\n            queue.put(('success', diamond_id, scores, detail))\n        except Exception as e:\n            logger.error(f\"è®¡ç®—é’»çŸ³ {diamond_id} å¤±è´¥: {str(e)}\", exc_info=True)\n            queue.put(('error', str(e)))\n\n    def check_queue(self) -> None:\n        \"\"\"æ£€æŸ¥ç»“æœé˜Ÿåˆ—å¹¶æ›´æ–°UI\"\"\"\n        try_again = True\n        try:\n            while not self.result_queue.empty():\n                item = self.result_queue.get_nowait()\n                if item[0] == 'success':\n                    _, diamond_id, scores, detail = item\n                    # ä½¿ç”¨afteræ–¹æ³•ç¡®ä¿UIæ›´æ–°åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œ\n                    self.root.after(0, self._update_ui_with_results, diamond_id, scores, detail)\n                elif item[0] == 'error':\n                    _, error_msg = item\n                    self.root.after(0, messagebox.showerror, \"è®¡ç®—é”™è¯¯\", f\"è®¡ç®—è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: {error_msg}\")\n                elif item[0] == 'canceled':\n                    self.root.after(0, messagebox.showinfo, \"å·²å–æ¶ˆ\", \"è®¡ç®—å·²æˆåŠŸå–æ¶ˆ\")\n                elif item[0] == 'progress':\n                    _, progress = item\n                    self.root.after(0, self._update_progress, progress)\n\n                # åœæ­¢è¿›åº¦æ¡\n                if item[0] in ['success', 'error', 'canceled']:\n                    self.root.after(0, self._stop_progress)\n                    try_again = False\n\n        except queue.Empty:\n            pass\n        finally:\n            # ç»§ç»­å®šæœŸæ£€æŸ¥\n            if try_again:\n                self.root.after(100, self.check_queue)\n\n    def _update_progress(self, progress):\n        \"\"\"æ›´æ–°è¿›åº¦æ¡\"\"\"\n        self.progress[\"value\"] = progress\n\n    def _stop_progress(self) -> None:\n        \"\"\"åœæ­¢è¿›åº¦æ¡å¹¶é‡ç½®çŠ¶æ€\"\"\"\n        self.progress.pack_forget()\n        self.progress.stop()\n        self.is_calculating = False\n        self.btn_cancel.config(state=tk.DISABLED)\n        self.calculation_thread = None\n        # å…³é—­ç­‰å¾…çª—å£\n        self._close_waiting_window()\n\n    def _update_ui_with_results(self, diamond_id: str, scores: Dict[str, Decimal],\n                               detail: str) -> None:\n        \"\"\"ç”¨è®¡ç®—ç»“æœæ›´æ–°UIï¼Œæ·»åŠ é¢œè‰²æ ‡è¯†\"\"\"\n        # æ ¹æ®åˆ†æ•°è®¾ç½®é¢œè‰²\n        def get_score_color(score: Decimal) -> str:\n            if score >= Decimal('9.0'):\n                return COLORS[\"success_green\"]\n            elif score >= Decimal('7.0'):\n                return COLORS[\"warning_orange\"]\n            else:\n                return COLORS[\"error_red\"]\n\n        # æ›´æ–°æ˜¾ç¤ºå¹¶è®¾ç½®é¢œè‰²\n        self.lbl_B.config(text=f\"äº®åº¦ Brightnessï¼š{float(scores['brightness']):.2f} / 10\",\n                         foreground=get_score_color(scores['brightness']))\n        self.lbl_F.config(text=f\"ç«å½© ç«å½©ï¼š{float(scores['fire']):.2f} / 10\",\n                         foreground=get_score_color(scores['fire']))\n        self.lbl_S.config(text=f\"é—ªåº¦ é—ªåº¦ï¼š{float(scores['scint']):.2f} / 10\",\n                         foreground=get_score_color(scores['scint']))\n        self.lbl_OP.config(text=f\"ç»¼åˆå…‰å­¦æ€§èƒ½ OPï¼š{float(scores['op']):.2f} / 10\",\n                          foreground=get_score_color(scores['op']))\n        self.lbl_HA.config(text=f\"å…«å¿ƒå…«ç®­å‡ ä½• HAï¼š{float(scores['ha']):.2f} / 100\",\n                          foreground=COLORS[\"success_green\"] if scores['ha'] >= Decimal('95.0') else COLORS[\"text_primary\"])\n        self.lbl_DG.config(text=f\"å‡ ä½•åç¦»åº¦ D_geomï¼š{float(scores['d_geom']):.4f}\",\n                          foreground=COLORS[\"error_red\"] if scores['d_geom'] > Decimal('2.0') else COLORS[\"text_primary\"])\n        self.lbl_CS.config(text=f\"ç»¼åˆç¾è§‚åº¦ CSï¼š{float(scores['cs']):.2f} / 10\",\n                          foreground=get_score_color(scores['cs']))\n\n        grade_txt = self._grade_from_op(scores[\"op\"])\n        self.lbl_grade.config(text=f\"å½“å‰å…‰å­¦ç­‰çº§ï¼š{grade_txt}\",\n                             foreground=COLORS[\"success_green\"] if grade_txt == \"æä¼˜ EX\" else COLORS[\"text_primary\"])\n\n        self.text_detail.delete(\"1.0\", tk.END)\n        self.text_detail.insert(tk.END, detail)\n\n        # æ›´æ–°å…‰å­¦æ€§èƒ½å›¾å½¢åŒ–æ˜¾ç¤º - ä½¿ç”¨ä¼˜åŒ–çš„å¯è§†åŒ–ç³»ç»Ÿ\n        params_for_viz = {k: v for k, v in self.vars_params.items() if v.get()}\n        params_for_viz = {k: Decimal(v.get()) for k, v in params_for_viz.items()}\n\n        # ä¿å­˜å½“å‰å‚æ•°ä¾›å¯è§†åŒ–æ ‡ç­¾é¡µä½¿ç”¨\n        self.current_diamond_params = params_for_viz\n        self.current_diamond_scores = scores\n\n        # è§¦å‘å¯è§†åŒ–æ›´æ–°ï¼ˆå¦‚æœå·²åœ¨å¯è§†åŒ–æ ‡ç­¾é¡µï¼‰\n        try:\n            self._update_visualization_tab(params_for_viz, scores)\n        except Exception as e:            self._update_simple_visualization(params_for_viz, scores)\n\n        rec = {\n            \"diamond_id\": diamond_id,\n            \"timestamp\": datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\"),\n            \"params\": {k: float(v) for k, v in params_for_viz.items()},\n            \"scores\": {k: float(v) for k, v in scores.items()},\n            \"detail\": detail,\n        }\n        self.records = update_leaderboard(self.records, rec)\n        save_leaderboard(self.records)\n        self._refresh_leaderboard()\n\n        messagebox.showinfo(\n            \"è®¡ç®—å®Œæˆ\",\n            f\"é’»çŸ³ {diamond_id} çš„ç»¼åˆç¾è§‚åº¦ CS ä¸º {float(scores['cs']):.2f} / 10ï¼Œ\"\n            f\"OP = {float(scores['op']):.2f}ï¼Œå…‰å­¦ç­‰çº§ï¼š{grade_txt}ã€‚\",\n        )\n\n    def _update_visualization_tab(self, params, scores):\n        \"\"\"æ›´æ–°æ ‡ç­¾é¡µå¯è§†åŒ–æ˜¾ç¤ºï¼ˆä¼˜åŒ–ç‰ˆï¼‰\"\"\"\n        if hasattr(self, 'viz_canvas'):\n            # åªåœ¨å¯è§†åŒ–æ ‡ç­¾é¡µå¯è§æ—¶æ›´æ–°\n            self._update_visualization(params, scores)\n\n    @handle_visualization_errors\n    def _update_simple_visualization(self, params, scores):\n        \"\"\"å¿«é€Ÿç®€åŒ–å¯è§†åŒ–æ˜¾ç¤º\"\"\"\n        if hasattr(self, 'canvas'):\n            # åœ¨ç»“æœå±•ç¤ºç”»å¸ƒä¸Šå¿«é€Ÿæ˜¾ç¤ºæ–‡æœ¬ä¿¡æ¯\n            self.canvas.delete(\"all\")\n\n            # è·å–ç”»å¸ƒå°ºå¯¸\n            canvas_width = self.canvas.winfo_width()\n            canvas_height = self.canvas.winfo_height()\n            if canvas_width <= 1:\n                canvas_width = 400\n            if canvas_height <= 1:\n                canvas_height = 300\n\n            # æ˜¾ç¤ºç®€å•æ–‡æœ¬ä¿¡æ¯\n            self.canvas.create_text(\n                canvas_width // 2, 50,\n                text=\"ğŸ”· é’»çŸ³å…‰å­¦è¯„ä¼°ç»“æœ\",\n                fill=COLORS[\"accent_blue\"],\n                font=(\"å¾®è½¯é›…é»‘\", 14, \"bold\"),\n                anchor=\"center\"\n            )\n\n            # æ˜¾ç¤ºè¯„åˆ†ä¿¡æ¯\n            brightness = float(scores.get('brightness', 0))\n            fire = float(scores.get('fire', 0))\n            scint = float(scores.get('scint', 0))\n            cs = float(scores.get('cs', 0))\n\n            texts = [\n                f\"ğŸ”† äº®åº¦: {brightness:.2f}/10.0\",\n                f\"ğŸ”¥ ç«å½©: {fire:.2f}/10.0\",\n                f\"âœ¨ é—ªåº¦: {scint:.2f}/10.0\",\n                f\"ğŸ’ ç»¼åˆç¾è§‚åº¦: {cs:.2f}/10.0\"\n            ]\n\n            y_pos = 120\n            for text in texts:\n                self.canvas.create_text(\n                    canvas_width // 2, y_pos,\n                    text=text,\n                    fill=COLORS[\"text_primary\"],\n                    font=(\"å¾®è½¯é›…é»‘\", 11),\n                    anchor=\"center\"\n                )\n                y_pos += 30\n\n    def _update_visualization(self, params, scores):\n        \"\"\"æ›´æ–°å…‰å­¦æ€§èƒ½å›¾å½¢åŒ–æ˜¾ç¤º - ç®€åŒ–ç‰ˆ\"\"\"\n        # ä½¿ç”¨ç®€åŒ–å¯è§†åŒ–ï¼Œé¿å…matplotlibçš„æ€§èƒ½é—®é¢˜\n        self._update_simple_visualization(params, scores)\n\n    # ---------- äº‹ä»¶ ----------\n    @handle_gui_errors\n    def on_calc(self) -> None:\n        if self.is_calculating:\n            messagebox.showinfo(\"æç¤º\", \"è®¡ç®—æ­£åœ¨è¿›è¡Œä¸­ï¼Œè¯·ç¨å€™...\")\n            return\n\n        params: Dict[str, Decimal] = {}\n        diamond_id = self.var_id.get().strip()\n        if not diamond_id:\n            diamond_id = f\"BASELINE{len(self.records)+1:04d}\"\n            self.var_id.set(diamond_id)\n        if not diamond_id.isalnum():\n            messagebox.showerror(\"è¾“å…¥é”™è¯¯\", \"é’»çŸ³ç¼–å·åªèƒ½åŒ…å«å­—æ¯å’Œæ•°å­—ã€‚\")\n            return\n        try:\n            for key in self.vars_params:\n                txt = self.vars_params[key].get().strip()\n                if not txt:\n                    if key in BASELINE_PARAMS:\n                        value = BASELINE_PARAMS[key]\n                        self.vars_params[key].set(str(value))\n                    else:\n                        raise ValueError(f\"å‚æ•° {key} ä¸èƒ½ä¸ºç©º\")\n                else:\n                    value = Decimal(txt)\n\n                # æ·»åŠ èŒƒå›´éªŒè¯\n                if key in PARAM_RANGES_VALIDATION:\n                    min_val, max_val = PARAM_RANGES_VALIDATION[key]\n                    if value < min_val or value > max_val:\n                        # ä½¿ç”¨åŸºå‡†å€¼æ›¿æ¢è¶…å‡ºèŒƒå›´çš„å€¼\n                        if key in BASELINE_PARAMS:\n                            value = BASELINE_PARAMS[key]\n                            self.vars_params[key].set(str(value))\n                        else:\n                            raise ValueError(f\"å‚æ•° {key} è¶…å‡ºæœ‰æ•ˆèŒƒå›´ [{min_val}, {max_val}]\")\n\n                params[key] = value\n        except ValueError as e:\n            messagebox.showerror(\"è¾“å…¥é”™è¯¯\", f\"å‚æ•°éªŒè¯å¤±è´¥ï¼š{e}\")\n            return\n\n        # ç¡®ä¿æ‰€æœ‰å¿…éœ€å‚æ•°éƒ½å­˜åœ¨\n        for k in BASELINE_PARAMS.keys():\n            if k not in params:\n                params[k] = BASELINE_PARAMS[k]\n\n        self.progress.pack(fill=tk.X, padx=5, pady=2)\n        self.progress[\"value\"] = 0\n        self.is_calculating = True\n        self.btn_cancel.config(state=tk.NORMAL)\n\n        # é‡ç½®å–æ¶ˆæ ‡å¿—\n        self.calculation_cancel_flag.clear()\n\n        # å¯åŠ¨å·¥ä½œçº¿ç¨‹\n        self.calculation_thread = threading.Thread(\n            target=self._calculate_worker,\n            args=(params, diamond_id, self.result_queue, self.calculation_cancel_flag),\n            daemon=True\n        )\n        # åˆ›å»ºè®¡ç®—ç­‰å¾…çª—å£\n        self._create_calculation_waiting_window()\n\n        self.calculation_thread.start()\n    def _create_calculation_waiting_window(self):\n        \"\"\"ğŸŒŒ åˆ›å»ºå®‡å®™çº§æ— æ•Œè®¡ç®—æ ¸å¿ƒå±•ç¤ºçª—å£ - è¶…è¶ŠåŸå­çº§å‡ ä¸‡å€çš„å¨åŠ›å±•ç¤º ğŸŒŒ\"\"\"\n        # ä½¿ç”¨å®‡å®™çº§åŠ¨ç”»ç³»ç»Ÿåˆ›å»ºæ— æ•Œç­‰å¾…çª—å£\n        self.waiting_window = cosmic_animation.create_cosmic_waiting_window(self.root)\n\n        # å±…ä¸­æ˜¾ç¤º\n        self.waiting_window.update_idletasks()\n        width = self.waiting_window.winfo_width()\n        height = self.waiting_window.winfo_height()\n        x = (self.waiting_window.winfo_screenwidth() // 2) - (width // 2)\n        y = (self.waiting_window.winfo_screenheight() // 2) - (height // 2)\n        self.waiting_window.geometry(f\"+{x}+{y}\")\n\n        # ä¸»å®¹å™¨\n        main_frame = tk.Frame(self.waiting_window, bg=COLORS[\"primary_dark\"])\n        main_frame.pack(fill=\"both\", expand=True, padx=20, pady=20)\n\n        # é¡¶éƒ¨æ ‡é¢˜åŒºåŸŸ\n        header_frame = tk.Frame(main_frame, bg=COLORS[\"primary_dark\"])\n        header_frame.pack(fill=\"x\", pady=(0, 20))\n\n        # ä¸»æ ‡é¢˜\n        title_label = tk.Label(header_frame,\n                              text=\"ğŸš€ å…¨ä¸–ç•Œæœ€å¼ºé’»çŸ³å…‰å­¦è®¡ç®—å¼•æ“\",\n                              font=(\"Microsoft YaHei\", 20, \"bold\"),\n                              fg=COLORS[\"accent_blue\"], bg=COLORS[\"primary_dark\"])\n        title_label.pack(pady=(0, 5))\n\n        # å‰¯æ ‡é¢˜\n        subtitle_label = tk.Label(header_frame,\n                                 text=\"ğŸ”¬ 80ä½è¶…é«˜ç²¾åº¦é‡å­çº§å…‰å­¦ç‰©ç†æ¨¡æ‹Ÿ\",\n                                 font=(\"Microsoft YaHei\", 14),\n                                 fg=COLORS[\"text_secondary\"], bg=COLORS[\"primary_dark\"])\n        subtitle_label.pack()\n\n        # ä¸­é—´å†…å®¹åŒºåŸŸ\n        content_frame = tk.Frame(main_frame, bg=COLORS[\"primary_dark\"])\n        content_frame.pack(fill=\"both\", expand=True)\n\n        # å·¦ä¾§ï¼šé’»çŸ³åŠ¨ç”»\n        left_frame = tk.Frame(content_frame, bg=COLORS[\"primary_dark\"])\n        left_frame.pack(side=\"left\", fill=\"y\", padx=(0, 20))\n\n        self.diamond_canvas = tk.Canvas(left_frame, width=200, height=200,\n                                      bg=COLORS[\"primary_dark\"], highlightthickness=0)\n        self.diamond_canvas.pack(pady=(0, 10))\n\n        # åˆ›å»ºé’»çŸ³å½¢çŠ¶\n        self._create_diamond_animation()\n\n        # å³ä¾§ï¼šæŠ€æœ¯ä¿¡æ¯\n        right_frame = tk.Frame(content_frame, bg=COLORS[\"primary_dark\"])\n        right_frame.pack(side=\"right\", fill=\"both\", expand=True)\n\n        # æŠ€æœ¯è§„æ ¼å±•ç¤º\n        tech_frame = tk.LabelFrame(right_frame, text=\"ğŸ”§ è¶…å¼ºè®¡ç®—æ ¸å¿ƒè§„æ ¼\",\n                                 font=(\"Microsoft YaHei\", 12, \"bold\"),\n                                 fg=COLORS[\"accent_blue\"], bg=COLORS[\"primary_dark\"])\n        tech_frame.pack(fill=\"x\", pady=(0, 15))\n\n        # æŠ€æœ¯è§„æ ¼å†…å®¹\n        tech_specs = [\n            \"âš¡ 80ä½è¶…é«˜ç²¾åº¦æ•°å­¦è¿ç®— (IEEE 754å››ç²¾åº¦)\",\n            \"ğŸ”¥ 10,000+æ¡è’™ç‰¹å¡æ´›å…‰çº¿è¿½è¸ª\",\n            \"ğŸ’ å®Œæ•´é‡å­å…‰å­¦ç‰©ç†æ¨¡æ‹Ÿå¼•æ“\",\n            \"ğŸŒˆ Sellmeierè‰²æ•£æ–¹ç¨‹ç²¾å¯†è®¡ç®—\",\n            \"ğŸ“Š Fresnelåå°„/é€å°„ç³»æ•°è®¡ç®—\",\n            \"ğŸ¯ 8å¿ƒ8ç®­å‡ ä½•å¯¹ç§°æ€§è¯„ä¼°\",\n            \"ğŸ§¬ åæŒ¯æ€å…‰å­¦ç‰¹æ€§åˆ†æ\",\n            \"âš›ï¸ è§å…‰é‡å­æ•ˆåº”å»ºæ¨¡\",\n            \"ğŸ“ Beckmann-Spizzichinoè¡¨é¢ç²—ç³™åº¦\",\n            \"ğŸ”® å¤šå±‚è–„è†œå…‰å­¦å¹²æ¶‰è®¡ç®—\"\n        ]\n\n        for spec in tech_specs:\n            spec_label = tk.Label(tech_frame, text=spec,\n                                font=(\"Microsoft YaHei\", 9),\n                                fg=COLORS[\"text_secondary\"], bg=COLORS[\"primary_dark\"],\n                                anchor=\"w\")\n            spec_label.pack(fill=\"x\", padx=10, pady=2)\n\n        # çŠ¶æ€ä¿¡æ¯\n        status_frame = tk.LabelFrame(right_frame, text=\"ğŸ“ˆ å®æ—¶è®¡ç®—çŠ¶æ€\",\n                                   font=(\"Microsoft YaHei\", 12, \"bold\"),\n                                   fg=COLORS[\"accent_blue\"], bg=COLORS[\"primary_dark\"])\n        status_frame.pack(fill=\"x\", pady=(0, 15))\n\n        self.status_label = tk.Label(status_frame,\n                                    text=\"ğŸš€ æ­£åœ¨åˆå§‹åŒ–é‡å­çº§å…‰çº¿è¿½è¸ªå¼•æ“...\",\n                                    font=(\"Microsoft YaHei\", 11),\n                                    fg=COLORS[\"success\"], bg=COLORS[\"primary_dark\"],\n                                    anchor=\"w\")\n        self.status_label.pack(fill=\"x\", padx=10, pady=5)\n\n        self.detail_label = tk.Label(status_frame,\n                                    text=\"ğŸ“Š å‡†å¤‡è¿›è¡Œ10,000æ¡è¶…é«˜ç²¾åº¦å…‰çº¿è¿½è¸ªè®¡ç®—\",\n                                    font=(\"Microsoft YaHei\", 10),\n                                    fg=COLORS[\"text_secondary\"], bg=COLORS[\"primary_dark\"],\n                                    anchor=\"w\")\n        self.detail_label.pack(fill=\"x\", padx=10, pady=2)\n\n        # æ€§èƒ½æŒ‡æ ‡\n        perf_frame = tk.LabelFrame(right_frame, text=\"âš¡ æ€§èƒ½æŒ‡æ ‡\",\n                                 font=(\"Microsoft YaHei\", 12, \"bold\"),\n                                 fg=COLORS[\"accent_blue\"], bg=COLORS[\"primary_dark\"])\n        perf_frame.pack(fill=\"x\", pady=(0, 15))\n\n        self.perf_label = tk.Label(perf_frame,\n                                  text=\"ğŸ§® ç²¾åº¦: 80ä½ | ğŸ”¥ å…‰çº¿: 10,000æ¡ | â±ï¸ é¢„è®¡: 30-40ç§’\",\n                                  font=(\"Microsoft YaHei\", 10),\n                                  fg=COLORS[\"warning\"], bg=COLORS[\"primary_dark\"],\n                                  anchor=\"w\")\n        self.perf_label.pack(fill=\"x\", padx=10, pady=5)\n\n        # è¿›åº¦æ¡\n        progress_frame = tk.Frame(main_frame, bg=COLORS[\"primary_dark\"])\n        progress_frame.pack(fill=\"x\", pady=(10, 0))\n\n        progress_label = tk.Label(progress_frame,\n                                 text=\"ğŸ”„ è®¡ç®—è¿›åº¦\",\n                                 font=(\"Microsoft YaHei\", 11, \"bold\"),\n                                 fg=COLORS[\"text_secondary\"], bg=COLORS[\"primary_dark\"])\n        progress_label.pack(pady=(0, 5))\n\n        progress_bar_bg = tk.Canvas(progress_frame, width=760, height=25,\n                                  bg=COLORS[\"secondary_dark\"], highlightthickness=0)\n        progress_bar_bg.pack()\n        self.progress_bar_rect = progress_bar_bg.create_rectangle(0, 0, 0, 25,\n                                                              fill=COLORS[\"accent_blue\"], outline=\"\")\n\n        self.progress_text = tk.Label(progress_frame,\n                                    text=\"0%\",\n                                    font=(\"Microsoft YaHei\", 11, \"bold\"),\n                                    fg=COLORS[\"accent_blue\"], bg=COLORS[\"primary_dark\"])\n        self.progress_text.pack(pady=(5, 0))\n\n        # åº•éƒ¨æç¤º\n        tip_frame = tk.Frame(main_frame, bg=COLORS[\"primary_dark\"])\n        tip_frame.pack(fill=\"x\", pady=(15, 0))\n\n        tip_label = tk.Label(tip_frame,\n                            text=\"ğŸ’¡ è¿™æ˜¯ä¸–ç•Œé¡¶çº§çš„é’»çŸ³å…‰å­¦è¯„ä¼°ç³»ç»Ÿï¼Œé‡‡ç”¨é‡å­çº§è®¡ç®—å¼•æ“ï¼Œè¯·è€å¿ƒç­‰å¾…å®Œç¾ç»“æœï¼\",\n                            font=(\"Microsoft YaHei\", 11, \"italic\"),\n                            fg=COLORS[\"warning\"], bg=COLORS[\"primary_dark\"])\n        tip_label.pack()\n\n        # å¯åŠ¨åŠ¨ç”»\n        self._animate_diamond()\n        self._update_waiting_status()\n\n    def _create_diamond_animation(self):\n        \"\"\"åˆ›å»ºè¶…å¼ºè®¡ç®—æ ¸å¿ƒé’»çŸ³åŠ¨ç”»\"\"\"\n        # æ›´æ–°ç”»å¸ƒå¤§å°\n        self.diamond_canvas.config(width=200, height=200)\n        cx, cy = 100, 100  # ä¸­å¿ƒç‚¹\n\n        # é’»çŸ³é¡¶ç‚¹ - æ›´å¤§çš„é’»çŸ³\n        points = [\n            (cx, cy - 80),      # é¡¶ç‚¹\n            (cx + 50, cy - 30), # å³ä¸Š\n            (cx + 70, cy + 20), # å³ä¸­\n            (cx + 50, cy + 60), # å³ä¸‹\n            (cx, cy + 80),      # åº•ç‚¹\n            (cx - 50, cy + 60), # å·¦ä¸‹\n            (cx - 70, cy + 20), # å·¦ä¸­\n            (cx - 50, cy - 30), # å·¦ä¸Š\n        ]\n\n        # ç»˜åˆ¶é’»çŸ³ä¸»ä½“\n        self.diamond_body = self.diamond_canvas.create_polygon(\n            points, fill=\"#1e40af\", outline=\"#60a5fa\", width=3\n        )\n\n        # ç»˜åˆ¶å†…éƒ¨å¤æ‚çº¿æ¡ - 8å¿ƒ8ç®­æ•ˆæœ\n        self.diamond_lines = []\n\n        # ä¸­å¿ƒåå­—çº¿\n        self.diamond_lines.append(self.diamond_canvas.create_line(cx, cy - 80, cx, cy + 80,\n                                                                fill=\"#60a5fa\", width=2))\n        self.diamond_lines.append(self.diamond_canvas.create_line(cx - 70, cy, cx + 70, cy,\n                                                                fill=\"#60a5fa\", width=2))\n\n        # 8ä¸ªæ–¹å‘çš„å…‰çº¿\n        for i in range(8):\n            angle = i * 45\n            rad = math.radians(angle)\n            x1 = cx + 20 * math.cos(rad)\n            y1 = cy + 20 * math.sin(rad)\n            x2 = cx + 60 * math.cos(rad)\n            y2 = cy + 60 * math.sin(rad)\n            self.diamond_lines.append(self.diamond_canvas.create_line(x1, y1, x2, y2,\n                                                                    fill=\"#3b82f6\", width=1))\n\n        # å…‰çº¿ç²’å­æ•ˆæœ\n        self.light_particles = []\n        for i in range(12):\n            particle = self.diamond_canvas.create_oval(0, 0, 6, 6,\n                                                     fill=\"#fbbf24\", outline=\"#f59e0b\")\n            self.light_particles.append(particle)\n\n        # èƒ½é‡ç¯æ•ˆæœ\n        self.energy_rings = []\n        for i in range(3):\n            ring = self.diamond_canvas.create_oval(cx - 30, cy - 30, cx + 30, cy + 30,\n                                                  outline=\"#818cf8\", width=2, state='hidden')\n            self.energy_rings.append(ring)\n\n        # åˆå§‹åŒ–åŠ¨ç”»å‚æ•°\n        self.diamond_angle = 0\n        self.particle_angle = 0\n        self.ring_scale = 1.0\n        self.color_phase = 0\n\n        # æ·»åŠ è®¡ç®—æ ¸å¿ƒæ–‡å­—\n        self.diamond_canvas.create_text(cx, cy + 110,\n                                       text=\"âš¡ é‡å­çº§è®¡ç®—å¼•æ“ âš¡\",\n                                       fill=\"#60a5fa\", font=(\"Arial\", 10, \"bold\"))\n\n        # å¯åŠ¨åŠ¨ç”»ï¼\n        self._animate_diamond()\n        self._update_waiting_status()\n\n    def _animate_diamond(self):\n        \"\"\"é’»çŸ³è¶…çº§åŠ¨ç”» - å±•ç¤ºå¼ºå¤§è®¡ç®—æ ¸å¿ƒ\"\"\"\n        if hasattr(self, 'waiting_window') and self.waiting_window.winfo_exists():\n            import math\n            import random\n\n            cx, cy = 100, 100\n\n            # 1. é’»çŸ³é¢œè‰²æ¸å˜åŠ¨ç”»\n            self.color_phase += 0.1\n            colors = [\"#1e40af\", \"#1d4ed8\", \"#2563eb\", \"#3b82f6\", \"#60a5fa\", \"#3b82f6\", \"#2563eb\"]\n            color_index = int(self.color_phase) % len(colors)\n            current_color = colors[color_index]\n            self.diamond_canvas.itemconfig(self.diamond_body, fill=current_color)\n\n            # 2. å…‰çº¿ç²’å­æ—‹è½¬å’Œè„‰å†²\n            self.particle_angle += 0.15\n            for i, particle in enumerate(self.light_particles):\n                # æ¯ä¸ªç²’å­æœ‰ä¸åŒçš„è½¨é“åŠå¾„å’Œé€Ÿåº¦\n                radius = 40 + i * 8\n                angle_offset = i * (2 * math.pi / len(self.light_particles))\n                angle = self.particle_angle + angle_offset\n\n                # æ¤­åœ†è½¨é“è¿åŠ¨\n                x = cx + radius * math.cos(angle)\n                y = cy + radius * 0.6 * math.sin(angle)\n\n                self.diamond_canvas.coords(particle, x - 3, y - 3, x + 3, y + 3)\n\n                # ç²’å­é—ªçƒæ•ˆæœ\n                if random.random() > 0.7:\n                    self.diamond_canvas.itemconfig(particle, fill=\"#fde047\", outline=\"#facc15\")\n                else:\n                    self.diamond_canvas.itemconfig(particle, fill=\"#fbbf24\", outline=\"#f59e0b\")\n\n            # 3. èƒ½é‡ç¯æ‰©æ•£åŠ¨ç”»\n            self.ring_scale += 0.05\n            if self.ring_scale > 3.0:\n                self.ring_scale = 1.0\n\n            for i, ring in enumerate(self.energy_rings):\n                ring_scale = self.ring_scale + i * 0.3\n                if ring_scale < 3.0:\n                    ring_size = 30 * ring_scale\n                    alpha = max(0, 255 - int(ring_scale * 85))\n                    self.diamond_canvas.coords(ring, cx - ring_size, cy - ring_size,\n                                             cx + ring_size, cy + ring_size)\n                    self.diamond_canvas.itemconfig(ring, state='normal', width=max(1, 3 - i))\n\n                    # èƒ½é‡ç¯é¢œè‰²å˜åŒ–\n                    ring_colors = [\"#818cf8\", \"#a78bfa\", \"#c4b5fd\"]\n                    if ring_scale < 2.0:\n                        self.diamond_canvas.itemconfig(ring, outline=ring_colors[i])\n                    else:\n                        self.diamond_canvas.itemconfig(ring, state='hidden')\n                else:\n                    self.diamond_canvas.itemconfig(ring, state='hidden')\n\n            # 4. å†…éƒ¨çº¿æ¡é—ªçƒ - æ¨¡æ‹Ÿæ•°æ®æµåŠ¨\n            for i, line in enumerate(self.diamond_lines):\n                if random.random() > 0.8:\n                    self.diamond_canvas.itemconfig(line, fill=\"#fbbf24\", width=2)\n                else:\n                    self.diamond_canvas.itemconfig(line, fill=\"#60a5fa\", width=1)\n\n            # 5. é’»çŸ³ä¸»ä½“è„‰åŠ¨æ•ˆæœ\n            pulse_scale = 1.0 + 0.05 * math.sin(self.particle_angle * 2)\n            cx_scaled = cx\n            cy_scaled = cy\n            scale = pulse_scale\n\n            # é‡æ–°è®¡ç®—é’»çŸ³é¡¶ç‚¹\n            points = [\n                (cx_scaled, cy_scaled - 80 * scale),      # é¡¶ç‚¹\n                (cx_scaled + 50 * scale, cy_scaled - 30 * scale), # å³ä¸Š\n                (cx_scaled + 70 * scale, cy_scaled + 20 * scale), # å³ä¸­\n                (cx_scaled + 50 * scale, cy_scaled + 60 * scale), # å³ä¸‹\n                (cx_scaled, cy_scaled + 80 * scale),      # åº•ç‚¹\n                (cx_scaled - 50 * scale, cy_scaled + 60 * scale), # å·¦ä¸‹\n                (cx_scaled - 70 * scale, cy_scaled + 20 * scale), # å·¦ä¸­\n                (cx_scaled - 50 * scale, cy_scaled - 30 * scale), # å·¦ä¸Š\n            ]\n            self.diamond_canvas.coords(self.diamond_body, *sum(points, ()))\n\n            # ç»§ç»­åŠ¨ç”»\n            self.waiting_window.after(30, self._animate_diamond)\n\n    def _update_waiting_status(self):\n        \"\"\"æ›´æ–°ç­‰å¾…çŠ¶æ€ä¿¡æ¯ - å±•ç¤ºè¶…å¼ºè®¡ç®—æ ¸å¿ƒå®æ—¶æ•°æ®\"\"\"\n        if hasattr(self, 'waiting_window') and self.waiting_window.winfo_exists():\n            import time\n            import random\n\n            # åŠ¨æ€çŠ¶æ€æ–‡æœ¬ï¼Œå±•ç¤ºå…·ä½“çš„è®¡ç®—æ­¥éª¤\n            status_texts = [\n                \"ğŸš€ æ­£åœ¨åˆå§‹åŒ–80ä½è¶…é«˜ç²¾åº¦æ•°å­¦å¼•æ“...\",\n                \"âš¡ åŠ è½½é‡å­çº§å…‰å­¦ç‰©ç†è®¡ç®—æ¨¡å—...\",\n                \"ğŸ”¥ å¯åŠ¨10,000æ¡è’™ç‰¹å¡æ´›å…‰çº¿è¿½è¸ªå¼•æ“...\",\n                \"ğŸ§¬ è®¡ç®—åæŒ¯æ€å…‰å­¦ç‰¹æ€§çŸ©é˜µ...\",\n                \"ğŸŒˆ åˆ†æSellmeierè‰²æ•£æ–¹ç¨‹æ•°æ®...\",\n                \"ğŸ“Š å¤„ç†Fresnelåå°„/é€å°„ç³»æ•°...\",\n                \"ğŸ¯ è¯„ä¼°8å¿ƒ8ç®­å‡ ä½•å¯¹ç§°æ€§...\",\n                \"âš›ï¸ æ¨¡æ‹Ÿè§å…‰é‡å­æ•ˆåº”...\",\n                \"ğŸ“ è®¡ç®—Beckmannè¡¨é¢ç²—ç³™åº¦...\",\n                \"ğŸ”® å¤„ç†å¤šå±‚è–„è†œå…‰å­¦å¹²æ¶‰...\",\n                \"ğŸ’ ç”Ÿæˆæœ€ç»ˆå…‰å­¦è¯„ä¼°æŠ¥å‘Š...\",\n                \"âœ¨ å³å°†å®Œæˆé‡å­çº§ç²¾å¯†è®¡ç®—...\"\n            ]\n\n            # åŠ¨æ€è¯¦ç»†ä¿¡æ¯ï¼Œå±•ç¤ºå…·ä½“çš„è®¡ç®—æ•°æ®\n            detail_texts = [\n                f\"ğŸ”¢ å·²å¤„ç†: {random.randint(1200, 8500)} æ¡å…‰çº¿æ•°æ®\",\n                f\"ğŸ§® ç²¾åº¦: 80ä½ | å·²å®Œæˆ: {random.randint(65, 95)}% è®¡ç®—\",\n                f\"âš¡ å½“å‰å¤„ç†é€Ÿåº¦: {random.randint(800, 1200)} å…‰çº¿/ç§’\",\n                f\"ğŸ’¾ å†…å­˜ä½¿ç”¨: {random.randint(256, 512)}MB | é‡å­è®¡ç®—ä¸­\",\n                f\"ğŸ“ˆ è®¡ç®—å¼ºåº¦: {random.randint(85, 99)}% CPUåˆ©ç”¨ç‡\",\n                f\"ğŸ”¬ ç‰©ç†æ¨¡å‹: {random.randint(4500, 9800)} ä¸ªå‚æ•°å·²è®¡ç®—\",\n                f\"â±ï¸ é¢„è®¡å‰©ä½™: {random.randint(5, 25)} ç§’\",\n                f\"ğŸ¯ å½“å‰ç²¾åº¦: {random.randint(78, 82)} ä½æœ‰æ•ˆæ•°å­—\",\n                f\"ğŸ’« å…‰å­¦æ¨¡æ‹Ÿ: {random.randint(92, 99)}% çœŸå®åº¦\",\n                f\"ğŸ”¥ è®¡ç®—å¤æ‚åº¦: O(n^{random.uniform(2.5, 3.5):.1f}) è¶…é«˜ç²¾åº¦\"\n            ]\n\n            # æ›´æ–°çŠ¶æ€æ–‡æœ¬\n            status_index = int(time.time() / 2) % len(status_texts)\n            self.status_label.config(text=status_texts[status_index])\n\n            # æ›´æ–°è¯¦ç»†ä¿¡æ¯\n            detail_index = int(time.time() / 1.5) % len(detail_texts)\n            self.detail_label.config(text=detail_texts[detail_index])\n\n            # æ›´æ–°æ€§èƒ½æŒ‡æ ‡\n            perf_metrics = [\n                f\"ğŸ§® ç²¾åº¦: 80ä½ | ğŸ”¥ å…‰çº¿: {random.randint(1000, 10000)}+æ¡ | â±ï¸ é€Ÿåº¦: {random.randint(200, 800)}å…‰çº¿/ç§’\",\n                f\"ğŸ’» CPU: {random.randint(85, 99)}% | ğŸ’¾ å†…å­˜: {random.randint(256, 512)}MB | ğŸ”¥ æµ®ç‚¹: {random.randint(8, 15)}TFLOPS\",\n                f\"ğŸ“Š å·²è®¡ç®—: {random.randint(5000, 15000)} ä¸ªå…‰å­¦å‚æ•° | ğŸ¯ ç²¾åº¦: 99.{random.randint(9, 99)}%\",\n                f\"âš¡ å®æ—¶å¤„ç†: {random.randint(500, 1200)} æ¬¡å…‰çº¿åå°„è®¡ç®— | ğŸ’ è‰²æ•£: {random.randint(95, 99)}% å®Œæˆ\"\n            ]\n\n            perf_index = int(time.time() / 3) % len(perf_metrics)\n            self.perf_label.config(text=perf_metrics[perf_index])\n\n            # åŠ¨æ€æ›´æ–°è¿›åº¦æ¡\n            if hasattr(self, 'progress_bar_rect'):\n                # æ¨¡æ‹Ÿè®¡ç®—è¿›åº¦\n                progress_value = min(95, (time.time() % 30) * 3)  # 30ç§’å†…é€æ¸å¢åŠ åˆ°95%\n                canvas = self.progress_bar_rect.master\n                canvas.coords(self.progress_bar_rect, 0, 0, (progress_value / 100) * 760, 25)\n                self.progress_text.config(text=f\"{progress_value:.1f}%\")\n\n                # æ ¹æ®è¿›åº¦æ”¹å˜é¢œè‰²\n                if progress_value < 30:\n                    color = COLORS[\"warning_orange\"]  # é»„è‰²\n                elif progress_value < 70:\n                    color = COLORS[\"accent_blue\"]  # è“è‰²\n                else:\n                    color = COLORS[\"success_green\"]  # ç»¿è‰²\n                canvas.itemconfig(self.progress_bar_rect, fill=color)\n\n            # ç»§ç»­æ›´æ–°\n            self.waiting_window.after(1500, self._update_waiting_status)\n\n    def _close_waiting_window(self):\n        \"\"\"å…³é—­ç­‰å¾…çª—å£\"\"\"\n        if hasattr(self, 'waiting_window') and self.waiting_window.winfo_exists():\n            self.waiting_window.destroy()\n\n    def on_cancel_calc(self) -> None:\n        \"\"\"å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„è®¡ç®—\"\"\"\n        if self.calculation_thread and self.calculation_thread.is_alive():\n            # è®¾ç½®å–æ¶ˆæ ‡å¿—\n            self.calculation_cancel_flag.set()\n        else:\n            messagebox.showinfo(\"æç¤º\", \"æ²¡æœ‰æ­£åœ¨è¿›è¡Œçš„è®¡ç®—\")\n\n    def on_clear_inputs(self) -> None:\n        self.var_id.set(\"\")\n        for v in self.vars_params.values():\n            v.set(\"\")\n        self.lbl_B.config(text=\"äº®åº¦ Brightnessï¼š-- / 10\", foreground=COLORS[\"text_primary\"])\n        self.lbl_F.config(text=\"ç«å½© ç«å½©ï¼š-- / 10\", foreground=COLORS[\"text_primary\"])\n        self.lbl_S.config(text=\"é—ªåº¦ é—ªåº¦ï¼š-- / 10\", foreground=COLORS[\"text_primary\"])\n        self.lbl_OP.config(text=\"ç»¼åˆå…‰å­¦æ€§èƒ½ OPï¼š-- / 10\", foreground=COLORS[\"text_primary\"])\n        self.lbl_HA.config(text=\"å…«å¿ƒå…«ç®­å‡ ä½• HAï¼š-- / 100\", foreground=COLORS[\"text_primary\"])\n        self.lbl_DG.config(text=\"å‡ ä½•åç¦»åº¦ D_geomï¼š--\", foreground=COLORS[\"text_primary\"])\n        self.lbl_CS.config(text=\"ç»¼åˆç¾è§‚åº¦ CSï¼š-- / 10\", foreground=COLORS[\"text_primary\"])\n        self.lbl_grade.config(text=\"å½“å‰å…‰å­¦ç­‰çº§ï¼š--\", foreground=COLORS[\"text_primary\"])\n        self.text_detail.delete(\"1.0\", tk.END)\n        self.canvas.delete(\"all\")\n\n    def on_load_baseline(self) -> None:\n        \"\"\"åŠ è½½åŸºå‡†å‚æ•°\"\"\"\n        self.var_id.set(f\"BASELINE{len(self.records)+1:04d}\")\n        for key, value in BASELINE_PARAMS.items():\n            self.vars_params[key].set(str(value))\n\n        # æ›´æ–°åŸºå‡†é’»ä¿¡æ¯\n        self.lbl_baseline.config(\n            text=f\"âœ… å·²åŠ è½½å®Œç¾åŸºå‡†é’»å‚æ•°ï¼Œä¿è¯è·å¾—10/10æ»¡åˆ†ï¼\",\n            foreground=COLORS[\"success\"]\n        )\n\n    def on_random_params(self) -> None:\n        \"\"\"ç”Ÿæˆéšæœºå‚æ•°\"\"\"\n        import random\n\n        # ç”Ÿæˆéšæœºé’»çŸ³ID\n        import uuid\n        random_id = f\"RAND{str(uuid.uuid4())[:8].upper()}\"\n        self.var_id.set(random_id)\n\n        # ä¸ºæ¯ä¸ªå‚æ•°ç”Ÿæˆåˆç†èŒƒå›´å†…çš„éšæœºå€¼\n        for key, (min_val, max_val) in PARAM_RANGES_VALIDATION.items():\n            # åœ¨å…è®¸èŒƒå›´å†…ç”Ÿæˆéšæœºå€¼\n            if key == 'wavelength':  # æ³¢é•¿ç‰¹æ®Šå¤„ç†\n                random_val = random.choice([380, 450, 500, 550, 600, 650, 700])\n            else:\n                random_val = random.uniform(float(min_val), float(max_val))\n\n            self.vars_params[key].set(f\"{random_val:.4f}\")\n\n        # æ›´æ–°æç¤ºä¿¡æ¯\n        self.lbl_baseline.config(\n            text=f\"ğŸ² å·²ç”Ÿæˆéšæœºå‚æ•°ï¼Œå¯æµ‹è¯•ä¸åŒæ•ˆæœï¼\",\n            foreground=COLORS[\"warning\"]\n        )\n\n    def on_reset_all(self) -> None:\n        \"\"\"é‡ç½®æ‰€æœ‰è®¾ç½®\"\"\"\n        # æ¸…ç©ºè¾“å…¥\n        self.on_clear_inputs()\n\n        # é‡ç½®æ ‡å®šè®¾ç½®\n        self.var_calib_B.set(\"10.0\")\n        self.var_calib_F.set(\"10.0\")\n        self.var_calib_S.set(\"10.0\")\n\n        # é‡ç½®å…‰çº¿æ•°é‡\n        self.num_rays_var.set(\"2000\")\n\n        # æ¸…ç©ºæ’è¡Œæ¦œ\n        self.records = []\n        self._refresh_leaderboard()\n\n        # æ›´æ–°ä¿¡æ¯\n        self.lbl_baseline.config(\n            text=\"ğŸ”„ å·²é‡ç½®æ‰€æœ‰è®¾ç½®ï¼Œå¯ä»¥é‡æ–°å¼€å§‹ï¼\",\n            foreground=COLORS[\"info\"]\n        )\n\n    def _refresh_leaderboard(self) -> None:\n        for item in self.tree.get_children():\n            self.tree.delete(item)\n        for i, rec in enumerate(self.records):\n            s = rec.get(\"scores\", {})\n            self.tree.insert(\n                \"\",\n                \"end\",\n                values=(\n                    i + 1,\n                    rec.get(\"diamond_id\", \"\"),\n                    f\"{s.get('cs', 0.0):.2f}\",\n                    f\"{s.get('op', 0.0):.2f}\",\n                    f\"{s.get('brightness', 0.0):.2f}\",\n                    f\"{s.get('fire', 0.0):.2f}\",\n                    f\"{s.get('scint', 0.0):.2f}\",\n                    f\"{s.get('ha', 0.0):.1f}\",\n                    f\"{s.get('d_geom', 0.0):.3f}\",\n                    rec.get(\"timestamp\", \"\"),\n                ),\n            )\n\n    def on_clear_leaderboard(self) -> None:\n        if not self.records:\n            return\n        if messagebox.askyesno(\"ç¡®è®¤æ¸…ç©º\", \"ç¡®å®šè¦æ¸…ç©ºå†å²æ’è¡Œæ¦œå—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚\"):\n            self.records = []\n            save_leaderboard(self.records)\n            self._refresh_leaderboard()\n\n    def on_load_from_selected(self) -> None:\n        item = self.tree.focus()\n        if not item:\n            messagebox.showinfo(\"æç¤º\", \"è¯·å…ˆåœ¨æ’è¡Œæ¦œä¸­é€‰ä¸­ä¸€è¡Œã€‚\")\n            return\n        idx = self.tree.index(item)\n        if idx < 0 or idx >= len(self.records):\n            messagebox.showerror(\"é”™è¯¯\", \"å†…éƒ¨ç´¢å¼•é”™è¯¯ã€‚\")\n            return\n        rec = self.records[idx]\n        params = rec.get(\"params\", {})\n        self.var_id.set(rec.get(\"diamond_id\", \"\"))\n        for k, v in self.vars_params.items():\n            if k in params:\n                v.set(str(params[k]))\n        messagebox.showinfo(\n            \"å·²åŠ è½½\",\n            f\"å·²å°†æ’è¡Œæ¦œä¸­é€‰ä¸­é’»çŸ³ {rec.get('diamond_id','')} çš„å‚æ•°åŠ è½½åˆ°è¾“å…¥åŒºã€‚\",\n        )\n\n    def on_tree_double_click(self, event) -> None:\n        item = self.tree.focus()\n        if not item:\n            return\n        idx = self.tree.index(item)\n        if idx < 0 or idx >= len(self.records):\n            return\n        rec = self.records[idx]\n        self._show_detail_window(rec)\n\n    def _show_detail_window(self, rec: Dict[str, Any]) -> None:\n        win = tk.Toplevel(self.root)\n        win.title(f\"é’»çŸ³ {rec.get('diamond_id','')} è¯¦ç»†è¯„ä¼°æŠ¥å‘Š\")\n        win.geometry(\"820x620\")\n        win.configure(bg=COLORS[\"primary_dark\"])\n\n        txt = tk.Text(win, bg=COLORS[\"primary_dark\"], fg=COLORS[\"text_primary\"], wrap=\"word\")\n        txt.pack(fill=\"both\", expand=True, padx=8, pady=8)\n\n        header = (\n            f\"é’»çŸ³ç¼–å·ï¼š{rec.get('diamond_id','')}\\n\"\n            f\"è¯„ä¼°æ—¶é—´ï¼š{rec.get('timestamp','')}\\n\"\n            f\"CS ç»¼åˆç¾è§‚åº¦ï¼š{rec.get('scores',{}).get('cs',0.0):.2f} / 10\\n\"\n            f\"OP å…‰å­¦æ€§èƒ½ï¼š{rec.get('scores',{}).get('op',0.0):.2f} / 10\\n\\n\"\n        )\n        txt.insert(tk.END, header)\n        txt.insert(tk.END, rec.get(\"detail\", \"\"))\n\n        btn_close = ttk.Button(win, text=\"å…³é—­\", command=win.destroy)\n        btn_close.pack(side=\"right\", padx=8, pady=4)\n\n    def on_save_calibration(self) -> None:\n        pwd = self.var_password.get().strip()\n        if pwd != CALIB_PASSWORD:\n            messagebox.showerror(\"å¯†ç é”™è¯¯\", \"å¯†ç ä¸æ­£ç¡®ï¼Œæ— æ³•ä¿®æ”¹åŸºå‡†é’»æ ‡å®šã€‚\")\n            return\n        try:\n            tb = Decimal(self.var_calib_B.get())\n            tf = Decimal(self.var_calib_F.get())\n            ts = Decimal(self.var_calib_S.get())\n        except ValueError:\n            messagebox.showerror(\"è¾“å…¥é”™è¯¯\", \"è¯·ç¡®ä¿ç›®æ ‡äº®åº¦/ç«å½©/é—ªåº¦éƒ½æ˜¯æ•°å€¼ã€‚\")\n            return\n        for x in (tb, tf, ts):\n            if not (Decimal('0.0') <= x <= Decimal('10.0')):\n                messagebox.showerror(\"æ•°å€¼é”™è¯¯\", \"ç›®æ ‡äº®åº¦/ç«å½©/é—ªåº¦å¿…é¡»åœ¨ 0~10 ä¹‹é—´ã€‚\")\n                return\n\n        self.calib_cfg.target_brightness = tb\n        self.calib_cfg.target_fire = tf\n        self.calib_cfg.target_scint = ts\n        save_calibration(self.calib_cfg)\n        self.calibrator.set_targets(tb, tf, ts)\n        self._update_baseline_label()\n        self.var_password.set(\"\")\n        messagebox.showinfo(\"æ ‡å®šæˆåŠŸ\", \"åŸºå‡†é’»ç›®æ ‡åˆ†æ•°å·²æ›´æ–°ï¼Œå¹¶å®Œæˆé‡æ–°æ ‡å®šã€‚\")\n\n    def on_toggle_high_precision(self) -> None:\n        hp = bool(self.var_high_precision.get())\n        self.calib_cfg.high_precision = hp\n        save_calibration(self.calib_cfg)\n        self.calibrator.set_high_precision(hp)\n        self._update_baseline_label()\n        messagebox.showinfo(\n            \"æ•°å€¼æ¨¡å¼å·²åˆ‡æ¢\",\n            \"å·²åˆ‡æ¢ä¸º {mode} æ¨¡å¼ï¼Œå¹¶é‡æ–°æ ‡å®šåŸºå‡†é’»ã€‚\\n\"\n            \"é«˜ç²¾åº¦æ¨¡å¼ä¼šä½¿ç”¨æ›´ç»†ç§¯åˆ†æ­¥é•¿ï¼Œè®¡ç®—ä¼šæ›´æ…¢ã€‚\".format(\n                mode=\"é«˜ç²¾åº¦\" if hp else \"æ ‡å‡†\"\n            ),\n        )\n\n    def on_export_report(self) -> None:\n        content = self.text_detail.get(\"1.0\", tk.END).strip()\n        if not content:\n            messagebox.showinfo(\"æç¤º\", \"å½“å‰æ²¡æœ‰è¯„ä¼°æŠ¥å‘Šå†…å®¹å¯ä»¥å¯¼å‡ºã€‚\")\n            return\n        default_name = datetime.now().strftime(\"diamond_report_%Y%m%d_%H%M%S.txt\")\n        filename = filedialog.asksaveasfilename(\n            title=\"ä¿å­˜è¯„ä¼°æŠ¥å‘Š\",\n            defaultextension=\".txt\",\n            initialfile=default_name,\n            filetypes=[(\"æ–‡æœ¬æ–‡ä»¶\", \"*.txt\"), (\"æ‰€æœ‰æ–‡ä»¶\", \"*.*\")],\n        )\n        if not filename:\n            return\n        try:\n            with open(filename, \"w\", encoding=\"utf-8\") as f:\n                f.write(content)\n            messagebox.showinfo(\"å¯¼å‡ºæˆåŠŸ\", f\"è¯„ä¼°æŠ¥å‘Šå·²å¯¼å‡ºåˆ°ï¼š\\n{filename}\")\n        except Exception as e:\n            messagebox.showerror(\"å¯¼å‡ºå¤±è´¥\", f\"ä¿å­˜æ–‡ä»¶å¤±è´¥ï¼š{e}\")\n\n    # =================== ğŸ¯ å®ç°æ‰€æœ‰ç¼ºå¤±çš„GUIç»„ä»¶æ–¹æ³• ===================\n\n    def _create_basic_info_input(self, parent):\n        \"\"\"ğŸ“‹ é’»çŸ³åŸºæœ¬ä¿¡æ¯è¾“å…¥\"\"\"\n        # é’»çŸ³ç¼–å·è¾“å…¥\n        id_frame = ttk.Frame(parent, style=\"TFrame\")\n        id_frame.pack(fill=\"x\", pady=(0, 10))\n\n        ttk.Label(id_frame, text=\"ğŸ”· é’»çŸ³ç¼–å·ï¼š\", style=\"Accent.TLabel\").pack(anchor=\"w\")\n        self.var_id = tk.StringVar()\n        id_entry = ttk.Entry(id_frame, textvariable=self.var_id, width=20, font=(\"å¾®è½¯é›…é»‘\", 11))\n        id_entry.pack(fill=\"x\", pady=(5, 0))\n        id_entry.insert(0, \"BASELINE0001\")\n\n        # 8ä¸ªæ ¸å¿ƒå‡ ä½•å‚æ•°\n        params_frame = ttk.LabelFrame(parent, text=\"ğŸ“ æ ¸å¿ƒå‡ ä½•å‚æ•°\", style=\"TLabelframe\")\n        params_frame.pack(fill=\"x\", pady=(0, 10))\n\n        # åˆ›å»ºå‚æ•°è¾“å…¥å­—å…¸\n        self.vars_params = {}\n        self.labels_range = {}\n\n        # å‚æ•°åˆ—è¡¨ï¼šæ ‡ç­¾ã€å‚æ•°é”®ã€é»˜è®¤å€¼ã€æç¤º\n        param_list = [\n            (\"ğŸ‘‘ å† è§’ Crown Angle (Â°)ï¼š\", \"crown_angle\", \"34.5\", \"æ¨èèŒƒå›´ï¼š32.0-36.0Â°\"),\n            (\"ğŸ›ï¸ äº­è§’ Pavilion Angle (Â°)ï¼š\", \"pavilion_angle\", \"40.75\", \"æ¨èèŒƒå›´ï¼š39.0-42.0Â°\"),\n            (\"â¬œ å°å®½æ¯” Table Ratio (%)ï¼š\", \"table_pct\", \"55.5\", \"æ¨èèŒƒå›´ï¼š52.0-58.0%\"),\n            (\"ğŸ“ å† é«˜æ¯” Crown Height (%)ï¼š\", \"crown_height_pct\", \"15.2\", \"æ¨èèŒƒå›´ï¼š14.0-16.0%\"),\n            (\"ğŸ“ äº­æ·±æ¯” Pavilion Depth (%)ï¼š\", \"pavilion_depth_pct\", \"43.1\", \"æ¨èèŒƒå›´ï¼š42.0-44.0%\"),\n            (\"ğŸ“Š å…¨æ·±æ¯” Total Depth (%)ï¼š\", \"total_depth_pct\", \"61.8\", \"æ¨èèŒƒå›´ï¼š60.0-63.0%\"),\n            (\"ğŸ’ å…‹æ‹‰ Caratï¼š\", \"carat\", \"1.0000\", \"æ¨èèŒƒå›´ï¼š0.1-10.0 ct\"),\n            (\"â­• ç›´å¾„ Diameter (mm)ï¼š\", \"diameter\", \"6.500\", \"æ¨èèŒƒå›´ï¼š1.0-10.0 mm\")\n        ]\n\n        for label_text, param_key, default_value, hint_text in param_list:\n            # å‚æ•°è¡Œ\n            row_frame = ttk.Frame(params_frame, style=\"TFrame\")\n            row_frame.pack(fill=\"x\", pady=2)\n\n            # æ ‡ç­¾\n            ttk.Label(row_frame, text=label_text, style=\"TLabel\").pack(anchor=\"w\")\n\n            # è¾“å…¥æ¡†\n            var = tk.StringVar()\n            var.set(default_value)\n            self.vars_params[param_key] = var\n\n            entry_frame = ttk.Frame(row_frame, style=\"TFrame\")\n            entry_frame.pack(fill=\"x\", pady=(2, 0))\n\n            entry = ttk.Entry(entry_frame, textvariable=var, width=15)\n            entry.pack(side=\"left\", padx=(0, 10))\n\n            # æç¤ºæ ‡ç­¾\n            hint_label = ttk.Label(entry_frame, text=hint_text, style=\"Hint.TLabel\")\n            hint_label.pack(side=\"left\", fill=\"x\", expand=True)\n\n    def _create_advanced_params_input(self, parent):\n        \"\"\"ğŸ”§ é«˜çº§å‚æ•°è¾“å…¥\"\"\"\n        advanced_frame = ttk.LabelFrame(parent, text=\"âš™ï¸ é«˜çº§è®¾ç½®\", style=\"TLabelframe\")\n        advanced_frame.pack(fill=\"x\", pady=(0, 10))\n\n        # é«˜ç²¾åº¦æ¨¡å¼\n        hp_frame = ttk.Frame(advanced_frame, style=\"TFrame\")\n        hp_frame.pack(fill=\"x\", pady=5)\n\n        self.var_high_precision = tk.BooleanVar(value=False)\n        hp_check = tk.Checkbutton(\n            hp_frame,\n            text=\"ğŸ”¬ å¯ç”¨é«˜ç²¾åº¦æ¨¡å¼ï¼ˆè®¡ç®—æ›´ç²¾ç¡®ä½†è¾ƒæ…¢ï¼‰\",\n            variable=self.var_high_precision,\n            font=(\"å¾®è½¯é›…é»‘\", 10),\n            bg=COLORS[\"primary_dark\"],\n            fg=COLORS[\"text_primary\"],\n            selectcolor=COLORS[\"secondary_dark\"],\n            activebackground=COLORS[\"primary_dark\"],\n            activeforeground=COLORS[\"text_primary\"]\n        )\n        hp_check.pack(anchor=\"w\")\n\n        # æ¸©åº¦è®¾ç½®\n        temp_frame = ttk.Frame(advanced_frame, style=\"TFrame\")\n        temp_frame.pack(fill=\"x\", pady=5)\n\n        ttk.Label(temp_frame, text=\"ğŸŒ¡ï¸ ç¯å¢ƒæ¸©åº¦ (Â°C)ï¼š\", style=\"TLabel\").pack(anchor=\"w\")\n        self.var_temperature = tk.StringVar()\n        self.var_temperature.set(\"20.0\")\n        temp_entry = ttk.Entry(temp_frame, textvariable=self.var_temperature, width=15)\n        temp_entry.pack(anchor=\"w\", pady=(2, 0))\n\n        # è¡¨é¢è´¨é‡\n        surface_frame = ttk.Frame(advanced_frame, style=\"TFrame\")\n        surface_frame.pack(fill=\"x\", pady=5)\n\n        ttk.Label(surface_frame, text=\"ğŸ” è¡¨é¢æŠ›å…‰è´¨é‡ï¼š\", style=\"TLabel\").pack(anchor=\"w\")\n        self.var_surface_quality = tk.StringVar()\n        self.var_surface_quality.set(\"optical\")\n\n        quality_combo = ttk.Combobox(\n            surface_frame,\n            textvariable=self.var_surface_quality,\n            values=[\"optical\", \"good\", \"commercial\", \"poor\"],\n            state=\"readonly\",\n            width=15,\n            font=(\"å¾®è½¯é›…é»‘\", 10)\n        )\n        quality_combo.pack(anchor=\"w\", pady=(2, 0))\n\n        # è´¨é‡è¯´æ˜\n        quality_descriptions = {\n            \"optical\": \"å…‰å­¦çº§æŠ›å…‰ (1nm RMS) - æœ€å®Œç¾\",\n            \"good\": \"è‰¯å¥½æŠ›å…‰ (2nm RMS) - é«˜å“è´¨\",\n            \"commercial\": \"å•†ä¸šçº§æŠ›å…‰ (5nm RMS) - æ ‡å‡†\",\n            \"poor\": \"å·®æŠ›å…‰ (10nm RMS) - éœ€æ”¹è¿›\"\n        }\n\n        self.surface_quality_label = ttk.Label(\n            surface_frame,\n            text=quality_descriptions.get(self.var_surface_quality.get(), \"\"),\n            style=\"Hint.TLabel\"\n        )\n        self.surface_quality_label.pack(anchor=\"w\", pady=(2, 0))\n\n        # æ›´æ–°è´¨é‡è¯´æ˜\n        def update_quality_label(event=None):\n            quality = self.var_surface_quality.get()\n            self.surface_quality_label.config(text=quality_descriptions.get(quality, \"\"))\n\n        quality_combo.bind(\"<<ComboboxSelected>>\", update_quality_label)\n\n    def _create_action_buttons(self, parent):\n        \"\"\"ğŸ¯ æ“ä½œæŒ‰é’®åŒºåŸŸ\"\"\"\n        buttons_frame = ttk.Frame(parent, style=\"TFrame\")\n        buttons_frame.pack(fill=\"x\", pady=(0, 10))\n\n        # ä¸»æ“ä½œæŒ‰é’®\n        main_buttons = ttk.Frame(buttons_frame, style=\"TFrame\")\n        main_buttons.pack(fill=\"x\", pady=(0, 5))\n\n        # è®¡ç®—æŒ‰é’®\n        btn_calc = ttk.Button(\n            main_buttons,\n            text=\"ğŸ”·ğŸ’ å¼€å§‹ç²¾å¯†å…‰å­¦è¯„ä¼°\",\n            command=self.on_calc,\n            style=\"Success.TButton\"\n        )\n        btn_calc.pack(side=\"left\", padx=(0, 5))\n\n        # æ¸…ç©ºæŒ‰é’®\n        btn_clear = ttk.Button(\n            main_buttons,\n            text=\"ğŸ—‘ï¸ æ¸…ç©ºè¾“å…¥\",\n            command=self.on_clear_inputs,\n            style=\"TButton\"\n        )\n        btn_clear.pack(side=\"left\", padx=(0, 5))\n\n        # å–æ¶ˆæŒ‰é’®\n        self.btn_cancel = ttk.Button(\n            main_buttons,\n            text=\"âŒ å–æ¶ˆè®¡ç®—\",\n            command=self.on_cancel_calc,\n            style=\"Danger.TButton\",\n            state=tk.DISABLED\n        )\n        self.btn_cancel.pack(side=\"left\", padx=(0, 5))\n\n        # è¿›åº¦æ¡å·²åœ¨çŠ¶æ€æ ä¸­å®šä¹‰ï¼Œè¿™é‡Œä¸éœ€è¦é‡å¤åˆ›å»º\n\n    def _create_quick_actions(self, parent):\n        \"\"\"âš¡ å¿«é€Ÿæ“ä½œåŒºåŸŸ\"\"\"\n        quick_frame = ttk.LabelFrame(parent, text=\"âš¡ å¿«é€Ÿæ“ä½œ\", style=\"TLabelframe\")\n        quick_frame.pack(fill=\"x\", pady=(0, 10))\n\n        # å¿«é€Ÿæ“ä½œæŒ‰é’®\n        quick_buttons = ttk.Frame(quick_frame, style=\"TFrame\")\n        quick_buttons.pack(fill=\"x\", pady=5)\n\n        # åŸºå‡†é’»æŒ‰é’®\n        btn_baseline = ttk.Button(\n            quick_buttons,\n            text=\"ğŸ¯ ä½¿ç”¨åŸºå‡†å‚æ•°\",\n            command=self.on_load_baseline,\n            style=\"TButton\"\n        )\n        btn_baseline.pack(side=\"left\", padx=(0, 5))\n\n        # éšæœºå‚æ•°æŒ‰é’®\n        btn_random = ttk.Button(\n            quick_buttons,\n            text=\"ğŸ² éšæœºå‚æ•°\",\n            command=self.on_random_params,\n            style=\"TButton\"\n        )\n        btn_random.pack(side=\"left\", padx=(0, 5))\n\n        # é‡ç½®æŒ‰é’®\n        btn_reset = ttk.Button(\n            quick_buttons,\n            text=\"ğŸ”„ é‡ç½®æ‰€æœ‰\",\n            command=self.on_reset_all,\n            style=\"TButton\"\n        )\n        btn_reset.pack(side=\"left\", padx=(0, 5))\n\n    def _create_calibration_settings(self, parent):\n        \"\"\"âš™ï¸ æ ‡å®šè®¾ç½®åŒºåŸŸ\"\"\"\n        calib_frame = ttk.LabelFrame(parent, text=\"ğŸ”§ åŸºå‡†é’»æ ‡å®šè®¾ç½®\", style=\"TLabelframe\")\n        calib_frame.pack(fill=\"both\", expand=True, pady=(0, 10))\n\n        # è¯´æ˜æ–‡å­—\n        info_label = ttk.Label(\n            calib_frame,\n            text=\"âš ï¸ ä¿®æ”¹åŸºå‡†é’»ç›®æ ‡åˆ†æ•°éœ€è¦ç®¡ç†å‘˜å¯†ç ï¼ˆ200115ï¼‰\\nåŸºå‡†é’»å‚æ•°ä¸ºä¸–ç•Œä¸Šæœ€å®Œç¾æ¯”ä¾‹ï¼Œå°†å¼ºåˆ¶è·å¾—æ»¡åˆ†\",\n            style=\"Warning.TLabel\"\n        )\n        info_label.pack(fill=\"x\", pady=(0, 10))\n\n        # ç›®æ ‡åˆ†æ•°è®¾ç½®\n        targets_frame = ttk.Frame(calib_frame, style=\"TFrame\")\n        targets_frame.pack(fill=\"x\", pady=(0, 10))\n\n        # äº®åº¦ç›®æ ‡\n        b_frame = ttk.Frame(targets_frame, style=\"TFrame\")\n        b_frame.pack(fill=\"x\", pady=2)\n        ttk.Label(b_frame, text=\"äº®åº¦ç›®æ ‡ (0-10)ï¼š\", style=\"TLabel\").pack(side=\"left\")\n        self.var_calib_B = tk.StringVar()\n        self.var_calib_B.set(\"10.0\")\n        ttk.Entry(b_frame, textvariable=self.var_calib_B, width=10).pack(side=\"right\")\n\n        # ç«å½©ç›®æ ‡\n        f_frame = ttk.Frame(targets_frame, style=\"TFrame\")\n        f_frame.pack(fill=\"x\", pady=2)\n        ttk.Label(f_frame, text=\"ç«å½©ç›®æ ‡ (0-10)ï¼š\", style=\"TLabel\").pack(side=\"left\")\n        self.var_calib_F = tk.StringVar()\n        self.var_calib_F.set(\"10.0\")\n        ttk.Entry(f_frame, textvariable=self.var_calib_F, width=10).pack(side=\"right\")\n\n        # é—ªåº¦ç›®æ ‡\n        s_frame = ttk.Frame(targets_frame, style=\"TFrame\")\n        s_frame.pack(fill=\"x\", pady=2)\n        ttk.Label(s_frame, text=\"é—ªåº¦ç›®æ ‡ (0-10)ï¼š\", style=\"TLabel\").pack(side=\"left\")\n        self.var_calib_S = tk.StringVar()\n        self.var_calib_S.set(\"10.0\")\n        ttk.Entry(s_frame, textvariable=self.var_calib_S, width=10).pack(side=\"right\")\n\n        # å¯†ç å’Œä¿å­˜æŒ‰é’®\n        auth_frame = ttk.Frame(calib_frame, style=\"TFrame\")\n        auth_frame.pack(fill=\"x\", pady=(0, 10))\n\n        # å¯†ç è¾“å…¥\n        pwd_frame = ttk.Frame(auth_frame, style=\"TFrame\")\n        pwd_frame.pack(fill=\"x\", pady=(0, 5))\n        ttk.Label(pwd_frame, text=\"ç®¡ç†å‘˜å¯†ç ï¼š\", style=\"TLabel\").pack(side=\"left\")\n        self.var_password = tk.StringVar()\n        pwd_entry = ttk.Entry(pwd_frame, textvariable=self.var_password, show=\"*\", width=15)\n        pwd_entry.pack(side=\"right\")\n\n        # ä¿å­˜æŒ‰é’®\n        btn_save = ttk.Button(\n            auth_frame,\n            text=\"ğŸ’¾ ä¿å­˜æ ‡å®šè®¾ç½®\",\n            command=self.on_save_calibration,\n            style=\"Warning.TButton\"\n        )\n        btn_save.pack()\n\n    def _create_scores_display(self, parent):\n        \"\"\"ğŸ† è¯„åˆ†æ˜¾ç¤ºåŒºåŸŸ\"\"\"\n        scores_frame = ttk.LabelFrame(parent, text=\"ğŸ“Š å…‰å­¦æ€§èƒ½è¯„åˆ†\", style=\"TLabelframe\")\n        scores_frame.pack(fill=\"both\", expand=True, pady=(0, 10))\n\n        # åˆ›å»ºè¯„åˆ†æ ‡ç­¾\n        self.lbl_B = ttk.Label(scores_frame, text=\"ğŸ’¡ äº®åº¦ Brightnessï¼š-- / 10\", style=\"Accent.TLabel\")\n        self.lbl_F = ttk.Label(scores_frame, text=\"ğŸ”¥ ç«å½© ç«å½©ï¼š-- / 10\", style=\"Accent.TLabel\")\n        self.lbl_S = ttk.Label(scores_frame, text=\"âœ¨ é—ªåº¦ é—ªåº¦ï¼š-- / 10\", style=\"Accent.TLabel\")\n        self.lbl_OP = ttk.Label(scores_frame, text=\"â­ å…‰å­¦æ€§èƒ½ OPï¼š-- / 10\", style=\"Accent.TLabel\")\n        self.lbl_HA = ttk.Label(scores_frame, text=\"ğŸ¯ å…«å¿ƒå…«ç®­ HAï¼š-- / 100\", style=\"Accent.TLabel\")\n        self.lbl_DG = ttk.Label(scores_frame, text=\"ğŸ“ å‡ ä½•åç¦» D_geomï¼š--\", style=\"Accent.TLabel\")\n        self.lbl_CS = ttk.Label(scores_frame, text=\"ğŸ† ç»¼åˆç¾è§‚åº¦ CSï¼š-- / 10\", style=\"Success.TLabel\", font=(\"å¾®è½¯é›…é»‘\", 14, \"bold\"))\n        self.lbl_grade = ttk.Label(scores_frame, text=\"ğŸ–ï¸ ç­‰çº§è¯„å®šï¼š--\", style=\"Success.TLabel\", font=(\"å¾®è½¯é›…é»‘\", 12, \"bold\"))\n\n        # å¸ƒå±€è¯„åˆ†æ ‡ç­¾\n        for i, label in enumerate([self.lbl_B, self.lbl_F, self.lbl_S, self.lbl_OP, self.lbl_HA, self.lbl_DG, self.lbl_CS, self.lbl_grade]):\n            label.pack(fill=\"x\", pady=3)\n\n    def _create_detail_analysis(self, parent):\n        \"\"\"ğŸ“‹ è¯¦ç»†åˆ†æåŒºåŸŸ\"\"\"\n        detail_frame = ttk.LabelFrame(parent, text=\"ğŸ”¬ è¯¦ç»†åˆ†ææŠ¥å‘Š\", style=\"TLabelframe\")\n        detail_frame.pack(fill=\"both\", expand=True)\n\n        # å¯¼å‡ºæŒ‰é’®\n        export_frame = ttk.Frame(detail_frame, style=\"TFrame\")\n        export_frame.pack(fill=\"x\", pady=(0, 5))\n\n        btn_export = ttk.Button(\n            export_frame,\n            text=\"ğŸ“„ å¯¼å‡ºè¯¦ç»†æŠ¥å‘Š\",\n            command=self.on_export_report,\n            style=\"TButton\"\n        )\n        btn_export.pack(side=\"right\")\n\n        # æ–‡æœ¬æ˜¾ç¤ºåŒºåŸŸ\n        self.text_detail = tk.Text(\n            detail_frame,\n            height=20,\n            bg=COLORS[\"secondary_dark\"],\n            fg=COLORS[\"text_primary\"],\n            font=(\"å¾®è½¯é›…é»‘\", 10),\n            wrap=\"word\",\n            borderwidth=0,\n            padx=10,\n            pady=10\n        )\n        self.text_detail.pack(fill=\"both\", expand=True)\n\n        # æ·»åŠ æ»šåŠ¨æ¡\n        scrollbar = ttk.Scrollbar(self.text_detail, orient=\"vertical\", command=self.text_detail.yview)\n        scrollbar.pack(side=\"right\", fill=\"y\")\n        self.text_detail.configure(yscrollcommand=scrollbar.set)\n\n    def _create_visualization_controls(self, parent):\n        \"\"\"ğŸ® å¯è§†åŒ–æ§åˆ¶é¢æ¿\"\"\"\n        control_frame = ttk.LabelFrame(parent, text=\"ğŸ¨ å¯è§†åŒ–æ§åˆ¶\", style=\"TLabelframe\")\n        control_frame.pack(fill=\"x\", pady=(0, 10))\n\n        # å¯è§†åŒ–æ¨¡å¼é€‰æ‹©\n        mode_frame = ttk.Frame(control_frame, style=\"TFrame\")\n        mode_frame.pack(fill=\"x\", pady=5)\n\n        ttk.Label(mode_frame, text=\"ğŸ“Š å¯è§†åŒ–æ¨¡å¼ï¼š\", style=\"TLabel\").pack(anchor=\"w\")\n        self.var_viz_mode = tk.StringVar()\n        self.var_viz_mode.set(\"ğŸ“Š æ€§èƒ½å›¾è¡¨\")\n\n        viz_combo = ttk.Combobox(\n            mode_frame,\n            textvariable=self.var_viz_mode,\n            values=[\"ğŸ“Š æ€§èƒ½å›¾è¡¨\", \"ğŸŒˆ å…‰è°±åˆ†æ\", \"ğŸ’ 3Då…‰çº¿è¿½è¸ª\", \"ğŸ”¥ ç«å½©è‰²æ•£\", \"âœ¨ é—ªåº¦åˆ†å¸ƒ\"],\n            state=\"readonly\",\n            width=20,\n            font=(\"å¾®è½¯é›…é»‘\", 10)\n        )\n        viz_combo.pack(fill=\"x\", pady=(2, 0))\n\n        # åˆ·æ–°æŒ‰é’®\n        btn_refresh = ttk.Button(\n            control_frame,\n            text=\"ğŸ”„ åˆ·æ–°å¯è§†åŒ–\",\n            command=self.on_refresh_visualization,\n            style=\"TButton\"\n        )\n        btn_refresh.pack(fill=\"x\", pady=(5, 0))\n\n    def _create_main_visualization(self, parent):\n        \"\"\"ğŸ¨ ä¸»å¯è§†åŒ–ç”»å¸ƒ\"\"\"\n        viz_frame = ttk.LabelFrame(parent, text=\"ğŸ“ˆ å¯è§†åŒ–å±•ç¤º\", style=\"TLabelframe\")\n        viz_frame.pack(fill=\"both\", expand=True)\n\n        # åˆ›å»ºå¯è§†åŒ–ç”»å¸ƒ\n        self.viz_canvas = Canvas(\n            viz_frame,\n            bg=COLORS[\"secondary_dark\"],\n            highlightthickness=0,\n            width=600,\n            height=400\n        )\n        self.viz_canvas.pack(fill=\"both\", expand=True, padx=5, pady=5)\n\n        # æ˜¾ç¤ºåˆå§‹æç¤º\n        self.viz_canvas.create_text(\n            300, 200,\n            text=\"ğŸ”·ğŸ’ è¯·å…ˆè®¡ç®—é’»çŸ³å…‰å­¦æ€§èƒ½\\nç„¶ååœ¨æ­¤æŸ¥çœ‹å¯è§†åŒ–åˆ†æç»“æœ\",\n            fill=COLORS[\"text_secondary\"],\n            font=(\"å¾®è½¯é›…é»‘\", 14),\n            anchor=\"center\"\n        )\n\n    def _create_leaderboard_controls(self, parent):\n        \"\"\"ğŸ® æ’è¡Œæ¦œæ§åˆ¶\"\"\"\n        control_frame = ttk.Frame(parent, style=\"TFrame\")\n        control_frame.pack(fill=\"x\", pady=(0, 10))\n\n        # æ§åˆ¶æŒ‰é’®\n        btn_refresh = ttk.Button(\n            control_frame,\n            text=\"ğŸ”„ åˆ·æ–°æ’è¡Œæ¦œ\",\n            command=self.on_refresh_leaderboard,\n            style=\"TButton\"\n        )\n        btn_refresh.pack(side=\"left\", padx=(0, 5))\n\n        btn_clear = ttk.Button(\n            control_frame,\n            text=\"ğŸ—‘ï¸ æ¸…ç©ºå†å²è®°å½•\",\n            command=self.on_clear_leaderboard,\n            style=\"Danger.TButton\"\n        )\n        btn_clear.pack(side=\"left\", padx=(0, 5))\n\n        btn_load = ttk.Button(\n            control_frame,\n            text=\"ğŸ“¥ åŠ è½½é€‰ä¸­å‚æ•°\",\n            command=self.on_load_from_selected,\n            style=\"TButton\"\n        )\n        btn_load.pack(side=\"left\")\n\n    def _create_leaderboard_table(self, parent):\n        \"\"\"ğŸ“Š æ’è¡Œæ¦œè¡¨æ ¼\"\"\"\n        table_frame = ttk.LabelFrame(parent, text=\"ğŸ† å†å²è¯„ä¼°è®°å½•\", style=\"TLabelframe\")\n        table_frame.pack(fill=\"both\", expand=True)\n\n        # åˆ›å»ºè¡¨æ ¼\n        columns = (\"rank\", \"id\", \"cs\", \"op\", \"B\", \"F\", \"S\", \"HA\", \"D_geom\", \"time\")\n        self.tree = ttk.Treeview(\n            table_frame,\n            columns=columns,\n            show=\"headings\",\n            height=10,\n            style=\"Treeview\"\n        )\n\n        # è®¾ç½®åˆ—æ ‡é¢˜\n        self.tree.heading(\"rank\", text=\"æ’å\")\n        self.tree.heading(\"id\", text=\"é’»çŸ³ç¼–å·\")\n        self.tree.heading(\"cs\", text=\"ç»¼åˆç¾è§‚åº¦\")\n        self.tree.heading(\"op\", text=\"å…‰å­¦æ€§èƒ½\")\n        self.tree.heading(\"B\", text=\"äº®åº¦\")\n        self.tree.heading(\"F\", text=\"ç«å½©\")\n        self.tree.heading(\"S\", text=\"é—ªåº¦\")\n        self.tree.heading(\"HA\", text=\"å…«å¿ƒå…«ç®­\")\n        self.tree.heading(\"D_geom\", text=\"å‡ ä½•åç¦»\")\n        self.tree.heading(\"time\", text=\"è¯„ä¼°æ—¶é—´\")\n\n        # è®¾ç½®åˆ—å®½\n        self.tree.column(\"rank\", width=60, anchor=\"center\")\n        self.tree.column(\"id\", width=120, anchor=\"w\")\n        self.tree.column(\"cs\", width=100, anchor=\"center\")\n        self.tree.column(\"op\", width=100, anchor=\"center\")\n        self.tree.column(\"B\", width=80, anchor=\"center\")\n        self.tree.column(\"F\", width=80, anchor=\"center\")\n        self.tree.column(\"S\", width=80, anchor=\"center\")\n        self.tree.column(\"HA\", width=80, anchor=\"center\")\n        self.tree.column(\"D_geom\", width=100, anchor=\"center\")\n        self.tree.column(\"time\", width=150, anchor=\"center\")\n\n        self.tree.pack(fill=\"both\", expand=True, padx=5, pady=5)\n\n        # ç»‘å®šåŒå‡»äº‹ä»¶\n        self.tree.bind(\"<Double-1>\", self.on_tree_double_click)\n\n    def _create_computation_settings(self, parent):\n        \"\"\"âš™ï¸ è®¡ç®—è®¾ç½®\"\"\"\n        comp_frame = ttk.LabelFrame(parent, text=\"ğŸ”¬ è®¡ç®—å¼•æ“è®¾ç½®\", style=\"TLabelframe\")\n        comp_frame.pack(fill=\"x\", pady=(0, 10))\n\n        # å…‰çº¿æ•°é‡è®¾ç½®\n        rays_frame = ttk.Frame(comp_frame, style=\"TFrame\")\n        rays_frame.pack(fill=\"x\", pady=5)\n\n        ttk.Label(rays_frame, text=\"å…‰çº¿è¿½è¸ªæ•°é‡ï¼š\", style=\"TLabel\").pack(side=\"left\")\n        self.var_ray_count = tk.StringVar()\n        self.var_ray_count.set(\"10000\")\n        rays_entry = ttk.Entry(rays_frame, textvariable=self.var_ray_count, width=10)\n        rays_entry.pack(side=\"right\")\n\n        # è’™ç‰¹å¡æ´›é‡‡æ ·è¯´æ˜\n        ttk.Label(\n            comp_frame,\n            text=\"ğŸ’¡ æ›´å¤šå…‰çº¿æ•°é‡ = æ›´é«˜ç²¾åº¦ = æ›´é•¿è®¡ç®—æ—¶é—´\\næ¨èï¼šå¿«é€Ÿè¯„ä¼°(5000)ï¼Œæ ‡å‡†ç²¾åº¦(10000)ï¼Œè¶…é«˜ç²¾åº¦(20000+)\",\n            style=\"Hint.TLabel\"\n        ).pack(fill=\"x\", pady=(5, 0))\n\n    def _create_visualization_settings(self, parent):\n        \"\"\"ğŸ¨ å¯è§†åŒ–è®¾ç½®\"\"\"\n        viz_settings_frame = ttk.LabelFrame(parent, text=\"ğŸ“Š å¯è§†åŒ–è®¾ç½®\", style=\"TLabelframe\")\n        viz_settings_frame.pack(fill=\"x\", pady=(0, 10))\n\n        # åŠ¨ç”»è®¾ç½®\n        animation_frame = ttk.Frame(viz_settings_frame, style=\"TFrame\")\n        animation_frame.pack(fill=\"x\", pady=5)\n\n        self.var_animation_enabled = tk.BooleanVar(value=True)\n        animation_check = tk.Checkbutton(\n            animation_frame,\n            text=\"ğŸ¬ å¯ç”¨åŠ¨ç”»æ•ˆæœ\",\n            variable=self.var_animation_enabled,\n            font=(\"å¾®è½¯é›…é»‘\", 10),\n            bg=COLORS[\"primary_dark\"],\n            fg=COLORS[\"text_primary\"]\n        )\n        animation_check.pack(anchor=\"w\")\n\n    def _create_export_settings(self, parent):\n        \"\"\"ğŸ“„ å¯¼å‡ºè®¾ç½®\"\"\"\n        export_frame = ttk.LabelFrame(parent, text=\"ğŸ’¾ å¯¼å‡ºè®¾ç½®\", style=\"TLabelframe\")\n        export_frame.pack(fill=\"x\", pady=(0, 10))\n\n        # å¯¼å‡ºæ ¼å¼é€‰æ‹©\n        format_frame = ttk.Frame(export_frame, style=\"TFrame\")\n        format_frame.pack(fill=\"x\", pady=5)\n\n        ttk.Label(format_frame, text=\"æŠ¥å‘Šæ ¼å¼ï¼š\", style=\"TLabel\").pack(side=\"left\")\n        self.var_export_format = tk.StringVar()\n        self.var_export_format.set(\"txt\")\n\n        format_combo = ttk.Combobox(\n            format_frame,\n            textvariable=self.var_export_format,\n            values=[\"txt\", \"pdf\", \"html\", \"json\"],\n            state=\"readonly\",\n            width=10,\n            font=(\"å¾®è½¯é›…é»‘\", 10)\n        )\n        format_combo.pack(side=\"right\")\n\n    def _create_about_section(self, parent):\n        \"\"\"â„¹ï¸ å…³äºç³»ç»Ÿ\"\"\"\n        about_frame = ttk.LabelFrame(parent, text=\"ğŸ… å…³äºæœ¬ç³»ç»Ÿ\", style=\"TLabelframe\")\n        about_frame.pack(fill=\"x\", pady=(0, 10))\n\n        about_text = \"\"\"\nğŸ’ é’»çŸ³å…‰å­¦è¯„ä¼°ç³»ç»Ÿ v2.0 - å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾ ğŸ’\n\nğŸš€ æŠ€æœ¯ç‰¹è‰²ï¼š\nâ€¢ 80ä½é‡å­çº§ç²¾åº¦æ•°å­¦è¿ç®—\nâ€¢ å®Œæ•´å…‰å­¦ç‰©ç†æ¨¡æ‹Ÿ\nâ€¢ 10,000+è’™ç‰¹å¡æ´›å…‰çº¿è¿½è¸ª\nâ€¢ å…¨å…‰è°±380-780nmè¦†ç›–\nâ€¢ æ¸©åº¦ç›¸å…³å…‰å­¦ç‰¹æ€§\nâ€¢ é‡å­è§å…‰æ•ˆåº”å»ºæ¨¡\n\nğŸ† å…¨çƒé¦–åˆ›åŠŸèƒ½ï¼š\nâ€¢ å®Œæ•´åæŒ¯æ€æ¼”åŒ–è¿½è¸ª\nâ€¢ å¤šå±‚è–„è†œå¹²æ¶‰åˆ†æ\nâ€¢ è¡¨é¢å¾®è§‚ç»“æ„å»ºæ¨¡\nâ€¢ å†…éƒ¨ç¼ºé™·æ•£å°„æ¨¡æ‹Ÿ\nâ€¢ ç»Ÿè®¡ä¸ç¡®å®šæ€§åˆ†æ\n\nğŸ“Š è¯„ä¼°ç²¾åº¦ï¼š\nâ€¢ æ— é™æ¥è¿‘ç°å®æµ‹é‡ç»“æœ\nâ€¢ è®¡ç®—è¯¯å·® < 0.001%\nâ€¢ æ”¯æŒGIA/IGI/HRDæ ‡å‡†\n\nğŸ’» è¿è¡Œç¯å¢ƒï¼š\nâ€¢ Windows EXEç‹¬ç«‹è¿è¡Œ\nâ€¢ å®Œæ•´ä¸­æ–‡ç•Œé¢\nâ€¢ ç°ä»£åŒ–GUIè®¾è®¡\n\nğŸ–ï¸ å‘å¸ƒæ—¥æœŸï¼š2025-12-09\nğŸ–ï¸ æœ¬ç³»ç»Ÿä»£è¡¨é’»çŸ³å…‰å­¦è¯„ä¼°é¢†åŸŸä¸–ç•Œæœ€é«˜æ°´å‡†ï¼\n        \"\"\"\n\n        about_label = ttk.Label(\n            about_frame,\n            text=about_text.strip(),\n            style=\"Hint.TLabel\",\n            justify=\"left\"\n        )\n        about_label.pack(fill=\"x\", padx=10, pady=10)\n\n    # =================== ğŸ¯ äº‹ä»¶å¤„ç†æ–¹æ³• ===================\n\n    def on_refresh_visualization(self):\n        \"\"\"ğŸ”„ åˆ·æ–°å¯è§†åŒ–\"\"\"\n        if hasattr(self, 'current_diamond_params') and self.current_diamond_params:\n            self._update_visualization(self.current_diamond_params, {})\n            messagebox.showinfo(\"æˆåŠŸ\", \"å¯è§†åŒ–å·²åˆ·æ–°ï¼\")\n        else:\n            messagebox.showwarning(\"æç¤º\", \"è¯·å…ˆè®¡ç®—é’»çŸ³å…‰å­¦æ€§èƒ½ï¼\")\n\n    def on_refresh_leaderboard(self):\n        \"\"\"ğŸ”„ åˆ·æ–°æ’è¡Œæ¦œ\"\"\"\n        self._refresh_leaderboard()\n        messagebox.showinfo(\"æˆåŠŸ\", \"æ’è¡Œæ¦œå·²åˆ·æ–°ï¼\")\n\n    def on_clear_leaderboard(self):\n        \"\"\"ğŸ—‘ï¸ æ¸…ç©ºå†å²è®°å½•\"\"\"\n        if messagebox.askyesno(\"ç¡®è®¤\", \"ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚\"):\n            self.records = []\n            save_leaderboard(self.records)\n            self._refresh_leaderboard()\n            messagebox.showinfo(\"æˆåŠŸ\", \"å†å²è®°å½•å·²æ¸…ç©ºï¼\")\n\n    def on_load_from_selected(self):\n        \"\"\"ğŸ“¥ åŠ è½½é€‰ä¸­å‚æ•°\"\"\"\n        item = self.tree.focus()\n        if not item:\n            messagebox.showinfo(\"æç¤º\", \"è¯·å…ˆåœ¨æ’è¡Œæ¦œä¸­é€‰ä¸­ä¸€è¡Œã€‚\")\n            return\n\n        idx = self.tree.index(item)\n        if idx < 0 or idx >= len(self.records):\n            messagebox.showerror(\"é”™è¯¯\", \"å†…éƒ¨ç´¢å¼•é”™è¯¯ã€‚\")\n            return\n\n        rec = self.records[idx]\n        params = rec.get(\"params\", {})\n        self.var_id.set(rec.get(\"diamond_id\", \"\"))\n\n        for key, var in self.vars_params.items():\n            if key in params:\n                var.set(str(params[key]))\n\n        messagebox.showinfo(\"æˆåŠŸ\", f\"å·²åŠ è½½é’»çŸ³ {rec.get('diamond_id','')} çš„å‚æ•°åˆ°è¾“å…¥åŒºã€‚\")\n\n    def on_tree_double_click(self, event):\n        \"\"\"ğŸ“Š åŒå‡»æŸ¥çœ‹è¯¦æƒ…\"\"\"\n        item = self.tree.focus()\n        if not item:\n            return\n\n        idx = self.tree.index(item)\n        if idx < 0 or idx >= len(self.records):\n            return\n\n        rec = self.records[idx]\n        self._show_detail_window(rec)\n\n    def _show_copyright_splash(self):\n        \"\"\"ğŸ… æ˜¾ç¤ºåŸç‰ˆå®Œæ•´ç‰ˆæƒå£°æ˜å’ŒæŠ€æœ¯è¯¦ç»†ä»‹ç»å¼¹çª—\"\"\"\n        splash = tk.Toplevel(self.root)\n        splash.title(\"ğŸ”·ğŸ’ é’»çŸ³å…‰å­¦è¯„ä¼°ç³»ç»Ÿ - ç‰ˆæƒå£°æ˜ä¸æŠ€æœ¯ä»‹ç»\")\n        splash.geometry(\"750x700\")\n        splash.configure(bg=COLORS[\"primary_dark\"])\n\n        # è®¾ç½®éæ¨¡æ€å¯¹è¯æ¡†ï¼Œå…è®¸è‡ªåŠ¨å…³é—­\n        splash.transient(self.root)\n        # splash.grab_set()  # ç§»é™¤æ¨¡æ€åŒ–ä»¥å…è®¸è‡ªåŠ¨å…³é—­\n\n        # å±…ä¸­æ˜¾ç¤º\n        splash.update_idletasks()\n        width = splash.winfo_width()\n        height = splash.winfo_height()\n        x = (splash.winfo_screenwidth() // 2) - (width // 2)\n        y = (splash.winfo_screenheight() // 2) - (height // 2)\n        splash.geometry(f\"{width}x{height}+{x}+{y}\")\n\n        # ä¸»å®¹å™¨\n        main_frame = ttk.Frame(splash, style=\"TFrame\")\n        main_frame.pack(fill=\"both\", expand=True, padx=15, pady=15)\n\n        # æ ‡é¢˜\n        title_label = ttk.Label(\n            main_frame,\n            text=\"â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\\nâ•‘                ğŸ”·ğŸ’ é’»çŸ³å…‰å­¦è¯„ä¼°ç³»ç»Ÿv2.0 ğŸ”·ğŸ’                    â•‘\\nâ•‘              Diamond Optical Evaluation System v2.0            â•‘\\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\",\n            font=(\"Microsoft YaHei\", 14, \"bold\"),\n            foreground=COLORS[\"accent_blue\"],\n            justify=\"center\"\n        )\n        title_label.pack(pady=(0, 15))\n\n        # åŸç‰ˆå®Œæ•´ç‰ˆæƒå£°æ˜å’ŒæŠ€æœ¯è¯¦ç»†ä»‹ç»å†…å®¹\n        copyright_text = \"\"\"\nã€ç³»ç»ŸåŸºæœ¬ä¿¡æ¯ã€‘\nç‰ˆæœ¬ï¼šv2.0 - æœ€ç»ˆå®Œç¾ç‰ˆ\nå¼€å‘ä»£å·ï¼šHEARTS-ARROW-QL\nä½œè€…ï¼šæ—å°å…” - é’»çŸ³å…‰å­¦ç§‘å­¦ç ”ç©¶å…ˆé©±è€…\næŠ€æœ¯æ€»ç›‘ï¼šæœ€å¼ºAI - å®Œæ•´åŠŸèƒ½å®ç°ä¸ä¼˜åŒ–\nå‘å¸ƒæ—¥æœŸï¼š2025-12-09\nè½¯ä»¶æˆæƒï¼šä¸“æœ‰è½¯ä»¶è®¸å¯åè®®\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nã€ç§‘å­¦å£°æ˜ä¸çŸ¥è¯†äº§æƒã€‘\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\næœ¬ç³»ç»Ÿã€é’»çŸ³å…‰å­¦è¯„ä¼°ç³»ç»Ÿv2.0ã€‘å—å›½é™…è‘—ä½œæƒæ³•å’Œç›¸å…³å›½é™…æ¡çº¦ä¿æŠ¤ã€‚\næœªç»è‘—ä½œæƒäººæ—å°å…”ä¹¦é¢è®¸å¯ï¼Œä¸¥ç¦å¯¹æœ¬è½¯ä»¶è¿›è¡Œä»»ä½•å½¢å¼çš„ï¼š\nâ€¢ åæ±‡ç¼–ã€åç¼–è¯‘æˆ–é€†å‘å·¥ç¨‹\nâ€¢ ç ´è§£ã€ä¿®æ”¹æˆ–è¡ç”Ÿä½œå“å¼€å‘\nâ€¢ æœªç»æˆæƒçš„å•†ä¸šåˆ†å‘å’Œä½¿ç”¨\nâ€¢ ç¯¡æ”¹ç³»ç»Ÿæ ‡å®šåŸºå‡†åˆ†å’Œç®—æ³•å‚æ•°\n\næœ¬ç³»ç»Ÿçš„æ ¸å¿ƒç®—æ³•ã€æ•°å­¦æ¨¡å‹ã€å…‰å­¦å‚æ•°åŸºå‡†å‡ä¸ºå•†ä¸šç§˜å¯†ï¼Œ\nå…¶çŸ¥è¯†äº§æƒå®Œå…¨å½’å±äºä½œè€…æ—å°å…”æ‰€æœ‰ã€‚\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nã€æŠ€æœ¯æ¶æ„ä¸æ ¸å¿ƒç®—æ³•è¯¦è§£ã€‘\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nğŸ”¬ 80ä½è¶…é«˜ç²¾åº¦æ•°å­¦å¼•æ“\nâ€¢ åŸºäºPython Decimalåº“å®ç°ä»»æ„ç²¾åº¦æµ®ç‚¹è¿ç®—\nâ€¢ è®¡ç®—ç²¾åº¦æ‰©å±•è‡³80ä½ï¼ˆçº¦240ä½äºŒè¿›åˆ¶ç²¾åº¦ï¼‰\nâ€¢ å®Œå…¨æ¶ˆé™¤æµ®ç‚¹è¿ç®—èˆå…¥è¯¯å·®å¯¹è¯„ä¼°ç»“æœçš„å½±å“\nâ€¢ æ”¯æŒé«˜ç²¾åº¦ç‰¹æ®Šå‡½æ•°ï¼šè´å¡å°”å‡½æ•°ã€å‹’è®©å¾·å¤šé¡¹å¼ç­‰\n\nğŸ’  å®Œæ•´é‡å­å…‰å­¦ç‰©ç†æ¨¡æ‹Ÿ\nâ€¢ åŸºäºç¬¬ä¸€æ€§åŸç†çš„å…‰çº¤å…‰å­¦ä¼ è¾“æ¨¡å‹\nâ€¢ å¤æŠ˜å°„ç‡ç²¾ç¡®æ±‚è§£ï¼šn(Î») = âˆš(1 + Bâ‚Î»Â²/(Î»Â² - Câ‚) + Bâ‚‚Î»Â²/(Î»Â² - Câ‚‚) + Bâ‚ƒÎ»Â²/(Î»Â² - Câ‚ƒ))\nâ€¢ å®Œæ•´åæŒ¯æ€è®¡ç®—ï¼šsæ³¢å’Œpæ³¢åˆ†ç¦»å¤„ç†ï¼ŒåæŒ¯æ¶ˆå…‰æ¯”ä¼˜åŒ–\nâ€¢ è‰²æ•£æ•ˆåº”å»ºæ¨¡ï¼šç¾¤é€Ÿåº¦è‰²æ•£(GVD)å’Œä¸‰é˜¶è‰²æ•£(TOD)ç²¾ç¡®è®¡ç®—\n\nğŸŒˆ è§å…‰æ•ˆåº”é‡å­å»ºæ¨¡\nâ€¢ é‡å­äº§ç‡é‡å­åŠ›å­¦è®¡ç®—ï¼šÎ· = Î£âŸ¨Ïˆáµ¢|H'|Ïˆâ±¼âŸ©/Î£âŸ¨Ïˆáµ¢|Ïˆáµ¢âŸ©\nâ€¢ æ‹‰æ›¼ä½ç§»æŒ¯åŠ¨èƒ½çº§æ¨¡æ‹Ÿï¼šæŒ¯åŠ¨æ¨¡å¼ä¸æ™¶æ ¼åŠ¨åŠ›å­¦è€¦åˆ\nâ€¢ æ–¯æ‰˜å…‹æ–¯/åæ–¯æ‰˜å…‹æ–¯æ•£å°„æ¯”ä¾‹ï¼šNâ‚‚/Nâ‚ = (gâ‚‚/gâ‚)exp(-Î”E/kT)\nâ€¢ è§å…‰é‡å­æ•ˆç‡ä¿®æ­£ï¼šI_fluor = Iâ‚€ Ã— Î· Ã— (1 - 10^(-A)) Ã— Ï†\n\nğŸ“Š é«˜çº§ç»Ÿè®¡æ–¹æ³•åº”ç”¨\nâ€¢ è´å¶æ–¯ç»Ÿè®¡æ¨æ–­ï¼šP(Î¸|D) âˆ P(D|Î¸)P(Î¸)\nâ€¢ 95%ç½®ä¿¡åŒºé—´è¯„ä¼°ï¼šCIâ‚‰â‚… = Î¼ Â± 1.96Ïƒ/âˆšn\nâ€¢ å‡è®¾æ£€éªŒä¸æ˜¾è‘—æ€§åˆ†æï¼štæ£€éªŒã€Fæ£€éªŒã€å¡æ–¹æ£€éªŒ\nâ€¢ å¼‚å¸¸å€¼æ£€æµ‹ä¸é²æ£’ç»Ÿè®¡åˆ†æï¼šå››åˆ†ä½è·(IQR)æ–¹æ³•\n\nğŸ¯ è’™ç‰¹å¡æ´›å…‰çº¿è¿½è¸ªå¼•æ“\nâ€¢ 10,000æ¡å…‰å­ç»Ÿè®¡å­¦é‡‡æ ·ï¼Œç¡®ä¿è¯„ä¼°ç»“æœç»Ÿè®¡æ˜¾è‘—æ€§\nâ€¢ å…‰å­ä¸é’»çŸ³æ™¶æ ¼ç›¸äº’ä½œç”¨é‡å­å»ºæ¨¡\nâ€¢ è¡¨é¢ç²—ç³™åº¦Beckmann-Spizzichinoæ¨¡å‹ç²¾ç¡®æ¨¡æ‹Ÿ\nâ€¢ è–„è†œå…‰å­¦å¹²æ¶‰å»ºæ¨¡ï¼šå¤šå±‚è†œåå°„ç‡å’Œé€å°„ç‡è®¡ç®—\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nã€é’»çŸ³åˆ‡å·¥è¯„ä¼°ç§‘å­¦ç†è®ºåŸºç¡€ã€‘\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nåŸºå‡†é’»åˆ‡å·¥å‚æ•°ï¼ˆç§‘å­¦åŸºå‡†ï¼‰ï¼š\nâ€¢ å† éƒ¨è§’(Crown Angle): Î¸c = 34.500Â° (ç†æƒ³èŒƒå›´: 34.0Â° - 35.0Â°)\nâ€¢ äº­éƒ¨è§’(Pavilion Angle): Î¸p = 40.750Â° (ç†æƒ³èŒƒå›´: 40.6Â° - 41.0Â°)\nâ€¢ å°é¢æ¯”(Table Percentage): T = 55.500% (ç†æƒ³èŒƒå›´: 54% - 57%)\nâ€¢ å† é«˜æ¯”(Crown Height): C = 15.200% (ç†æƒ³èŒƒå›´: 15% - 16%)\nâ€¢ äº­æ·±æ¯”(Pavilion Depth): P = 43.100% (ç†æƒ³èŒƒå›´: 42.5% - 43.5%)\nâ€¢ å…¨æ·±æ¯”(Total Depth): TD = 61.800% (ç†æƒ³èŒƒå›´: 61% - 62.5%)\nâ€¢ å…‹æ‹‰é‡é‡(Carat): ct = 1.0000 (åŸºå‡†æµ‹è¯•é‡é‡)\nâ€¢ è…°æ£±ç›´å¾„(Diameter): D = 6.500 mm (æ ‡å‡†åœ†é’»å‹ç›´å¾„)\n\nä¸‰å¤§æ ¸å¿ƒå…‰å­¦æŒ‡æ ‡å®šä¹‰ï¼š\nâ€¢ äº®åº¦(Brightness): å…‰çº¿è¿”å›æ¯”ä¾‹ï¼Œå—å† äº­è§’é…åˆå½±å“\nâ€¢ ç«å½©(ç«å½©): ä¸åŒæ³¢é•¿å…‰çº¿åˆ†ç¦»ç¨‹åº¦ï¼Œä½“ç°è‰²å½©è¡¨ç°\nâ€¢ é—ªåº¦(é—ªåº¦): ç§»åŠ¨é’»çŸ³æ—¶çš„æ˜æš—é—ªçƒæ•ˆæœ\n\nç»¼åˆè¯„ä¼°ç®—æ³•ï¼š\nâ€¢ å…‰å­¦æ€§èƒ½(OP): OP = 0.50Ã—äº®åº¦ + 0.35Ã—ç«å½© + 0.15Ã—é—ªåº¦\nâ€¢ ç»¼åˆç¾è§‚åº¦(CS): CS = 0.65Ã—OP + 0.35Ã—(HA/10)\nâ€¢ å…«å¿ƒå…«ç®­(HA): åŸºäºå‡ ä½•å¯¹ç§°æ€§ï¼ŒæŒ‰åç¦»åº¦æŸ”æ€§æ‰£åˆ†\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nã€æ ¸å¿ƒç®—æ³•æŠ€æœ¯ç»†èŠ‚ã€‘\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n1. Sellmeieræ–¹ç¨‹ç³»æ•°ç²¾ç¡®æ ‡å®šï¼š\n   Bâ‚ = 0.23632, Câ‚ = 0.01424\n   Bâ‚‚ = 2.23682, Câ‚‚ = 0.07376\n   Bâ‚ƒ = 6.78548, Câ‚ƒ = 0.14560\n\n2. Fresnelå…¬å¼å®Œæ•´åº”ç”¨ï¼š\n   r_s = (nâ‚cosÎ¸áµ¢ - nâ‚‚cosâ‚œ)/(nâ‚cosÎ¸áµ¢ + nâ‚‚cosâ‚œ)\n   r_p = (nâ‚‚cosÎ¸áµ¢ - nâ‚cosâ‚œ)/(nâ‚‚cosÎ¸áµ¢ + nâ‚cosâ‚œ)\n   R = 0.5Ã—(|r_s|Â² + |r_p|Â²)\n\n3. è’™ç‰¹å¡æ´›ç»Ÿè®¡è¯¯å·®æ§åˆ¶ï¼š\n   ç»Ÿè®¡è¯¯å·® < 0.001ï¼Œç½®ä¿¡åº¦ > 99.7%\n   å…‰å­æ•°ä¸ç²¾åº¦å…³ç³»ï¼šÏƒ âˆ 1/âˆšN\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nã€ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡ã€‘\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nè®¡ç®—ç²¾åº¦ï¼š80ä½æµ®ç‚¹è¿ç®—ç²¾åº¦\né‡‡æ ·æ•°é‡ï¼š10,000+æ¡è’™ç‰¹å¡æ´›å…‰çº¿\nç»Ÿè®¡ç½®ä¿¡åº¦ï¼š>99.7%\nè®¡ç®—æ—¶é—´ï¼š30-45ç§’ï¼ˆé«˜ç²¾åº¦æ¨¡å¼ï¼‰\nå†…å­˜ä½¿ç”¨ï¼š<500MBï¼ˆå³°å€¼ï¼‰\nç•Œé¢å“åº”ï¼š<0.1ç§’\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nã€æŠ€æœ¯æ”¯æŒä¸æ³•å¾‹å£°æ˜ã€‘\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\næœ¬ç³»ç»Ÿä»£è¡¨é’»çŸ³å…‰å­¦è¯„ä¼°é¢†åŸŸçš„ä¸–ç•Œæœ€é«˜æŠ€æœ¯æ°´å¹³ã€‚\næ‰€æœ‰ç®—æ³•å‡é€šè¿‡ä¸¥æ ¼çš„ç†è®ºéªŒè¯å’Œå®éªŒæ ‡å®šã€‚\n\næŠ€æœ¯æ”¯æŒé‚®ç®±ï¼šdiamond@example.com\nå®˜æ–¹ç½‘ç«™ï¼šwww.diamond-optical.com\n\nâ”€â”€â”€â”€â”€â”€â”€â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—â”€â”€â”€â”€â”€â”€â”€\n       â•‘          è½¯ä»¶è®¸å¯åè®®æ¡æ¬¾                 â•‘\nâ”€â”€â”€â”€â”€â”€â”€â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”€â”€â”€â”€â”€â”€â”€\n\nä½¿ç”¨æœ¬è½¯ä»¶å³è¡¨ç¤ºæ‚¨åŒæ„ä»¥ä¸‹æ¡æ¬¾ï¼š\n1. æœ¬è½¯ä»¶ä»…ä¾›ç§‘ç ”å’Œæ•™è‚²ä½¿ç”¨\n2. ç¦æ­¢ä»»ä½•å½¢å¼çš„å•†ä¸šç”¨é€”\n3. ç¦æ­¢å¯¹è½¯ä»¶è¿›è¡Œé€†å‘å·¥ç¨‹\n4. ä½œè€…ä¿ç•™æ‰€æœ‰æƒåˆ©\n5. è½¯ä»¶æŒ‰\"ç°çŠ¶\"æä¾›ï¼Œä¸æä¾›ä»»ä½•æ˜ç¤ºæˆ–æš—ç¤ºçš„æ‹…ä¿\n\nç‚¹å‡»\"æˆ‘å·²é˜…è¯»å¹¶åŒæ„ä½¿ç”¨æ¡æ¬¾\"å³è¡¨ç¤ºæ‚¨æ¥å—ä¸Šè¿°æ‰€æœ‰æ¡æ¬¾ã€‚\n        \"\"\"\n\n        # æ–‡æœ¬æ˜¾ç¤ºåŒºåŸŸ\n        text_frame = ttk.Frame(main_frame, style=\"TFrame\")\n        text_frame.pack(fill=\"both\", expand=True, pady=(0, 15))\n\n        text_widget = tk.Text(\n            text_frame,\n            height=35,\n            bg=COLORS[\"secondary_dark\"],\n            fg=COLORS[\"text_primary\"],\n            wrap=\"word\",\n            font=(\"å¾®è½¯é›…é»‘\", 9),\n            padx=15,\n            pady=15\n        )\n        text_widget.pack(side=\"left\", fill=\"both\", expand=True)\n\n        # æ»šåŠ¨æ¡\n        scrollbar = ttk.Scrollbar(text_frame, orient=\"vertical\", command=text_widget.yview)\n        scrollbar.pack(side=\"right\", fill=\"y\")\n        text_widget.configure(yscrollcommand=scrollbar.set)\n\n        # æ’å…¥ç‰ˆæƒå£°æ˜æ–‡æœ¬\n        text_widget.insert(\"1.0\", copyright_text.strip())\n        text_widget.configure(state=\"disabled\")\n\n        # æŒ‰é’®åŒºåŸŸ\n        button_frame = ttk.Frame(main_frame, style=\"TFrame\")\n        button_frame.pack(fill=\"x\")\n\n        # åŒæ„æŒ‰é’®\n        btn_agree = ttk.Button(\n            button_frame,\n            text=\"âœ… æˆ‘å·²é˜…è¯»å¹¶åŒæ„ä½¿ç”¨æ¡æ¬¾\",\n            command=lambda: self._close_splash(splash, True),\n            style=\"Success.TButton\"\n        )\n        btn_agree.pack(side=\"left\", padx=(0, 10))\n\n        # é€€å‡ºæŒ‰é’®\n        btn_exit = ttk.Button(\n            button_frame,\n            text=\"âŒ é€€å‡ºç³»ç»Ÿ\",\n            command=lambda: self._close_splash(splash, False),\n            style=\"Danger.TButton\"\n        )\n        btn_exit.pack(side=\"right\")\n\n        # è‡ªåŠ¨èšç„¦åˆ°åŒæ„æŒ‰é’®\n        btn_agree.focus_set()\n\n    def _close_splash(self, splash, continue_usage):\n        \"\"\"å…³é—­ç‰ˆæƒå£°æ˜å¼¹çª—\"\"\"\n        splash.destroy()\n        if not continue_usage:\n            self.root.quit()\n\n    def _show_technical_details(self):\n        \"\"\"æ˜¾ç¤ºæŠ€æœ¯è¯¦æƒ…çª—å£\"\"\"\n        details_win = tk.Toplevel(self.root)\n        details_win.title(\"ğŸ”¬ æŠ€æœ¯è¯¦æƒ…\")\n        details_win.geometry(\"900x700\")\n        details_win.configure(bg=COLORS[\"primary_dark\"])\n\n        # ä¸»å®¹å™¨\n        main_frame = ttk.Frame(details_win, style=\"TFrame\")\n        main_frame.pack(fill=\"both\", expand=True, padx=20, pady=20)\n\n        # æ ‡é¢˜\n        title_label = ttk.Label(\n            main_frame,\n            text=\"ğŸ”¬ ç³»ç»ŸæŠ€æœ¯è¯¦æƒ…\",\n            style=\"Title.TLabel\"\n        )\n        title_label.pack(pady=(0, 20))\n\n        # æŠ€æœ¯è¯¦æƒ…å†…å®¹\n        tech_text = \"\"\"\nğŸ”· æ ¸å¿ƒè®¡ç®—å¼•æ“ï¼š\n\nã€1. æ•°å­¦è®¡ç®—æ¨¡å—ã€‘\nâ€¢ ç²¾åº¦ï¼š80ä½åè¿›åˆ¶ç²¾åº¦ (è¶…è¿‡IEEE 754åŒç²¾åº¦)\nâ€¢ å‡½æ•°åº“ï¼šsin, cos, tan, exp, sqrt, log, log10ç­‰å®Œæ•´å®ç°\nâ€¢ å¸¸é‡ï¼šPI, E, GOLDEN_RATIOç­‰é«˜ç²¾åº¦å¸¸é‡\n\nã€2. å…‰å­¦ç‰©ç†æ¨¡å—ã€‘\nâ€¢ SellmeieræŠ˜å°„ç‡æ–¹ç¨‹ï¼šnÂ²(Î») = 1 + Bâ‚Î»Â²/(Î»Â²-Câ‚) + Bâ‚‚Î»Â²/(Î»Â²-Câ‚‚) + Bâ‚ƒÎ»Â²/(Î»Â²-Câ‚ƒ)\nâ€¢ Fresnelåå°„/é€å°„ï¼šå®Œæ•´åæŒ¯å¤„ç†\nâ€¢ ç¾¤é€Ÿåº¦å’Œè‰²æ•£ï¼šâˆ‚n/âˆ‚Î»æ•°å€¼è®¡ç®—\nâ€¢ é‡å­å¹²æ¶‰ï¼šæ³¢å‡½æ•°å åŠ è®¡ç®—\n\nã€3. å‡ ä½•è¯„ä¼°æ¨¡å—ã€‘\nâ€¢ 8å¿ƒ8ç®­å›¾æ¡ˆåˆ†æ\nâ€¢ å† éƒ¨è§’åº¦ä¼˜åŒ–ï¼š34.5Â° Â± 2.5Â°\nâ€¢ äº­éƒ¨è§’åº¦ä¼˜åŒ–ï¼š40.75Â° Â± 1.5Â°\nâ€¢ å°é¢æ¯”ä¾‹ï¼š53.0% - 63.0%\nâ€¢ å¯¹ç§°æ€§è¯„ä¼°ç®—æ³•\n\nã€4. å…‰çº¿è¿½è¸ªå¼•æ“ã€‘\nâ€¢ Monte Carloé‡‡æ ·ï¼š10,000+å…‰å­\nâ€¢ ç‰©ç†æ­£ç¡®åå°„/æŠ˜å°„\nâ€¢ åæŒ¯æ€è¿½è¸ª\nâ€¢ è·¯å¾„é•¿åº¦ç§¯åˆ†\nâ€¢ ç»Ÿè®¡è¯¯å·®åˆ†æ\n\nã€5. æ€§èƒ½è¯„åˆ†ç³»ç»Ÿã€‘\nâ€¢ äº®åº¦ (Brightness)ï¼šCIE V(Î»)åŠ æƒå…‰é€šé‡\nâ€¢ ç«å½© (ç«å½©)ï¼šè‰²æ•£åˆ†ç¦»åº¦è¯„ä¼°\nâ€¢ é—ªåº¦ (é—ªåº¦)ï¼šè§†è§’å“åº”å‡½æ•°\nâ€¢ ç»¼åˆç¾è§‚åº¦ (CS)ï¼šå¤šç»´åº¦ç»¼åˆæŒ‡æ ‡\n\nğŸ“Š æ•°æ®å¯è§†åŒ–ï¼š\n\nâ€¢ 3Dé’»çŸ³æ¨¡å‹æ¸²æŸ“\nâ€¢ å…‰çº¿è·¯å¾„å¯è§†åŒ–\nâ€¢ æ€§èƒ½æŒ‡æ ‡å›¾è¡¨\nâ€¢ å®æ—¶è®¡ç®—åŠ¨ç”»\nâ€¢ äº¤äº’å¼å‚æ•°è°ƒèŠ‚\n\nğŸ”§ æŠ€æœ¯å®ç°ï¼š\n\nâ€¢ Python 3.8+ + tkinter GUI\nâ€¢ é«˜ç²¾åº¦Decimalè¿ç®—åº“\nâ€¢ å¤šçº¿ç¨‹å¹¶è¡Œè®¡ç®—\nâ€¢ æœ¬åœ°JSONæ•°æ®å­˜å‚¨\nâ€¢ Unicodeå®Œæ•´ä¸­æ–‡æ”¯æŒ\n\nğŸ¯ è´¨é‡ä¿è¯ï¼š\n\nâ€¢ åŸºå‡†é’»çŸ³100%æ»¡åˆ†éªŒè¯\nâ€¢ 10,000ä¸ªéšæœºæ ·å“æµ‹è¯•\nâ€¢ ä¸å›½é™…æ ‡å‡†å¯¹æ¯”éªŒè¯\nâ€¢ é•¿æœŸç¨³å®šæ€§æµ‹è¯•\n        \"\"\"\n\n        # æ–‡æœ¬æ˜¾ç¤ºåŒºåŸŸ\n        text_frame = ttk.Frame(main_frame, style=\"TFrame\")\n        text_frame.pack(fill=\"both\", expand=True)\n\n        text_widget = tk.Text(\n            text_frame,\n            bg=COLORS[\"secondary_dark\"],\n            fg=COLORS[\"text_primary\"],\n            wrap=\"word\",\n            font=(\"å¾®è½¯é›…é»‘\", 10),\n            padx=15,\n            pady=15\n        )\n        text_widget.pack(side=\"left\", fill=\"both\", expand=True)\n\n        # æ»šåŠ¨æ¡\n        scrollbar = ttk.Scrollbar(text_frame, orient=\"vertical\", command=text_widget.yview)\n        scrollbar.pack(side=\"right\", fill=\"y\")\n        text_widget.configure(yscrollcommand=scrollbar.set)\n\n        # æ’å…¥æŠ€æœ¯è¯¦æƒ…æ–‡æœ¬\n        text_widget.insert(\"1.0\", tech_text.strip())\n        text_widget.configure(state=\"disabled\")\n\n        # å…³é—­æŒ‰é’®\n        btn_close = ttk.Button(\n            main_frame,\n            text=\"å…³é—­\",\n            command=details_win.destroy,\n            style=\"TButton\"\n        )\n        btn_close.pack(pady=(20, 0))\n\n    def _show_detail_window(self, rec):\n        \"\"\"ğŸ“‹ æ˜¾ç¤ºè¯¦æƒ…çª—å£\"\"\"\n        detail_win = tk.Toplevel(self.root)\n        detail_win.title(f\"ğŸ”· é’»çŸ³ {rec.get('diamond_id','')} è¯¦ç»†è¯„ä¼°æŠ¥å‘Š\")\n        detail_win.geometry(\"900x700\")\n        detail_win.configure(bg=COLORS[\"primary_dark\"])\n\n        # æ ‡é¢˜\n        title_label = ttk.Label(\n            detail_win,\n            text=f\"ğŸ† {rec.get('diamond_id','')} é’»çŸ³è¯¦ç»†è¯„ä¼°æŠ¥å‘Š\",\n            style=\"Title.TLabel\"\n        )\n        title_label.pack(pady=10)\n\n        # åŸºæœ¬ä¿¡æ¯\n        info_frame = ttk.LabelFrame(detail_win, text=\"ğŸ“‹ åŸºæœ¬ä¿¡æ¯\", style=\"TLabelframe\")\n        info_frame.pack(fill=\"x\", padx=10, pady=5)\n\n        info_text = f\"\"\"\nè¯„ä¼°æ—¶é—´ï¼š{rec.get('timestamp','')}\nç»¼åˆç¾è§‚åº¦ï¼š{rec.get('scores',{}).get('cs',0.0):.2f} / 10\nå…‰å­¦æ€§èƒ½ï¼š{rec.get('scores',{}).get('op',0.0):.2f} / 10\n        \"\"\".strip()\n\n        info_label = ttk.Label(info_frame, text=info_text, style=\"TLabel\")\n        info_label.pack(padx=10, pady=5)\n\n        # è¯¦ç»†å†…å®¹\n        text_widget = tk.Text(\n            detail_win,\n            bg=COLORS[\"secondary_dark\"],\n            fg=COLORS[\"text_primary\"],\n            font=(\"å¾®è½¯é›…é»‘\", 10),\n            wrap=\"word\",\n            padx=10,\n            pady=10\n        )\n        text_widget.pack(fill=\"both\", expand=True, padx=10, pady=5)\n\n        # æ’å…¥è¯¦ç»†å†…å®¹\n        text_widget.insert(\"1.0\", rec.get(\"detail\", \"è¯¦ç»†ä¿¡æ¯æœªæ‰¾åˆ°\"))\n\n        # å…³é—­æŒ‰é’®\n        btn_close = ttk.Button(\n            detail_win,\n            text=\"âŒ å…³é—­\",\n            command=detail_win.destroy,\n            style=\"Danger.TButton\"\n        )\n        btn_close.pack(pady=10)\n\n    def _update_visualization(self, params, scores):\n        \"\"\"ğŸ¨ æ›´æ–°å¯è§†åŒ–æ˜¾ç¤º - ä¼˜åŒ–ç‰ˆæœ¬\"\"\"\n        try:\n            # æ¸…ç©ºç”»å¸ƒ\n            self.viz_canvas.delete(\"all\")\n\n            # è·å–å¯è§†åŒ–æ¨¡å¼\n            viz_mode = getattr(self, 'var_viz_mode', None)\n            if viz_mode:\n                mode = viz_mode.get() if hasattr(viz_mode, 'get') else \"ğŸ“Š æ€§èƒ½å›¾è¡¨\"\n            else:\n                mode = \"ğŸ“Š æ€§èƒ½å›¾è¡¨\"\n\n            # ä¼˜åŒ–ï¼šåˆ›å»ºç®€åŒ–çš„å‚æ•°å‰¯æœ¬ï¼Œé¿å…å¤æ‚æ•°æ®å¤„ç†\n            simplified_scores = {\n                'brightness': float(scores.get('brightness', 0)),\n                'fire': float(scores.get('fire', 0)),\n                'scint': float(scores.get('scint', 0)),\n                'op': float(scores.get('op', 0)),\n                'cs': float(scores.get('cs', 0))\n            }\n\n            # æ ¹æ®ä¸åŒæ¨¡å¼ç»˜åˆ¶ä¸åŒå¯è§†åŒ–\n            if mode == \"ğŸ“Š æ€§èƒ½å›¾è¡¨\" or mode == \"performance_chart\":\n                self._draw_performance_chart(params, simplified_scores)\n            elif mode == \"ğŸŒˆ å…‰è°±åˆ†æ\" or mode == \"spectrum_analysis\":\n                self._draw_spectrum_analysis(params, simplified_scores)\n            elif mode == \"ğŸ’ 3Då…‰çº¿è¿½è¸ª\" or mode == \"ray_tracing_3d\":\n                self._draw_ray_tracing_3d_optimized(params, simplified_scores)\n            elif mode == \"ğŸ”¥ ç«å½©è‰²æ•£\" or mode == \"fire_dispersion\":\n                self._draw_fire_dispersion_optimized(params, simplified_scores)\n            elif mode == \"âœ¨ é—ªåº¦åˆ†å¸ƒ\" or mode == \"scintillation_map\":\n                self._draw_scintillation_map_optimized(params, simplified_scores)\n            else:\n                self._draw_performance_chart(params, simplified_scores)\n\n        except Exception as e:\n            # é”™è¯¯å¤„ç†ï¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯è€Œä¸æ˜¯å´©æºƒ\n            self.viz_canvas.create_text(\n                300, 200,\n                text=f\"âš ï¸ å¯è§†åŒ–åŠ è½½å¤±è´¥\\n{str(e)}\",\n                fill=COLORS[\"warning_orange\"],\n                font=(\"å¾®è½¯é›…é»‘\", 12),\n                anchor=\"center\"\n            )\n\n    def _draw_performance_chart(self, params, scores):\n        \"\"\"ğŸ“Š ç»˜åˆ¶æ€§èƒ½å›¾è¡¨\"\"\"\n        # è·å–ç”»å¸ƒå°ºå¯¸\n        canvas_width = self.viz_canvas.winfo_width()\n        canvas_height = self.viz_canvas.winfo_height()\n        if canvas_width <= 1:\n            canvas_width = 600\n        if canvas_height <= 1:\n            canvas_height = 400\n\n        # ç»˜åˆ¶æ ‡é¢˜\n        self.viz_canvas.create_text(\n            canvas_width // 2, 30,\n            text=\"ğŸ”· é’»çŸ³å…‰å­¦æ€§èƒ½åˆ†æå›¾è¡¨\",\n            fill=COLORS[\"text_primary\"],\n            font=(\"å¾®è½¯é›…é»‘\", 16, \"bold\"),\n            anchor=\"center\"\n        )\n\n        # è·å–è¯„åˆ†æ•°æ®\n        b_score = float(scores.get(\"brightness\", 0))\n        f_score = float(scores.get(\"fire\", 0))\n        s_score = float(scores.get(\"scint\", 0))\n        op_score = float(scores.get(\"op\", 0))\n        cs_score = float(scores.get(\"cs\", 0))\n\n        # ç»˜åˆ¶æŸ±çŠ¶å›¾\n        chart_x = 100\n        chart_y = 100\n        bar_width = 80\n        max_height = 200\n        spacing = 100\n\n        # äº®åº¦æŸ±\n        b_height = (b_score / 10.0) * max_height\n        self.viz_canvas.create_rectangle(\n            chart_x, chart_y + max_height - b_height,\n            chart_x + bar_width, chart_y + max_height,\n            fill=COLORS[\"success_green\"],\n            outline=COLORS[\"text_primary\"]\n        )\n        self.viz_canvas.create_text(\n            chart_x + bar_width // 2, chart_y + max_height + 20,\n            text=f\"äº®åº¦\\n{b_score:.2f}\",\n            fill=COLORS[\"text_primary\"],\n            font=(\"å¾®è½¯é›…é»‘\", 10),\n            anchor=\"center\"\n        )\n\n        # ç«å½©æŸ±\n        f_height = (f_score / 10.0) * max_height\n        self.viz_canvas.create_rectangle(\n            chart_x + spacing, chart_y + max_height - f_height,\n            chart_x + spacing + bar_width, chart_y + max_height,\n            fill=COLORS[\"warning_orange\"],\n            outline=COLORS[\"text_primary\"]\n        )\n        self.viz_canvas.create_text(\n            chart_x + spacing + bar_width // 2, chart_y + max_height + 20,\n            text=f\"ç«å½©\\n{f_score:.2f}\",\n            fill=COLORS[\"text_primary\"],\n            font=(\"å¾®è½¯é›…é»‘\", 10),\n            anchor=\"center\"\n        )\n\n        # é—ªåº¦æŸ±\n        s_height = (s_score / 10.0) * max_height\n        self.viz_canvas.create_rectangle(\n            chart_x + spacing * 2, chart_y + max_height - s_height,\n            chart_x + spacing * 2 + bar_width, chart_y + max_height,\n            fill=COLORS[\"accent_blue\"],\n            outline=COLORS[\"text_primary\"]\n        )\n        self.viz_canvas.create_text(\n            chart_x + spacing * 2 + bar_width // 2, chart_y + max_height + 20,\n            text=f\"é—ªåº¦\\n{s_score:.2f}\",\n            fill=COLORS[\"text_primary\"],\n            font=(\"å¾®è½¯é›…é»‘\", 10),\n            anchor=\"center\"\n        )\n\n        # ç»˜åˆ¶ç»¼åˆè¯„åˆ†\n        self.viz_canvas.create_text(\n            canvas_width // 2, chart_y + max_height + 80,\n            text=f\"ğŸ† ç»¼åˆç¾è§‚åº¦ (CS): {cs_score:.2f}/10 | å…‰å­¦æ€§èƒ½ (OP): {op_score:.2f}/10\",\n            fill=COLORS[\"success_green\"],\n            font=(\"å¾®è½¯é›…é»‘\", 12, \"bold\"),\n            anchor=\"center\"\n        )\n\n    def _draw_spectrum_analysis(self, params, scores):\n        \"\"\"ğŸŒˆ ç»˜åˆ¶å…‰è°±åˆ†æå›¾\"\"\"\n        canvas_width = self.viz_canvas.winfo_width()\n        canvas_height = self.viz_canvas.winfo_height()\n        if canvas_width <= 1:\n            canvas_width = 600\n        if canvas_height <= 1:\n            canvas_height = 400\n\n        # ç»˜åˆ¶æ ‡é¢˜\n        self.viz_canvas.create_text(\n            canvas_width // 2, 30,\n            text=\"ğŸŒˆ é’»çŸ³å…‰è°±åˆ†æ (380-780nm)\",\n            fill=COLORS[\"text_primary\"],\n            font=(\"å¾®è½¯é›…é»‘\", 16, \"bold\"),\n            anchor=\"center\"\n        )\n\n        # æ¨¡æ‹Ÿå…‰è°±æ•°æ®ï¼ˆåŸºäºç«å½©å’Œé—ªåº¦è¯„åˆ†ï¼‰\n        import math\n        spectrum_x = 50\n        spectrum_y = 100\n        spectrum_width = canvas_width - 100\n        spectrum_height = 200\n\n        # ç»˜åˆ¶å…‰è°±èƒŒæ™¯\n        for i in range(spectrum_width):\n            wavelength = 380 + i * 400 / spectrum_width\n            # æ ¹æ®æ³¢é•¿è®¡ç®—é¢œè‰²ï¼ˆç®€åŒ–æ¨¡æ‹Ÿï¼‰\n            if wavelength < 450:  # ç´«å…‰\n                r, g, b = 0.5, 0, 1\n            elif wavelength < 495:  # è“å…‰\n                r, g, b = 0, 0, 1\n            elif wavelength < 570:  # ç»¿å…‰\n                r, g, b = 0, 1, 0\n            elif wavelength < 590:  # é»„å…‰\n                r, g, b = 1, 1, 0\n            elif wavelength < 620:  # æ©™å…‰\n                r, g, b = 1, 0.5, 0\n            else:  # çº¢å…‰\n                r, g, b = 1, 0, 0\n\n            # åŸºäºç«å½©è¯„åˆ†çš„å¼ºåº¦è°ƒåˆ¶\n            fire_intensity = float(scores.get(\"fire\", 5)) / 10.0\n            height_mod = 1 + fire_intensity * math.sin(i * math.pi / spectrum_width * 3)\n\n            # è½¬æ¢é¢œè‰²\n            color = f\"#{int(r*255):02x}{int(g*255):02x}{int(b*255):02x}\"\n\n            # ç»˜åˆ¶å…‰è°±çº¿\n            self.viz_canvas.create_line(\n                spectrum_x + i, spectrum_y + spectrum_height,\n                spectrum_x + i, spectrum_y + spectrum_height - int(50 * height_mod),\n                fill=color,\n                width=1\n            )\n\n        # æ·»åŠ è¯´æ˜æ–‡å­—\n        self.viz_canvas.create_text(\n            canvas_width // 2, spectrum_y + spectrum_height + 30,\n            text=f\"ğŸ”¥ ç«å½©å¼ºåº¦: {scores.get('fire', 0):.2f}/10 (è‰²æ•£åˆ†æ)\",\n            fill=COLORS[\"warning_orange\"],\n            font=(\"å¾®è½¯é›…é»‘\", 11),\n            anchor=\"center\"\n        )\n\n    def _draw_ray_tracing_3d_optimized(self, params, scores):\n        \"\"\"ğŸ’ ç»˜åˆ¶3Då…‰çº¿è¿½è¸ªç¤ºæ„å›¾ - ä¼˜åŒ–ç‰ˆ\"\"\"\n        canvas_width = self.viz_canvas.winfo_width()\n        canvas_height = self.viz_canvas.winfo_height()\n        if canvas_width <= 1:\n            canvas_width = 600\n        if canvas_height <= 1:\n            canvas_height = 400\n\n        # ç»˜åˆ¶æ ‡é¢˜\n        self.viz_canvas.create_text(\n            canvas_width // 2, 25,\n            text=\"ğŸ’ 3Då…‰çº¿è¿½è¸ªå¯è§†åŒ–ï¼ˆä¼˜åŒ–ç‰ˆï¼‰\",\n            fill=COLORS[\"text_primary\"],\n            font=(\"å¾®è½¯é›…é»‘\", 16, \"bold\"),\n            anchor=\"center\"\n        )\n\n        center_x = canvas_width // 2\n        center_y = canvas_height // 2 + 20\n        diamond_size = 80\n\n        import math\n\n        # ç®€åŒ–çš„3Dé’»çŸ³è½®å»“ï¼ˆå‡å°‘ç»˜åˆ¶å¤æ‚åº¦ï¼‰\n        # åªç»˜åˆ¶åŸºæœ¬çš„å…«è¾¹å½¢\n        points = []\n        for i in range(8):\n            angle = i * math.pi / 4\n            x = center_x + diamond_size * math.cos(angle)\n            y = center_y + diamond_size * math.sin(angle)\n            points.extend([x, y])\n\n        self.viz_canvas.create_polygon(\n            points,\n            outline=COLORS[\"accent_blue\"],\n            fill=\"\",\n            width=2\n        )\n\n        # ç»˜åˆ¶ä¸­å¿ƒé«˜äº®ç‚¹\n        self.viz_canvas.create_oval(\n            center_x - 5, center_y - 5,\n            center_x + 5, center_y + 5,\n            fill=COLORS[\"warning_orange\"],\n            outline=COLORS[\"success_green\"],\n            width=2\n        )\n\n        # ä¼˜åŒ–ï¼šå‡å°‘å…‰çº¿æ•°é‡ï¼Œä½¿ç”¨å›ºå®šçš„å…‰çº¿è·¯å¾„é¿å…éšæœºè®¡ç®—\n        num_rays = 8  # ä»20å‡å°‘åˆ°8\n        for i in range(num_rays):\n            # å›ºå®šçš„èµ·å§‹ä½ç½®ï¼Œé¿å…éšæœºè®¡ç®—\n            start_x = 50 + i * (canvas_width - 100) // num_rays\n            start_y = 50\n\n            # ç®€åŒ–çš„å…‰çº¿è·¯å¾„\n            mid_x = center_x + (i - num_rays//2) * 10\n            mid_y = center_y - 10\n\n            # ç®€åŒ–çš„é¢œè‰²é€‰æ‹©\n            ray_color = COLORS[\"warning_orange\"] if i < num_rays // 2 else COLORS[\"success_green\"]\n\n            # ç»˜åˆ¶å…¥å°„å…‰çº¿\n            self.viz_canvas.create_line(\n                start_x, start_y,\n                mid_x, mid_y,\n                fill=ray_color,\n                width=2,\n                arrow=tk.LAST\n            )\n\n        # ç®€åŒ–çš„åå°„å…‰çº¿ï¼ˆå‡å°‘æ•°é‡å’Œå¤æ‚åº¦ï¼‰\n        num_reflect = 8  # ä»16å‡å°‘åˆ°8\n        for i in range(num_reflect):\n            angle = i * math.pi / 4\n            radius = diamond_size * 1.2\n            end_x = center_x + radius * math.cos(angle)\n            end_y = center_y + radius * math.sin(angle)\n\n            color = COLORS[\"success_green\"] if i % 2 == 0 else \"#00FFFF\"\n\n            self.viz_canvas.create_line(\n                center_x, center_y,\n                end_x, end_y,\n                fill=color,\n                width=2,\n                arrow=tk.LAST\n            )\n\n        # è·å–é¢„å¤„ç†çš„è¯„åˆ†æ•°æ®\n        brightness_score = scores.get('brightness', 0)\n        fire_score = scores.get('fire', 0)\n        scint_score = scores.get('scint', 0)\n\n        # ç»˜åˆ¶æ€§èƒ½æŒ‡æ ‡æ˜¾ç¤º\n        self.viz_canvas.create_text(\n            50, canvas_height - 80,\n            text=f\"ğŸ”† äº®åº¦: {brightness_score:.2f}/10\",\n            fill=COLORS[\"success_green\"],\n            font=(\"å¾®è½¯é›…é»‘\", 11, \"bold\"),\n            anchor=\"w\"\n        )\n\n        self.viz_canvas.create_text(\n            50, canvas_height - 60,\n            text=f\"ğŸ”¥ ç«å½©: {fire_score:.2f}/10\",\n            fill=COLORS[\"warning_orange\"],\n            font=(\"å¾®è½¯é›…é»‘\", 11, \"bold\"),\n            anchor=\"w\"\n        )\n\n        self.viz_canvas.create_text(\n            50, canvas_height - 40,\n            text=f\"âœ¨ é—ªåº¦: {scint_score:.2f}/10\",\n            fill=\"#00FFFF\",\n            font=(\"å¾®è½¯é›…é»‘\", 11, \"bold\"),\n            anchor=\"w\"\n        )\n\n        # æ·»åŠ ä¼˜åŒ–çš„è¯´æ˜\n        self.viz_canvas.create_text(\n            canvas_width - 50, canvas_height - 40,\n            text=\"æ€§èƒ½ä¼˜åŒ–æ¨¡å¼\",\n            fill=COLORS[\"text_secondary\"],\n            font=(\"å¾®è½¯é›…é»‘\", 9),\n            anchor=\"e\"\n        )\n\n    def _draw_ray_tracing_3d(self, params, scores):\n        \"\"\"ğŸ’ ç»˜åˆ¶3Då…‰çº¿è¿½è¸ªç¤ºæ„å›¾ - å®Œæ•´ç‰ˆ\"\"\"\n        # ä¿æŒåŸæœ‰çš„å®Œæ•´ç‰ˆæœ¬ï¼Œä¾›é€‰æ‹©ä½¿ç”¨\n        self._draw_ray_tracing_3d_optimized(params, scores)\n\n    def _draw_fire_dispersion_optimized(self, params, scores):\n        \"\"\"ğŸ”¥ ç»˜åˆ¶ç«å½©è‰²æ•£å›¾ - ä¼˜åŒ–ç‰ˆ\"\"\"\n        # ç®€åŒ–ç‰ˆæœ¬ï¼Œç›´æ¥è°ƒç”¨å…‰è°±åˆ†æ\n        self._draw_spectrum_analysis(params, scores)\n\n    def _draw_fire_dispersion(self, params, scores):\n        \"\"\"ğŸ”¥ ç»˜åˆ¶ç«å½©è‰²æ•£å›¾\"\"\"\n        # ä½¿ç”¨ä¼˜åŒ–ç‰ˆæœ¬\n        self._draw_fire_dispersion_optimized(params, scores)\n\n    def _draw_scintillation_map_optimized(self, params, scores):\n        \"\"\"âœ¨ ç»˜åˆ¶é—ªåº¦åˆ†å¸ƒå›¾ - ä¼˜åŒ–ç‰ˆ\"\"\"\n        canvas_width = self.viz_canvas.winfo_width()\n        canvas_height = self.viz_canvas.winfo_height()\n        if canvas_width <= 1:\n            canvas_width = 600\n        if canvas_height <= 1:\n            canvas_height = 400\n\n        # ç»˜åˆ¶æ ‡é¢˜\n        self.viz_canvas.create_text(\n            canvas_width // 2, 30,\n            text=\"âœ¨ é’»çŸ³é—ªåº¦åˆ†å¸ƒå›¾ï¼ˆä¼˜åŒ–ç‰ˆï¼‰\",\n            fill=COLORS[\"text_primary\"],\n            font=(\"å¾®è½¯é›…é»‘\", 16, \"bold\"),\n            anchor=\"center\"\n        )\n\n        # ä¼˜åŒ–ï¼šå‡å°‘ç½‘æ ¼å°ºå¯¸ä»¥æé«˜æ€§èƒ½\n        grid_size = 8  # ä»10å‡å°‘åˆ°8\n        cell_width = (canvas_width - 100) // grid_size\n        cell_height = (canvas_height - 150) // grid_size\n\n        scint_score = scores.get(\"scint\", 5) / 10.0  # ä½¿ç”¨é¢„å¤„ç†çš„æ•°æ®\n\n        for i in range(grid_size):\n            for j in range(grid_size):\n                x = 50 + i * cell_width\n                y = 80 + j * cell_height\n\n                # ç®€åŒ–çš„å¼ºåº¦è®¡ç®—ï¼Œé¿å…å¤æ‚çš„ä¸‰è§’å‡½æ•°\n                intensity = (i + j) / (grid_size * 2)\n                intensity *= scint_score\n\n                # ç®€åŒ–çš„é¢œè‰²é€‰æ‹©\n                if intensity > 0.6:\n                    color = COLORS[\"warning_orange\"]\n                elif intensity > 0.3:\n                    color = COLORS[\"accent_blue\"]\n                else:\n                    color = COLORS[\"secondary_dark\"]\n\n                self.viz_canvas.create_rectangle(\n                    x, y, x + cell_width, y + cell_height,\n                    fill=color,\n                    outline=\"\"\n                )\n\n        # æ·»åŠ è¯´æ˜\n        self.viz_canvas.create_text(\n            canvas_width // 2, canvas_height - 20,\n            text=f\"é—ªåº¦è¯„åˆ†: {scint_score * 10:.2f}/10\",\n            fill=COLORS[\"text_primary\"],\n            font=(\"å¾®è½¯é›…é»‘\", 11),\n            anchor=\"center\"\n        )\n\n    def _draw_scintillation_map(self, params, scores):\n        \"\"\"âœ¨ ç»˜åˆ¶é—ªåº¦åˆ†å¸ƒå›¾\"\"\"\n        # ä½¿ç”¨ä¼˜åŒ–ç‰ˆæœ¬\n        self._draw_scintillation_map_optimized(params, scores)\n\n\n\n\ndef main() -> None:\n    root = tk.Tk()\n    app = DiamondApp(root)\n    root.mainloop()\n\n\nif __name__ == \"__main__\":\n    main()\n\n# å…¨å±€è®¡ç®—å‡½æ•°ï¼Œä¾›å¤–éƒ¨è°ƒç”¨\n\ndef compute_scores(params, cancel_flag=None):\n    \"\"\"\n    å…¨å±€è®¡ç®—å‡½æ•° - é’»çŸ³å…‰å­¦è¯„åˆ†è®¡ç®—\n    ä¾›å¤–éƒ¨è°ƒç”¨å’Œæµ‹è¯•ä½¿ç”¨\n    \"\"\"\n    try:\n        # ç›´æ¥è°ƒç”¨æ ¸å¿ƒè®¡ç®—å‡½æ•°ï¼Œé¿å…GUIä¾èµ–\n        # å‡½æ•°å·²åœ¨å½“å‰æ–‡ä»¶ä¸­å®šä¹‰ï¼Œæ— éœ€å¯¼å…¥\n        \n        ray_results = advanced_monte_carlo_ray_tracing(params, cancel_flag=cancel_flag)\n        geometry_ha, geometry_dg = geometry_metrics(params)\n\n        base_scores = {\n            \"brightness\": Decimal(str(ray_results.get(\"brightness\", 0))),\n            \"fire\": Decimal(str(ray_results.get(\"fire\", 0))),\n            \"scint\": Decimal(str(ray_results.get(\"scint\", 0))),\n            \"cs\": Decimal(str(ray_results.get(\"cs\", 0))),\n            \"op\": Decimal(str(ray_results.get(\"op\", 0))),\n            \"ha\": Decimal(str(geometry_ha)),\n            \"dg\": Decimal(str(geometry_dg))\n        }\n\n        calibrated_scores = calibrate_to_baseline(base_scores)\n        return calibrated_scores\n        \n    except Exception as e:\n        print(f\"Error in compute_scores: {e}\")\n        import traceback\n        traceback.print_exc()\n        # è¿”å›é»˜è®¤åˆ†æ•°\n        return {\n            \"brightness\": 10.0, \"fire\": 10.0, \"scint\": 10.0, \"cs\": 10.0,\n            \"op\": 10.0, \"ha\": 100.0, \"dg\": 0.0\n        }\n","numLines":5799,"startLine":1,"totalLines":5799}}}
{"parentUuid":"583e132d-bd7f-4521-b253-7e4026aa799d","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","slug":"misty-marinating-boot","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VZr7GedbLye4JyknEmQQ3u","type":"message","role":"assistant","content":[{"type":"text","text":"æˆ‘å·²ç»å®Œæˆäº†å¯¹è¿™ä¸ªä»£ç çš„å…¨é¢æ£€æŸ¥ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„æ£€æŸ¥æŠ¥å‘Šï¼š\n\n---\n\n## ğŸ“‹ ä»£ç æ£€æŸ¥æŠ¥å‘Šï¼šé’»çŸ³å…‰å­¦è¯„ä¼°ç³»ç»Ÿ\n\n### ğŸ“Š æ¦‚è¿°\nè¿™æ˜¯ä¸€ä¸ªçº¦ 5800 è¡Œçš„ Python GUI åº”ç”¨ç¨‹åºï¼Œç”¨äºé’»çŸ³å…‰å­¦æ€§èƒ½è¯„ä¼°ã€‚ä»£ç æ•´ä½“ç»“æ„å®Œæ•´ï¼Œä½†å­˜åœ¨å¤šå¤„éœ€è¦ä¿®å¤çš„é—®é¢˜ã€‚\n\n---\n\n### ğŸ”´ ä¸¥é‡é”™è¯¯ (å¿…é¡»ä¿®å¤)\n\n#### 1. **ç¼ºå°‘å¤–éƒ¨æ¨¡å—** (ç¬¬ 101 è¡Œ)\n```python\nimport cosmic_animation  # ğŸŒŒ å®‡å®™çº§åŠ¨ç”»ç³»ç»Ÿ\n```\n- **é—®é¢˜**: `cosmic_animation` æ¨¡å—æœªæä¾›ï¼Œä»£ç è¿è¡Œä¼šç«‹å³å¤±è´¥\n- **ä¿®å¤**: éœ€è¦åˆ›å»ºè¯¥æ¨¡å—æˆ–ç§»é™¤è¿™ä¸ªå¯¼å…¥\n\n#### 2. **è¯­æ³•é”™è¯¯** (ç¬¬ 3010 è¡Œ)\n```python\nexcept Exception as e:            return None\n```\n- **é—®é¢˜**: `except` å’Œ `return` åº”è¯¥åˆ†è¡Œï¼Œç¼©è¿›é”™è¯¯\n- **æ­£ç¡®å†™æ³•**:\n```python\nexcept Exception as e:\n    return None\n```\n\n#### 3. **æœªå®šä¹‰çš„é¢œè‰²é”®** (ç¬¬ 3813, 3833 è¡Œ)\n```python\nfg=COLORS[\"success\"],  # \"success\" ä¸å­˜åœ¨\nfg=COLORS[\"warning\"],  # \"warning\" ä¸å­˜åœ¨\nfg=COLORS[\"info\"],     # \"info\" ä¸å­˜åœ¨ (ç¬¬ 4191 è¡Œ)\n```\n- **é—®é¢˜**: `COLORS` å­—å…¸ä¸­åªå®šä¹‰äº† `success_green`ã€`warning_orange` ç­‰ï¼Œæ²¡æœ‰ `success`ã€`warning`ã€`info`\n- **ä¿®å¤**: ä½¿ç”¨æ­£ç¡®çš„é”®åå¦‚ `COLORS[\"success_green\"]`\n\n#### 4. **é‡å¤å®šä¹‰çš„æ–¹æ³•** (ç¬¬ 4916 è¡Œå’Œç¬¬ 4221 è¡Œ)\n```python\ndef on_clear_leaderboard(self):  # å®šä¹‰äº†ä¸¤æ¬¡\n```\n- **é—®é¢˜**: `on_clear_leaderboard` æ–¹æ³•é‡å¤å®šä¹‰\n\n#### 5. **é‡å¤å®šä¹‰çš„æ–¹æ³•** (ç¬¬ 4922 è¡Œå’Œç¬¬ 4223 è¡Œ)\n```python\ndef on_load_from_selected(self):  # å®šä¹‰äº†ä¸¤æ¬¡\n```\n\n#### 6. **é‡å¤å®šä¹‰çš„æ–¹æ³•** (ç¬¬ 4943 è¡Œå’Œç¬¬ 4244 è¡Œ)\n```python\ndef on_tree_double_click(self, event):  # å®šä¹‰äº†ä¸¤æ¬¡\n```\n\n#### 7. **é‡å¤å®šä¹‰çš„æ–¹æ³•** (ç¬¬ 5291 è¡Œå’Œç¬¬ 4254 è¡Œ)\n```python\ndef _show_detail_window(self, rec):  # å®šä¹‰äº†ä¸¤æ¬¡\n```\n\n#### 8. **é‡å¤å®šä¹‰çš„æ–¹æ³•** (ç¬¬ 5343 è¡Œå’Œç¬¬ 3651 è¡Œ)\n```python\ndef _update_visualization(self, params, scores):  # å®šä¹‰äº†ä¸¤æ¬¡\n```\n\n---\n\n### ğŸŸ  ä¸­ç­‰é—®é¢˜ (å»ºè®®ä¿®å¤)\n\n#### 1. **æœªä½¿ç”¨çš„å˜é‡** (ç¬¬ 2050 è¡Œ)\n```python\nfor score in [table_score, crown_height_score, pavilion_depth_score, total_depth_score]:\n    score = clamp(score, Decimal('0.0'), Decimal('1.0'))  # è¿™ä¸ªèµ‹å€¼æ— æ•ˆ\n```\n- **é—®é¢˜**: å¾ªç¯å˜é‡èµ‹å€¼ä¸ä¼šä¿®æ”¹åŸå§‹å˜é‡\n\n#### 2. **atan å‡½æ•°æ³°å‹’çº§æ•°é”™è¯¯** (ç¬¬ 274 è¡Œ)\n```python\nterm = term * x_squared / Decimal(str(n+2))  # åº”è¯¥æ˜¯ (n+2)/1\n```\n- **é—®é¢˜**: åæ­£åˆ‡æ³°å‹’çº§æ•°é€’æ¨å…¬å¼ä¸æ­£ç¡®\n\n#### 3. **æ½œåœ¨çš„é€’å½’é—®é¢˜** (ç¬¬ 154-157 è¡Œ)\n```python\nif abs(x - PI / Decimal('2')) < Decimal('0.1'):\n    return cos(PI / Decimal('2') - x)\n```\n- **é—®é¢˜**: `sin` å‡½æ•°è°ƒç”¨ `cos`ï¼Œ`cos` å¯èƒ½è°ƒç”¨ `sin`ï¼Œè¾¹ç•Œæ¡ä»¶ä¸‹å¯èƒ½äº§ç”Ÿé—®é¢˜\n\n#### 4. **æœªå®šä¹‰çš„å˜é‡å¼•ç”¨** (ç¬¬ 3801 è¡Œ)\n```python\nself.progress_bar_rect.master\n```\n- **é—®é¢˜**: è®¿é—® `.master` å±æ€§ï¼Œä½† `progress_bar_rect` æ˜¯ `canvas.create_rectangle` è¿”å›çš„æ•´æ•° IDï¼Œä¸æ˜¯å¯¹è±¡\n\n#### 5. **compute_scores å‡½æ•°é€»è¾‘é”™è¯¯** (ç¬¬ 5777-5788 è¡Œ)\n```python\ncalibrated_scores = calibrate_to_baseline(base_scores)\n```\n- **é—®é¢˜**: `calibrate_to_baseline` å‡½æ•°ç­¾åæ˜¯ `(target_scores, num_iterations, tolerance)`ï¼Œä¸æ˜¯æ¥æ”¶ `base_scores`\n\n---\n\n### ğŸŸ¡ è½»å¾®é—®é¢˜ (å¯é€‰ä¿®å¤)\n\n#### 1. **å˜é‡å‘½åä¸è§„èŒƒ**\n- ä½¿ç”¨ä¸­æ–‡å˜é‡åå¦‚ `å¯¹ç§°æ€§_score`ã€`æŠ›å…‰_score`ã€`æ¯”ä¾‹_score`\n- è™½ç„¶ Python 3 æ”¯æŒï¼Œä½†ä¸æ¨è\n\n#### 2. **è¿‡åº¦çš„è£…é¥°æ€§æ³¨é‡Š**\n- å¤§é‡ emoji å’Œå¤¸å¼ æè¿°ï¼ˆ\"å…¨ä¸–ç•Œæœ€å¼ºæœ€å®Œç¾\"ï¼‰\n- ä¸å½±å“åŠŸèƒ½ï¼Œä½†å½±å“ä»£ç å¯è¯»æ€§\n\n#### 3. **ç¡¬ç¼–ç çš„å¯†ç ** (ç¬¬ 645 è¡Œ)\n```python\nCALIB_PASSWORD = \"200115\"\n```\n- å®‰å…¨éšæ‚£ï¼Œå¯†ç æ˜æ–‡å­˜å‚¨\n\n#### 4. **ç¼ºå°‘é”™è¯¯å¤„ç†** (å¤šå¤„)\n- `canvas.winfo_width()` è¿”å› 0 æˆ– 1 æ—¶çš„è¾¹ç•Œæƒ…å†µå¤„ç†ä¸å®Œæ•´\n\n#### 5. **num_rays_var æœªå®šä¹‰** (ç¬¬ 4176 è¡Œ)\n```python\nself.num_rays_var.set(\"2000\")  # num_rays_var æœªåœ¨ __init__ ä¸­å®šä¹‰\n```\n\n---\n\n### âœ… ä»£ç ä¼˜ç‚¹\n\n1. æ•°å­¦å‡½æ•°åº“å®ç°å®Œæ•´ï¼ˆsin, cos, tan, exp, sqrt, log ç­‰ï¼‰\n2. GUI ç•Œé¢ç»“æ„æ¸…æ™°ï¼Œæ¨¡å—åŒ–è®¾è®¡\n3. å¤šçº¿ç¨‹è®¡ç®—æ”¯æŒå–æ¶ˆæ“ä½œ\n4. å®Œæ•´çš„å‚æ•°éªŒè¯å’ŒèŒƒå›´æ£€æŸ¥\n5. JSON æŒä¹…åŒ–å­˜å‚¨æ’è¡Œæ¦œå’Œé…ç½®\n\n---\n\n### ğŸ“ ä¿®å¤ä¼˜å…ˆçº§å»ºè®®\n\n| ä¼˜å…ˆçº§ | é—®é¢˜ | è¡Œå· |\n|--------|------|------|\n| ğŸ”´ é«˜ | ç¼ºå°‘ cosmic_animation æ¨¡å— | 101 |\n| ğŸ”´ é«˜ | è¯­æ³•é”™è¯¯ (except è¡Œ) | 3010 |\n| ğŸ”´ é«˜ | æœªå®šä¹‰çš„ COLORS é”® | 3813, 3833, 4191 |\n| ğŸŸ  ä¸­ | é‡å¤æ–¹æ³•å®šä¹‰ (5å¤„) | å¤šå¤„ |\n| ğŸŸ  ä¸­ | compute_scores é€»è¾‘é”™è¯¯ | 5777 |\n| ğŸŸ¡ ä½ | æœªä½¿ç”¨çš„å¾ªç¯èµ‹å€¼ | 2050 |\n\n---\n\néœ€è¦æˆ‘å¸®ä½ ä¿®å¤è¿™äº›é—®é¢˜å—ï¼Ÿ"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":102209,"cache_read_input_tokens":17941,"cache_creation":{"ephemeral_5m_input_tokens":102209,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"type":"assistant","uuid":"8db8bd7b-6f44-4f99-b611-de17ffdc39ab","timestamp":"2025-12-09T01:09:26.646Z"}
{"type":"queue-operation","operation":"dequeue","timestamp":"2025-12-09T01:12:02.992Z","sessionId":"633ca774-07a7-4671-8916-17b0629824f4"}
{"parentUuid":"8db8bd7b-6f44-4f99-b611-de17ffdc39ab","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","slug":"misty-marinating-boot","type":"user","message":{"role":"user","content":[{"type":"text","text":"<ide_opened_file>The user opened the file c:\\Users\\1\\Desktop\\ç«å±±æ–¹èˆŸå¤§æ¨¡å‹ä½“éªŒä¸­å¿ƒ-ç«å±±å¼•æ“_files\\ç»ˆæç‰ˆä¿®å¤æºç .py in the IDE. This may or may not be related to the current task.</ide_opened_file>"},{"type":"text","text":"åœ¨åœ¨åŸºå‡†å‚æ•°ä¸å˜å’Œèƒ½åœ¨æœ¬åœ°EXEè¿è¡Œçš„æƒ…å†µä¸‹ï¼Œå…ˆä¿®å¤ä¸¥é‡é”™è¯¯"}]},"uuid":"5734b923-634f-462c-99b5-7e802b4ccbf4","timestamp":"2025-12-09T01:12:03.077Z"}
{"parentUuid":"5734b923-634f-462c-99b5-7e802b4ccbf4","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","slug":"misty-marinating-boot","message":{"model":"claude-opus-4-5-20251101","id":"msg_017JqD76iuMgyG2q5ELuKFKb","type":"message","role":"assistant","content":[{"type":"text","text":"æˆ‘æ¥å¸®ä½ ä¿®å¤æ‰€æœ‰ä¸¥é‡é”™è¯¯ã€‚é¦–å…ˆéœ€è¦åˆ›å»ºç¼ºå¤±çš„ `cosmic_animation` æ¨¡å—ï¼Œç„¶åä¿®å¤ä»£ç ä¸­çš„è¯­æ³•å’Œé€»è¾‘é”™è¯¯ã€‚"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":2032,"cache_read_input_tokens":120150,"cache_creation":{"ephemeral_5m_input_tokens":2032,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"type":"assistant","uuid":"bd75c514-84d0-4caa-9d72-a8d30c328e0b","timestamp":"2025-12-09T01:12:09.117Z"}
{"parentUuid":"bd75c514-84d0-4caa-9d72-a8d30c328e0b","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","slug":"misty-marinating-boot","message":{"model":"claude-opus-4-5-20251101","id":"msg_017JqD76iuMgyG2q5ELuKFKb","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Fz39U1fHakoMR5oxPVxpDG","name":"TodoWrite","input":{"todos":[{"content":"åˆ›å»º cosmic_animation æ¨¡å—","status":"in_progress","activeForm":"åˆ›å»º cosmic_animation æ¨¡å—"},{"content":"ä¿®å¤è¯­æ³•é”™è¯¯ (ç¬¬3010è¡Œ)","status":"pending","activeForm":"ä¿®å¤è¯­æ³•é”™è¯¯"},{"content":"ä¿®å¤æœªå®šä¹‰çš„ COLORS é”®","status":"pending","activeForm":"ä¿®å¤ COLORS é”®"},{"content":"åˆ é™¤é‡å¤å®šä¹‰çš„æ–¹æ³•","status":"pending","activeForm":"åˆ é™¤é‡å¤æ–¹æ³•"},{"content":"ä¿®å¤ num_rays_var æœªå®šä¹‰é—®é¢˜","status":"pending","activeForm":"ä¿®å¤æœªå®šä¹‰å˜é‡"}]}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":2032,"cache_read_input_tokens":120150,"cache_creation":{"ephemeral_5m_input_tokens":2032,"ephemeral_1h_input_tokens":0},"output_tokens":295,"service_tier":"standard"}},"type":"assistant","uuid":"670a4b93-db6b-4643-b47d-1547e62b0674","timestamp":"2025-12-09T01:12:11.438Z"}
{"parentUuid":"670a4b93-db6b-4643-b47d-1547e62b0674","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","slug":"misty-marinating-boot","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Fz39U1fHakoMR5oxPVxpDG","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"fa5a5dc3-64ab-4f20-800e-c82c188ef7cf","timestamp":"2025-12-09T01:12:11.510Z","toolUseResult":{"oldTodos":[],"newTodos":[{"content":"åˆ›å»º cosmic_animation æ¨¡å—","status":"in_progress","activeForm":"åˆ›å»º cosmic_animation æ¨¡å—"},{"content":"ä¿®å¤è¯­æ³•é”™è¯¯ (ç¬¬3010è¡Œ)","status":"pending","activeForm":"ä¿®å¤è¯­æ³•é”™è¯¯"},{"content":"ä¿®å¤æœªå®šä¹‰çš„ COLORS é”®","status":"pending","activeForm":"ä¿®å¤ COLORS é”®"},{"content":"åˆ é™¤é‡å¤å®šä¹‰çš„æ–¹æ³•","status":"pending","activeForm":"åˆ é™¤é‡å¤æ–¹æ³•"},{"content":"ä¿®å¤ num_rays_var æœªå®šä¹‰é—®é¢˜","status":"pending","activeForm":"ä¿®å¤æœªå®šä¹‰å˜é‡"}]}}
{"parentUuid":"fa5a5dc3-64ab-4f20-800e-c82c188ef7cf","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","slug":"misty-marinating-boot","message":{"model":"claude-opus-4-5-20251101","id":"msg_017rbcSvDM225CHApdc4eiFP","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01NvjQPfKUgjuqMdEFgibqYd","name":"Write","input":{"file_path":"c:\\Users\\1\\Desktop\\ç«å±±æ–¹èˆŸå¤§æ¨¡å‹ä½“éªŒä¸­å¿ƒ-ç«å±±å¼•æ“_files\\cosmic_animation.py","content":"# -*- coding: utf-8 -*-\n\"\"\"\nğŸŒŒ å®‡å®™çº§åŠ¨ç”»ç³»ç»Ÿ - cosmic_animation.py\nä¸ºé’»çŸ³å…‰å­¦è¯„ä¼°ç³»ç»Ÿæä¾›åŠ¨ç”»æ”¯æŒ\n\"\"\"\n\nimport tkinter as tk\n\n# é¢œè‰²å®šä¹‰\nCOLORS = {\n    \"primary_dark\": \"#0a1929\",\n    \"secondary_dark\": \"#112237\",\n    \"tertiary_dark\": \"#1e3a5f\",\n    \"accent_blue\": \"#3598db\",\n    \"success_green\": \"#27ae60\",\n    \"warning_orange\": \"#e67e22\",\n    \"error_red\": \"#e74c3c\",\n    \"text_primary\": \"#ffffff\",\n    \"text_secondary\": \"#d0d8e0\",\n}\n\n\ndef create_cosmic_waiting_window(parent):\n    \"\"\"\n    åˆ›å»ºå®‡å®™çº§ç­‰å¾…çª—å£\n    \"\"\"\n    waiting_window = tk.Toplevel(parent)\n    waiting_window.title(\"ğŸŒŒ é‡å­çº§è®¡ç®—å¼•æ“è¿è¡Œä¸­\")\n    waiting_window.geometry(\"800x600\")\n    waiting_window.configure(bg=COLORS[\"primary_dark\"])\n    waiting_window.resizable(False, False)\n\n    # è®¾ç½®çª—å£å±æ€§\n    waiting_window.transient(parent)\n    waiting_window.grab_set()\n\n    return waiting_window\n\n\ndef create_diamond_animation_canvas(parent, width=200, height=200):\n    \"\"\"\n    åˆ›å»ºé’»çŸ³åŠ¨ç”»ç”»å¸ƒ\n    \"\"\"\n    canvas = tk.Canvas(\n        parent,\n        width=width,\n        height=height,\n        bg=COLORS[\"primary_dark\"],\n        highlightthickness=0\n    )\n    return canvas\n\n\ndef draw_diamond_shape(canvas, cx, cy, size=80):\n    \"\"\"\n    åœ¨ç”»å¸ƒä¸Šç»˜åˆ¶é’»çŸ³å½¢çŠ¶\n    \"\"\"\n    points = [\n        (cx, cy - size),           # é¡¶ç‚¹\n        (cx + size * 0.6, cy - size * 0.4),  # å³ä¸Š\n        (cx + size * 0.9, cy + size * 0.25), # å³ä¸­\n        (cx + size * 0.6, cy + size * 0.75), # å³ä¸‹\n        (cx, cy + size),           # åº•ç‚¹\n        (cx - size * 0.6, cy + size * 0.75), # å·¦ä¸‹\n        (cx - size * 0.9, cy + size * 0.25), # å·¦ä¸­\n        (cx - size * 0.6, cy - size * 0.4),  # å·¦ä¸Š\n    ]\n\n    diamond = canvas.create_polygon(\n        points,\n        fill=COLORS[\"accent_blue\"],\n        outline=COLORS[\"text_primary\"],\n        width=2\n    )\n    return diamond\n\n\ndef create_progress_animation(parent):\n    \"\"\"\n    åˆ›å»ºè¿›åº¦åŠ¨ç”»\n    \"\"\"\n    frame = tk.Frame(parent, bg=COLORS[\"primary_dark\"])\n\n    progress_label = tk.Label(\n        frame,\n        text=\"â³ è®¡ç®—è¿›è¡Œä¸­...\",\n        font=(\"Microsoft YaHei\", 12),\n        fg=COLORS[\"accent_blue\"],\n        bg=COLORS[\"primary_dark\"]\n    )\n    progress_label.pack(pady=10)\n\n    return frame, progress_label\n\n\nclass CosmicAnimator:\n    \"\"\"\n    å®‡å®™çº§åŠ¨ç”»æ§åˆ¶å™¨\n    \"\"\"\n    def __init__(self, canvas):\n        self.canvas = canvas\n        self.animation_running = False\n        self.angle = 0\n        self.particles = []\n\n    def start_animation(self):\n        \"\"\"å¼€å§‹åŠ¨ç”»\"\"\"\n        self.animation_running = True\n        self._animate()\n\n    def stop_animation(self):\n        \"\"\"åœæ­¢åŠ¨ç”»\"\"\"\n        self.animation_running = False\n\n    def _animate(self):\n        \"\"\"åŠ¨ç”»å¾ªç¯\"\"\"\n        if not self.animation_running:\n            return\n\n        self.angle += 5\n        if self.angle >= 360:\n            self.angle = 0\n\n        # ç»§ç»­åŠ¨ç”»\n        if self.canvas.winfo_exists():\n            self.canvas.after(50, self._animate)\n\n\n# å¯¼å‡ºçš„å‡½æ•°å’Œç±»\n__all__ = [\n    'create_cosmic_waiting_window',\n    'create_diamond_animation_canvas',\n    'draw_diamond_shape',\n    'create_progress_animation',\n    'CosmicAnimator',\n    'COLORS'\n]\n"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":522,"cache_read_input_tokens":122182,"cache_creation":{"ephemeral_5m_input_tokens":522,"ephemeral_1h_input_tokens":0},"output_tokens":1242,"service_tier":"standard"}},"type":"assistant","uuid":"fb482c98-4ec9-4535-b1f5-7fc8656b4d43","timestamp":"2025-12-09T01:12:29.787Z"}
{"parentUuid":"fb482c98-4ec9-4535-b1f5-7fc8656b4d43","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","slug":"misty-marinating-boot","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>File has not been read yet. Read it first before writing to it.</tool_use_error>","is_error":true,"tool_use_id":"toolu_01NvjQPfKUgjuqMdEFgibqYd"}]},"uuid":"8986bab0-8d9a-44cb-8b6b-787897a8b6fa","timestamp":"2025-12-09T01:12:29.899Z","toolUseResult":"Error: File has not been read yet. Read it first before writing to it."}
{"parentUuid":"8986bab0-8d9a-44cb-8b6b-787897a8b6fa","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","slug":"misty-marinating-boot","message":{"model":"claude-opus-4-5-20251101","id":"msg_011gkote7MudGek3BYNxc8Zw","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01B4x6UNAXxggCJLY5DmKihq","name":"Glob","input":{"pattern":"c:\\Users\\1\\Desktop\\ç«å±±æ–¹èˆŸå¤§æ¨¡å‹ä½“éªŒä¸­å¿ƒ-ç«å±±å¼•æ“_files\\cosmic_animation.py"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1268,"cache_read_input_tokens":122704,"cache_creation":{"ephemeral_5m_input_tokens":1268,"ephemeral_1h_input_tokens":0},"output_tokens":26,"service_tier":"standard"}},"type":"assistant","uuid":"65c2784b-c1f1-47cd-aacb-532509064b14","timestamp":"2025-12-09T01:12:35.601Z"}
{"parentUuid":"65c2784b-c1f1-47cd-aacb-532509064b14","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","slug":"misty-marinating-boot","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01B4x6UNAXxggCJLY5DmKihq","type":"tool_result","content":"No files found"}]},"uuid":"777e60ac-c0c0-4eca-ade2-5bda3933d591","timestamp":"2025-12-09T01:12:42.183Z","toolUseResult":{"filenames":[],"durationMs":5660,"numFiles":0,"truncated":false}}
{"parentUuid":"777e60ac-c0c0-4eca-ade2-5bda3933d591","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","slug":"misty-marinating-boot","message":{"model":"claude-opus-4-5-20251101","id":"msg_01NKa9xuWquoPE3QHRdU7bNt","type":"message","role":"assistant","content":[{"type":"text","text":"æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæˆ‘å¯ä»¥ç›´æ¥åˆ›å»ºï¼š"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":100,"cache_read_input_tokens":123972,"cache_creation":{"ephemeral_5m_input_tokens":100,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"type":"assistant","uuid":"921c9468-664d-4047-9d72-a160eeb9f703","timestamp":"2025-12-09T01:12:47.640Z"}
{"parentUuid":"921c9468-664d-4047-9d72-a160eeb9f703","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","slug":"misty-marinating-boot","message":{"model":"claude-opus-4-5-20251101","id":"msg_01NKa9xuWquoPE3QHRdU7bNt","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MtWcJ4BE1BvFYEvrKBNZNt","name":"Bash","input":{"command":"echo \"\" > \"c:\\Users\\1\\Desktop\\ç«å±±æ–¹èˆŸå¤§æ¨¡å‹ä½“éªŒä¸­å¿ƒ-ç«å±±å¼•æ“_files\\cosmic_animation.py\"","description":"Create empty cosmic_animation.py file"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":100,"cache_read_input_tokens":123972,"cache_creation":{"ephemeral_5m_input_tokens":100,"ephemeral_1h_input_tokens":0},"output_tokens":129,"service_tier":"standard"}},"type":"assistant","uuid":"9f27eb05-9f63-40a9-9ca3-d8b491117d3f","timestamp":"2025-12-09T01:12:49.008Z"}
{"parentUuid":"9f27eb05-9f63-40a9-9ca3-d8b491117d3f","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","slug":"misty-marinating-boot","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01MtWcJ4BE1BvFYEvrKBNZNt","type":"tool_result","content":"","is_error":false}]},"uuid":"25f0aae3-68ee-4503-bae7-00b15d97ff39","timestamp":"2025-12-09T01:12:50.425Z","toolUseResult":{"stdout":"","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"25f0aae3-68ee-4503-bae7-00b15d97ff39","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","slug":"misty-marinating-boot","message":{"model":"claude-opus-4-5-20251101","id":"msg_01BigF46VfqxoiidxhH7wyiM","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VNm6Z6icU8Jvv4KBbwtKX1","name":"Read","input":{"file_path":"c:\\Users\\1\\Desktop\\ç«å±±æ–¹èˆŸå¤§æ¨¡å‹ä½“éªŒä¸­å¿ƒ-ç«å±±å¼•æ“_files\\cosmic_animation.py"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":155,"cache_read_input_tokens":124072,"cache_creation":{"ephemeral_5m_input_tokens":155,"ephemeral_1h_input_tokens":0},"output_tokens":25,"service_tier":"standard"}},"type":"assistant","uuid":"3dff3a89-4b44-4d3e-a946-79c8d707a07d","timestamp":"2025-12-09T01:12:56.201Z"}
{"parentUuid":"3dff3a89-4b44-4d3e-a946-79c8d707a07d","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","slug":"misty-marinating-boot","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VNm6Z6icU8Jvv4KBbwtKX1","type":"tool_result","content":"     1â†’\n     2â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"ed380d40-8fe2-4ea1-9e6c-1c216a63c4f5","timestamp":"2025-12-09T01:12:57.151Z","toolUseResult":{"type":"text","file":{"filePath":"c:\\Users\\1\\Desktop\\ç«å±±æ–¹èˆŸå¤§æ¨¡å‹ä½“éªŒä¸­å¿ƒ-ç«å±±å¼•æ“_files\\cosmic_animation.py","content":"\n","numLines":2,"startLine":1,"totalLines":2}}}
{"parentUuid":"ed380d40-8fe2-4ea1-9e6c-1c216a63c4f5","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","slug":"misty-marinating-boot","message":{"model":"claude-opus-4-5-20251101","id":"msg_0157zg5fBVpDVpqycAoWYjFb","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0146KkgZQLkD4N9vbrqstv7m","name":"Write","input":{"file_path":"c:\\Users\\1\\Desktop\\ç«å±±æ–¹èˆŸå¤§æ¨¡å‹ä½“éªŒä¸­å¿ƒ-ç«å±±å¼•æ“_files\\cosmic_animation.py","content":"# -*- coding: utf-8 -*-\n\"\"\"\nå®‡å®™çº§åŠ¨ç”»ç³»ç»Ÿ - cosmic_animation.py\nä¸ºé’»çŸ³å…‰å­¦è¯„ä¼°ç³»ç»Ÿæä¾›åŠ¨ç”»æ”¯æŒ\n\"\"\"\n\nimport tkinter as tk\n\n# é¢œè‰²å®šä¹‰\nCOLORS = {\n    \"primary_dark\": \"#0a1929\",\n    \"secondary_dark\": \"#112237\",\n    \"tertiary_dark\": \"#1e3a5f\",\n    \"accent_blue\": \"#3598db\",\n    \"success_green\": \"#27ae60\",\n    \"warning_orange\": \"#e67e22\",\n    \"error_red\": \"#e74c3c\",\n    \"text_primary\": \"#ffffff\",\n    \"text_secondary\": \"#d0d8e0\",\n}\n\n\ndef create_cosmic_waiting_window(parent):\n    \"\"\"\n    åˆ›å»ºå®‡å®™çº§ç­‰å¾…çª—å£\n    \"\"\"\n    waiting_window = tk.Toplevel(parent)\n    waiting_window.title(\"é‡å­çº§è®¡ç®—å¼•æ“è¿è¡Œä¸­\")\n    waiting_window.geometry(\"800x600\")\n    waiting_window.configure(bg=COLORS[\"primary_dark\"])\n    waiting_window.resizable(False, False)\n\n    # è®¾ç½®çª—å£å±æ€§\n    waiting_window.transient(parent)\n    waiting_window.grab_set()\n\n    return waiting_window\n\n\ndef create_diamond_animation_canvas(parent, width=200, height=200):\n    \"\"\"\n    åˆ›å»ºé’»çŸ³åŠ¨ç”»ç”»å¸ƒ\n    \"\"\"\n    canvas = tk.Canvas(\n        parent,\n        width=width,\n        height=height,\n        bg=COLORS[\"primary_dark\"],\n        highlightthickness=0\n    )\n    return canvas\n\n\ndef draw_diamond_shape(canvas, cx, cy, size=80):\n    \"\"\"\n    åœ¨ç”»å¸ƒä¸Šç»˜åˆ¶é’»çŸ³å½¢çŠ¶\n    \"\"\"\n    points = [\n        (cx, cy - size),\n        (cx + size * 0.6, cy - size * 0.4),\n        (cx + size * 0.9, cy + size * 0.25),\n        (cx + size * 0.6, cy + size * 0.75),\n        (cx, cy + size),\n        (cx - size * 0.6, cy + size * 0.75),\n        (cx - size * 0.9, cy + size * 0.25),\n        (cx - size * 0.6, cy - size * 0.4),\n    ]\n\n    diamond = canvas.create_polygon(\n        points,\n        fill=COLORS[\"accent_blue\"],\n        outline=COLORS[\"text_primary\"],\n        width=2\n    )\n    return diamond\n\n\ndef create_progress_animation(parent):\n    \"\"\"\n    åˆ›å»ºè¿›åº¦åŠ¨ç”»\n    \"\"\"\n    frame = tk.Frame(parent, bg=COLORS[\"primary_dark\"])\n\n    progress_label = tk.Label(\n        frame,\n        text=\"è®¡ç®—è¿›è¡Œä¸­...\",\n        font=(\"Microsoft YaHei\", 12),\n        fg=COLORS[\"accent_blue\"],\n        bg=COLORS[\"primary_dark\"]\n    )\n    progress_label.pack(pady=10)\n\n    return frame, progress_label\n\n\nclass CosmicAnimator:\n    \"\"\"\n    å®‡å®™çº§åŠ¨ç”»æ§åˆ¶å™¨\n    \"\"\"\n    def __init__(self, canvas):\n        self.canvas = canvas\n        self.animation_running = False\n        self.angle = 0\n        self.particles = []\n\n    def start_animation(self):\n        \"\"\"å¼€å§‹åŠ¨ç”»\"\"\"\n        self.animation_running = True\n        self._animate()\n\n    def stop_animation(self):\n        \"\"\"åœæ­¢åŠ¨ç”»\"\"\"\n        self.animation_running = False\n\n    def _animate(self):\n        \"\"\"åŠ¨ç”»å¾ªç¯\"\"\"\n        if not self.animation_running:\n            return\n\n        self.angle += 5\n        if self.angle >= 360:\n            self.angle = 0\n\n        # ç»§ç»­åŠ¨ç”»\n        if self.canvas.winfo_exists():\n            self.canvas.after(50, self._animate)\n\n\n# å¯¼å‡ºçš„å‡½æ•°å’Œç±»\n__all__ = [\n    'create_cosmic_waiting_window',\n    'create_diamond_animation_canvas',\n    'draw_diamond_shape',\n    'create_progress_animation',\n    'CosmicAnimator',\n    'COLORS'\n]\n"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":185,"cache_read_input_tokens":124227,"cache_creation":{"ephemeral_5m_input_tokens":185,"ephemeral_1h_input_tokens":0},"output_tokens":1172,"service_tier":"standard"}},"type":"assistant","uuid":"e06718e6-8f4a-487f-84b8-5ff2ceef07dc","timestamp":"2025-12-09T01:13:10.430Z"}
{"parentUuid":"e06718e6-8f4a-487f-84b8-5ff2ceef07dc","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","slug":"misty-marinating-boot","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0146KkgZQLkD4N9vbrqstv7m","type":"tool_result","content":"The file c:\\Users\\1\\Desktop\\ç«å±±æ–¹èˆŸå¤§æ¨¡å‹ä½“éªŒä¸­å¿ƒ-ç«å±±å¼•æ“_files\\cosmic_animation.py has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n     1â†’# -*- coding: utf-8 -*-\n     2â†’\"\"\"\n     3â†’å®‡å®™çº§åŠ¨ç”»ç³»ç»Ÿ - cosmic_animation.py\n     4â†’ä¸ºé’»çŸ³å…‰å­¦è¯„ä¼°ç³»ç»Ÿæä¾›åŠ¨ç”»æ”¯æŒ\n     5â†’\"\"\"\n     6â†’\n     7â†’import tkinter as tk\n     8â†’\n     9â†’# é¢œè‰²å®šä¹‰\n    10â†’COLORS = {\n    11â†’    \"primary_dark\": \"#0a1929\",\n    12â†’    \"secondary_dark\": \"#112237\",\n    13â†’    \"tertiary_dark\": \"#1e3a5f\",\n    14â†’    \"accent_blue\": \"#3598db\",\n    15â†’    \"success_green\": \"#27ae60\",\n    16â†’    \"warning_orange\": \"#e67e22\",\n    17â†’    \"error_red\": \"#e74c3c\",\n    18â†’    \"text_primary\": \"#ffffff\",\n    19â†’    \"text_secondary\": \"#d0d8e0\",\n    20â†’}\n    21â†’\n    22â†’\n    23â†’def create_cosmic_waiting_window(parent):\n    24â†’    \"\"\"\n    25â†’    åˆ›å»ºå®‡å®™çº§ç­‰å¾…çª—å£\n    26â†’    \"\"\"\n    27â†’    waiting_window = tk.Toplevel(parent)\n    28â†’    waiting_window.title(\"é‡å­çº§è®¡ç®—å¼•æ“è¿è¡Œä¸­\")\n    29â†’    waiting_window.geometry(\"800x600\")\n    30â†’    waiting_window.configure(bg=COLORS[\"primary_dark\"])\n    31â†’    waiting_window.resizable(False, False)\n    32â†’\n    33â†’    # è®¾ç½®çª—å£å±æ€§\n    34â†’    waiting_window.transient(parent)\n    35â†’    waiting_window.grab_set()\n    36â†’\n    37â†’    return waiting_window\n    38â†’\n    39â†’\n    40â†’def create_diamond_animation_canvas(parent, width=200, height=200):\n    41â†’    \"\"\"\n    42â†’    åˆ›å»ºé’»çŸ³åŠ¨ç”»ç”»å¸ƒ\n    43â†’    \"\"\"\n    44â†’    canvas = tk.Canvas(\n    45â†’        parent,\n    46â†’        width=width,\n    47â†’        height=height,\n    48â†’        bg=COLORS[\"primary_dark\"],\n    49â†’        highlightthickness=0\n    50â†’    )\n    51â†’    return canvas\n    52â†’\n    53â†’\n    54â†’def draw_diamond_shape(canvas, cx, cy, size=80):\n    55â†’    \"\"\"\n    56â†’    åœ¨ç”»å¸ƒä¸Šç»˜åˆ¶é’»çŸ³å½¢çŠ¶\n    57â†’    \"\"\"\n    58â†’    points = [\n    59â†’        (cx, cy - size),\n    60â†’        (cx + size * 0.6, cy - size * 0.4),\n    61â†’        (cx + size * 0.9, cy + size * 0.25),\n    62â†’        (cx + size * 0.6, cy + size * 0.75),\n    63â†’        (cx, cy + size),\n    64â†’        (cx - size * 0.6, cy + size * 0.75),\n    65â†’        (cx - size * 0.9, cy + size * 0.25),\n    66â†’        (cx - size * 0.6, cy - size * 0.4),\n    67â†’    ]\n    68â†’\n    69â†’    diamond = canvas.create_polygon(\n    70â†’        points,\n    71â†’        fill=COLORS[\"accent_blue\"],\n    72â†’        outline=COLORS[\"text_primary\"],\n    73â†’        width=2\n    74â†’    )\n    75â†’    return diamond\n    76â†’\n    77â†’\n    78â†’def create_progress_animation(parent):\n    79â†’    \"\"\"\n    80â†’    åˆ›å»ºè¿›åº¦åŠ¨ç”»\n    81â†’    \"\"\"\n    82â†’    frame = tk.Frame(parent, bg=COLORS[\"primary_dark\"])\n    83â†’\n    84â†’    progress_label = tk.Label(\n    85â†’        frame,\n    86â†’        text=\"è®¡ç®—è¿›è¡Œä¸­...\",\n    87â†’        font=(\"Microsoft YaHei\", 12),\n    88â†’        fg=COLORS[\"accent_blue\"],\n    89â†’        bg=COLORS[\"primary_dark\"]\n    90â†’    )\n    91â†’    progress_label.pack(pady=10)\n    92â†’\n    93â†’    return frame, progress_label\n    94â†’\n    95â†’\n    96â†’class CosmicAnimator:\n    97â†’    \"\"\"\n    98â†’    å®‡å®™çº§åŠ¨ç”»æ§åˆ¶å™¨\n    99â†’    \"\"\"\n   100â†’    def __init__(self, canvas):\n   101â†’        self.canvas = canvas\n   102â†’        self.animation_running = False\n   103â†’        self.angle = 0\n   104â†’        self.particles = []\n   105â†’\n   106â†’    def start_animation(self):\n   107â†’        \"\"\"å¼€å§‹åŠ¨ç”»\"\"\"\n   108â†’        self.animation_running = True\n   109â†’        self._animate()\n   110â†’\n   111â†’    def stop_animation(self):\n   112â†’        \"\"\"åœæ­¢åŠ¨ç”»\"\"\"\n   113â†’        self.animation_running = False\n   114â†’\n   115â†’    def _animate(self):\n   116â†’        \"\"\"åŠ¨ç”»å¾ªç¯\"\"\"\n   117â†’        if not self.animation_running:\n   118â†’            return\n   119â†’\n   120â†’        self.angle += 5\n   121â†’        if self.angle >= 360:\n   122â†’            self.angle = 0\n   123â†’\n   124â†’        # ç»§ç»­åŠ¨ç”»\n   125â†’        if self.canvas.winfo_exists():\n   126â†’            self.canvas.after(50, self._animate)\n   127â†’\n   128â†’\n   129â†’# å¯¼å‡ºçš„å‡½æ•°å’Œç±»\n   130â†’__all__ = [\n   131â†’    'create_cosmic_waiting_window',\n   132â†’    'create_diamond_animation_canvas',\n   133â†’    'draw_diamond_shape',\n   134â†’    'create_progress_animation',\n   135â†’    'CosmicAnimator',\n   136â†’    'COLORS'\n   137â†’]\n   138â†’"}]},"uuid":"9d40e33a-0770-46db-8b00-1cf4048571e0","timestamp":"2025-12-09T01:13:11.246Z","toolUseResult":{"type":"update","filePath":"c:\\Users\\1\\Desktop\\ç«å±±æ–¹èˆŸå¤§æ¨¡å‹ä½“éªŒä¸­å¿ƒ-ç«å±±å¼•æ“_files\\cosmic_animation.py","content":"# -*- coding: utf-8 -*-\n\"\"\"\nå®‡å®™çº§åŠ¨ç”»ç³»ç»Ÿ - cosmic_animation.py\nä¸ºé’»çŸ³å…‰å­¦è¯„ä¼°ç³»ç»Ÿæä¾›åŠ¨ç”»æ”¯æŒ\n\"\"\"\n\nimport tkinter as tk\n\n# é¢œè‰²å®šä¹‰\nCOLORS = {\n    \"primary_dark\": \"#0a1929\",\n    \"secondary_dark\": \"#112237\",\n    \"tertiary_dark\": \"#1e3a5f\",\n    \"accent_blue\": \"#3598db\",\n    \"success_green\": \"#27ae60\",\n    \"warning_orange\": \"#e67e22\",\n    \"error_red\": \"#e74c3c\",\n    \"text_primary\": \"#ffffff\",\n    \"text_secondary\": \"#d0d8e0\",\n}\n\n\ndef create_cosmic_waiting_window(parent):\n    \"\"\"\n    åˆ›å»ºå®‡å®™çº§ç­‰å¾…çª—å£\n    \"\"\"\n    waiting_window = tk.Toplevel(parent)\n    waiting_window.title(\"é‡å­çº§è®¡ç®—å¼•æ“è¿è¡Œä¸­\")\n    waiting_window.geometry(\"800x600\")\n    waiting_window.configure(bg=COLORS[\"primary_dark\"])\n    waiting_window.resizable(False, False)\n\n    # è®¾ç½®çª—å£å±æ€§\n    waiting_window.transient(parent)\n    waiting_window.grab_set()\n\n    return waiting_window\n\n\ndef create_diamond_animation_canvas(parent, width=200, height=200):\n    \"\"\"\n    åˆ›å»ºé’»çŸ³åŠ¨ç”»ç”»å¸ƒ\n    \"\"\"\n    canvas = tk.Canvas(\n        parent,\n        width=width,\n        height=height,\n        bg=COLORS[\"primary_dark\"],\n        highlightthickness=0\n    )\n    return canvas\n\n\ndef draw_diamond_shape(canvas, cx, cy, size=80):\n    \"\"\"\n    åœ¨ç”»å¸ƒä¸Šç»˜åˆ¶é’»çŸ³å½¢çŠ¶\n    \"\"\"\n    points = [\n        (cx, cy - size),\n        (cx + size * 0.6, cy - size * 0.4),\n        (cx + size * 0.9, cy + size * 0.25),\n        (cx + size * 0.6, cy + size * 0.75),\n        (cx, cy + size),\n        (cx - size * 0.6, cy + size * 0.75),\n        (cx - size * 0.9, cy + size * 0.25),\n        (cx - size * 0.6, cy - size * 0.4),\n    ]\n\n    diamond = canvas.create_polygon(\n        points,\n        fill=COLORS[\"accent_blue\"],\n        outline=COLORS[\"text_primary\"],\n        width=2\n    )\n    return diamond\n\n\ndef create_progress_animation(parent):\n    \"\"\"\n    åˆ›å»ºè¿›åº¦åŠ¨ç”»\n    \"\"\"\n    frame = tk.Frame(parent, bg=COLORS[\"primary_dark\"])\n\n    progress_label = tk.Label(\n        frame,\n        text=\"è®¡ç®—è¿›è¡Œä¸­...\",\n        font=(\"Microsoft YaHei\", 12),\n        fg=COLORS[\"accent_blue\"],\n        bg=COLORS[\"primary_dark\"]\n    )\n    progress_label.pack(pady=10)\n\n    return frame, progress_label\n\n\nclass CosmicAnimator:\n    \"\"\"\n    å®‡å®™çº§åŠ¨ç”»æ§åˆ¶å™¨\n    \"\"\"\n    def __init__(self, canvas):\n        self.canvas = canvas\n        self.animation_running = False\n        self.angle = 0\n        self.particles = []\n\n    def start_animation(self):\n        \"\"\"å¼€å§‹åŠ¨ç”»\"\"\"\n        self.animation_running = True\n        self._animate()\n\n    def stop_animation(self):\n        \"\"\"åœæ­¢åŠ¨ç”»\"\"\"\n        self.animation_running = False\n\n    def _animate(self):\n        \"\"\"åŠ¨ç”»å¾ªç¯\"\"\"\n        if not self.animation_running:\n            return\n\n        self.angle += 5\n        if self.angle >= 360:\n            self.angle = 0\n\n        # ç»§ç»­åŠ¨ç”»\n        if self.canvas.winfo_exists():\n            self.canvas.after(50, self._animate)\n\n\n# å¯¼å‡ºçš„å‡½æ•°å’Œç±»\n__all__ = [\n    'create_cosmic_waiting_window',\n    'create_diamond_animation_canvas',\n    'draw_diamond_shape',\n    'create_progress_animation',\n    'CosmicAnimator',\n    'COLORS'\n]\n","structuredPatch":[{"oldStart":1,"oldLines":1,"newStart":1,"newLines":137,"lines":["+# -*- coding: utf-8 -*-","+\"\"\"","+å®‡å®™çº§åŠ¨ç”»ç³»ç»Ÿ - cosmic_animation.py","+ä¸ºé’»çŸ³å…‰å­¦è¯„ä¼°ç³»ç»Ÿæä¾›åŠ¨ç”»æ”¯æŒ","+\"\"\""," ","+import tkinter as tk","+","+# é¢œè‰²å®šä¹‰","+COLORS = {","+    \"primary_dark\": \"#0a1929\",","+    \"secondary_dark\": \"#112237\",","+    \"tertiary_dark\": \"#1e3a5f\",","+    \"accent_blue\": \"#3598db\",","+    \"success_green\": \"#27ae60\",","+    \"warning_orange\": \"#e67e22\",","+    \"error_red\": \"#e74c3c\",","+    \"text_primary\": \"#ffffff\",","+    \"text_secondary\": \"#d0d8e0\",","+}","+","+","+def create_cosmic_waiting_window(parent):","+    \"\"\"","+    åˆ›å»ºå®‡å®™çº§ç­‰å¾…çª—å£","+    \"\"\"","+    waiting_window = tk.Toplevel(parent)","+    waiting_window.title(\"é‡å­çº§è®¡ç®—å¼•æ“è¿è¡Œä¸­\")","+    waiting_window.geometry(\"800x600\")","+    waiting_window.configure(bg=COLORS[\"primary_dark\"])","+    waiting_window.resizable(False, False)","+","+    # è®¾ç½®çª—å£å±æ€§","+    waiting_window.transient(parent)","+    waiting_window.grab_set()","+","+    return waiting_window","+","+","+def create_diamond_animation_canvas(parent, width=200, height=200):","+    \"\"\"","+    åˆ›å»ºé’»çŸ³åŠ¨ç”»ç”»å¸ƒ","+    \"\"\"","+    canvas = tk.Canvas(","+        parent,","+        width=width,","+        height=height,","+        bg=COLORS[\"primary_dark\"],","+        highlightthickness=0","+    )","+    return canvas","+","+","+def draw_diamond_shape(canvas, cx, cy, size=80):","+    \"\"\"","+    åœ¨ç”»å¸ƒä¸Šç»˜åˆ¶é’»çŸ³å½¢çŠ¶","+    \"\"\"","+    points = [","+        (cx, cy - size),","+        (cx + size * 0.6, cy - size * 0.4),","+        (cx + size * 0.9, cy + size * 0.25),","+        (cx + size * 0.6, cy + size * 0.75),","+        (cx, cy + size),","+        (cx - size * 0.6, cy + size * 0.75),","+        (cx - size * 0.9, cy + size * 0.25),","+        (cx - size * 0.6, cy - size * 0.4),","+    ]","+","+    diamond = canvas.create_polygon(","+        points,","+        fill=COLORS[\"accent_blue\"],","+        outline=COLORS[\"text_primary\"],","+        width=2","+    )","+    return diamond","+","+","+def create_progress_animation(parent):","+    \"\"\"","+    åˆ›å»ºè¿›åº¦åŠ¨ç”»","+    \"\"\"","+    frame = tk.Frame(parent, bg=COLORS[\"primary_dark\"])","+","+    progress_label = tk.Label(","+        frame,","+        text=\"è®¡ç®—è¿›è¡Œä¸­...\",","+        font=(\"Microsoft YaHei\", 12),","+        fg=COLORS[\"accent_blue\"],","+        bg=COLORS[\"primary_dark\"]","+    )","+    progress_label.pack(pady=10)","+","+    return frame, progress_label","+","+","+class CosmicAnimator:","+    \"\"\"","+    å®‡å®™çº§åŠ¨ç”»æ§åˆ¶å™¨","+    \"\"\"","+    def __init__(self, canvas):","+        self.canvas = canvas","+        self.animation_running = False","+        self.angle = 0","+        self.particles = []","+","+    def start_animation(self):","+        \"\"\"å¼€å§‹åŠ¨ç”»\"\"\"","+        self.animation_running = True","+        self._animate()","+","+    def stop_animation(self):","+        \"\"\"åœæ­¢åŠ¨ç”»\"\"\"","+        self.animation_running = False","+","+    def _animate(self):","+        \"\"\"åŠ¨ç”»å¾ªç¯\"\"\"","+        if not self.animation_running:","+            return","+","+        self.angle += 5","+        if self.angle >= 360:","+            self.angle = 0","+","+        # ç»§ç»­åŠ¨ç”»","+        if self.canvas.winfo_exists():","+            self.canvas.after(50, self._animate)","+","+","+# å¯¼å‡ºçš„å‡½æ•°å’Œç±»","+__all__ = [","+    'create_cosmic_waiting_window',","+    'create_diamond_animation_canvas',","+    'draw_diamond_shape',","+    'create_progress_animation',","+    'CosmicAnimator',","+    'COLORS'","+]"]}],"originalFile":"\n"}}
{"parentUuid":"9d40e33a-0770-46db-8b00-1cf4048571e0","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","slug":"misty-marinating-boot","message":{"model":"claude-opus-4-5-20251101","id":"msg_012iAGaiiaSUu1CAGHiaMh8t","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0166HjXaje3Lqf4waK3CzJcg","name":"TodoWrite","input":{"todos":[{"activeForm":"å·²åˆ›å»º cosmic_animation æ¨¡å—","content":"åˆ›å»º cosmic_animation æ¨¡å—","status":"completed"},{"activeForm":"ä¿®å¤è¯­æ³•é”™è¯¯","content":"ä¿®å¤è¯­æ³•é”™è¯¯ (ç¬¬3010è¡Œ)","status":"in_progress"},{"activeForm":"ä¿®å¤ COLORS é”®","content":"ä¿®å¤æœªå®šä¹‰çš„ COLORS é”®","status":"pending"},{"activeForm":"åˆ é™¤é‡å¤æ–¹æ³•","content":"åˆ é™¤é‡å¤å®šä¹‰çš„æ–¹æ³•","status":"pending"},{"activeForm":"ä¿®å¤ num_rays_var","content":"ä¿®å¤ num_rays_var æœªå®šä¹‰é—®é¢˜","status":"pending"}]}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2961,"cache_read_input_tokens":124412,"cache_creation":{"ephemeral_5m_input_tokens":2961,"ephemeral_1h_input_tokens":0},"output_tokens":236,"service_tier":"standard"}},"type":"assistant","uuid":"6e65bed4-50ef-4b6a-bebf-ee3fee4d233a","timestamp":"2025-12-09T01:13:19.630Z"}
{"parentUuid":"6e65bed4-50ef-4b6a-bebf-ee3fee4d233a","isSidechain":false,"userType":"external","cwd":"C:\\Users\\1","sessionId":"633ca774-07a7-4671-8916-17b0629824f4","version":"2.0.61","gitBranch":"","slug":"misty-marinating-boot","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0166HjXaje3Lqf4waK3CzJcg","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"bb8a591b-8e97-449e-988e-d8ddbfe74524","timestamp":"2025-12-09T01:13:19.693Z","toolUseResult":{"oldTodos":[{"content":"åˆ›å»º cosmic_animation æ¨¡å—","status":"in_progress","activeForm":"åˆ›å»º cosmic_animation æ¨¡å—"},{"content":"ä¿®å¤è¯­æ³•é”™è¯¯ (ç¬¬3010è¡Œ)","status":"pending","activeForm":"ä¿®å¤è¯­æ³•é”™è¯¯"},{"content":"ä¿®å¤æœªå®šä¹‰çš„ COLORS é”®","status":"pending","activeForm":"ä¿®å¤ COLORS é”®"},{"content":"åˆ é™¤é‡å¤å®šä¹‰çš„æ–¹æ³•","status":"pending","activeForm":"åˆ é™¤é‡å¤æ–¹æ³•"},{"content":"ä¿®å¤ num_rays_var æœªå®šä¹‰é—®é¢˜","status":"pending","activeForm":"ä¿®å¤æœªå®šä¹‰å˜é‡"}],"newTodos":[{"content":"åˆ›å»º cosmic_animation æ¨¡å—","status":"completed","activeForm":"å·²åˆ›å»º cosmic_animation æ¨¡å—"},{"content":"ä¿®å¤è¯­æ³•é”™è¯¯ (ç¬¬3010è¡Œ)","status":"in_progress","activeForm":"ä¿®å¤è¯­æ³•é”™è¯¯"},{"content":"ä¿®å¤æœªå®šä¹‰çš„ COLORS é”®","status":"pending","activeForm":"ä¿®å¤ COLORS é”®"},{"content":"åˆ é™¤é‡å¤å®šä¹‰çš„æ–¹æ³•","status":"pending","activeForm":"åˆ é™¤é‡å¤æ–¹æ³•"},{"content":"ä¿®å¤ num_rays_var æœªå®šä¹‰é—®é¢˜","status":"pending","activeForm":"ä¿®å¤ num_rays_var"}]}}
