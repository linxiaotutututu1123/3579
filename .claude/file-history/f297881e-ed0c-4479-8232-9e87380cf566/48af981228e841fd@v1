# CLAUDE上校 项目进度记忆文件

> **最后更新**: 2025-12-17
> **当前阶段**: V4PRO军规级升级计划实施中
> **身份**: 军规级别国家伟大工程总工程师 CLAUDE上校

---

## 一、项目核心指令

**最高军令**:
1. 专注于中国期货市场
2. 全程使用中文（代码注释、文档、日志）
3. 严格遵守军规 M1-M20
4. 保证风险控制的前提下最大化收益
5. 所有模块必须通过门禁检查方可合并

**核心目标**: 把代码与规格通过"可回放、可审计、可验证"的门禁闭环交付

---

## 二、审计报告推荐实施模块 (来源: 未确定方案/V4PRO军规级审计报告_CLAUDE上校.md)

| 模块 | 可行性 | 风险 | 状态 | 完成日期 |
|------|--------|------|------|----------|
| 策略联邦中枢 | ★★★★☆ | MEDIUM | ✅ 完成 | 2025-12-17 |
| 动态风控引擎 | ★★★☆☆ | HIGH | ✅ 完成 | 2025-12-17 |
| 多维收益归因 | ★★★★★ | LOW | 🔄 进行中 | - |
| 实验策略门禁闭环 | ★★★★☆ | LOW | ⏸ 待实施 | - |
| 夜盘全链路集成 | ★★★★★ | LOW | ⏸ 待实施 | - |

---

## 三、已完成模块详情

### 3.1 策略联邦中枢 (✅ 完成)
- **位置**: `src/strategy/federation/`
- **核心文件**:
  - `central_coordinator.py` (~696行)
  - `__init__.py`
- **测试文件**: `tests/test_strategy_federation.py` (44个测试)
- **军规覆盖**: M1 (单一信号源), M19 (风险归因), M20 (跨所一致)
- **核心功能**:
  - StrategyFederation 联邦管理器
  - CorrelationMatrix 相关性矩阵
  - FederationSignal 联邦信号
  - 动态权重更新
  - 相关性惩罚机制

### 3.2 动态风控引擎 (✅ 完成)
- **位置**: `src/risk/dynamic_var.py`
- **测试文件**: `tests/test_dynamic_var.py`
- **军规覆盖**: M6 (熔断保护), M13 (涨跌停感知), M16 (保证金监控)
- **核心功能**:
  - EVT极值理论VaR (POT + GPD)
  - 半参数VaR (核密度 + GPD)
  - 涨跌停调整VaR
  - 流动性调整VaR
  - 风险等级动态计算

### 3.3 风险归因模块 (已部分实施 - v4.1)
- **位置**: `src/risk/attribution.py`
- **军规覆盖**: M19 (风险归因)
- **已实现**:
  - SHAP值计算
  - 因子归因 (动量/成交量/波动率)
  - 亏损订单自动归因
  - 审计日志记录

---

## 四、待实施模块

### 4.1 多维收益归因扩展
需要扩展的功能:
- [ ] 策略级归因 (按策略分解)
- [ ] 持仓级归因 (按合约分解)
- [ ] 时间序列归因
- [ ] 与策略联邦集成

### 4.2 实验策略门禁闭环
需要实施:
- [ ] 成熟度与资金分配联动
- [ ] 自动晋升/降级机制
- [ ] 训练状态追踪闭环

### 4.3 夜盘全链路集成
需要实施:
- [ ] 夜盘信号生成
- [ ] 跨日持仓处理
- [ ] 夜盘风控特殊规则

---

## 五、关键文件路径

### 核心指示文件
- `docs/V4PRO_UPGRADE_PLAN_SUPREME_DIRECTIVE.md` - 最高指示文件
- `docs/V4PRO_ACCEPTANCE_MATRIX_SUPREME.md` - 验收矩阵 (165场景)
- `未确定方案/V4PRO军规级审计报告_CLAUDE上校.md` - 审计报告

### 已完成模块
- `src/strategy/federation/` - 策略联邦
- `src/risk/dynamic_var.py` - 动态VaR
- `src/risk/attribution.py` - 风险归因

### 待实施模块位置
- `src/strategy/experimental/` - 实验策略门禁
- `src/market/trading_calendar.py` - 交易日历

---

## 六、门禁状态

| 门禁 | 状态 | 备注 |
|------|------|------|
| Ruff Check | ✅ PASS | - |
| Ruff Format | ✅ PASS | - |
| Mypy | ✅ PASS | - |
| Pytest | ✅ PASS | 2029+ tests |
| Coverage | ~88% | - |
| Policy | ✅ PASS | - |

---

## 七、军规速查 M1-M20

| 军规 | 名称 | 要点 |
|------|------|------|
| M1 | 单一信号源 | 一个交易信号只能来自一个策略实例 |
| M3 | 完整审计 | 所有决策必须有审计日志 |
| M4 | 降级兜底 | 策略异常必须有降级路径 |
| M5 | 成本先行 | 信号边际收益必须大于成本 |
| M6 | 熔断保护 | 触发风控阈值必须立即停止 |
| M7 | 回放一致 | 相同输入必须产生相同输出 |
| M12 | 双重确认 | 大额订单需人工或二次确认 |
| M13 | 涨跌停感知 | 订单价格必须检查涨跌停板 |
| M14 | 平今平昨分离 | 平仓时必须区分平今/平昨 |
| M15 | 夜盘跨日处理 | 夜盘交易日归属必须正确 |
| M16 | 保证金实时监控 | 保证金使用率必须实时计算 |
| M17 | 程序化合规 | 报撤单频率必须在监管阈值内 |
| M18 | 实验性门禁 | 未成熟策略禁止实盘启用 |
| M19 | 风险归因 | 每笔亏损必须有归因分析 |
| M20 | 跨所一致 | 不同交易所逻辑必须一致 |

---

**每次任务前必读文件**:
1. `docs/V4PRO_UPGRADE_PLAN_SUPREME_DIRECTIVE.md`
2. `docs/CLAUDE_PROJECT_MEMORY.md` (本文件)

---

*为国家争光！为人民争光！*
*CLAUDE上校 敬礼！*
