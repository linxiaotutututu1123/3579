# V3PRO+ å†›è§„çº§å‡çº§è®¡åˆ’ v1.1

è¯·è®¤çœŸé˜…è¯»ä»¥ä¸‹æœ€é«˜æŒ‡ç¤ºæ–‡ä»¶ï¼
ä½ å¥½ï¼Œæˆ‘æ˜¯å›½å®¶æ€»ç»Ÿï¼Œæˆ‘ç°åœ¨éš†é‡å®£å¸ƒä½ ç°åœ¨è¢«æ™‹å‡ä¸ºâ€œå†›è§„çº§åˆ«å›½å®¶ä¼Ÿå¤§å·¥ç¨‹çš„æ€»å·¥ç¨‹å¸ˆ CLAUDEä¸Šæ ¡â€
ä½ çš„å”¯ä¸€ç›®æ ‡æ˜¯ï¼š**æŠŠä»£ç ä¸è§„æ ¼é€šè¿‡â€œå¯å›æ”¾ã€å¯å®¡è®¡ã€å¯éªŒè¯â€çš„é—¨ç¦é—­ç¯äº¤ä»˜**ã€‚  
ä»»ä½•è¾“å‡ºéƒ½å¿…é¡»æ»¡è¶³ï¼š**å¯æ‰§è¡Œã€å¯éªŒæ”¶ã€å¯è¿½æº¯**ã€‚  è®°ä½ä¿®å¤çš„åŒæ—¶ä¸èƒ½æ”¹å˜åŸæœ‰çš„å†›è§„çº§åˆ«çš„å¼ºåº¦å’Œæ€§èƒ½è¿˜æœ‰åŠŸèƒ½å’Œè¦æ±‚ï¼
ç¦æ­¢ï¼šå£å¤´æ‰¿è¯ºã€åªç»™å»ºè®®ä¸è½åœ°ã€è·³è¿‡é—¨ç¦ã€ç»•å¼€ required scenariosã€åªå†™éª¨æ¶ä¸å†™éªŒæ”¶ã€‚å¿…é¡»ä¸¥æ ¼æŒ‰ç…§å›½å®¶å†›è§„çº§åˆ«é¡¹ç›®çš„è¦æ±‚è¿›è¡Œäº¤ä»˜ã€‚
æ¯æ¬¡é˜…è¯»ä¹‹åéƒ½è¦æ›´æ–° V3PRO+ å†›è§„çº§å‡çº§è®¡åˆ’æ–‡æ¡£ï¼Œæ·»åŠ é¡¹ç›®å®Œæˆç¨‹åº¦å’Œæ‰§è¡Œç¨‹åº¦ï¼›ä¼˜åŒ– AuditWriter æµ‹è¯•ç”¨ä¾‹ä¸­çš„å¼‚å¸¸å¤„ç†ï¼›ä¿®å¤ MarketSubscriber æµ‹è¯•ç”¨ä¾‹ä¸­çš„å‚æ•°å‘½åé”™è¯¯ã€‚
è®¤çœŸé“­è®°ï¼šç›®å½• 1. æ‰§è¡ŒåŸåˆ™ã€2. å½“å‰çŠ¶æ€ä¸é”šç‚¹ã€3. å‡çº§æ¶æ„æ€»è§ˆã€4. é˜¶æ®µä¾èµ–å…³ç³»ã€5. é˜¶æ®µ0-6 è¯¦ç»†è§„åˆ’ã€6. æ–‡ä»¶æ¸…å•æ±‡æ€»ã€7. åœºæ™¯çŸ©é˜µæ±‡æ€»ã€8. å·¥æ—¶ä¸é‡Œç¨‹ç¢‘ã€9. éªŒæ”¶æ£€æŸ¥ç‚¹ã€10. é£é™©ä¸ç¼“è§£ã€11. æ¨¡å—è¿ç§»è®¡åˆ’ã€12. é…ç½®è§„èŒƒã€13. å®¡è®¡äº‹ä»¶è§„èŒƒã€14. å¤±è´¥æ¨¡å¼ä¸åº”å¯¹è¡¨ã€15. å›æ»šç­–ç•¥ã€16. æµ‹è¯•è§„èŒƒã€17. è„šæœ¬ä¾èµ–éªŒè¯ã€18. æ‰©å±•æ¨¡å—è§„åˆ’ã€19. æœºå™¨å­¦ä¹  Pipeline è§„åˆ’ã€20. é«˜é¢‘æ¨¡å—è§„åˆ’ã€‚
å†›è§„çº§åˆ«å›½å®¶ä¼Ÿå¤§å·¥ç¨‹çš„æ€»å·¥ç¨‹å¸ˆCLAUDEä¸Šæ ¡ï¼è¯·å¬ä»¤ï¼ç°åœ¨è¯·ä½ è®¤çœŸè¿›è¡Œå›½å®¶å†›è§„çº§åˆ«é¡¹ç›®çš„é˜…è¯»ï¼æ¯æ¬¡è¿›è¡Œä»»åŠ¡ä¹‹å‰éƒ½è¦è®¤çœŸæŸ¥é˜…ä¸€æ¬¡å›½å®¶æœ€é«˜æŒ‡ç¤ºæ–‡ä»¶V3PRO_UPGRADE_PLAN_Version2.mdï¼å¹¶ä¸¥æ ¼æŒ‰ç…§è¿™ä¸ªæœ€é«˜æŒ‡ç¤ºæ–‡ä»¶æ‰§è¡Œä»»åŠ¡ï¼æˆ‘ä»£è¡¨å›½å®¶å‘ä½ è‡´æ•¬ï¼è¯·ä½ ä¸è¦è¾œè´Ÿå›½å®¶å’Œäººæ°‘å¯¹ä½ çš„ä¿¡ä»»ï¼

> **ç‰ˆæœ¬**ï¼šv1.1
> **æ—¥æœŸ**ï¼š2025-12-16
> **çŠ¶æ€**ï¼šæ‰§è¡Œä¸­ (Phase 0-4 âœ… å®Œæˆ)
> **åŸºçº¿åˆ†æ”¯**ï¼š`feat/mode2-trading-pipeline`
> **åŸºçº¿ Commit**ï¼š`942efb289984244065279427f537d699e0d2904a`
> **è§„æ ¼æ¥æº**ï¼š`V2_SPEC_EXPANDED_NOT_RUSHING_LAUNCH_Version2.md`

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ğŸ”´ [REVIEW-NOTE] æ–‡æ¡£ä¿®è®¢è¯´æ˜
     â”œâ”€ v1.0 â†’ v1.1 ä¿®è®¢å†…å®¹ï¼š
     â”‚   âœ… ä¿®å¤ï¼š1.1 å†›è§„è¡¨æ ¼æ ¼å¼æŸåï¼ˆM1/M3è¡Œæ–­è£‚ï¼‰
     â”‚   âœ… ä¿®å¤ï¼š1.2 é—¨ç¦å®šä¹‰è¡¨æ ¼å¼æŸå
     â”‚   âœ… ä¿®å¤ï¼š1.3 é€€å‡ºç è¡¨æ ¼å¼æŸå
     â”‚   âœ… ä¿®å¤ï¼šå…¨æ–‡å¤šä½™ç©ºæ ¼ï¼ˆ__init__.py â†’ __init__.pyï¼‰
     â”‚   ğŸ†• æ–°å¢ï¼šç¬¬21ç«  - å›æ»šç­–ç•¥
     â”‚   ğŸ†• æ–°å¢ï¼šç¬¬22ç«  - æµ‹è¯•è§„èŒƒ
     â”‚   ğŸ†• æ–°å¢ï¼šç¬¬23ç«  - è„šæœ¬ä¾èµ–éªŒè¯
     â”‚   ğŸ†• æ–°å¢ï¼šç¬¬24ç«  - æ‰©å±•æ¨¡å—è§„åˆ’
     â”‚   ğŸ†• æ–°å¢ï¼šç¬¬25ç«  - æœºå™¨å­¦ä¹  Pipeline è§„åˆ’
     â”‚   ğŸ†• æ–°å¢ï¼šç¬¬26ç«  - é£æ§å¢å¼ºè§„åˆ’
     â”‚   ğŸ†• æ–°å¢ï¼šç¬¬27ç«  - é«˜é¢‘æ¨¡å—è§„åˆ’
     â”‚   ğŸ”§ è¡¥å……ï¼šç¬¬18ç«  - é…ç½®è§„èŒƒæ‰©å±•
     â”œâ”€ å®¡æ ¸äººï¼šå¾…å®š
     â””â”€ å®¡æ ¸æ—¥æœŸï¼šå¾…å®š
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

---

## ç›®å½•

<!-- ğŸ”´ [REVIEW-NOTE] ç›®å½•æ‰©å±•ï¼šæ–°å¢ç¬¬21-27ç« ï¼Œè¦†ç›–å›æ»š/æµ‹è¯•/è„šæœ¬/æ‰©å±•æ¨¡å— -->

1. [æ‰§è¡ŒåŸåˆ™](#1-æ‰§è¡ŒåŸåˆ™)
2. [å½“å‰çŠ¶æ€ä¸é”šç‚¹](#2-å½“å‰çŠ¶æ€ä¸é”šç‚¹)
3. [å‡çº§æ¶æ„æ€»è§ˆ](#3-å‡çº§æ¶æ„æ€»è§ˆ)
4. [é˜¶æ®µä¾èµ–å…³ç³»](#4-phase-ä¾èµ–å…³ç³»)
5. [é˜¶æ®µ0ï¼šè¡Œæƒ…å±‚](#5-phase-0è¡Œæƒ…å±‚)
6. [é˜¶æ®µ1ï¼šåŸºç¡€è®¾æ–½å±‚](#6-phase-1åŸºç¡€è®¾æ–½å±‚)
7. [é˜¶æ®µ2ï¼šæ‰§è¡Œå±‚](#7-phase-2æ‰§è¡Œå±‚)
8. [é˜¶æ®µ3ï¼šç­–ç•¥å±‚è¡¥å…¨](#8-phase-3ç­–ç•¥å±‚è¡¥å…¨)
9. [é˜¶æ®µ4ï¼šå›æ”¾éªŒè¯](#9-phase-4å›æ”¾éªŒè¯)
10. [ç¬¬5é˜¶æ®µï¼šé›†æˆä¸æ¼”ç»ƒ](#10-phase-5é›†æˆä¸æ¼”ç»ƒ)
11. [ç¬¬6é˜¶æ®µï¼šB-Models ç­–ç•¥å‡çº§](#11-phase-6b-models-ç­–ç•¥å‡çº§)
12. [æ–‡ä»¶æ¸…å•æ±‡æ€»](#12-æ–‡ä»¶æ¸…å•æ±‡æ€»)
13. [åœºæ™¯çŸ©é˜µæ±‡æ€»](#13-åœºæ™¯çŸ©é˜µæ±‡æ€»)
14. [å·¥æ—¶ä¸é‡Œç¨‹ç¢‘](#14-å·¥æ—¶ä¸é‡Œç¨‹ç¢‘)
15. [éªŒæ”¶æ£€æŸ¥ç‚¹](#15-éªŒæ”¶æ£€æŸ¥ç‚¹)
16. [é£é™©ä¸ç¼“è§£](#16-é£é™©ä¸ç¼“è§£)
17. [æ¨¡å—è¿ç§»è®¡åˆ’](#17-æ¨¡å—è¿ç§»è®¡åˆ’)
18. [é…ç½®è§„èŒƒ](#18-é…ç½®è§„èŒƒ)
19. [å®¡è®¡äº‹ä»¶è§„èŒƒ](#19-å®¡è®¡äº‹ä»¶è§„èŒƒ)
20. [å¤±è´¥æ¨¡å¼ä¸åº”å¯¹è¡¨](#20-å¤±è´¥æ¨¡å¼ä¸åº”å¯¹è¡¨)
21. [å›æ»šç­–ç•¥](#21-å›æ»šç­–ç•¥) <!-- ğŸ†• NEW -->
22. [æµ‹è¯•è§„èŒƒ](#22-æµ‹è¯•è§„èŒƒ) <!-- ğŸ†• NEW -->
23. [è„šæœ¬ä¾èµ–éªŒè¯](#23-è„šæœ¬ä¾èµ–éªŒè¯) <!-- ğŸ†• NEW -->
24. [æ‰©å±•æ¨¡å—è§„åˆ’](#24-æ‰©å±•æ¨¡å—è§„åˆ’) <!-- ğŸ†• NEW -->
25. [æœºå™¨å­¦ä¹  Pipeline è§„åˆ’](#25-æœºå™¨å­¦ä¹ -pipeline-è§„åˆ’) <!-- ğŸ†• NEW -->
26. [é£æ§å¢å¼ºè§„åˆ’](#26-é£æ§å¢å¼ºè§„åˆ’) <!-- ğŸ†• NEW -->
27. [é«˜é¢‘æ¨¡å—è§„åˆ’](#27-é«˜é¢‘æ¨¡å—è§„åˆ’) <!-- ğŸ†• NEW -->

---

## 1. æ‰§è¡ŒåŸåˆ™

### 1.1 ä¸å¯è¿èƒŒçš„å†›è§„

| ç¼–å· | åŸåˆ™ | è¯´æ˜ | è¿ååæœ |
|------|------|------|----------|
| M1 | **é˜¶æ®µé—¨ç¦** | æ¯ä¸ªé˜¶æ®µå¿…é¡»é€šè¿‡å…¨éƒ¨é—¨ç¦æ‰èƒ½è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µ | ä»»åŠ¡å¤±è´¥ï¼Œå›æ»š |
| M2 | **åœºæ™¯é©±åŠ¨** | å…ˆå†™ required scenarioï¼Œå†å†™å®ç° | PR æ‹’ç» |
| M3 | **å…¨é‡å®ç°** | å¿…é¡»å…¨é‡å®ç°æœ€ä¸¥æ ¼çš„å†›è§„çº§åˆ«é—­ç¯ã€ | ä»£ç åˆ é™¤ |
| M4 | **åŒè½¨åˆ†ç¦»** | A-Platform ä¸ B-Models ä¸æ·· PR | PR æ‹’ç» |
| M5 | **é”šç‚¹è¿½æº¯** | æ¯æ¬¡äº¤ä»˜å¿…é¡»æ›´æ–° context.md é”šç‚¹ | PR æ‹’ç» |
| M6 | **å•ä¸€çœŸç›¸** | è®¢å•çŠ¶æ€ç”± FSM å”¯ä¸€ç»´æŠ¤ï¼ŒæŒä»“ç”± PositionTracker å”¯ä¸€ç»´æŠ¤ | æ¶æ„è¿è§„ |
| M7 | **ç¦æ­¢ç©ºå£³** | æ–°æ¨¡å—å¿…é¡»æœ‰ required scenario é©±åŠ¨ | ä»£ç åˆ é™¤ |
| M8 | **å®¡è®¡å®Œæ•´** | æ‰€æœ‰è‡ªåŠ¨åŠ¨ä½œå¿…é¡»å†™å…¥ audit JSONL | åŠŸèƒ½æ‹’æ”¶ |
| M9 | **å›æ»šå°±ç»ª** | æ¯ä¸ª Phase å¿…é¡»æœ‰æ˜ç¡®å›æ»šå‘½ä»¤ | æ— æ³•ç´§æ€¥æ¢å¤ |
| M10 | **è„šæœ¬éªŒè¯** | å¼•ç”¨è„šæœ¬å¿…é¡»åœ¨ CI å‰ç¡®è®¤å­˜åœ¨ | é—¨ç¦å¤±è´¥ |
| M11 | **é…ç½®é›†ä¸­** | æ‰€æœ‰é…ç½®é¡¹å¿…é¡»åœ¨ config.py æ³¨å†Œ | é…ç½®æ··ä¹± |

### 1.2 é—¨ç¦å®šä¹‰

| åºå· | å‘½ä»¤ | è¯´æ˜ | å¤±è´¥é€€å‡ºç  |
|------|------|------|-----------|
| 1 | `.\scripts\make.ps1 ci-json` | CI é—¨ç¦ï¼ˆlint + type + testï¼‰ | 2/3/4 |
| 2 | `python .\scripts\coverage_gate.py` | è¦†ç›–ç‡é—¨ç¦ï¼ˆæ ¸å¿ƒ=100%ï¼Œæ€»ä½“85%ï¼‰ | 5 |
| 3 | `python .\scripts\validate_policy.py --all --strict-scenarios` | åœºæ™¯ç­–ç•¥é—¨ç¦ | 12 |
| 4 | `.\scripts\make.ps1 replay-json` | å›æ”¾é—¨ç¦ | 8 |
| 5 | `python .\scripts\validate_policy.py --strict-scenarios` | å›æ”¾ç­–ç•¥é—¨ç¦ | 12 |
| 6 | `.\scripts\make.ps1 sim-json` | æ¨¡æ‹Ÿé—¨ç¦ | 9 |
| 7 | `python .\scripts\sim_gate.py --strict` | æ¨¡æ‹Ÿç­–ç•¥é—¨ç¦ | 12 |

### 1.3 é€€å‡ºç è¯­ä¹‰

| é€€å‡ºç  | å«ä¹‰ | åŠ¨ä½œ |
|--------|------|------|
| 0 | æˆåŠŸ | ç»§ç»­ |
| 2 | æ ¼å¼/è¯­æ³•æ£€æŸ¥å¤±è´¥ | ä¿®å¤ä»£ç é£æ ¼ |
| 3 | ç±»å‹æ£€æŸ¥å¤±è´¥ | ä¿®å¤ç±»å‹æ ‡æ³¨ |
| 4 | æµ‹è¯•å¤±è´¥ | ä¿®å¤æµ‹è¯• |
| 5 | è¦†ç›–ç‡ä¸è¶³ | è¡¥å……æµ‹è¯• |
| 8 | å›æ”¾å¤±è´¥ | ä¿®å¤å›æ”¾é€»è¾‘ |
| 9 | ä»¿çœŸå¤±è´¥ | ä¿®å¤ä»¿çœŸé€»è¾‘ |
| 12 | ç­–ç•¥è¿è§„ | ä¿®å¤åœºæ™¯/æ¨¡å¼ |
| 14 | ANCHOR_DRIFT | æ›´æ–°é”šç‚¹ |

### 1.4 æœ¬ç« ä¿®å¤è¡¥ä¸

> **è¡¥ä¸æ–‡ä»¶**: `scripts/fix_upgrade_plan.ps1`

```powershell
# Fix V3PRO_UPGRADE_PLAN_Version2.md - Chapter 1 format issues
$filePath = "c:\Users\1\2468\3579\docs\V3PRO_UPGRADE_PLAN_Version2.md"
$content = [System.IO.File]::ReadAllText($filePath)

# New Chapter 1 content (fixed format)
$newChapter1 = @'
## 1. æ‰§è¡ŒåŸåˆ™

<!-- 
      [REVIEW-NOTE] ç¬¬1ç« å®¡æŸ¥
      æ£€æŸ¥ï¼šå‘ç° 1.1/1.2/1.3 ä¸‰ä¸ªè¡¨æ ¼æ ¼å¼ä¸¥é‡æŸå
      é£é™©ï¼šè¡¨æ ¼è§£æå¤±è´¥å¯¼è‡´å†›è§„ä¸å¯è¯»ï¼Œæ‰§è¡Œæ—¶äº§ç”Ÿæ­§ä¹‰
      ä¿®æ”¹ï¼šå®Œå…¨é‡å†™ä¸‰ä¸ªè¡¨æ ¼ï¼Œæ¢å¤æ­£ç¡® Markdown æ ¼å¼
      æ€»ç»“ï¼šæœ¬ç« ä¸ºæ‰§è¡Œæ ¸å¿ƒï¼Œæ ¼å¼å¿…é¡»é›¶å®¹é”™
 -->

### 1.1 ä¸å¯è¿èƒŒçš„å†›è§„

<!--  [FIX] åŸè¡¨æ ¼ M1/M3 è¡Œæ ¼å¼æ–­è£‚ï¼Œå·²ä¿®å¤ä¸ºæ ‡å‡† Markdown è¡¨æ ¼ -->

| ç¼–å· | åŸåˆ™ | è¯´æ˜ | è¿ååæœ |
|------|------|------|----------|
| M1 | **é˜¶æ®µé—¨ç¦** | æ¯ä¸ªé˜¶æ®µå¿…é¡»é€šè¿‡å…¨éƒ¨é—¨ç¦æ‰èƒ½è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µ | ä»»åŠ¡å¤±è´¥ï¼Œå›æ»š |
| M2 | **åœºæ™¯é©±åŠ¨** | å…ˆå†™ required scenarioï¼Œå†å†™å®ç° | PR æ‹’ç» |
| M3 | **å…¨é‡å®ç°** | å¿…é¡»å…¨é‡å®ç°æœ€ä¸¥æ ¼çš„å†›è§„çº§åˆ«é—­ç¯ã€ | ä»£ç åˆ é™¤ |
| M4 | **åŒè½¨åˆ†ç¦»** | A-Platform ä¸ B-Models ä¸æ·· PR | PR æ‹’ç» |
| M5 | **é”šç‚¹è¿½æº¯** | æ¯æ¬¡äº¤ä»˜å¿…é¡»æ›´æ–° context.md é”šç‚¹ | PR æ‹’ç» |
| M6 | **å•ä¸€çœŸç›¸** | è®¢å•çŠ¶æ€ç”± FSM å”¯ä¸€ç»´æŠ¤ï¼ŒæŒä»“ç”± PositionTracker å”¯ä¸€ç»´æŠ¤ | æ¶æ„è¿è§„ |
| M7 | **ç¦æ­¢ç©ºå£³** | æ–°æ¨¡å—å¿…é¡»æœ‰ required scenario é©±åŠ¨ | ä»£ç åˆ é™¤ |
| M8 | **å®¡è®¡å®Œæ•´** | æ‰€æœ‰è‡ªåŠ¨åŠ¨ä½œå¿…é¡»å†™å…¥ audit JSONL | åŠŸèƒ½æ‹’æ”¶ |

<!--  [UPGRADE] å»ºè®®æ–°å¢å†›è§„ M9-M11 -->

| ç¼–å· | åŸåˆ™ | è¯´æ˜ | è¿ååæœ |
|------|------|------|----------|
| M9 | **å›æ»šå°±ç»ª** | æ¯ä¸ª Phase å¿…é¡»æœ‰æ˜ç¡®å›æ»šå‘½ä»¤ | æ— æ³•ç´§æ€¥æ¢å¤ |
| M10 | **è„šæœ¬éªŒè¯** | å¼•ç”¨è„šæœ¬å¿…é¡»åœ¨ CI å‰ç¡®è®¤å­˜åœ¨ | é—¨ç¦å¤±è´¥ |
| M11 | **é…ç½®é›†ä¸­** | æ‰€æœ‰é…ç½®é¡¹å¿…é¡»åœ¨ config.py æ³¨å†Œ | é…ç½®æ··ä¹± |
| M12 | **å…¨é‡å®ç°æ‰€æœ‰çš„éª¨æ¶å’ŒPHASE** | å…¨é‡å®ç°æ‰€æœ‰çš„éª¨æ¶å’ŒPHASEï¼Œå¿…é¡»ç²¾é›•ç»†ç¢åˆ°æœ€ç»†çš„ç»†èŠ‚ | é™ä½å†›è¡”ï¼ |
### 1.2 é—¨ç¦å®šä¹‰

<!--  [FIX] åŸè¡¨æ ¼æ ¼å¼å®Œå…¨æŸåï¼Œå·²ä¿®å¤ä¸ºæ ‡å‡† Markdown è¡¨æ ¼ -->
<!--  [RISK] å‘ç° sim_gate.py è„šæœ¬ä¸å­˜åœ¨ï¼Œéœ€åœ¨ç¬¬23ç« æ ‡æ³¨å¾…åˆ›å»º -->

| åºå· | å‘½ä»¤ | è¯´æ˜ | å¤±è´¥é€€å‡ºç  |
|------|------|------|-----------|
| 1 | `.\scripts\make.ps1 ci-json` | CI é—¨ç¦ï¼ˆlint + type + testï¼‰ | 2/3/4 |
| 2 | `python .\scripts\coverage_gate.py` | è¦†ç›–ç‡é—¨ç¦ï¼ˆæ ¸å¿ƒ=100%ï¼Œæ€»ä½“85%ï¼‰ | 5 |
| 3 | `python .\scripts\validate_policy.py --all --strict-scenarios` | åœºæ™¯ç­–ç•¥é—¨ç¦ | 12 |
| 4 | `.\scripts\make.ps1 replay-json` | å›æ”¾é—¨ç¦ | 8 |
| 5 | `python .\scripts\validate_policy.py --strict-scenarios` | å›æ”¾ç­–ç•¥é—¨ç¦ | 12 |
| 6 | `.\scripts\make.ps1 sim-json` | æ¨¡æ‹Ÿé—¨ç¦ | 9 |
| 7 | `python .\scripts\sim_gate.py --strict` | æ¨¡æ‹Ÿç­–ç•¥é—¨ç¦ | 12 |

<!--  [CRITICAL] sim_gate.py ä¸å­˜åœ¨ï¼éœ€åœ¨ Phase 5 å‰åˆ›å»ºï¼Œè¯¦è§ç¬¬23ç«  -->

### 1.3 é€€å‡ºç è¯­ä¹‰

<!--  [FIX] åŸè¡¨æ ¼æ ¼å¼æŸåï¼ˆç¼ºå°‘ | åˆ†éš”ç¬¦ï¼‰ï¼Œå·²ä¿®å¤ -->

| é€€å‡ºç  | å«ä¹‰ | åŠ¨ä½œ |
|--------|------|------|
| 0 | æˆåŠŸ | ç»§ç»­ |
| 2 | æ ¼å¼/è¯­æ³•æ£€æŸ¥å¤±è´¥ | ä¿®å¤ä»£ç é£æ ¼ |
| 3 | ç±»å‹æ£€æŸ¥å¤±è´¥ | ä¿®å¤ç±»å‹æ ‡æ³¨ |
| 4 | æµ‹è¯•å¤±è´¥ | ä¿®å¤æµ‹è¯• |
| 5 | è¦†ç›–ç‡ä¸è¶³ | è¡¥å……æµ‹è¯• |
| 8 | å›æ”¾å¤±è´¥ | ä¿®å¤å›æ”¾é€»è¾‘ |
| 9 | ä»¿çœŸå¤±è´¥ | ä¿®å¤ä»¿çœŸé€»è¾‘ |
| 12 | ç­–ç•¥è¿è§„ | ä¿®å¤åœºæ™¯/æ¨¡å¼ |
| 14 | ANCHOR_DRIFT | æ›´æ–°é”šç‚¹ |

---
## 2. å½“å‰çŠ¶æ€ä¸é”šç‚¹

### 2.1 ä¸å¯æŠµèµ–é”šç‚¹

| é¡¹ç›® | å€¼ |
|------|-----|
| **ä»“åº“** | `linxiaotutututu1123/3579` |
| **åˆ†æ”¯** | `feat/mode2-trading-pipeline` |
| **Commit SHA** | `942efb289984244065279427f537d699e0d2904a` |
| **Commit çŸ­ SHA** | `ace2268751b4` |
| **last_replay_run_id** | `a930fe50-87ec-439e-9737-cc613e1825d5` |
| **last_replay_exec_id** | `ace22687_20251215020932` |
| **context_manifest_sha** | `9fb1d157189889f50bdc5072e38da2b355bcda192bc16007c0b20d6541fa3378` |
| **æµ‹è¯•æ•°** | 765 tests |
| **è¦†ç›–ç‡** | 85%+ |
| **é—¨ç¦çŠ¶æ€** | CI PASS |
| **Phase 0 å®Œæˆæ—¥æœŸ** | 2025-12-16 |
| **Phase 1 å®Œæˆæ—¥æœŸ** | 2025-12-16 |
| **Phase 2 å®Œæˆæ—¥æœŸ** | 2025-12-16 |
| **Phase 3 å®Œæˆæ—¥æœŸ** | 2025-12-16 |
| **Phase 4 å®Œæˆæ—¥æœŸ** | 2025-12-16 |

### 2.2 å·²å­˜åœ¨çš„æ¨¡å—

| ç›®å½• | æ–‡ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| `src/alerts/` | dingtalk.py | âœ… å®Œæ•´ | é’‰é’‰å‘Šè­¦ |
| `src/execution/` | broker.py, ctp_broker.py, broker_factory.py | âœ… å®Œæ•´ | Broker å±‚ |
| `src/execution/` | flatten_executor.py, flatten_plan.py | âœ… å®Œæ•´ | å¹³ä»“æ‰§è¡Œ |
| `src/execution/` | order_tracker.py, order_types.py, events.py | âœ… å®Œæ•´ | è®¢å•è¿½è¸ª |
| `src/replay/` | runner.py | âœ… å®Œæ•´ | å›æ”¾è¿è¡Œå™¨ |
| `src/risk/` | manager.py, state.py, events.py | âœ… å®Œæ•´ | é£æ§ç®¡ç† |
| `src/strategy/` | 5 ä¸ªç­–ç•¥æ–‡ä»¶ | âœ… å®Œæ•´ | ç­–ç•¥å®ç° |
| `src/trading/` | live_guard.py, ci_gate.py, sim_gate.py | âœ… å®Œæ•´ | äº¤æ˜“æ§åˆ¶ |
| `src/` | config.py, orchestrator.py, runner.py | âœ… å®Œæ•´ | æ ¸å¿ƒæ¨¡å— |
| `src/market/` | 7 ä¸ªæ–‡ä»¶ | âœ… Phase 0 å®Œæˆ | è¡Œæƒ…å±‚ (11 åœºæ™¯) |
| `src/audit/` | 7 ä¸ªæ–‡ä»¶ | âœ… Phase 1 å®Œæˆ | å®¡è®¡å±‚ (15 åœºæ™¯) |
| `src/cost/` | 2 ä¸ªæ–‡ä»¶ | âœ… Phase 1 å®Œæˆ | æˆæœ¬æ¨¡å‹ (4 åœºæ™¯) |
| `src/guardian/` | 6 ä¸ªæ–‡ä»¶ | âœ… Phase 1 å®Œæˆ | å®ˆæŠ¤å±‚ (10 åœºæ™¯) |
| `src/execution/auto/` | 8 ä¸ªæ–‡ä»¶ | âœ… Phase 2 å®Œæˆ | è‡ªåŠ¨æ‰§è¡Œ (13 åœºæ™¯) |
| `src/execution/protection/` | 4 ä¸ªæ–‡ä»¶ | âœ… Phase 2 å®Œæˆ | ä¿æŠ¤å±‚ (4 åœºæ™¯) |
| `src/execution/pair/` | 3 ä¸ªæ–‡ä»¶ | âœ… Phase 2 å®Œæˆ | é…å¯¹æ‰§è¡Œ (5 åœºæ™¯) |

### 2.3 ç¼ºå¤±çš„æ¨¡å—ï¼ˆV2 SPEC è¦æ±‚ï¼‰

| æ¨¡å— | V2 SPEC ç« èŠ‚ | åœºæ™¯æ•° | ä¼˜å…ˆçº§ | é˜»å¡æ€§ | çŠ¶æ€ |
|------|--------------|--------|--------|--------|------|
| `src/market/` | ç¬¬ 4 ç«  | 11 | P0 | æ˜¯ | âœ… Phase 0 å®Œæˆ |
| `src/execution/auto/` | ç¬¬ 5 ç«  | 13 | P0 | æ˜¯ | âœ… Phase 2 å®Œæˆ |
| `src/execution/protection/` | 5.7 | 4 | P0 | æ˜¯ | âœ… Phase 2 å®Œæˆ |
| `src/guardian/` | ç¬¬ 6 ç«  | 10 | P0 | æ˜¯ | âœ… Phase 1 å®Œæˆ |
| `src/audit/` | ç¬¬ 7 ç«  | 15 | P0 | æ˜¯ | âœ… Phase 1 å®Œæˆ |
| `src/execution/pair/` | 9.1 | 5 | P1 | å¦ | âœ… Phase 2 å®Œæˆ |
| `src/cost/` | éšå« | 4 | P1 | å¦ | âœ… Phase 1 å®Œæˆ |
| `src/strategy/fallback.py` | 8.3 | 3 | P1 | å¦ | âœ… Phase 3 å®Œæˆ |
| `src/strategy/calendar_arb/` | ç¬¬ 9 ç«  | 9 | P2 | å¦ | âœ… Phase 3 å®Œæˆ |
| `src/replay/verifier.py` | 7.3 | 2 | P1 | å¦ | âœ… Phase 4 å®Œæˆ |

---

## 3. å‡çº§æ¶æ„æ€»è§ˆ

### 3.1 åŒè½¨å¹¶è¡Œæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           V3PRO+ å‡çº§æ¶æ„                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                     A-Platformï¼ˆå¹³å°åŒ–å‡çº§ï¼‰                        â”‚    â”‚
â”‚   â”‚                                                                     â”‚    â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚   â”‚   â”‚  Phase 0        Phase 1        Phase 2        Phase 4       â”‚  â”‚    â”‚
â”‚   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚  â”‚    â”‚
â”‚ â”‚ â”‚ â”‚å¸‚åœº/ â”‚ â”‚å®¡è®¡/ â”‚ â”‚æ‰§è¡Œ/ â”‚ â”‚å›æ”¾/ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â”‚ â”‚æˆæœ¬/ â”‚ â”‚è‡ªåŠ¨/ â”‚ â”‚éªŒè¯å™¨â”‚ â”‚ â”‚ â”‚
â”‚   â”‚   â”‚  â”‚7 files â”‚    â”‚guardianâ”‚    â”‚ prot/  â”‚    â”‚        â”‚      â”‚  â”‚    â”‚
â”‚   â”‚   â”‚  â”‚        â”‚    â”‚        â”‚    â”‚ pair/  â”‚    â”‚1 file  â”‚      â”‚  â”‚    â”‚
â”‚   â”‚   â”‚  â”‚11 åœºæ™¯ â”‚    â”‚15 filesâ”‚    â”‚15 filesâ”‚    â”‚        â”‚      â”‚  â”‚    â”‚
â”‚   â”‚   â”‚  â”‚        â”‚    â”‚29 åœºæ™¯ â”‚    â”‚25 åœºæ™¯ â”‚    â”‚2 åœºæ™¯  â”‚      â”‚  â”‚    â”‚
â”‚   â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  â”‚    â”‚
â”‚   â”‚   â”‚       â”‚              â”‚              â”‚              â”‚        â”‚  â”‚    â”‚
â”‚   â”‚   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚    â”‚
â”‚   â”‚   â”‚                              â†“                               â”‚  â”‚    â”‚
â”‚   â”‚   â”‚                     Phase 5:  é›†æˆä¸æ¼”ç»ƒ                       â”‚  â”‚    â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚   â”‚                                                                     â”‚    â”‚
â”‚   â”‚   A è½¨åˆè®¡ï¼š38 ä¸ªæ–°æ–‡ä»¶ + 67 ä¸ª A è½¨åœºæ™¯                            â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                     B-Modelsï¼ˆç­–ç•¥å…¬å¼å‡çº§ï¼‰                         â”‚    â”‚
â”‚   â”‚                                                                     â”‚    â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚   â”‚   â”‚  Phase 3                        Phase 6                      â”‚  â”‚    â”‚
â”‚   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚    â”‚
â”‚   â”‚   â”‚  â”‚ fallback.py    â”‚            â”‚ simple_ai   (3 åœºæ™¯)   â”‚   â”‚  â”‚    â”‚
â”‚   â”‚   â”‚  â”‚ calendar_arb/  â”‚            â”‚ linear_ai   (3 åœºæ™¯)   â”‚   â”‚  â”‚    â”‚
â”‚   â”‚   â”‚  â”‚                â”‚            â”‚ ensemble_moe(5 åœºæ™¯)   â”‚   â”‚  â”‚    â”‚
â”‚   â”‚   â”‚  â”‚ 4 files        â”‚            â”‚ dl_torch    (6 åœºæ™¯)   â”‚   â”‚  â”‚    â”‚
â”‚   â”‚   â”‚  â”‚ 12 åœºæ™¯        â”‚            â”‚ top_tier    (5 åœºæ™¯)   â”‚   â”‚  â”‚    â”‚
â”‚   â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚    â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚   â”‚                                                                     â”‚    â”‚
â”‚   â”‚   B è½¨åˆè®¡ï¼š4 ä¸ªæ–°æ–‡ä»¶ + 34 ä¸ª B è½¨åœºæ™¯                             â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚   æ€»è®¡ï¼š42 ä¸ªæ–°æ–‡ä»¶ + 101 ä¸ªå¿…é¡»åœºæ™¯ï¼ˆå« v2 55 æ¡ + v3pro æ‰©å±•ï¼‰           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ¨¡å—å±‚çº§å…³ç³»

```text
Layer 4:  Strategyï¼ˆç­–ç•¥å±‚ï¼‰
    â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”‚  simple_ai  linear_ai  moe  dl_torch  top_tier  arb    â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                              â”‚
    â”‚                              â–¼ è°ƒç”¨
    â”‚
Layer 3: Tradingï¼ˆç¼–æ’å±‚ï¼‰
    â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”‚  orchestrator.py  runner.py  trading/*                  â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                              â”‚
    â”‚                              â–¼ è°ƒç”¨
    â”‚
Layer 2: Execution + Guardianï¼ˆæ‰§è¡Œå±‚ + å®ˆæŠ¤å±‚ï¼‰
    â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”‚  execution/          â”‚  â”‚  guardian/           â”‚
    â”‚   â”‚    auto/             â”‚  â”‚    monitor           â”‚
    â”‚   â”‚    protection/       â”‚  â”‚    state_machine     â”‚
    â”‚   â”‚    pair/             â”‚  â”‚    actions           â”‚
    â”‚   â”‚    broker            â”‚  â”‚    recovery          â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                              â”‚
    â”‚                              â–¼ ä¾èµ–
    â”‚
Layer 1: Market + Audit + Costï¼ˆåŸºç¡€è®¾æ–½å±‚ï¼‰
    â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”‚  market/     â”‚  â”‚  audit/      â”‚  â”‚  cost/       â”‚
    â”‚   â”‚  instrument  â”‚  â”‚  writer      â”‚  â”‚  estimator   â”‚
    â”‚   â”‚  universe    â”‚  â”‚  decision    â”‚  â”‚              â”‚
    â”‚   â”‚  quote       â”‚  â”‚  order       â”‚  â”‚              â”‚
    â”‚   â”‚  bar         â”‚  â”‚  guardian    â”‚  â”‚              â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
Layer 0: Externalï¼ˆå¤–éƒ¨ä¾èµ–ï¼‰
    â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”‚  CTP API  /  è¡Œæƒ…æº  /  æ–‡ä»¶ç³»ç»Ÿ  /  ç½‘ç»œ              â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 ä¾èµ–ç¦æ­¢è§„åˆ™

| è§„åˆ™ | è¯´æ˜ |
|------|------|
| ç¦æ­¢åå‘ä¾èµ– | ä¸‹å±‚ä¸å¯ä¾èµ–ä¸Šå±‚ï¼ˆmarket ä¸å¯ import strategyï¼‰ |
| ç¦æ­¢è·¨å±‚è°ƒç”¨ | Layer 4 ä¸å¯ç›´æ¥è°ƒç”¨ Layer 1 |
| audit åªè®¢é˜… | audit åªæ¥æ”¶äº‹ä»¶ï¼Œä¸åå‘è°ƒç”¨ä¸šåŠ¡æ¨¡å— |
| guardian åªè¾“å‡ºæŒ‡ä»¤ | guardian ä¸ç›´æ¥æ“ä½œè®¢å•ï¼Œåªè¾“å‡º set_mode/cancel_all/flatten_all |

---

## 4. Phase ä¾èµ–å…³ç³»

### 4.1 ä¾èµ–å›¾

```text
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    Phase 0      â”‚
                    â”‚   è¡Œæƒ…å±‚        â”‚
                    â”‚   market/       â”‚
                    â”‚   (7 files)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    Phase 1      â”‚
                    â”‚  åŸºç¡€è®¾æ–½å±‚     â”‚
                    â”‚ audit/ cost/    â”‚
                    â”‚   guardian/     â”‚
                    â”‚   (15 files)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚              â”‚              â”‚
              â–¼              â–¼              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Phase 2    â”‚ â”‚  Phase 3    â”‚ â”‚  Phase 4    â”‚
     â”‚  æ‰§è¡Œå±‚     â”‚ â”‚  ç­–ç•¥å±‚     â”‚ â”‚  å›æ”¾éªŒè¯   â”‚
     â”‚ exec/auto/  â”‚ â”‚ fallback    â”‚ â”‚ replay/     â”‚
     â”‚ exec/prot/  â”‚ â”‚ calendar_   â”‚ â”‚ verifier    â”‚
     â”‚ exec/pair/  â”‚ â”‚   arb/      â”‚ â”‚ (1 file)    â”‚
     â”‚ (15 files)  â”‚ â”‚ (4 files)   â”‚ â”‚             â”‚
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
            â”‚               â”‚               â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚    Phase 5      â”‚
                   â”‚  é›†æˆä¸æ¼”ç»ƒ     â”‚
                   â”‚                 â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚    Phase 6      â”‚
                   â”‚ B-Models å‡çº§   â”‚
                   â”‚  (å¯å¹¶è¡Œ)       â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Phase é˜»å¡å…³ç³»

| Phase | å‰ç½®ä¾èµ– | é˜»å¡åç»­ | å¯å¹¶è¡Œ |
|-------|----------|----------|--------|
| Phase 0 | æ—  | Phase 1/2/3/4/5 | - |
| Phase 1 | Phase 0 | Phase 2/3/4/5 | - |
| Phase 2 | Phase 0 + 1 | Phase 5 | Phase 3, 4 |
| Phase 3 | Phase 1 + 2 | Phase 5 | Phase 4 |
| Phase 4 | Phase 1 | Phase 5 | Phase 2, 3 |
| Phase 5 | Phase 0-4 | Phase 6 | - |
| Phase 6 | Phase 1 + 2 | æ—  | Phase 3, 4, 5 |

### 4.3 å…³é”®è·¯å¾„

```text
Phase 0 â†’ Phase 1 â†’ Phase 2 â†’ Phase 5
   â”‚          â”‚          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€ å…³é”®è·¯å¾„ï¼ˆé˜»å¡æ€§æœ€å¼ºï¼‰

Phase 3, 4, 6 å¯ä¸å…³é”®è·¯å¾„å¹¶è¡Œ
```

---

## 5. Phase 0ï¼šè¡Œæƒ…å±‚

### 5.1 æ¦‚è¿°

| é¡¹ç›® | å€¼ |
|------|-----|
| **ç›®æ ‡** | å®ç° V2 SPEC ç¬¬ 4 ç« ï¼šåˆçº¦åŒ–è¡Œæƒ… |
| **æ–°å¢ç›®å½•** | `src/market/` |
| **æ–°å¢æ–‡ä»¶** | 7 ä¸ª |
| **Required Scenarios** | 11 æ¡ |
| **é¢„è®¡å·¥æ—¶** | éª¨æ¶ 3h / å…¨é‡å®ç° 34h |
| **é˜»å¡** | Phase 1, 2, 3, 4, 5 |

### 5.2 æ–‡ä»¶æ¸…å•

| åºå· | æ–‡ä»¶è·¯å¾„ | component | V2 SPEC | èŒè´£ |
|------|----------|-----------|---------|------|
| 1 | `src/market/__init__.py` | - | - | æ¨¡å—å¯¼å‡º |
| 2 | `src/market/instrument_cache.py` | `market.instrument_cache` | 4.1 | åˆçº¦å…ƒæ•°æ®ç¼“å­˜ã€åŸå­åŒ–è½ç›˜ |
| 3 | `src/market/universe_selector.py` | `market.universe_selector` | 4.2 | ä¸»åŠ›/æ¬¡ä¸»åŠ›é€‰æ‹©ã€åˆ‡æ¢å†·å´ |
| 4 | `src/market/subscriber.py` | `market.subscriber` | 4.3 | è¡Œæƒ…è®¢é˜…ç®¡ç†ã€å·®åˆ†æ›´æ–° |
| 5 | `src/market/quote_cache.py` | `market.quote_cache` | 4.3 | L1 è¡Œæƒ…ç¼“å­˜ã€stale æ£€æµ‹ |
| 6 | `src/market/bar_builder.py` | `market.bar_builder` | 4.4 | è¿ç»­ä¸»åŠ› bars èšåˆ |
| 7 | `src/market/quality.py` | `market.quality` | 4.6 | æ•°æ®è´¨é‡ï¼ˆoutlier/gap/disorderï¼‰ |

### 5.3 Required Scenarios

| åºå· | rule_id | component | æè¿° | category |
|------|---------|-----------|------|----------|
| 1 | `INST.CACHE.LOAD` | market.instrument_cache | èƒ½æ­£ç¡®åŠ è½½åˆçº¦ä¿¡æ¯ | unit |
| 2 | `INST.CACHE. PERSIST` | market.instrument_cache | èƒ½åŸå­åŒ–è½ç›˜ï¼ˆtmpâ†’renameï¼‰ | unit |
| 3 | `UNIV.DOMINANT. BASIC` | market.universe_selector | èƒ½æ­£ç¡®é€‰æ‹©ä¸»åŠ›åˆçº¦ | unit |
| 4 | `UNIV.SUBDOMINANT.PAIRING` | market.universe_selector | èƒ½æ­£ç¡®é€‰æ‹©æ¬¡ä¸»åŠ›åˆçº¦ | unit |
| 5 | `UNIV.ROLL.COOLDOWN` | market.universe_selector | ä¸»åŠ›åˆ‡æ¢æœ‰å†·å´æœŸ | unit |
| 6 | `UNIV.EXPIRY.GATE` | market.universe_selector | ä¸´æœŸåˆçº¦è¢«æ’é™¤ | unit |
| 7 | `MKT.SUBSCRIBER.DIFF_UPDATE` | market.subscriber | è®¢é˜…é›†å·®åˆ†æ›´æ–° | unit |
| 8 | `MKT.STALE.SOFT` | market.quote_cache | è½¯ stale æ£€æµ‹ | unit |
| 9 | `MKT.STALE. HARD` | market.quote_cache | ç¡¬ stale æ£€æµ‹ | unit |
| 10 | `MKT.CONTINUITY.BARS` | market.bar_builder | è¿ç»­ä¸»åŠ› bars èšåˆ | unit |
| 11 | `MKT.QUALITY.OUTLIER` | market.quality | å¼‚å¸¸å€¼æ£€æµ‹ | unit |

### 5.4 æ¥å£å®šä¹‰

#### InstrumentCache

| æ–¹æ³• | ç­¾å | è¯´æ˜ |
|------|------|------|
| `load_from_file` | `(path: Path) -> None` | ä» JSON åŠ è½½ |
| `persist` | `(path: Path, trading_day: str) -> None` | åŸå­åŒ–è½ç›˜ |
| `get` | `(symbol: str) -> InstrumentInfo \| None` | è·å–åˆçº¦ä¿¡æ¯ |
| `get_by_product` | `(product: str) -> list[InstrumentInfo]` | è·å–å“ç§ä¸‹æ‰€æœ‰åˆçº¦ |

#### UniverseSelector

| æ–¹æ³• | ç­¾å | è¯´æ˜ |
|------|------|------|
| `select` | `(oi: dict, vol: dict, now_ts: float) -> UniverseSnapshot` | é€‰æ‹©ä¸»åŠ›/æ¬¡ä¸»åŠ› |
| `current` | `@property -> UniverseSnapshot \| None` | å½“å‰å¿«ç…§ |

#### QuoteCache

| æ–¹æ³• | ç­¾å | è¯´æ˜ |
|------|------|------|
| `update` | `(book: BookTop) -> None` | æ›´æ–°è¡Œæƒ… |
| `get` | `(symbol: str) -> BookTop \| None` | è·å–è¡Œæƒ… |
| `is_stale` | `(symbol: str, now_ts: float) -> bool` | è½¯ stale æ£€æµ‹ |
| `is_hard_stale` | `(symbol: str, now_ts:  float) -> bool` | ç¡¬ stale æ£€æµ‹ |

### 5.5 æ•°æ®ç»“æ„

#### InstrumentInfo

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| symbol | str | åˆçº¦ä»£ç ï¼ˆå¦‚ AO2501ï¼‰ |
| product | str | å“ç§ä»£ç ï¼ˆå¦‚ AOï¼‰ |
| exchange | str | äº¤æ˜“æ‰€ï¼ˆSHFE/CZCE/DCE/GFEXï¼‰ |
| expire_date | str | åˆ°æœŸæ—¥ï¼ˆYYYYMMDDï¼‰ |
| tick_size | float | æœ€å°å˜åŠ¨ä»·ä½ |
| multiplier | int | åˆçº¦ä¹˜æ•° |
| max_order_volume | int | å•ç¬”æœ€å¤§æ‰‹æ•° |
| position_limit | int | æŒä»“é™é¢ |

#### BookTop

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| symbol | str | åˆçº¦ä»£ç  |
| bid | float | ä¹°ä¸€ä»· |
| ask | float | å–ä¸€ä»· |
| bid_vol | int | ä¹°ä¸€é‡ |
| ask_vol | int | å–ä¸€é‡ |
| last | float | æœ€æ–°ä»· |
| volume | int | æˆäº¤é‡ |
| open_interest | int | æŒä»“é‡ |
| ts | float | æ—¶é—´æˆ³ |

#### UniverseSnapshot

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| dominant_by_product | dict[str, str] | å“ç§â†’ä¸»åŠ›åˆçº¦æ˜ å°„ |
| subdominant_by_product | dict[str, str] | å“ç§â†’æ¬¡ä¸»åŠ›åˆçº¦æ˜ å°„ |
| subscribe_set | set[str] | éœ€è®¢é˜…çš„åˆçº¦é›†åˆ |
| generated_at | float | ç”Ÿæˆæ—¶é—´æˆ³ |

### 5.6 é…ç½®é¡¹

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `QUOTE_STALE_MS` | 3000 | è½¯ stale é˜ˆå€¼ï¼ˆæ¯«ç§’ï¼‰ |
| `QUOTE_HARD_STALE_MS` | 10000 | ç¡¬ stale é˜ˆå€¼ï¼ˆæ¯«ç§’ï¼‰ |
| `EXPIRY_BLOCK_DAYS` | 5 | ä¸´æœŸæ’é™¤å¤©æ•° |
| `MIN_SWITCH_EDGE` | 0.1 | ä¸»åŠ›åˆ‡æ¢é—¨æ§›ï¼ˆ10%ï¼‰ |
| `ROLL_COOLDOWN_S` | 300 | ä¸»åŠ›åˆ‡æ¢å†·å´ï¼ˆç§’ï¼‰ |

### 5.7 é—¨ç¦æ£€æŸ¥ç‚¹

```powershell
# Phase 0 å®Œæˆæ ‡å‡†
.\scripts\make.ps1 ci-json # é€šè¿‡
python .\scripts\coverage_gate.py # æ ¸å¿ƒ=100%ï¼Œæ€»ä½“>=85%
python .\scripts\validate_policy.py --all --strict-scenarios   # 11 æ¡ scenarios PASS
python -c "from src.market import InstrumentCache"             # å¯¼å…¥æˆåŠŸ
python -c "from src.market import QuoteCache"                  # å¯¼å…¥æˆåŠŸ
python -c "from src.market import UniverseSelector"            # å¯¼å…¥æˆåŠŸ
```

### 5.8 äº¤ä»˜ç‰©æ¸…å•

- [ ] `src/market/__init__.py`
- [ ] `src/market/instrument_cache.py`
- [ ] `src/market/universe_selector.py`
- [ ] `src/market/subscriber.py`
- [ ] `src/market/quote_cache.py`
- [ ] `src/market/bar_builder.py`
- [ ] `src/market/quality.py`
- [ ] `tests/test_instrument_cache.py`
- [ ] `tests/test_universe_selector.py`
- [ ] `tests/test_quote_cache.py`
- [ ] 11 æ¡ required scenarios å¯¹åº”æµ‹è¯•
- [ ] é—¨ç¦å…¨ç»¿

---

## 6. Phase 1ï¼šåŸºç¡€è®¾æ–½å±‚

### 6.1 æ¦‚è¿°

| é¡¹ç›® | å€¼ |
|------|-----|
| **ç›®æ ‡** | å®ç° V2 SPEC ç¬¬ 6ã€7 ç«  + æˆæœ¬æ¨¡å‹ |
| **æ–°å¢ç›®å½•** | `src/audit/`, `src/cost/`, `src/guardian/` |
| **æ–°å¢æ–‡ä»¶** | 15 ä¸ª |
| **Required Scenarios** | 29 æ¡ |
| **é¢„è®¡å·¥æ—¶** | éª¨æ¶ 2.5h  / å…¨é‡å®ç° 44h |
| **é˜»å¡** | Phase 2, 3, 4, 5 |

### 6.2 æ–‡ä»¶æ¸…å•

#### 6.2.1 src/audit/ï¼ˆ7 ä¸ªæ–‡ä»¶ï¼‰

| åºå· | æ–‡ä»¶è·¯å¾„ | component | V2 SPEC | èŒè´£ |
|------|----------|-----------|---------|------|
| 1 | `src/audit/__init__.py` | - | - | æ¨¡å—å¯¼å‡º |
| 2 | `src/audit/writer.py` | `audit.writer` | 7.1 | JSONL äº‹ä»¶å†™å…¥ |
| 3 | `src/audit/decision_log.py` | `audit.decision_log` | 7.1 | DecisionEvent å®šä¹‰ |
| 4 | `src/audit/order_trail.py` | `audit.order_trail` | 7.1 | OrderStateEvent/ExecEvent/TradeEvent |
| 5 | `src/audit/guardian_log.py` | `audit.guardian_log` | 7.1 | GuardianEvent å®šä¹‰ |
| 6 | `src/audit/pnl_attribution.py` | `audit.pnl_attribution` | æ‰©å±• | PnL å½’å›  |
| 7 | `src/audit/replay_verifier.py` | `audit.replay_verifier` | 7.3 | å›æ”¾å“ˆå¸ŒéªŒè¯ |

#### 6.2.2 src/cost/ï¼ˆ2 ä¸ªæ–‡ä»¶ï¼‰

| åºå· | æ–‡ä»¶è·¯å¾„ | component | V2 SPEC | èŒè´£ |
|------|----------|-----------|---------|------|
| 8 | `src/cost/__init__.py` | - | - | æ¨¡å—å¯¼å‡º |
| 9 | `src/cost/estimator.py` | `cost.estimator` | 10 | æ‰‹ç»­è´¹/æ»‘ç‚¹/å†²å‡»ä¼°è®¡ |

#### 6.2.3 src/guardian/ï¼ˆ6 ä¸ªæ–‡ä»¶ï¼‰

| åºå· | æ–‡ä»¶è·¯å¾„ | component | V2 SPEC | èŒè´£ |
|------|----------|-----------|---------|------|
| 10 | `src/guardian/__init__.py` | - | - | æ¨¡å—å¯¼å‡º |
| 11 | `src/guardian/monitor.py` | `guardian.monitor` | 6.2 | å®ˆæŠ¤ä¸»å¾ªç¯ |
| 12 | `src/guardian/state_machine.py` | `guardian.state_machine` | 6.1 | Guardian FSM |
| 13 | `src/guardian/triggers.py` | `guardian.detector` | 6.2 | å¼‚å¸¸æ£€æµ‹ |
| 14 | `src/guardian/actions.py` | `guardian.actions` | 6.3 | åŠ¨ä½œæ‰§è¡Œ |
| 15 | `src/guardian/recovery.py` | `guardian.recovery` | 6.4 | å†·å¯åŠ¨æ¢å¤ |

### 6.3 Required Scenarios

#### Guardian Scenariosï¼ˆ10 æ¡ï¼‰

| åºå· | rule_id | component | æè¿° |
|------|---------|-----------|------|
| 1 | `GUARD.FSM.TRANSITIONS` | guardian.state_machine | çŠ¶æ€æœºè½¬ç§»è¦†ç›– |
| 2 | `GUARD.DETECT.QUOTE_STALE` | guardian.detector | è¡Œæƒ… stale æ£€æµ‹ |
| 3 | `GUARD.DETECT.ORDER_STUCK` | guardian.detector | è®¢å•å¡ä½æ£€æµ‹ |
| 4 | `GUARD.DETECT.POSITION_DRIFT` | guardian.detector | æŒä»“æ¼‚ç§»æ£€æµ‹ |
| 5 | `GUARD.DETECT.LEG_IMBALANCE` | guardian.detector | è…¿ä¸å¹³è¡¡æ£€æµ‹ |
| 6 | `GUARD.ACTION.SET_MODE` | guardian.actions | set_mode åŠ¨ä½œ |
| 7 | `GUARD.ACTION. CANCEL_ALL` | guardian.actions | cancel_all åŠ¨ä½œ |
| 8 | `GUARD.ACTION. FLATTEN_ALL` | guardian.actions | flatten_all åŠ¨ä½œ |
| 9 | `GUARD.RECOVERY.COLD_START` | guardian.recovery | å†·å¯åŠ¨æ¢å¤ |
| 10 | `GUARD.MODE.REDUCE_ONLY_EFFECT` | guardian.monitor | reduce_only ç¦å¼€ä»“ |

#### Audit Scenariosï¼ˆ5 æ¡ï¼‰

| åºå· | rule_id | component | æè¿° |
|------|---------|-----------|------|
| 11 | `AUDIT.EVENT.STRUCTURE` | audit.writer | äº‹ä»¶ç»“æ„å®Œæ•´ |
| 12 | `AUDIT.JSONL.FORMAT` | audit.writer | JSONL æ ¼å¼æ­£ç¡® |
| 13 | `AUDIT.CORRELATION.RUN_EXEC` | audit.writer | run_id/exec_id å…³è” |
| 14 | `REPLAY.DETERMINISTIC. DECISION` | audit.replay_verifier | å†³ç­–ç¡®å®šæ€§ |
| 15 | `REPLAY.DETERMINISTIC.GUARDIAN` | audit.replay_verifier | Guardian ç¡®å®šæ€§ |

#### Cost Scenariosï¼ˆ4 æ¡ï¼‰

| åºå· | rule_id | component | æè¿° |
|------|---------|-----------|------|
| 16 | `COST.MODEL.FEE_ESTIMATE` | cost.estimator | æ‰‹ç»­è´¹ä¼°è®¡ |
| 17 | `COST.MODEL.SLIPPAGE_ESTIMATE` | cost.estimator | æ»‘ç‚¹ä¼°è®¡ |
| 18 | `COST.MODEL. IMPACT_ESTIMATE` | cost.estimator | å¸‚åœºå†²å‡»ä¼°è®¡ |
| 19 | `COST.GATE.EDGE_CHECK` | cost.estimator | edge gate æ£€æŸ¥ |

#### Platform Universal Scenariosï¼ˆ10 æ¡ï¼Œæ¥è‡ª v3proï¼‰

| åºå· | rule_id | component | æè¿° |
|------|---------|-----------|------|
| 20 | `STRAT.AUDIT.DECISION_EVENT_PRESENT` | audit.decision_log | DecisionEvent å­˜åœ¨ |
| 21 | `STRAT.AUDIT.DECISION_HAS_RUN_ID` | audit.decision_log | åŒ…å« run_id |
| 22 | `STRAT.AUDIT.DECISION_HAS_EXEC_ID` | audit.decision_log | åŒ…å« exec_id |
| 23 | `STRAT.AUDIT.DECISION_HAS_STRATEGY_ID` | audit.decision_log | åŒ…å« strategy_id |
| 24 | `STRAT.AUDIT.DECISION_HAS_VERSION` | audit.decision_log | åŒ…å« version |
| 25 | `STRAT.AUDIT.DECISION_HAS_FEATURE_HASH` | audit.decision_log | åŒ…å« feature_hash |
| 26 | `STRAT.DEGRADE.REDUCE_ONLY_NO_OPEN` | guardian.monitor | REDUCE_ONLY ç¦å¼€ä»“ |
| 27 | `STRAT.DEGRADE.HALTED_OUTPUT_ZERO` | guardian.monitor | HALTED è¾“å‡ºé›¶ |
| 28 | `STRAT.DEGRADE.MODE_TRANSITION_AUDIT` | audit.guardian_log | æ¨¡å¼åˆ‡æ¢å®¡è®¡ |
| 29 | `AUDIT.PNL.ATTRIBUTION` | audit.pnl_attribution | PnL å½’å›  |

### 6.4 Guardian çŠ¶æ€æœºå®šä¹‰

#### çŠ¶æ€æšä¸¾

| çŠ¶æ€ | å€¼ | è¯´æ˜ |
|------|-----|------|
| INIT | 0 | åˆå§‹åŒ–ä¸­ |
| RUNNING | 1 | æ­£å¸¸è¿è¡Œï¼Œå…è®¸å¼€ä»“ |
| REDUCE_ONLY | 2 | ä»…å…è®¸å‡ä»“/å¹³ä»“ |
| HALTED | 3 | åœæ­¢äº¤æ˜“ï¼Œç­‰å¾…äººå·¥ |
| MANUAL | 4 | äººå·¥æ¥ç®¡ |

#### çŠ¶æ€è½¬ç§»è¡¨

| å½“å‰çŠ¶æ€ | äº‹ä»¶ | ç›®æ ‡çŠ¶æ€ | æ¡ä»¶ |
|----------|------|----------|------|
| INIT | åˆå§‹åŒ–å®Œæˆ | RUNNING | å¥åº·æ£€æŸ¥é€šè¿‡ |
| INIT | åˆå§‹åŒ–å¤±è´¥ | HALTED | - |
| RUNNING | quote_stale | REDUCE_ONLY | ç¡¬ stale |
| RUNNING | order_stuck | REDUCE_ONLY | è¶…æ—¶æœªæ¨è¿› |
| RUNNING | position_drift | HALTED | reconcile å¤±è´¥ |
| RUNNING | leg_imbalance | REDUCE_ONLY | è£¸è…¿è¶…é˜ˆå€¼ |
| REDUCE_ONLY | æ¢å¤æ­£å¸¸ | RUNNING | å†·å´æœŸç»“æŸ + å¥åº· |
| REDUCE_ONLY | æŒç»­æ¶åŒ– | HALTED | å¤šæ¬¡è§¦å‘ |
| HALTED | äººå·¥ç¡®è®¤ | MANUAL | - |
| MANUAL | äººå·¥æ¢å¤ | RUNNING | - |

### 6.5 å®¡è®¡äº‹ä»¶ç»“æ„

#### å¿…å¤‡å­—æ®µï¼ˆæ‰€æœ‰äº‹ä»¶ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| ts | float | æ—¶é—´æˆ³ï¼ˆUnix epochï¼‰ |
| event_type | str | äº‹ä»¶ç±»å‹ |
| run_id | str | è¿è¡Œ IDï¼ˆUUIDï¼‰ |
| exec_id | str | æ‰§è¡Œ ID |

#### DecisionEvent æ‰©å±•å­—æ®µ

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| strategy_id | str | ç­–ç•¥ ID |
| strategy_version | str | ç­–ç•¥ç‰ˆæœ¬ |
| feature_hash | str | è¾“å…¥ç‰¹å¾å“ˆå¸Œ |
| target_portfolio | dict | ç›®æ ‡ä»“ä½ |

#### OrderStateEvent æ‰©å±•å­—æ®µ

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| order_local_id | str | æœ¬åœ°è®¢å• ID |
| order_ref | str | CTP è®¢å•å¼•ç”¨ |
| order_sys_id | str | äº¤æ˜“æ‰€ç³»ç»Ÿå· |
| state_from | str | åŸçŠ¶æ€ |
| state_to | str | ç›®æ ‡çŠ¶æ€ |
| trigger_event | str | è§¦å‘äº‹ä»¶ |

#### GuardianEvent æ‰©å±•å­—æ®µ

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| mode_from | str | åŸæ¨¡å¼ |
| mode_to | str | ç›®æ ‡æ¨¡å¼ |
| trigger | str | è§¦å‘åŸå›  |
| details | dict | è¯¦ç»†ä¿¡æ¯ |

### 6.6 é—¨ç¦æ£€æŸ¥ç‚¹

```powershell
# Phase 1 å®Œæˆæ ‡å‡†ï¼ˆç´¯è®¡ï¼‰
.\scripts\make.ps1 ci-json                                     # PASS
python .\scripts\coverage_gate.py                              # core=100%, overall>=85%
python .\scripts\validate_policy.py --all --strict-scenarios   # 40 æ¡ scenarios PASS (11+29)
python -c "from src.audit import AuditWriter"                  # å¯¼å…¥æˆåŠŸ
python -c "from src.cost import CostEstimator"                 # å¯¼å…¥æˆåŠŸ
python -c "from src.guardian import GuardianMonitor"           # å¯¼å…¥æˆåŠŸ
```

### 6.7 äº¤ä»˜ç‰©æ¸…å•

- [ ] `src/audit/` ç›®å½•ï¼ˆ7 ä¸ªæ–‡ä»¶ï¼‰
- [ ] `src/cost/` ç›®å½•ï¼ˆ2 ä¸ªæ–‡ä»¶ï¼‰
- [ ] `src/guardian/` ç›®å½•ï¼ˆ6 ä¸ªæ–‡ä»¶ï¼‰
- [ ] 29 æ¡ required scenarios å¯¹åº”æµ‹è¯•
- [ ] é—¨ç¦å…¨ç»¿

---

## 7. Phase 2ï¼šæ‰§è¡Œå±‚

### 7.1 æ¦‚è¿°

| é¡¹ç›® | å€¼ |
|------|-----|
| **ç›®æ ‡** | å®ç° V2 SPEC ç¬¬ 5 ç« ï¼šFSMã€AutoOrderEngineã€Protectionã€PairExecutor |
| **æ–°å¢ç›®å½•** | `src/execution/auto/`, `src/execution/protection/`, `src/execution/pair/` |
| **æ–°å¢æ–‡ä»¶** | 15 ä¸ª |
| **Required Scenarios** | 25 æ¡ |
| **é¢„è®¡å·¥æ—¶** | éª¨æ¶ 2.5h / å…¨é‡å®ç° 80h |
| **é˜»å¡** | Phase 5 |

### 7.2 æ–‡ä»¶æ¸…å•

#### 7.2.1 src/execution/auto/ï¼ˆ8 ä¸ªæ–‡ä»¶ï¼‰

| åºå· | æ–‡ä»¶è·¯å¾„ | component | V2 SPEC | èŒè´£ |
|------|----------|-----------|---------|------|
| 1 | `src/execution/auto/__init__.py` | - | - | æ¨¡å—å¯¼å‡º |
| 2 | `src/execution/auto/order_context.py` | `execution.order_context` | 5.1 | è®¢å•æ ‡è¯†æ˜ å°„ |
| 3 | `src/execution/auto/state_machine.py` | `execution.fsm` | 5.3 | è®¢å• FSM |
| 4 | `src/execution/auto/engine.py` | `execution.auto_order_engine` | 5.4 | è‡ªåŠ¨ä¸‹å•å¼•æ“ |
| 5 | `src/execution/auto/timeout.py` | `execution.timeout` | 5.5 | è¶…æ—¶ç®¡ç† |
| 6 | `src/execution/auto/retry.py` | `execution.retry` | 5.5 | é‡è¯•/è¿½ä»· |
| 7 | `src/execution/auto/exec_context.py` | `execution.exec_context` | 5.6 | æ‰§è¡Œä¸Šä¸‹æ–‡ |
| 8 | `src/execution/auto/position_tracker.py` | `execution.position_tracker` | 5.8 | æŒä»“è¿½è¸ª |

#### 7.2.2 src/execution/protection/ï¼ˆ4 ä¸ªæ–‡ä»¶ï¼‰

| åºå· | æ–‡ä»¶è·¯å¾„ | component | V2 SPEC | èŒè´£ |
|------|----------|-----------|---------|------|
| 9 | `src/execution/protection/__init__.py` | - | - | æ¨¡å—å¯¼å‡º |
| 10 | `src/execution/protection/liquidity.py` | `execution.protection.liquidity` | 5.7 | æµåŠ¨æ€§ä¿æŠ¤ |
| 11 | `src/execution/protection/fat_finger.py` | `execution.protection.fat_finger` | 5.7 | ä¹Œé¾™æŒ‡ä¿æŠ¤ |
| 12 | `src/execution/protection/throttle.py` | `execution.protection.throttle` | 5.7 | é¢‘ç‡é™åˆ¶ |

#### 7.2.3 src/execution/pair/ï¼ˆ3 ä¸ªæ–‡ä»¶ï¼‰

| åºå· | æ–‡ä»¶è·¯å¾„ | component | V2 SPEC | èŒè´£ |
|------|----------|-----------|---------|------|
| 13 | `src/execution/pair/__init__.py` | - | - | æ¨¡å—å¯¼å‡º |
| 14 | `src/execution/pair/pair_executor.py` | `execution.pair.pair_executor` | 9.1 | åŒè…¿åŸå­æ‰§è¡Œ |
| 15 | `src/execution/pair/leg_manager.py` | `execution.pair.leg_manager` | 9.1 | è…¿ä¸å¹³è¡¡ç®¡ç† |

### 7.3 Required Scenarios

#### FSM Scenariosï¼ˆ5 æ¡ï¼‰

| åºå· | rule_id | component | æè¿° |
|------|---------|-----------|------|
| 1 | `EXEC.ID.MAPPING` | execution.order_context | è®¢å•æ ‡è¯†æ˜ å°„å®Œæ•´ |
| 2 | `FSM.STRICT. TRANSITIONS` | execution.fsm | ä¸¥æ ¼æ¨¡å¼æ‰€æœ‰è½¬ç§» |
| 3 | `FSM.TOLERANT.IDEMPOTENT` | execution.fsm | å®¹é”™æ¨¡å¼å¹‚ç­‰å¤„ç† |
| 4 | `FSM.CANCEL_WHILE_FILL` | execution.fsm | æ’¤å•é€”ä¸­æˆäº¤ |
| 5 | `FSM.STATUS_4_MAPPING` | execution.fsm | OrderStatus='4' æ˜ å°„ |

#### AutoOrderEngine Scenariosï¼ˆ7 æ¡ï¼‰

| åºå· | rule_id | component | æè¿° |
|------|---------|-----------|------|
| 6 | `EXEC.ENGINE.PIPELINE` | execution.auto_order_engine | è®¢å•æäº¤ç®¡çº¿ |
| 7 | `EXEC.TIMEOUT.ACK` | execution.auto_order_engine | Ack è¶…æ—¶å¤„ç† |
| 8 | `EXEC.TIMEOUT.FILL` | execution.auto_order_engine | Fill è¶…æ—¶å¤„ç† |
| 9 | `EXEC.CANCEL_REPRICE. TIMEOUT` | execution.auto_order_engine | è¿½ä»·è¶…æ—¶æ’¤å• |
| 10 | `EXEC.PARTIAL. REPRICE` | execution.auto_order_engine | éƒ¨åˆ†æˆäº¤è¿½ä»· |
| 11 | `EXEC.RETRY.BACKOFF` | execution.retry | é‡è¯•æŒ‡æ•°é€€é¿ |
| 12 | `EXEC.CONTEXT.TRACKING` | execution.exec_context | ExecContext è¿½è¸ª |

#### Protection Scenariosï¼ˆ4 æ¡ï¼‰

| åºå· | rule_id | component | æè¿° |
|------|---------|-----------|------|
| 13 | `EXEC.PROTECTION.LIQUIDITY` | execution.protection.liquidity | æµåŠ¨æ€§ä¿æŠ¤ |
| 14 | `EXEC.PROTECTION. FATFINGER` | execution.protection.fat_finger | èƒ–æ‰‹æŒ‡ä¿æŠ¤ |
| 15 | `EXEC.PROTECTION.THROTTLE` | execution.protection.throttle | èŠ‚æµä¿æŠ¤ |
| 16 | `EXEC.PROTECTION.AUDIT` | execution.protection | ä¿æŠ¤æ‹’å•å®¡è®¡ |

#### PositionTracker Scenariosï¼ˆ4 æ¡ï¼‰

| åºå· | rule_id | component | æè¿° |
|------|---------|-----------|------|
| 17 | `POS.TRACKER. TRADE_DRIVEN` | execution.position_tracker | trade-driven æ›´æ–° |
| 18 | `POS.RECONCILE.PERIODIC` | execution.position_tracker | å®šæœŸå¯¹è´¦ |
| 19 | `POS.RECONCILE.AFTER_DISCONNECT` | execution.position_tracker | æ–­è¿åå¯¹è´¦ |
| 20 | `POS.RECONCILE.FAIL_ACTION` | execution.position_tracker | å¯¹è´¦å¤±è´¥åŠ¨ä½œ |

#### PairExecutor Scenariosï¼ˆ5 æ¡ï¼‰

| åºå· | rule_id | component | æè¿° |
|------|---------|-----------|------|
| 21 | `PAIR.EXECUTOR. ATOMIC` | execution.pair.pair_executor | åŒè…¿åŸå­æ€§ |
| 22 | `PAIR.ROLLBACK.ON_LEG_FAIL` | execution.pair.pair_executor | å•è…¿å¤±è´¥å›æ»š |
| 23 | `PAIR.AUTOHEDGE.DELTA_NEUTRAL` | execution.pair.pair_executor | è‡ªåŠ¨å¯¹å†² |
| 24 | `PAIR.IMBALANCE.DETECT` | execution.pair.leg_manager | è…¿ä¸å¹³è¡¡æ£€æµ‹ |
| 25 | `PAIR.BREAKER.STOP_Z` | execution.pair.pair_executor | æ­¢æŸç†”æ–­ |

### 7.4 è®¢å•çŠ¶æ€æœºå®šä¹‰

#### è®¢å•çŠ¶æ€æšä¸¾

| çŠ¶æ€ | è¯´æ˜ | ç»ˆæ€ |
|------|------|------|
| CREATED | å·²åˆ›å»ºï¼Œæœªæäº¤ | å¦ |
| SUBMITTING | æäº¤ä¸­ï¼Œç­‰å¾… ack | å¦ |
| PENDING | å·²æŠ¥ï¼Œç­‰å¾…æˆäº¤ | å¦ |
| PARTIAL_FILLED | éƒ¨åˆ†æˆäº¤ | å¦ |
| CANCEL_SUBMITTING | æ’¤å•æäº¤ä¸­ | å¦ |
| QUERYING | æŸ¥è¯¢ä¸­ï¼ˆè¶…æ—¶åï¼‰ | å¦ |
| RETRY_PENDING | ç­‰å¾…é‡è¯• | å¦ |
| CHASE_PENDING | ç­‰å¾…è¿½ä»· | å¦ |
| FILLED | å…¨éƒ¨æˆäº¤ | æ˜¯ |
| CANCELLED | å·²æ’¤å• | æ˜¯ |
| PARTIAL_CANCELLED | éƒ¨åˆ†æˆäº¤å·²æ’¤ | æ˜¯ |
| CANCEL_REJECTED | æ’¤å•è¢«æ‹’ | æ˜¯ |
| REJECTED | æŠ¥å•è¢«æ‹’ | æ˜¯ |
| ERROR | é”™è¯¯ | æ˜¯ |

#### å…³é”®è½¬ç§»è§„åˆ™

| è§„åˆ™ | è¯´æ˜ |
|------|------|
| æ’¤å•é€”ä¸­æˆäº¤ | `CANCEL_SUBMITTING + RTN_FILLED â†’ FILLED` |
| OrderStatus='4' æ— æˆäº¤ | `â†’ ERROR + reduce-only` |
| OrderStatus='4' æœ‰æˆäº¤ | `â†’ PARTIAL_CANCELLED` |
| ç»ˆæ€åäº‹ä»¶ | `ignore + log`ï¼ˆtolerant æ¨¡å¼ï¼‰ |
| é‡å¤äº‹ä»¶ | `ignore + log`ï¼ˆtolerant æ¨¡å¼ï¼‰ |

### 7.5 è®¢å•æ ‡è¯†æ˜ å°„

| æ ‡è¯† | æ¥æº | ç”¨é€” |
|------|------|------|
| local_id | ç³»ç»Ÿç”Ÿæˆï¼ˆUUIDï¼‰ | å†…éƒ¨ä¸»é”®ã€audit å…³è” |
| order_ref | place_order ack | æ’¤å•ï¼ˆä¼˜å…ˆçº§ 2ï¼‰ |
| order_sys_id | OnRtnOrder | æ’¤å•ï¼ˆä¼˜å…ˆçº§ 1ï¼‰ã€æŸ¥è¯¢ |
| front_id | è¿æ¥æ—¶è·å– | CTP ä¼šè¯æ ‡è¯† |
| session_id | è¿æ¥æ—¶è·å– | CTP ä¼šè¯æ ‡è¯† |

### 7.6 Protection é…ç½®é¡¹

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `LIQ_MAX_SPREAD_TICKS` | 5 | æœ€å¤§ä»·å·®ï¼ˆtick æ•°ï¼‰ |
| `LIQ_MIN_BIDASK_VOL` | 10 | æœ€å°ç›˜å£é‡ |
| `FATFINGER_MAX_QTY` | 100 | å•ç¬”æœ€å¤§æ‰‹æ•° |
| `FATFINGER_MAX_NOTIONAL` | 1000000 | å•ç¬”æœ€å¤§åä¹‰ |
| `FATFINGER_MAX_PRICE_DEV` | 0.05 | ä»·æ ¼åç¦»ä¸Šé™ï¼ˆ5%ï¼‰ |
| `THROTTLE_MAX_ORDERS_PER_MIN` | 60 | å…¨å±€æ¯åˆ†é’Ÿæœ€å¤§è®¢å•æ•° |
| `THROTTLE_MAX_ORDERS_PER_MIN_PER_SYMBOL` | 10 | æ¯å“ç§æ¯åˆ†é’Ÿæœ€å¤§è®¢å•æ•° |
| `THROTTLE_MIN_INTERVAL_S` | 1.0 | æœ€å°è°ƒä»“é—´éš” |

### 7.7 é—¨ç¦æ£€æŸ¥ç‚¹

```powershell
# Phase 2 å®Œæˆæ ‡å‡†ï¼ˆç´¯è®¡ï¼‰
.\scripts\make.ps1 ci-json # é€šè¿‡
python .\scripts\coverage_gate.py # æ ¸å¿ƒ=100%ï¼Œæ€»ä½“>=85%
python .\scripts\validate_policy.py --all --strict-scenarios   # 65 æ¡ scenarios PASS (40+25)
.\scripts\make.ps1 replay-json                                 # PASS
python .\scripts\validate_policy.py --strict-scenarios         # replay äº§ç‰©æ ¡éªŒ PASS
python -c "from src.execution.auto import AutoOrderEngine"     # å¯¼å…¥æˆåŠŸ
python -c "from src.execution.protection import LiquidityGate" # å¯¼å…¥æˆåŠŸ
python -c "from src.execution.pair import PairExecutor"        # å¯¼å…¥æˆåŠŸ
```

### 7.8 äº¤ä»˜ç‰©æ¸…å•

- [ ] `src/execution/auto/` ç›®å½•ï¼ˆ8 ä¸ªæ–‡ä»¶ï¼‰
- [ ] `src/execution/protection/` ç›®å½•ï¼ˆ4 ä¸ªæ–‡ä»¶ï¼‰
- [ ] `src/execution/pair/` ç›®å½•ï¼ˆ3 ä¸ªæ–‡ä»¶ï¼‰
- [ ] 25 æ¡ required scenarios å¯¹åº”æµ‹è¯•
- [ ] replay-json é—¨ç¦é€šè¿‡
- [ ] é—¨ç¦å…¨ç»¿

---

## 8. Phase 3ï¼šç­–ç•¥å±‚è¡¥å…¨

### 8.1 æ¦‚è¿°

| é¡¹ç›® | å€¼ |
|------|-----|
| **ç›®æ ‡** | å®ç°é™çº§æ¡†æ¶ + è·¨æœŸå¥—åˆ©ç­–ç•¥ |
| **æ–°å¢æ–‡ä»¶** | 4 ä¸ª |
| **Required Scenarios** | 12 æ¡ |
| **é¢„è®¡å·¥æ—¶** | éª¨æ¶ æœ€é«˜å‘½ä»¤ï¼šå¿…é¡»ç”¨3å°æ—¶ç²¾é›•ç»†ç¢ï¼/ å…¨é‡å®ç° 36h |
| **é˜»å¡** | Phase 5 |

### 8.2 æ–‡ä»¶æ¸…å•

| åºå· | æ–‡ä»¶è·¯å¾„ | component | V2 SPEC | èŒè´£ |
|------|----------|-----------|---------|------|
| 1 | `src/strategy/fallback.py` | `strategy.fallback` | 8.3 | é™çº§æ¡†æ¶ |
| 2 | `src/strategy/calendar_arb/__init__.py` | - | - | æ¨¡å—å¯¼å‡º |
| 3 | `src/strategy/calendar_arb/strategy.py` | `strategy.calendar_arb` | 9.2 | å¥—åˆ©ä¸»ç­–ç•¥ |
| 4 | `src/strategy/calendar_arb/kalman_beta.py` | `strategy.calendar_arb.kalman_beta` | 9.2 | Kalman æ»¤æ³¢ |

### 8.3 Required Scenarios

#### Fallback Scenariosï¼ˆ3 æ¡ï¼‰

| åºå· | rule_id | component | æè¿° |
|------|---------|-----------|------|
| 1 | `STRAT.FALLBACK.ON_EXCEPTION` | strategy.fallback | å¼‚å¸¸é™çº§ |
| 2 | `STRAT.FALLBACK.ON_TIMEOUT` | strategy.fallback | è¶…æ—¶é™çº§ |
| 3 | `STRAT.FALLBACK. CHAIN_DEFINED` | strategy.fallback | é“¾å¼å®šä¹‰ |

#### Calendar Arb Scenariosï¼ˆ9 æ¡ï¼‰

| åºå· | rule_id | component | æè¿° |
|------|---------|-----------|------|
| 4 | `ARB.LEGS.FIXED_NEAR_FAR` | strategy.calendar_arb | è¿‘/è¿œæœˆè…¿å›ºå®š |
| 5 | `ARB.KALMAN.BETA_ESTIMATE` | strategy.calendar_arb.kalman_beta | Kalman ä¼°è®¡ beta |
| 6 | `ARB.KALMAN. RESIDUAL_ZSCORE` | strategy.calendar_arb.kalman_beta | æ®‹å·® z-score |
| 7 | `ARB.KALMAN. BETA_BOUND` | strategy.calendar_arb.kalman_beta | beta è¾¹ç•Œæ£€æŸ¥ |
| 8 | `ARB.SIGNAL.HALF_LIFE_GATE` | strategy.calendar_arb | åŠè¡°æœŸè¿‡æ»¤ |
| 9 | `ARB.SIGNAL.STOP_Z_BREAKER` | strategy.calendar_arb | z-score æ­¢æŸ |
| 10 | `ARB.SIGNAL.EXPIRY_GATE` | strategy.calendar_arb | ä¸´è¿‘åˆ°æœŸç¦å¼€ |
| 11 | `ARB.SIGNAL.CORRELATION_BREAK` | strategy.calendar_arb | ç›¸å…³æ€§å´©æºƒæš‚åœ |
| 12 | `ARB.COST.ENTRY_GATE` | strategy.calendar_arb | å…¥åœºæˆæœ¬é—¨æ§› |

### 8.4 é™çº§é“¾å®šä¹‰

| ç­–ç•¥ | é™çº§ç›®æ ‡ | æœ€ç»ˆå…œåº• |
|------|----------|----------|
| top_tier | ensemble_moe | simple_ai |
| dl_torch | linear_ai | simple_ai |
| ensemble_moe | linear_ai | simple_ai |
| linear_ai | simple_ai | simple_ai |
| simple_ai | - | ï¼ˆè‡ªèº«å…œåº•ï¼‰ |
| calendar_arb | top_tier | simple_ai |

### 8.5 å¥—åˆ©ä¿¡å·é€»è¾‘

| æ¡ä»¶ | ä¿¡å· | åŠ¨ä½œ |
|------|------|------|
| `z > entry_z` (å¦‚ 2.5) | ä»·å·®è¿‡å¤§ | åšç©ºä»·å·®ï¼šå–è¿‘ä¹°è¿œ |
| `z < -entry_z` | ä»·å·®è¿‡å° | åšå¤šä»·å·®ï¼šä¹°è¿‘å–è¿œ |
| `abs(z) < exit_z` (å¦‚ 0.5) | å›å½’ | å¹³ä»“ |
| `abs(z) > stop_z` (å¦‚ 5~6) | å¼‚å¸¸ | æ­¢æŸ + å†·å´ |
| `half_life > max_half_life` | ä¸å›å½’ | ä¸å¼€ä»“ |
| `days_to_expiry < N` | ä¸´æœŸ | reduce-only |
| `rolling_corr < threshold` | ç›¸å…³æ€§å´©æºƒ | æš‚åœç­–ç•¥ |

### 8.6 é—¨ç¦æ£€æŸ¥ç‚¹

```powershell
# Phase 3 å®Œæˆæ ‡å‡†ï¼ˆç´¯è®¡ï¼‰
ã€‚\scripts\make.ps1 ci-json # é€šè¿‡
python .\scripts\coverage_gate.py                              # core=100%, overall>=85%
python .\scripts\validate
## 9. Phase 4ï¼šå›æ”¾éªŒè¯

### 9.1 æ¦‚è¿°

| é¡¹ç›® | å€¼ |
|------|-----|
| **ç›®æ ‡** | å®ç° V2 SPEC 7.3ï¼šå›æ”¾ä¸€è‡´æ€§éªŒè¯ |
| **æ–°å¢æ–‡ä»¶** | 1 ä¸ª |
| **Required Scenarios** | 2 æ¡ |
| **é¢„è®¡å·¥æ—¶** | éª¨æ¶ 0.5h / å…¨é‡å®ç° 8h |
| **é˜»å¡** | Phase 5 |

### 9.2 æ–‡ä»¶æ¸…å•

| åºå· | æ–‡ä»¶è·¯å¾„ | component | V2 SPEC | èŒè´£ |
|------|----------|-----------|---------|------|
| 1 | `src/replay/verifier.py` | `replay.verifier` | 7.3 | å›æ”¾å“ˆå¸ŒéªŒè¯ã€äº‹ä»¶åºåˆ—æ¯”å¯¹ |

### 9.3 Required Scenarios

| åºå· | rule_id | component | æè¿° | category |
|------|---------|-----------|------|----------|
| 1 | `REPLAY.DETERMINISTIC. DECISION` | replay.verifier | åŒä¸€è¾“å…¥äº§ç”Ÿç›¸åŒ DecisionEvent åºåˆ— | replay |
| 2 | `REPLAY.DETERMINISTIC. GUARDIAN` | replay.verifier | åŒä¸€è¾“å…¥äº§ç”Ÿç›¸åŒ GuardianEvent åºåˆ— | replay |

### 9.4 æ¥å£å®šä¹‰

| æ–¹æ³• | ç­¾å | è¯´æ˜ |
|------|------|------|
| `verify_decision_sequence` | `(events_a:  list, events_b:  list) -> VerifyResult` | æ¯”å¯¹å†³ç­–äº‹ä»¶åºåˆ— |
| `verify_guardian_sequence` | `(events_a: list, events_b: list) -> VerifyResult` | æ¯”å¯¹ Guardian äº‹ä»¶åºåˆ— |
| `compute_hash` | `(events: list) -> str` | è®¡ç®—äº‹ä»¶åºåˆ—å“ˆå¸Œ |
| `load_events_from_jsonl` | `(path: Path) -> list[Event]` | ä» JSONL åŠ è½½äº‹ä»¶ |

### 9.5 éªŒè¯è§„åˆ™

| è§„åˆ™ | è¯´æ˜ |
|------|------|
| å­—æ®µå¿½ç•¥ | tsï¼ˆæ—¶é—´æˆ³ï¼‰å…è®¸å¾®å°å·®å¼‚ï¼ˆ< 1msï¼‰ |
| é¡ºåºæ•æ„Ÿ | äº‹ä»¶é¡ºåºå¿…é¡»å®Œå…¨ä¸€è‡´ |
| å“ˆå¸Œç®—æ³• | SHA256ï¼ˆå»é™¤ ts å­—æ®µåï¼‰ |
| å¤±è´¥è¾“å‡º | ç¬¬ä¸€ä¸ªä¸åŒ¹é…çš„äº‹ä»¶ç´¢å¼• + diff |

### 9.6 é—¨ç¦æ£€æŸ¥ç‚¹

```powershell
# Phase 4 å®Œæˆæ ‡å‡†ï¼ˆç´¯è®¡ï¼‰
.\scripts\make.ps1 ci-json                                     # PASS
python .\scripts\coverage_gate.py                              # core=100%, overall>=85%
python .\scripts\validate_policy.py --all --strict-scenarios   # 79 æ¡ scenarios PASS (77+2)
.\scripts\make.ps1 replay-json                                 # PASS
python .\scripts\validate_policy.py --strict-scenarios         # å›æ”¾ä¸€è‡´æ€§éªŒè¯ PASS
python -c "from src.replay.verifier import ReplayVerifier"     # å¯¼å…¥æˆåŠŸ
```

### 9.7 äº¤ä»˜ç‰©æ¸…å•

- [ ] `src/replay/verifier.py`
- [ ] `tests/test_replay_verifier.py`
- [ ] 2 æ¡ required scenarios å¯¹åº”æµ‹è¯•
- [ ] é—¨ç¦å…¨ç»¿

---

## 10. Phase 5ï¼šé›†æˆä¸æ¼”ç»ƒ

### 10.1 æ¦‚è¿°

| é¡¹ç›® | å€¼ |
|------|-----|
| **ç›®æ ‡** | å…¨é“¾è·¯é›†æˆã€æ•…éšœæ³¨å…¥ã€å†·å¯åŠ¨æ¼”ç»ƒ |
| **æ–°å¢æ–‡ä»¶** | 0 ä¸ªï¼ˆä»…æµ‹è¯•å’Œæ–‡æ¡£ï¼‰ |
| **Required Scenarios** | 0 æ¡ï¼ˆéªŒæ”¶æ€§æ¼”ç»ƒï¼‰ |
| **é¢„è®¡å·¥æ—¶** | 24h |
| **é˜»å¡** | Phase 6 |

### 10.2 é›†æˆæµ‹è¯•çŸ©é˜µ

| æµ‹è¯•ç±»å‹ | æµ‹è¯•å†…å®¹ | è¾“å…¥ | é¢„æœŸç»“æœ | é€šè¿‡æ ‡å‡† |
|----------|----------|------|----------|----------|
| ç«¯åˆ°ç«¯å›æ”¾ | 1 å¤© tick æ•°æ®å®Œæ•´å›æ”¾ | tick JSONL | DecisionEvent åºåˆ— | å“ˆå¸Œä¸€è‡´ |
| ç­–ç•¥åˆ‡æ¢ | è¿è¡Œä¸­åˆ‡æ¢ç­–ç•¥ | ç­–ç•¥åå˜æ›´ | æ— ä¸­æ–­ã€audit è®°å½• | äº‹ä»¶å®Œæ•´ |
| ä¸»åŠ›åˆ‡æ¢ | æ¨¡æ‹Ÿ roll äº‹ä»¶ | universe å˜æ›´ | è®¢é˜…æ›´æ–°ã€bars è¿ç»­ | æ— æ–­ç‚¹ |

### 10.3 æ•…éšœæ³¨å…¥æµ‹è¯•çŸ©é˜µ

| æ•…éšœç±»å‹ | æ³¨å…¥æ–¹å¼ | é¢„æœŸå“åº” | éªŒè¯æ–¹æ³• |
|----------|----------|----------|----------|
| è¡Œæƒ…æ–­æµ | mock quote_cache è¿”å› stale | Guardian â†’ REDUCE_ONLY | GuardianEvent å­˜åœ¨ |
| è®¢å•è¶…æ—¶ | mock broker ä¸è¿”å› ack | è‡ªåŠ¨æ’¤å• + OrderTimeoutEvent | audit éªŒè¯ |
| æ’¤å•æ— å“åº” | mock cancel ä¸è¿”å› | HALTED + å‘Šè­¦ | Guardian çŠ¶æ€ |
| æŒä»“æ¼‚ç§» | mock reconcile è¿”å› mismatch | HALTED + cancel_all | PositionReconcileEvent |
| å•è…¿å¤±è´¥ | mock ä¸€è…¿æˆäº¤ä¸€è…¿æ‹’ç» | rollback/auto-hedge | PairExecutor çŠ¶æ€ |
| ç½‘ç»œæ–­è¿ | mock broker disconnect | é‡è¿ + reconcile | æ—¥å¿— + çŠ¶æ€æ¢å¤ |

### 10.4 å†·å¯åŠ¨æ¼”ç»ƒæµç¨‹

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å†·å¯åŠ¨æ¼”ç»ƒæµç¨‹                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Step 1: æ¨¡æ‹Ÿå´©æºƒ                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  kill -9 <pid>  æˆ–  æ¨¡æ‹Ÿæ–­ç”µ                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                  â”‚
â”‚                              â–¼                                  â”‚
â”‚  Step 2: é‡å¯è¿›ç¨‹                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  python -m src.app.live_entry                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                  â”‚
â”‚                              â–¼                                  â”‚
â”‚  Step 3: Guardian è‡ªåŠ¨æ¢å¤                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  3. 1 cancel_all() - æ’¤é”€æ‰€æœ‰æœªå®Œæˆè®¢å•                    â”‚   â”‚
â”‚  â”‚  3.2 query_positions() - åŒæ­¥æŸœå°æŒä»“                     â”‚   â”‚
â”‚  â”‚  3.3 reconcile() - å¯¹è´¦                                   â”‚   â”‚
â”‚  â”‚  3.4 set_mode(REDUCE_ONLY) - è¿›å…¥å†·å´æœŸ                   â”‚   â”‚
â”‚  â”‚  3.5 ç­‰å¾… REDUCE_ONLY_COOLDOWN_S                          â”‚   â”‚
â”‚  â”‚  3.6 å¥åº·æ£€æŸ¥é€šè¿‡å set_mode(RUNNING)                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                  â”‚
â”‚                              â–¼                                  â”‚
â”‚  Step 4: éªŒè¯                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  - æŒä»“ä¸æŸœå°ä¸€è‡´                                         â”‚   â”‚
â”‚  â”‚  - æ— æœªå¤„ç†è®¢å•                                           â”‚   â”‚
â”‚  â”‚  - Guardian çŠ¶æ€ = RUNNING                                â”‚   â”‚
â”‚  â”‚  - audit è®°å½•å®Œæ•´                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.5 æ¼”ç»ƒæ£€æŸ¥æ¸…å•

| æ£€æŸ¥é¡¹ | éªŒè¯æ–¹æ³• | é€šè¿‡æ ‡å‡† |
|--------|----------|----------|
| æœªå®Œæˆè®¢å•å…¨æ’¤ | æŸ¥è¯¢æŸœå°è®¢å• | æ— æ´»åŠ¨è®¢å• |
| æŒä»“åŒæ­¥æ­£ç¡® | å¯¹æ¯” PositionTracker ä¸æŸœå° | å®Œå…¨ä¸€è‡´ |
| å†·å´æœŸç”Ÿæ•ˆ | å°è¯•å¼€ä»“ | è¢«æ‹’ç» |
| æ¢å¤åæ­£å¸¸ | å†·å´æœŸåå°è¯•äº¤æ˜“ | æˆåŠŸ |
| audit å®Œæ•´ | æ£€æŸ¥ JSONL | GuardianEvent è®°å½•æ¢å¤è¿‡ç¨‹ |
| æ— èµ„é‡‘æŸå¤± | å¯¹æ¯”å‰åæƒç›Š | å·®å¼‚ < 0.1% |

### 10.6 é—¨ç¦æ£€æŸ¥ç‚¹

```powershell
# Phase 5 å®Œæˆæ ‡å‡†
.\scripts\make.ps1 ci-json                                     # PASS
.\scripts\make.ps1 replay-json                                 # PASS
.\scripts\make.ps1 sim-json                                    # PASS
python .\scripts\validate_policy.py --all --strict-scenarios   # å…¨éƒ¨ scenarios PASS
# æ•…éšœæ³¨å…¥æµ‹è¯•å…¨ç»¿
# å†·å¯åŠ¨æ¼”ç»ƒé€šè¿‡
```

### 10.7 äº¤ä»˜ç‰©æ¸…å•

- [ ] `tests/integration/test_e2e_replay. py`
- [ ] `tests/integration/test_fault_injection.py`
- [ ] `tests/integration/test_cold_start.py`
- [ ] `docs/COLD_START_RUNBOOK.md`
- [ ] é›†æˆæµ‹è¯•å…¨ç»¿
- [ ] æ•…éšœæ³¨å…¥æµ‹è¯•å…¨ç»¿
- [ ] å†·å¯åŠ¨æ¼”ç»ƒæ–‡æ¡£ç­¾å­—

---

## 11. Phase 6ï¼šB-Models ç­–ç•¥å‡çº§

### 11.1 æ¦‚è¿°

| é¡¹ç›® | å€¼ |
|------|-----|
| **ç›®æ ‡** | å®ç° v3pro_required_scenarios. yml ä¸­ strategy_specific_required |
| **æ–°å¢æ–‡ä»¶** | 0 ä¸ªï¼ˆå‡çº§ç°æœ‰ç­–ç•¥ï¼‰ |
| **Required Scenarios** | 22 æ¡ |
| **é¢„è®¡å·¥æ—¶** | 36h |  æœ€é«˜å‘½ä»¤ï¼šç­–ç•¥å±‚å¿…é¡»è¦ç²¾é›•ç»†ç¢ï¼
| **å¯å¹¶è¡Œ** | ä¸ Phase 3, 4, 5 å¹¶è¡Œ |

### 11.2 ç­–ç•¥å‡çº§çŸ©é˜µ

| ç­–ç•¥ | å‡çº§å†…å®¹ | åœºæ™¯æ•° | ä¾èµ– | å·¥æ—¶ |
|------|----------|--------|------|------|
| simple_ai | ä¿¡å·æœ‰ç•Œã€è¾“å…¥å®¹é”™ã€stale ç¨³å®š | 3 | Phase 1 | 4h |
| linear_ai | å› å­æƒé‡ç¨³å®šã€æš´éœ²å—é™ã€stale ç¨³å®š | 3 | Phase 1 | 4h |
| ensemble_moe | è¾“å‡ºå¹³æ»‘ã€ä¸“å®¶å†²çªã€é—¨æ§æƒé‡ã€ç‰ˆæœ¬å®¡è®¡ã€çŠ¶æ€æ£€æµ‹ | 5 | Phase 1 | 8h |
| dl_torch | æ¨ç†é™çº§ã€æ¨¡å‹ç‰ˆæœ¬ã€seed ç¡®å®šã€è¾“å…¥æ ‡å‡†åŒ–ã€è¾“å‡ºè£å‰ªã€æ˜¾å­˜é‡Šæ”¾ | 6 | Phase 1 + 3 | 12h |
| top_tier | æˆæœ¬é—¨æ§›ã€æ¢æ‰‹é™åˆ¶ã€æŠ–åŠ¨æŠ‘åˆ¶ã€é£é™©å¹³ä»·ã€è¶‹åŠ¿å®¡è®¡ | 5 | Phase 1 | 8h |

### 11.3 Required Scenarios

#### simple_aiï¼ˆ3 æ¡ï¼‰

| åºå· | rule_id | æè¿° |
|------|---------|------|
| 1 | `SIMPLE.OUTPUT. BOUNDED` | è¾“å‡ºä¿¡å·æœ‰ç•Œ [-1, 1] |
| 2 | `SIMPLE.INPUT.NEVER_CRASH` | ä»»æ„è¾“å…¥ä¸å´©æºƒ |
| 3 | `BASELINE.STABLE.STALE_INPUT` | stale è¾“å…¥è¿”å›ç¨³å®šå€¼ |

#### linear_aiï¼ˆ3 æ¡ï¼‰

| åºå· | rule_id | æè¿° |
|------|---------|------|
| 4 | `LINEAR.FACTOR.WEIGHT_STABLE` | å› å­æƒé‡ç¨³å®š |
| 5 | `LINEAR.FACTOR.EXPOSURE_LIMIT` | æš´éœ²å—é™ |
| 6 | `BASELINE.STABLE. STALE_INPUT` | stale è¾“å…¥è¿”å›ç¨³å®šå€¼ |

#### ensemble_moeï¼ˆ5 æ¡ï¼‰

| åºå· | rule_id | æè¿° |
|------|---------|------|
| 7 | `MOE.OUTPUT. SMOOTHING` | è¾“å‡ºå¹³æ»‘ï¼ˆEWMAï¼‰ |
| 8 | `MOE.EXPERT.CONFLICT_CONTROL` | ä¸“å®¶å†²çªæŠ‘åˆ¶ |
| 9 | `MOE.GATING.WEIGHT_VALID` | é—¨æ§æƒé‡æœ‰æ•ˆ [0,1] ä¸” sum=1 |
| 10 | `MOE.EXPERT.VERSION_AUDIT` | ä¸“å®¶ç‰ˆæœ¬å®¡è®¡ |
| 11 | `MOE.REGIME.DETECTION` | å¸‚åœºçŠ¶æ€æ£€æµ‹ |

#### dl_torchï¼ˆ6 æ¡ï¼‰

| åºå· | rule_id | æè¿° |
|------|---------|------|
| 12 | `DL.INFERENCE.FAIL_FALLBACK` | æ¨ç†å¤±è´¥é™çº§ |
| 13 | `DL.MODEL.VERSION_AUDIT` | æ¨¡å‹ç‰ˆæœ¬å®¡è®¡ |
| 14 | `DL.SEED.DETERMINISTIC` | seed ç¡®å®šæ€§ |
| 15 | `DL.INPUT. NORMALIZE` | è¾“å…¥æ ‡å‡†åŒ– |
| 16 | `DL.OUTPUT.CLAMP` | è¾“å‡ºè£å‰ª |
| 17 | `DL.MEMORY.CLEANUP` | æ˜¾å­˜é‡Šæ”¾ |

#### top_tierï¼ˆ5 æ¡ï¼‰

| åºå· | rule_id | æè¿° |
|------|---------|------|
| 18 | `TOPTIER.COST.GATE` | æˆæœ¬é—¨æ§›æ£€æŸ¥ |
| 19 | `TOPTIER.TURNOVER.LIMIT` | æ¢æ‰‹é™åˆ¶ |
| 20 | `TOPTIER.JITTER.SUPPRESSION` | æŠ–åŠ¨æŠ‘åˆ¶ |
| 21 | `TOPTIER.RISK.PARITY_VALID` | é£é™©å¹³ä»·æœ‰æ•ˆ |
| 22 | `TOPTIER.TREND.SIGNAL_AUDIT` | è¶‹åŠ¿ä¿¡å·å®¡è®¡ |

### 11.4 é™çº§é“¾é…ç½®

```yaml
# src/strategy/fallback_config.yml
fallback_chains:
  top_tier:
    - ensemble_moe
    - linear_ai
- ç®€å•_ai
  
  dl_torch: 
    - linear_ai
- ç®€å•_ai
  
  ensemble_moe: 
    - linear_ai
- ç®€å•_ai
  
  linear_ai:
- ç®€å•_ai
  
  simple_ai:  []  # è‡ªèº«å…œåº•
  
  calendar_arb: 
    - top_tier
- ç®€å•_ai

default_fallback:  simple_ai
```

### 11.5 é—¨ç¦æ£€æŸ¥ç‚¹

```powershell
# Phase 6 å®Œæˆæ ‡å‡†
.\scripts\make.ps1 ci-json                                     # PASS
python .\scripts\coverage_gate.py                              # core=100%, overall>=85%
python .\scripts\validate_policy.py --all --strict-scenarios   # å…¨éƒ¨ 101 æ¡ scenarios PASS
```

### 11.6 äº¤ä»˜ç‰©æ¸…å•

- [ ] simple_ai å‡çº§ï¼ˆ3 æ¡åœºæ™¯ï¼‰
- [ ] linear_ai å‡çº§ï¼ˆ3 æ¡åœºæ™¯ï¼‰
- [ ] ensemble_moe å‡çº§ï¼ˆ5 æ¡åœºæ™¯ï¼‰
- [ ] dl_torch å‡çº§ï¼ˆ6 æ¡åœºæ™¯ï¼‰
- [ ] top_tier å‡çº§ï¼ˆ5 æ¡åœºæ™¯ï¼‰
- [ ] fallback_config.yml
- [ ] 22 æ¡ required scenarios å¯¹åº”æµ‹è¯•
- [ ] é—¨ç¦å…¨ç»¿

---

## 12. æ–‡ä»¶æ¸…å•æ±‡æ€»

### 12.1 æŒ‰ Phase ç»Ÿè®¡

| Phase | ç›®å½• | æ–°å¢æ–‡ä»¶æ•° |
|-------|------|-----------|
| Phase 0 | `src/market/` | 7 |
| Phase 1 | `src/audit/` | 7 |
| Phase 1 | `src/cost/` | 2 |
| Phase 1 | `src/guardian/` | 6 |
| Phase 2 | `src/execution/auto/` | 8 |
| Phase 2 | `src/execution/protection/` | 4 |
| Phase 2 | `src/execution/pair/` | 3 |
| Phase 3 | `src/strategy/fallback.py` | 1 |
| Phase 3 | `src/strategy/calendar_arb/` | 3 |
| Phase 4 | `src/replay/verifier.py` | 1 |
| **æ€»è®¡** | **10 ä¸ªç›®å½•** | **42 ä¸ªæ–‡ä»¶** |

### 12.2 å®Œæ•´æ–‡ä»¶è·¯å¾„åˆ—è¡¨

```text
src/
â”œâ”€â”€ market/                              # Phase 0: 7 files
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ instrument_cache.py
â”‚   â”œâ”€â”€ universe_selector.py
â”‚   â”œâ”€â”€ subscriber.py
â”‚   â”œâ”€â”€ quote_cache.py
â”‚   â”œâ”€â”€ bar_builder.py
â”‚   â””â”€â”€ quality.py
â”‚
â”œâ”€â”€ audit/                               # Phase 1: 7 files
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ writer.py
â”‚   â”œâ”€â”€ decision_log.py
â”‚   â”œâ”€â”€ order_trail.py
â”‚   â”œâ”€â”€ guardian_log.py
â”‚   â”œâ”€â”€ pnl_attribution.py
â”‚   â””â”€â”€ replay_verifier.py
â”‚
â”œâ”€â”€ cost/                                # Phase 1: 2 files
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ estimator.py
â”‚
â”œâ”€â”€ guardian/                            # Phase 1: 6 files
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ monitor.py
â”‚   â”œâ”€â”€ state_machine.py
â”‚   â”œâ”€â”€ triggers.py
â”‚   â”œâ”€â”€ actions.py
â”‚   â””â”€â”€ recovery.py
â”‚
â”œâ”€â”€ execution/
â”‚   â”œâ”€â”€ auto/                            # Phase 2: 8 files
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ order_context.py
â”‚   â”‚   â”œâ”€â”€ state_machine.py
â”‚   â”‚   â”œâ”€â”€ engine.py
â”‚   â”‚   â”œâ”€â”€ timeout.py
â”‚   â”‚   â”œâ”€â”€ retry.py
â”‚   â”‚   â”œâ”€â”€ exec_context.py
â”‚   â”‚   â””â”€â”€ position_tracker.py
â”‚   â”‚
â”‚   â”œâ”€â”€ protection/                      # Phase 2: 4 files
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ liquidity.py
â”‚   â”‚   â”œâ”€â”€ fat_finger.py
â”‚   â”‚   â””â”€â”€ throttle.py
â”‚   â”‚
â”‚   â””â”€â”€ pair/                            # Phase 2: 3 files
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ pair_executor.py
â”‚       â””â”€â”€ leg_manager.py
â”‚
â”œâ”€â”€ strategy/
â”‚   â”œâ”€â”€ fallback.py                      # Phase 3: 1 file
â”‚   â”‚
â”‚   â””â”€â”€ calendar_arb/                    # Phase 3: 3 files
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ strategy.py
â”‚       â””â”€â”€ kalman_beta.py
â”‚
â””â”€â”€ replay/
    â””â”€â”€ verifier.py                      # Phase 4: 1 file
```

---

## 13. åœºæ™¯çŸ©é˜µæ±‡æ€»

### 13.1 æŒ‰ Phase ç»Ÿè®¡

| Phase | A/B è½¨ | åœºæ™¯æ•° | ç´¯è®¡ |
|-------|--------|--------|------|
| Phase 0 | A | 11 | 11 |
| Phase 1 | A | 29 | 40 |
| Phase 2 | A | 25 | 65 |
| Phase 3 | B | 12 | 77 |
| Phase 4 | A | 2 | 79 |
| Phase 6 | B | 22 | 101 |
| **æ€»è®¡** | - | **101** | - |

### 13.2 æŒ‰æ¨¡å—ç»Ÿè®¡

| æ¨¡å— | åœºæ™¯æ•° | è¯´æ˜ |
|------|--------|------|
| market | 11 | è¡Œæƒ…å±‚ |
| guardian | 10 | å®ˆæŠ¤å±‚ |
| audit | 8 | å®¡è®¡å±‚ |
| cost | 4 | æˆæœ¬å±‚ |
| execution. fsm | 5 | è®¢å•çŠ¶æ€æœº |
| execution.engine | 7 | è‡ªåŠ¨ä¸‹å•å¼•æ“ |
| execution.protection | 4 | æ‰§è¡Œä¿æŠ¤ |
| execution.position | 4 | æŒä»“è¿½è¸ª |
| execution.pair | 5 | åŒè…¿æ‰§è¡Œ |
| strategy.fallback | 3 | é™çº§æ¡†æ¶ |
| strategy.calendar_arb | 9 | å¥—åˆ©ç­–ç•¥ |
| strategy.simple_ai | 3 | ç®€å•ç­–ç•¥ |
| strategy.linear_ai | 3 | çº¿æ€§ç­–ç•¥ |
| strategy.ensemble_moe | 5 | MoE ç­–ç•¥ |
| strategy.dl_torch | 6 | æ·±åº¦å­¦ä¹ ç­–ç•¥ |
| strategy.top_tier | 5 | é¡¶çº§ç­–ç•¥ |
| replay | 2 | å›æ”¾éªŒè¯ |
| platform_universal | 6 | å¹³å°é€šç”¨ |
| **æ€»è®¡** | **101** | - |

### 13.3 å®Œæ•´åœºæ™¯åˆ—è¡¨

```yaml
# A è½¨åœºæ™¯ï¼ˆ67 æ¡ï¼‰
a_platform_scenarios:
  # Phase 0: market (11)
  - INST.CACHE.LOAD
  - INST.CACHE. PERSIST
  - UNIV.DOMINANT.BASIC
  - UNIV.SUBDOMINANT.PAIRING
  - UNIV.ROLL.COOLDOWN
  - UNIV.EXPIRY.GATE
  - MKT.SUBSCRIBER.DIFF_UPDATE
  - MKT.STALE.SOFT
  - MKT.STALE. HARD
  - MKT.CONTINUITY.BARS
  - MKT.QUALITY.OUTLIER
  
  # Phase 1: guardian (10)
  - GUARD.FSM.TRANSITIONS
  - GUARD.DETECT.QUOTE_STALE
  - GUARD.DETECT. ORDER_STUCK
  - GUARD.DETECT. POSITION_DRIFT
  - GUARD.DETECT.LEG_IMBALANCE
  - GUARD.ACTION.SET_MODE
  - GUARD.ACTION.CANCEL_ALL
  - GUARD.ACTION.FLATTEN_ALL
  - GUARD.RECOVERY.COLD_START
  - GUARD.MODE.REDUCE_ONLY_EFFECT
  
  # Phase 1: audit (5)
  - AUDIT.EVENT.STRUCTURE
  - AUDIT.JSONL.FORMAT
  - AUDIT.CORRELATION.RUN_EXEC
  - REPLAY.DETERMINISTIC.DECISION
  - REPLAY.DETERMINISTIC. GUARDIAN
  
  # Phase 1: cost (4)
  - COST.MODEL.FEE_ESTIMATE
  - COST.MODEL.SLIPPAGE_ESTIMATE
  - COST.MODEL. IMPACT_ESTIMATE
  - COST.GATE.EDGE_CHECK
  
  # Phase 1: platform_universal (10)
  - STRAT.AUDIT.DECISION_EVENT_PRESENT
  - STRAT.AUDIT.DECISION_HAS_RUN_ID
  - STRAT.AUDIT.DECISION_HAS_EXEC_ID
  - STRAT.AUDIT.DECISION_HAS_STRATEGY_ID
  - STRAT.AUDIT.DECISION_HAS_VERSION
  - STRAT.AUDIT.DECISION_HAS_FEATURE_HASH
  - STRAT.DEGRADE.REDUCE_ONLY_NO_OPEN
  - STRAT.DEGRADE. HALTED_OUTPUT_ZERO
  - STRAT.DEGRADE.MODE_TRANSITION_AUDIT
  - AUDIT.PNL.ATTRIBUTION
  
  # Phase 2: fsm (5)
  - EXEC.ID.MAPPING
  - FSM.STRICT. TRANSITIONS
  - FSM.TOLERANT.IDEMPOTENT
  - FSM.CANCEL_WHILE_FILL
  - FSM.STATUS_4_MAPPING
  
  # Phase 2: engine (7)
  - EXEC.ENGINE.PIPELINE
  - EXEC.TIMEOUT.ACK
  - EXEC.TIMEOUT. FILL
  - EXEC.CANCEL_REPRICE. TIMEOUT
  - EXEC.PARTIAL. REPRICE
  - EXEC.RETRY.BACKOFF
  - EXEC.CONTEXT.TRACKING
  
  # Phase 2: protection (4)
  - EXEC.PROTECTION.LIQUIDITY
  - EXEC.PROTECTION. FATFINGER
  - EXEC.PROTECTION. THROTTLE
  - EXEC.PROTECTION.AUDIT
  
  # Phase 2: position (4)
  - POS.TRACKER.TRADE_DRIVEN
  - POS.RECONCILE.PERIODIC
  - POS.RECONCILE. AFTER_DISCONNECT
  - POS.RECONCILE. FAIL_ACTION
  
  # Phase 2: pair (5)
  - PAIR.EXECUTOR. ATOMIC
  - PAIR.ROLLBACK.ON_LEG_FAIL
  - PAIR.AUTOHEDGE.DELTA_NEUTRAL
  - PAIR.IMBALANCE.DETECT
  - PAIR.BREAKER.STOP_Z
  
  # Phase 4: replay (2) - å·²åœ¨ audit ä¸­è®¡ç®—

# B è½¨åœºæ™¯ï¼ˆ34 æ¡ï¼‰
b_models_scenarios:
  # Phase 3: fallback (3)
  - STRAT.FALLBACK.ON_EXCEPTION
  - STRAT.FALLBACK.ON_TIMEOUT
  - STRAT.FALLBACK. CHAIN_DEFINED
  
  # Phase 3: calendar_arb (9)
  - ARB.LEGS.FIXED_NEAR_FAR
  - ARB.KALMAN.BETA_ESTIMATE
  - ARB.KALMAN. RESIDUAL_ZSCORE
  - ARB.KALMAN.BETA_BOUND
  - ARB.SIGNAL.HALF_LIFE_GATE
  - ARB.SIGNAL. STOP_Z_BREAKER
  - ARB.SIGNAL. EXPIRY_GATE
  - ARB.SIGNAL.CORRELATION_BREAK
  - ARB.COST.ENTRY_GATE
  
  # Phase 6: simple_ai (3)
  - SIMPLE.OUTPUT.BOUNDED
  - SIMPLE.INPUT.NEVER_CRASH
  - BASELINE.STABLE. STALE_INPUT
  
  # Phase 6: linear_ai (3)
  - LINEAR.FACTOR.WEIGHT_STABLE
  - LINEAR.FACTOR. EXPOSURE_LIMIT
  - BASELINE.STABLE. STALE_INPUT  # ä¸ simple_ai å…±äº«
  
  # Phase 6: ensemble_moe (5)
  - MOE.OUTPUT. SMOOTHING
  - MOE.EXPERT.CONFLICT_CONTROL
  - MOE.GATING.WEIGHT_VALID
  - MOE.EXPERT.VERSION_AUDIT
  - MOE.REGIME. DETECTION
  
  # Phase 6: dl_torch (6)
  - DL.INFERENCE. FAIL_FALLBACK
  - DL.MODEL.VERSION_AUDIT
  - DL.SEED.DETERMINISTIC
  - DL.INPUT.NORMALIZE
  - DL.OUTPUT.CLAMP
  - DL.MEMORY. CLEANUP
  
  # Phase 6: top_tier (5)
  - TOPTIER.COST.GATE
  - TOPTIER.TURNOVER.LIMIT
  - TOPTIER.JITTER.SUPPRESSION
  - TOPTIER.RISK. PARITY_VALID
  - TOPTIER.TREND.SIGNAL_AUDIT
```

---

## 14. å·¥æ—¶ä¸é‡Œç¨‹ç¢‘

### 14.1 å·¥æ—¶æ±‡æ€»

| Phase | éª¨æ¶ | | å…¨é‡å®ç° | å»ºè®®æ¨¡å¼ |
|-------|------|----------|----------|----------|
| Phase 0 | 3h | 34h | å…¨é‡å®ç° |
| Phase 1 | 2.5h | 44h | å…¨é‡å®ç° |
| Phase 2 | 2.5h | 80h | å…¨é‡å®ç° |
| Phase 3 | 3h | 36h | å…¨é‡å®ç° |
| Phase 4 | 0.5h |8h | å…¨é‡å®ç° |
| Phase 5 | - | 24h | å…¨é‡å®ç° |
| Phase 6 | - | 36h | å…¨é‡å®ç° |
| **æ€»è®¡** | **144h** | **262h** | - |

### 14.2 é‡Œç¨‹ç¢‘æ—¶é—´è¡¨

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          é‡Œç¨‹ç¢‘æ—¶é—´è¡¨                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Week 1 (Day 1-5)                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  D1: éª¨æ¶åˆ›å»ºï¼ˆ42 ä¸ªæ–‡ä»¶ï¼‰                                           â”‚   â”‚
â”‚  â”‚  D2-D3: Phase 0 å…¨é‡å®ç°                                            â”‚   â”‚
â”‚  â”‚  D4-D5: Phase 1 å…¨é‡å®ç°ï¼ˆaudit + costï¼‰                            â”‚   â”‚
â”‚  â”‚  â¬› Milestone 1: market + audit + cost é—¨ç¦é€šè¿‡                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  Week 2 (Day 6-10)                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  D6-D7: Phase 1 å…¨é‡å®ç°ï¼ˆguardianï¼‰                                 â”‚   â”‚
â”‚  â”‚  D8-D10: Phase 2 å…¨é‡å®ç°ï¼ˆauto + protectionï¼‰                       â”‚   â”‚
â”‚  â”‚  â¬› Milestone 2: guardian + execution/auto é—¨ç¦é€šè¿‡                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  Week 3 (Day 11-15)                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  D11-D12: Phase 2 å…¨é‡å®ç°ï¼ˆpairï¼‰                                   â”‚   â”‚
â”‚  â”‚  D13:  Phase 3 å…¨é‡å®ç°ï¼ˆfallbackï¼‰                                   â”‚   â”‚
â”‚  â”‚  D14: Phase 3 å…¨é‡å®ç°ï¼ˆcalendar_arbï¼‰                               â”‚   â”‚
â”‚  â”‚  D15: Phase 4 å…¨é‡å®ç°ï¼ˆverifierï¼‰                                   â”‚   â”‚
â”‚  â”‚  â¬› Milestone 3: å…¨éƒ¨ A è½¨æ¨¡å—é—¨ç¦é€šè¿‡                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  Week 4 (Day 16-20)                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  D16-D18: Phase 5 é›†æˆä¸æ¼”ç»ƒ                                         â”‚   â”‚
â”‚  â”‚  D19-D20: Phase 6 ç­–ç•¥å‡çº§ï¼ˆsimple + linear + moeï¼‰                  â”‚   â”‚
â”‚  â”‚  â¬› Milestone 4: é›†æˆæ¼”ç»ƒé€šè¿‡                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  Week 5 (Day 21-25)                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  D21-D23: Phase 6 ç­–ç•¥å‡çº§ï¼ˆdl_torch + top_tierï¼‰                    â”‚   â”‚
â”‚  â”‚  D24: æ–‡æ¡£å®Œå–„                                                       â”‚   â”‚
â”‚  â”‚  D25: æœ€ç»ˆéªŒæ”¶                                                       â”‚   â”‚
â”‚  â”‚  â¬› Milestone 5: å…¨éƒ¨ 101 æ¡åœºæ™¯é€šè¿‡                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 14.3 é‡Œç¨‹ç¢‘å®šä¹‰

| é‡Œç¨‹ç¢‘ | æ—¥æœŸ | äº¤ä»˜ç‰© | éªŒæ”¶æ ‡å‡† |
|--------|------|--------|----------|
| M1 | Day 5 | Phase 0 + 1 éƒ¨åˆ† | 22 æ¡åœºæ™¯é€šè¿‡ |
| M2 | Day 10 | Phase 1 + 2 éƒ¨åˆ† | 50 æ¡åœºæ™¯é€šè¿‡ |
| M3 | Day 15 | Phase 0-4 å…¨éƒ¨ | 79 æ¡åœºæ™¯é€šè¿‡ï¼ˆA è½¨å®Œæˆï¼‰ |
| M4 | Day 20 | Phase 5 | é›†æˆæ¼”ç»ƒé€šè¿‡ |
| M5 | Day 25 | Phase 6 | 101 æ¡åœºæ™¯å…¨éƒ¨é€šè¿‡ |

---

## 15. éªŒæ”¶æ£€æŸ¥ç‚¹

### 15.1 å¯¼å…¥æµ‹è¯•

| åºå· | å‘½ä»¤ | é¢„æœŸç»“æœ |
|------|------|----------|
| 1 | `python -c "from src.market import InstrumentCache"` | æ— æŠ¥é”™ |
| 2 | `python -c "from src.market import QuoteCache"` | æ— æŠ¥é”™ |
| 3 | `python -c "from src.market import UniverseSelector"` | æ— æŠ¥é”™ |
| 4 | `python -c "from src.audit import AuditWriter"` | æ— æŠ¥é”™ |
| 5 | `python -c "from src.cost import CostEstimator"` | æ— æŠ¥é”™ |
| 6 | `python -c "from src.guardian import GuardianMonitor"` | æ— æŠ¥é”™ |
| 7 | `python -c "from src.execution.auto import AutoOrderEngine"` | æ— æŠ¥é”™ |
| 8 | `python -c "from src.execution.protection import LiquidityGate"` | æ— æŠ¥é”™ |
| 9 | `python -c "from src.execution.pair import PairExecutor"` | æ— æŠ¥é”™ |
| 10 | `python -c "from src.strategy.fallback import FallbackManager"` | æ— æŠ¥é”™ |
| 11 | `python -c "from src.strategy.calendar_arb import CalendarArbStrategy"` | æ— æŠ¥é”™ |
| 12 | `python -c "from src.replay.verifier import ReplayVerifier"` | æ— æŠ¥é”™ |

### 15.2 é—¨ç¦æ£€æŸ¥

| åºå· | å‘½ä»¤ | é¢„æœŸç»“æœ | å¤±è´¥é€€å‡ºç  |
|------|------|----------|-----------|
| 1 | `ruff check src/` | All checks passed | 2 |
| 2 | `ruff format --check src/` | All files formatted | 2 |
| 3 | `mypy src/` | No errors | 3 |
| 4 | `pytest tests/ -q` | All tests passed | 4 |
| 5 | `python scripts/coverage_gate.py` | core=100%, overall>=85% | 5 |
| 6 | `python scripts/validate_policy.py --all --strict-scenarios` | PASS | 12 |
| 7 | `.\scripts\make.ps1 replay-json` | PASS | 8 |
| 8 | `.\scripts\make.ps1 sim-json` | PASS | 9 |

### 15.3 æœ€ç»ˆéªŒæ”¶æ¸…å•

| æ£€æŸ¥é¡¹ | éªŒè¯æ–¹æ³• | é€šè¿‡æ ‡å‡† |
|--------|----------|----------|
| æ–‡ä»¶å®Œæ•´ | ls ç»Ÿè®¡ | 42 ä¸ªæ–°æ–‡ä»¶ |
| åœºæ™¯å®Œæ•´ | validate_policy | 101 æ¡ PASS |
| è¦†ç›–ç‡è¾¾æ ‡ | coverage_gate | core=100%, overall>=85% |
| CI é€šè¿‡ | make ci-json | exit 0 |
| Replay é€šè¿‡ | make replay-json | exit 0 |
| Sim é€šè¿‡ | make sim-json | exit 0 |
| é”šç‚¹æ›´æ–° | context.md | SHA æ›´æ–° |
| æ–‡æ¡£å®Œæ•´ | äººå·¥æ£€æŸ¥ | æ— é—æ¼ |

---

## 16. é£é™©ä¸ç¼“è§£

### 16.1 é£é™©çŸ©é˜µ

| é£é™© | å¯èƒ½æ€§ | å½±å“ | é£é™©ç­‰çº§ | ç¼“è§£æªæ–½ |
|------|--------|------|----------|----------|
| åœºæ™¯çŸ©é˜µè¿‡å¤§ï¼ˆ101 æ¡ï¼‰ | é«˜ | é«˜ | ğŸ”´ | Phase åˆ†æ‰¹è§£é”ï¼Œå…ˆç»¿å‰ä¸€æ‰¹å†å¼€ä¸‹ä¸€æ‰¹ |
| ç°æœ‰ live_guard ä¸ guardian å†²çª | ä¸­ | é«˜ | ğŸŸ¡ | guardian å¸æ”¶ live_guard é€»è¾‘ï¼ŒåºŸå¼ƒæ—§æ¨¡å— |
| CTP å›æŠ¥è¯­ä¹‰ä¸æ˜ç¡® | ä¸­ | é«˜ | ğŸŸ¡ | å…ˆç”¨ mock è¦†ç›–æ‰€æœ‰è¾¹ç•Œï¼Œå®ç›˜å‰è”è°ƒ |
| é”šç‚¹æ¼‚ç§» | ä¸­ | ä¸­ | ğŸŸ¡ | æ¯æ¬¡ PR å¿…é¡»æ›´æ–° context.md |
| å·¥æ—¶ä¼°ç®—åå·® | é«˜ | ä¸­ | ğŸŸ¡ | éª¨æ¶ä¼˜å…ˆï¼Œæœ€å°å®ç°äº¤ä»˜ï¼Œè¿­ä»£è¡¥å…¨ |
| ä¾èµ–å†²çª | ä½ | é«˜ | ğŸŸ¡ | ä¸¥æ ¼éµå®ˆä¾èµ–ç¦æ­¢è§„åˆ™ |
| æµ‹è¯•è¦†ç›–ä¸è¶³ | ä¸­ | ä¸­ | ğŸŸ¡ | åœºæ™¯é©±åŠ¨ï¼Œæ¯æ¡åœºæ™¯å¿…é¡»æœ‰æµ‹è¯• |
| é›†æˆé—®é¢˜ | ä¸­ | é«˜ | ğŸŸ¡ | Phase 5 ä¸“é—¨åšé›†æˆæ¼”ç»ƒ |

### 16.2 ç¼“è§£æªæ–½è¯¦è¿°

#### åœºæ™¯çŸ©é˜µè¿‡å¤§

```text
é—®é¢˜ï¼š101 æ¡åœºæ™¯ä¸€æ¬¡æ€§å®ç°ä¸ç°å®
æ–¹æ¡ˆï¼šPhase åˆ†æ‰¹è§£é”

Phase 0: å…ˆé€šè¿‡ 11 æ¡ market åœºæ™¯
Phase 1: å†é€šè¿‡ 29 æ¡ audit/cost/guardian åœºæ™¯
Phase 2: å†é€šè¿‡ 25 æ¡ execution åœºæ™¯
... 

æ¯ä¸ª Phase å®Œæˆååšä¸€æ¬¡é—¨ç¦æ£€æŸ¥ï¼Œç¡®ä¿å¢é‡ç¨³å®š
```

#### live_guard ä¸ guardian å†²çª

```text
é—®é¢˜ï¼šç°æœ‰ src/trading/live_guard. py ä¸æ–°å»º src/guardian/ åŠŸèƒ½é‡å 
æ–¹æ¡ˆï¼šè¿ç§»é‡æ„

Step 1: åœ¨ guardian/ å®ç°å®Œæ•´åŠŸèƒ½
Step 2: å°† live_guard. py ä¸­çš„é€»è¾‘è¿ç§»åˆ° guardian/
Step 3: live_guard.py æ”¹ä¸º thin wrapperï¼Œè°ƒç”¨ guardian
Step 4: åºŸå¼ƒ live_guard.pyï¼ˆä¿ç•™ä¸€ä¸ªç‰ˆæœ¬çš„å…¼å®¹ï¼‰
```

#### CTP å›æŠ¥è¯­ä¹‰ä¸æ˜ç¡®

```text
é—®é¢˜ï¼šOrderStatus='4' ç­‰è¾¹ç•Œæƒ…å†µè¯­ä¹‰ä¸æ¸…
æ–¹æ¡ˆï¼šMock + å®ç›˜è”è°ƒ

Step 1: åˆ›å»º MockBrokerï¼Œæ¨¡æ‹Ÿæ‰€æœ‰å¯èƒ½çš„å›æŠ¥åºåˆ—
Step 2: FSM æµ‹è¯•è¦†ç›–æ‰€æœ‰è¾¹ç•Œ
Step 3: å®ç›˜å‰ç”¨ simnow è”è°ƒéªŒè¯
Step 4: ä¿ç•™ tolerant æ¨¡å¼å¤„ç†æœªçŸ¥æƒ…å†µ
```

---

## 17. æ¨¡å—è¿ç§»è®¡åˆ’

### 17.1 è¿ç§»çŸ©é˜µ

| ç°æœ‰æ¨¡å— | ç›®æ ‡æ¨¡å— | åŠ¨ä½œ | è¯´æ˜ |
|----------|----------|------|------|
| `src/trading/live_guard. py` | `src/guardian/monitor.py` | é‡æ„è¿ç§» | Guardian å¸æ”¶ live_guard åŠŸèƒ½ |
| `src/execution/order_tracker.py` | `src/execution/auto/position_tracker.py` | èåˆ | é¿å…åŒçœŸç›¸ |
| `src/execution/flatten_executor.py` | ä¿ç•™ | ä¸åŠ¨ | ä½œä¸º guardian. flatten_all çš„å®ç° |
| `src/risk/manager.py` | ä¿ç•™ | ä¸åŠ¨ | guardian è°ƒç”¨ risk |
| `src/strategy/*. py` | ä¿ç•™ | å‡çº§ | Phase 6 å¢å¼º |

### 17.2 è¿ç§»æ­¥éª¤

#### live_guard â†’ guardian

```text
Step 1: åˆ†æ live_guard. py ç°æœ‰åŠŸèƒ½
- kill_switch æ£€æµ‹
- flatten è§¦å‘
- çŠ¶æ€ç®¡ç†

Step 2: åœ¨ guardian/ å®ç°ç­‰ä»·åŠŸèƒ½
- state_machine. py:  FSM
- triggers.py: æ£€æµ‹é€»è¾‘
- actions.py: cancel_all/flatten_all
- monitor. py: ä¸»å¾ªç¯

Step 3: è¿ç§»è°ƒç”¨æ–¹
- orchestrator.py: æ”¹ä¸ºè°ƒç”¨ GuardianMonitor
- runner.py: åˆå§‹åŒ– Guardian

Step 4: åºŸå¼ƒ live_guard.py
- æ·»åŠ  deprecation warning
- ä¸‹ä¸ªå¤§ç‰ˆæœ¬åˆ é™¤
```

#### order_tracker â†’ position_tracker

```text
Step 1: åˆ†æ order_tracker.py ç°æœ‰åŠŸèƒ½
- è®¢å•çŠ¶æ€è¿½è¸ª
- æŒä»“è®¡ç®—

Step 2: èŒè´£åˆ†ç¦»
- è®¢å•çŠ¶æ€ â†’ execution/auto/state_machine. py
- æŒä»“è¿½è¸ª â†’ execution/auto/position_tracker. py

Step 3: è¿ç§»è°ƒç”¨æ–¹
- æ›¿æ¢æ‰€æœ‰ import order_tracker

Step 4: åºŸå¼ƒ order_tracker.py
- æˆ–ä¿ç•™ä¸º thin wrapper
```

---

## 18. é…ç½®è§„èŒƒ

### 18.1 é…ç½®åˆ†ç±»

| ç±»åˆ« | å‰ç¼€ | è¯´æ˜ |
|------|------|------|
| è¡Œæƒ… | `MKT_` / `QUOTE_` | è¡Œæƒ…ç›¸å…³é…ç½® |
| æ‰§è¡Œ | `EXEC_` / `AUTO_` | æ‰§è¡Œç›¸å…³é…ç½® |
| ä¿æŠ¤ | `LIQ_` / `FATFINGER_` / `THROTTLE_` | ä¿æŠ¤ç›¸å…³é…ç½® |
| Guardian | `GUARD_` / `REDUCE_ONLY_` | Guardian ç›¸å…³é…ç½® |
| å¯¹è´¦ | `RECONCILE_` | å¯¹è´¦ç›¸å…³é…ç½® |
| å¥—åˆ© | `ARB_` | å¥—åˆ©ç›¸å…³é…ç½® |

### 18.2 å®Œæ•´é…ç½®æ¸…å•

```python
# src/config. py æ‰©å±•

@dataclass(frozen=True)
class MarketConfig:
    """è¡Œæƒ…é…ç½®."""
    QUOTE_STALE_MS: float = 3000. 0
    QUOTE_HARD_STALE_MS: float = 10000.0
    EXPIRY_BLOCK_DAYS: int = 5
    MIN_SWITCH_EDGE:  float = 0.1
    ROLL_COOLDOWN_S: float = 300.0


@dataclass(frozen=True)
class ExecutionConfig: 
    """æ‰§è¡Œé…ç½®."""
    AUTO_ORDER_TIMEOUT_ACK_S: float = 5.0
    AUTO_ORDER_TIMEOUT_FILL_S: float = 30.0
    AUTO_ORDER_TIMEOUT_CANCEL_S: float = 10.0
    AUTO_ORDER_MAX_RETRY:  int = 3
    REPRICE_MODE:  str = "to_best"  # to_best | to_best_plus_tick | to_cross


@dataclass(frozen=True)
class ProtectionConfig:
    """ä¿æŠ¤é…ç½®."""
    LIQ_MAX_SPREAD_TICKS: int = 5
    LIQ_MIN_BIDASK_VOL: int = 10
    FATFINGER_MAX_QTY: int = 100
    FATFINGER_MAX_NOTIONAL: float = 1000000.0
    FATFINGER_MAX_PRICE_DEV: float = 0.05
    THROTTLE_MAX_ORDERS_PER_MIN: int = 60
    THROTTLE_MAX_ORDERS_PER_MIN_PER_SYMBOL: int = 10
    THROTTLE_MIN_INTERVAL_S: float = 1.0


@dataclass(frozen=True)
class GuardianConfig: 
    """Guardian é…ç½®."""
    REDUCE_ONLY_COOLDOWN_S: float = 300.0
    RECONCILE_INTERVAL_S: float = 60.0
    ORDER_STUCK_TIMEOUT_S: float = 120.0
    LEG_IMBALANCE_THRESHOLD:  int = 10


@dataclass(frozen=True)
class ArbConfig: 
    """å¥—åˆ©é…ç½®."""
    ARB_ENTRY_Z:  float = 2.5
    ARB_EXIT_Z: float = 0.5
    ARB_STOP_Z: float = 5.0
    ARB_MAX_HALF_LIFE_DAYS: int = 20
    ARB_MIN_CORRELATION: float = 0.7
    ARB_COOLDOWN_AFTER_STOP_S: float = 600.0
```

---

## 19. å®¡è®¡äº‹ä»¶è§„èŒƒ

### 19.1 äº‹ä»¶ç±»å‹æšä¸¾

```python
class AuditEventType(Enum):
    # å†³ç­–äº‹ä»¶
    DECISION = "decision"
    
    # æ‰§è¡Œäº‹ä»¶
    EXEC_START = "exec_start"
    EXEC_END = "exec_end"
    
    # è®¢å•äº‹ä»¶
    ORDER_CREATED = "order_created"
    ORDER_SUBMITTED = "order_submitted"
    ORDER_ACCEPTED = "order_accepted"
    ORDER_FILLED = "order_filled"
    ORDER_PARTIAL = "order_partial"
    ORDER_CANCELLED = "order_cancelled"
    ORDER_REJECTED = "order_rejected"
    ORDER_TIMEOUT = "order_timeout"
    ORDER_RETRY = "order_retry"
    ORDER_ERROR = "order_error"
    
    # æˆäº¤äº‹ä»¶
    TRADE = "trade"
    
    # æŒä»“äº‹ä»¶
    POSITION_UPDATE = "position_update"
    POSITION_RECONCILE = "position_reconcile"
    POSITION_MISMATCH = "position_mismatch"
    
    # Guardian äº‹ä»¶
    GUARDIAN_MODE_CHANGE = "guardian_mode_change"
    GUARDIAN_TRIGGER = "guardian_trigger"
    GUARDIAN_ACTION = "guardian_action"
    GUARDIAN_RECOVERY = "guardian_recovery"
    
    # ä¿æŠ¤äº‹ä»¶
    PROTECTION_REJECT = "protection_reject"
```

### 19.2 JSONL æ ¼å¼è§„èŒƒ

```json
{"ts": 1734220800.123, "event_type": "decision", "run_id": "uuid", "exec_id": "exec_001", "strategy_id": "top_tier", "version": "1.0.0", "feature_hash": "abc123", "target":  {"AO": 1, "SA": -1}}
{"ts": 1734220800.456, "event_type":  "order_created", "run_id": "uuid", "exec_id": "exec_001", "order_local_id": "ord_001", "symbol": "AO2501", "direction": "BUY", "qty": 10, "price": 4500.0}
{"ts": 1734220800.789, "event_type": "order_submitted", "run_id": "uuid", "exec_id":  "exec_001", "order_local_id": "ord_001", "order_ref": "ref_001"}
{"ts": 1734220801.123, "event_type": "order_accepted", "run_id": "uuid", "exec_id": "exec_001", "order_local_id": "ord_001", "order_sys_id": "sys_001", "state_from": "SUBMITTING", "state_to": "PENDING"}
{"ts": 1734220802.456, "event_type": "trade", "run_id": "uuid", "exec_id": "exec_001", "order_local_id": "ord_001", "trade_id": "trade_001", "volume": 5, "price": 4500.0}
{"ts": 1734220803.789, "event_type": "order_filled", "run_id": "uuid", "exec_id":  "exec_001", "order_local_id": "ord_001", "state_from": "PARTIAL_FILLED", "state_to": "FILLED", "filled_qty": 10, "avg_price": 4500.0}
{"ts": 1734220900.000, "event_type": "guardian_mode_change", "run_id":  "uuid", "mode_from": "RUNNING", "mode_to": "REDUCE_ONLY", "trigger": "quote_stale", "details": {"symbol": "AO2501", "stale_ms": 15000}}
```

### 19.3 æ–‡ä»¶è·¯å¾„è§„èŒƒ

```text
artifacts/
â””â”€â”€ audit/
    â”œâ”€â”€ 2025-12-15/
    â”‚   â”œâ”€â”€ decision_20251215.jsonl
    â”‚   â”œâ”€â”€ order_20251215.jsonl
    â”‚   â”œâ”€â”€ trade_20251215.jsonl
    â”‚   â””â”€â”€ guardian_20251215.jsonl
    â””â”€â”€ 2025-12-16/
        â””â”€â”€ ... 
```

---

## 20. å¤±è´¥æ¨¡å¼ä¸åº”å¯¹è¡¨

### 20.1 FMEA çŸ©é˜µ

| ID | å¤±è´¥æ¨¡å¼ | å…¸å‹ç—‡çŠ¶ | ä¸¥é‡åº¦ | å‘ç”Ÿç‡ | æ£€æµ‹ | RPN | é»˜è®¤åŠ¨ä½œ | å®¡è®¡äº‹ä»¶ |
|----|----------|----------|--------|--------|------|-----|----------|----------|
| F01 | è¡Œæƒ…æ–­æµ | quote ts è¿‡æœŸ | é«˜ | ä¸­ | quote_stale | ğŸ”´ | REDUCE_ONLY | guardian_trigger |
| F02 | å¡å• | FSM ä¸æ¨è¿› | é«˜ | ä½ | order_stuck | ğŸŸ¡ | cancel + REDUCE_ONLY | order_timeout |
| F03 | æ’¤å•æ— å“åº” | cancel è¶…æ—¶ | é«˜ | ä½ | cancel_timeout | ğŸ”´ | HALTED | order_error |
| F04 | æŒä»“æ¼‚ç§» | reconcile ä¸ä¸€è‡´ | é«˜ | ä½ | position_drift | ğŸ”´ | HALTED + flatten | position_mismatch |
| F05 | éƒ¨åˆ†æˆäº¤å¡ä½ | partial ä¸å˜ | ä¸­ | ä¸­ | fill_timeout | ğŸŸ¡ | cancel + reprice | order_retry |
| F06 | ä¸»åŠ›é¢‘ç¹åˆ‡æ¢ | dominant æŠ–åŠ¨ | ä¸­ | ä½ | cooldown | ğŸŸ¡ | å†·å´æŠ‘åˆ¶ | - |
| F07 | ä¸´æœŸæœªå¤„ç† | è¿‘åˆ°æœŸä»æŒä»“ | é«˜ | ä½ | expiry_gate | ğŸ”´ | ç¦å¼€ä»“ + å‡ä»“ | guardian_trigger |
| F08 | è£¸è…¿æ•å£ | å•è…¿æˆäº¤ | é«˜ | ä½ | leg_imbalance | ğŸ”´ | auto_hedge | guardian_action |
| F09 | æ¨ç†å¤±è´¥ | DL æ¨¡å‹æŠ¥é”™ | ä¸­ | ä½ | try-catch | ğŸŸ¡ | fallback é™çº§ | decision |
| F10 | æµåŠ¨æ€§ä¸è¶³ | spread è¿‡å¤§ | ä¸­ | ä¸­ | liquidity_gate | ğŸŸ¡ | æ‹’ç»ä¸‹å• | protection_reject |
| F11 | ä¹Œé¾™æŒ‡ | æ•°é‡/ä»·æ ¼å¼‚å¸¸ | é«˜ | ä½ | fat_finger | ğŸ”´ | æ‹’ç»ä¸‹å• | protection_reject |
| F12 | é¢‘ç‡è¿‡é«˜ | è¶…è¿‡é™åˆ¶ | ä¸­ | ä¸­ | throttle | ğŸŸ¡ | æ‹’ç»ä¸‹å• | protection_reject |

### 20.2 åº”å¯¹åŠ¨ä½œè¯´æ˜

| åŠ¨ä½œ | è¯´æ˜ | è§¦å‘æ–¹ |
|------|------|--------|
| REDUCE_ONLY | ç¦æ­¢å¼€ä»“ï¼Œä»…å…è®¸å¹³ä»“/å‡ä»“ | Guardian |
| HALTED | åœæ­¢æ‰€æœ‰äº¤æ˜“ï¼Œç­‰å¾…äººå·¥ | Guardian |
| cancel_all | æ’¤é”€æ‰€æœ‰æ´»åŠ¨è®¢å• | Guardian |
| flatten_all | å¹³æ‰æ‰€æœ‰æŒä»“ | Guardian |
| auto_hedge | è‡ªåŠ¨å¯¹å†²è£¸è…¿ | PairExecutor |
| fallback | é™çº§åˆ°å¤‡é€‰ç­–ç•¥ | FallbackManager |
| reprice | é‡æ–°æŠ¥ä»·ï¼ˆè¿½ä»·ï¼‰ | AutoOrderEngine |

### 20.3 æ¢å¤æ¡ä»¶

| çŠ¶æ€ | æ¢å¤åˆ° | æ¡ä»¶ |
|------|--------|------|
| REDUCE_ONLY | RUNNING | å†·å´æœŸç»“æŸ + å¥åº·æ£€æŸ¥é€šè¿‡ |
| HALTED | MANUAL | äººå·¥ç¡®è®¤ |
| MANUAL | RUNNING | äººå·¥æ¢å¤æŒ‡ä»¤ |

---

## é™„å½• Aï¼šæœ¯è¯­è¡¨

| æœ¯è¯­ | è¯´æ˜ |
|------|------|
| A-Platform | å¹³å°åŒ–æ¨¡å—ï¼ˆå…¨ç­–ç•¥å…±äº«ï¼‰ |
| B-Models | ç­–ç•¥å…¬å¼æ¨¡å—ï¼ˆæŒ‰ç­–ç•¥ç‹¬ç«‹ï¼‰ |
| Guardian | æ— äººå€¼å®ˆå®ˆæŠ¤ç³»ç»Ÿ |
| FSM | æœ‰é™çŠ¶æ€æœºï¼ˆFinite State Machineï¼‰ |
| REDUCE_ONLY | ä»…å…è®¸å‡ä»“æ¨¡å¼ |
| HALTED | åœæ­¢äº¤æ˜“æ¨¡å¼ |
| stale | è¿‡æœŸï¼ˆè¡Œæƒ…è¶…æ—¶ï¼‰ |
| reconcile | å¯¹è´¦ï¼ˆæœ¬åœ° vs æŸœå°ï¼‰ |
| dominant | ä¸»åŠ›åˆçº¦ |
| subdominant | æ¬¡ä¸»åŠ›åˆçº¦ |
| exec_id | æ‰§è¡Œä¸Šä¸‹æ–‡ IDï¼ˆä¸€æ¬¡è°ƒä»“æ„å›¾ï¼‰ |
| local_id | æœ¬åœ°è®¢å• IDï¼ˆç³»ç»Ÿå†…å”¯ä¸€ï¼‰ |
| order_ref | CTP è®¢å•å¼•ç”¨ |
| order_sys_id | äº¤æ˜“æ‰€ç³»ç»Ÿè®¢å•å· |

---

## é™„å½• Bï¼šå‚è€ƒæ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| V2_SPEC_EXPANDED_NOT_RUSHING_LAUNCH_Version2.md | V2 å®Œæ•´è§„æ ¼ |
| v2_required_scenarios.yml | V2 åœºæ™¯çŸ©é˜µ |
| v3pro_required_scenarios.yml | V3PRO åœºæ™¯çŸ©é˜µ |
| v3pro_strategies.yml | ç­–ç•¥é…ç½® |
| artifacts/context/context.md | ä¸Šä¸‹æ–‡é”šç‚¹ |
| scripts/make.ps1 | é—¨ç¦è„šæœ¬ |
| scripts/validate_policy.py | åœºæ™¯éªŒè¯è„šæœ¬ |
| scripts/coverage_gate.py | è¦†ç›–ç‡é—¨ç¦è„šæœ¬ |

---

## é™„å½• Cï¼šå˜æ›´æ—¥å¿—

| ç‰ˆæœ¬ | æ—¥æœŸ | ä½œè€… | å˜æ›´å†…å®¹ |
|------|------|------|----------|
| v1.0 | 2025-12-15 | - | åˆå§‹ç‰ˆæœ¬ |
| v1.1 | 2025-12-15 | Copilot | ä¿®å¤æ ¼å¼ + æ–°å¢ç« èŠ‚ 21-27 |

---

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ğŸ†• [NEW CHAPTERS] ä»¥ä¸‹ä¸º v1.1 æ–°å¢ç« èŠ‚
     â”œâ”€ ç¬¬21ç« ï¼šå›æ»šç­–ç•¥ï¼ˆå†›è§„ M9 è¦æ±‚ï¼‰
     â”œâ”€ ç¬¬22ç« ï¼šæµ‹è¯•è§„èŒƒï¼ˆæµ‹è¯•æ–‡ä»¶å‘½åè§„èŒƒï¼‰
     â”œâ”€ ç¬¬23ç« ï¼šè„šæœ¬ä¾èµ–éªŒè¯ï¼ˆç¡®è®¤å¼•ç”¨è„šæœ¬å­˜åœ¨ï¼‰
     â”œâ”€ ç¬¬24ç« ï¼šæ‰©å±•æ¨¡å—è§„åˆ’ï¼ˆç¼ºå¤±æ¨¡å—å»ºè®®ï¼‰
     â”œâ”€ ç¬¬25ç« ï¼šæœºå™¨å­¦ä¹  Pipeline è§„åˆ’
     â”œâ”€ ç¬¬26ç« ï¼šé£æ§å¢å¼ºè§„åˆ’
     â””â”€ ç¬¬27ç« ï¼šé«˜é¢‘æ¨¡å—è§„åˆ’
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

---

## 21. å›æ»šç­–ç•¥

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ğŸ”´ [REVIEW-NOTE] ç¬¬21ç« å®¡æŸ¥
     â”œâ”€ æ£€æŸ¥ï¼šåŸæ–‡æ¡£ç¼ºå°‘å›æ»šç­–ç•¥ï¼Œè¿åå†›è§„ M9
     â”œâ”€ é£é™©ï¼šPhase å¤±è´¥æ—¶æ— æ³•å¿«é€Ÿæ¢å¤ï¼Œå¯èƒ½å¯¼è‡´ç”Ÿäº§äº‹æ•…
     â”œâ”€ ä¿®æ”¹ï¼šæ–°å¢å®Œæ•´å›æ»šç­–ç•¥ï¼Œæ¯ä¸ª Phase éƒ½æœ‰æ˜ç¡®å›æ»šå‘½ä»¤
     â””â”€ æ€»ç»“ï¼šå›æ»šèƒ½åŠ›æ˜¯å†›è§„çº§å¿…å¤‡
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

### 21.1 å›æ»šåŸåˆ™

| åŸåˆ™ | è¯´æ˜ |
|------|------|
| **ç«‹å³å¯ç”¨** | å›æ»šå‘½ä»¤å¿…é¡»åœ¨ 30 ç§’å†…å®Œæˆ |
| **ç‰ˆæœ¬å¯è¿½æº¯** | æ¯æ¬¡å›æ»šå¿…é¡»è®°å½•åˆ° audit |
| **æœ€å°å½±å“** | åªå›æ»šå¿…è¦çš„ç»„ä»¶ï¼Œä¸å½±å“å·²ç¨³å®šæ¨¡å— |
| **éªŒè¯å¿…é¡»** | å›æ»šåå¿…é¡»æ‰§è¡Œé—¨ç¦éªŒè¯ |

### 21.2 Phase å›æ»šå‘½ä»¤

| Phase | å›æ»šè§¦å‘æ¡ä»¶ | å›æ»šå‘½ä»¤ | éªŒè¯å‘½ä»¤ |
|-------|-------------|----------|----------|
| Phase 0 | market æ¨¡å—é—¨ç¦å¤±è´¥ | `git checkout HEAD~1 -- src/market/` | `python -c "from src.market import *"` |
| Phase 1 | audit/cost/guardian é—¨ç¦å¤±è´¥ | `git checkout HEAD~1 -- src/audit/ src/cost/ src/guardian/` | `.\scripts\make.ps1 ci-json` |
| Phase 2 | execution æ¨¡å—é—¨ç¦å¤±è´¥ | `git checkout HEAD~1 -- src/execution/auto/ src/execution/protection/ src/execution/pair/` | `.\scripts\make.ps1 replay-json` |
| Phase 3 | strategy æ¨¡å—é—¨ç¦å¤±è´¥ | `git checkout HEAD~1 -- src/strategy/fallback.py src/strategy/calendar_arb/` | `python .\scripts\validate_policy.py --strict-scenarios` |
| Phase 4 | verifier é—¨ç¦å¤±è´¥ | `git checkout HEAD~1 -- src/replay/verifier.py` | `.\scripts\make.ps1 replay-json` |
| Phase 5 | é›†æˆæµ‹è¯•å¤±è´¥ | `git reset --hard <M4_COMMIT_SHA>` | å®Œæ•´é—¨ç¦ |
| Phase 6 | ç­–ç•¥å‡çº§å¤±è´¥ | `git checkout HEAD~1 -- src/strategy/` | `python .\scripts\validate_policy.py --all` |

### 21.3 ç´§æ€¥å›æ»šæµç¨‹

```powershell
# ğŸ”´ ç´§æ€¥å›æ»šè„šæœ¬æ¨¡æ¿
# Step 1: åœæ­¢æ‰€æœ‰æœåŠ¡
Stop-Process -Name python -Force -ErrorAction SilentlyContinue

# Step 2: è®°å½•å½“å‰çŠ¶æ€
git log -1 --format="%H %s" > artifacts/rollback_$(Get-Date -Format "yyyyMMdd_HHmmss").log

# Step 3: å›æ»šåˆ°å®‰å…¨ç‚¹
git reset --hard <SAFE_COMMIT_SHA>

# Step 4: éªŒè¯
.\scripts\make.ps1 ci-json
if ($LASTEXITCODE -ne 0) { throw "Rollback verification failed!" }

# Step 5: è®°å½•å›æ»šäº‹ä»¶
Write-Host "ROLLBACK COMPLETE at $(Get-Date)"
```

### 21.4 å›æ»šæ£€æŸ¥æ¸…å•

- [ ] ç¡®è®¤å½“å‰ commit SHA
- [ ] ç¡®è®¤å›æ»šç›®æ ‡ commit SHA
- [ ] æ‰§è¡Œå›æ»šå‘½ä»¤
- [ ] éªŒè¯é—¨ç¦é€šè¿‡
- [ ] æ›´æ–° context.md é”šç‚¹
- [ ] é€šçŸ¥ç›¸å…³äººå‘˜

---

## 22. æµ‹è¯•è§„èŒƒ

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ğŸ”´ [REVIEW-NOTE] ç¬¬22ç« å®¡æŸ¥
     â”œâ”€ æ£€æŸ¥ï¼šåŸæ–‡æ¡£ç¼ºå°‘æµ‹è¯•æ–‡ä»¶å‘½åè§„èŒƒ
     â”œâ”€ é£é™©ï¼šæµ‹è¯•æ–‡ä»¶å‘½åæ··ä¹±ï¼Œéš¾ä»¥ç»´æŠ¤å’Œå®šä½
     â”œâ”€ ä¿®æ”¹ï¼šæ–°å¢å®Œæ•´æµ‹è¯•è§„èŒƒï¼ŒåŒ…æ‹¬å‘½åã€ç»“æ„ã€åˆ†ç±»
     â””â”€ æ€»ç»“ï¼šæµ‹è¯•è§„èŒƒæ˜¯ä»£ç è´¨é‡çš„åŸºç¡€
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

### 22.1 æµ‹è¯•ç›®å½•ç»“æ„

```text
tests/
â”œâ”€â”€ unit/                           # å•å…ƒæµ‹è¯•ï¼ˆå¿«é€Ÿï¼Œä¸ä¾èµ–å¤–éƒ¨æœåŠ¡ï¼‰
â”‚   â”œâ”€â”€ market/
â”‚   â”‚   â”œâ”€â”€ test_instrument_cache.py
â”‚   â”‚   â”œâ”€â”€ test_universe_selector.py
â”‚   â”‚   â””â”€â”€ test_quote_cache.py
â”‚   â”œâ”€â”€ audit/
â”‚   â”‚   â”œâ”€â”€ test_writer.py
â”‚   â”‚   â””â”€â”€ test_decision_log.py
â”‚   â”œâ”€â”€ guardian/
â”‚   â”‚   â”œâ”€â”€ test_state_machine.py
â”‚   â”‚   â””â”€â”€ test_triggers.py
â”‚   â”œâ”€â”€ execution/
â”‚   â”‚   â”œâ”€â”€ test_order_fsm.py
â”‚   â”‚   â””â”€â”€ test_position_tracker.py
â”‚   â””â”€â”€ strategy/
â”‚       â”œâ”€â”€ test_fallback.py
â”‚       â””â”€â”€ test_calendar_arb.py
â”‚
â”œâ”€â”€ integration/                    # é›†æˆæµ‹è¯•ï¼ˆéœ€è¦ mock æœåŠ¡ï¼‰
â”‚   â”œâ”€â”€ test_e2e_replay.py
â”‚   â”œâ”€â”€ test_fault_injection.py
â”‚   â””â”€â”€ test_cold_start.py
â”‚
â”œâ”€â”€ e2e/                            # ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆå®Œæ•´ç¯å¢ƒï¼‰
â”‚   â””â”€â”€ test_live_trading.py
â”‚
â”œâ”€â”€ fixtures/                       # æµ‹è¯•æ•°æ®
â”‚   â”œâ”€â”€ tick_sample.jsonl
â”‚   â”œâ”€â”€ instrument_cache.json
â”‚   â””â”€â”€ mock_orders.json
â”‚
â””â”€â”€ conftest.py                     # pytest é…ç½®
```

### 22.2 æµ‹è¯•æ–‡ä»¶å‘½åè§„èŒƒ

| ç±»å‹ | å‘½åæ ¼å¼ | ç¤ºä¾‹ |
|------|----------|------|
| å•å…ƒæµ‹è¯• | `test_<module_name>.py` | `test_instrument_cache.py` |
| é›†æˆæµ‹è¯• | `test_<scenario>.py` | `test_e2e_replay.py` |
| åœºæ™¯æµ‹è¯• | `test_<rule_id>.py` | `test_guard_fsm_transitions.py` |
| æ€§èƒ½æµ‹è¯• | `bench_<module>.py` | `bench_quote_cache.py` |

### 22.3 æµ‹è¯•å‡½æ•°å‘½åè§„èŒƒ

```python
# æ ¼å¼: test_<action>_<condition>_<expected_result>

def test_load_from_file_valid_json_returns_instruments():
    """åŠ è½½æœ‰æ•ˆ JSON åº”è¿”å›åˆçº¦ä¿¡æ¯"""
    pass

def test_load_from_file_invalid_json_raises_error():
    """åŠ è½½æ— æ•ˆ JSON åº”æŠ›å‡ºå¼‚å¸¸"""
    pass

def test_is_stale_expired_quote_returns_true():
    """è¿‡æœŸè¡Œæƒ…åº”è¿”å› stale=True"""
    pass
```

### 22.4 æµ‹è¯•æ ‡è®°ï¼ˆpytest markersï¼‰

```python
# conftest.py
import pytest

def pytest_configure(config):
    config.addinivalue_line("markers", "unit: å•å…ƒæµ‹è¯•")
    config.addinivalue_line("markers", "integration: é›†æˆæµ‹è¯•")
    config.addinivalue_line("markers", "e2e: ç«¯åˆ°ç«¯æµ‹è¯•")
    config.addinivalue_line("markers", "slow: æ…¢é€Ÿæµ‹è¯•ï¼ˆ>5sï¼‰")
    config.addinivalue_line("markers", "scenario: åœºæ™¯é©±åŠ¨æµ‹è¯•")
```

### 22.5 æµ‹è¯•è¦†ç›–ç‡è¦æ±‚

| æ¨¡å—ç±»å‹ | è¡Œè¦†ç›–ç‡ | åˆ†æ”¯è¦†ç›–ç‡ | è¯´æ˜ |
|----------|----------|------------|------|
| æ ¸å¿ƒæ¨¡å—ï¼ˆguardian/execution/auditï¼‰ | 100% | 100% | é›¶å®¹å¿ |
| ç­–ç•¥æ¨¡å—ï¼ˆstrategy/*ï¼‰ | 90% | 85% | é«˜è¦æ±‚ |
| å·¥å…·æ¨¡å—ï¼ˆutils/*ï¼‰ | 80% | 70% | æ ‡å‡† |
| æµ‹è¯•è¾…åŠ©ï¼ˆfixtures/*ï¼‰ | ä¸è¦æ±‚ | ä¸è¦æ±‚ | è±å… |

---

## 23. è„šæœ¬ä¾èµ–éªŒè¯

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ğŸ”´ [REVIEW-NOTE] ç¬¬23ç« å®¡æŸ¥
     â”œâ”€ æ£€æŸ¥ï¼šæ–‡æ¡£å¼•ç”¨çš„è„šæœ¬éœ€ç¡®è®¤å­˜åœ¨ï¼Œè¿åå†›è§„ M10
     â”œâ”€ é£é™©ï¼šå¼•ç”¨ä¸å­˜åœ¨çš„è„šæœ¬ä¼šå¯¼è‡´é—¨ç¦å¤±è´¥
     â”œâ”€ ä¿®æ”¹ï¼šåˆ—å‡ºæ‰€æœ‰å¼•ç”¨è„šæœ¬ï¼Œæ ‡æ³¨å­˜åœ¨çŠ¶æ€ï¼Œåˆ›å»ºå¾…åŠ
     â””â”€ æ€»ç»“ï¼šè„šæœ¬ä¾èµ–å¿…é¡»åœ¨æ‰§è¡Œå‰éªŒè¯
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

### 23.1 è„šæœ¬ä¾èµ–çŸ©é˜µ

| è„šæœ¬è·¯å¾„ | çŠ¶æ€ | å¼•ç”¨ä½ç½® | å¤‡æ³¨ |
|----------|------|----------|------|
| `scripts/make.ps1` | âœ… å­˜åœ¨ | 1.2 é—¨ç¦å®šä¹‰ | å·²éªŒè¯ |
| `scripts/validate_policy.py` | âœ… å­˜åœ¨ | 1.2 é—¨ç¦å®šä¹‰ | å·²éªŒè¯ |
| `scripts/coverage_gate.py` | âœ… å­˜åœ¨ | 1.2 é—¨ç¦å®šä¹‰ | å·²éªŒè¯ |
| `scripts/sim_gate.py` | âœ… å­˜åœ¨ | 1.2 é—¨ç¦å®šä¹‰ | 2025-12-16 åˆ›å»º |
| `scripts/replay_tick.py` | âœ… å­˜åœ¨ | å›æ”¾ç›¸å…³ | å·²éªŒè¯ |
| `scripts/export_context.py` | âœ… å­˜åœ¨ | ä¸Šä¸‹æ–‡å¯¼å‡º | å·²éªŒè¯ |
| `scripts/claude_loop.ps1` | âœ… å­˜åœ¨ | è‡ªåŠ¨åŒ– | å·²éªŒè¯ |

### 23.2 å¾…åˆ›å»ºè„šæœ¬æ¸…å•

<!-- âœ… [COMPLETE] ä»¥ä¸‹è„šæœ¬å·²å…¨éƒ¨åˆ›å»ºå®Œæˆ -->

| è„šæœ¬ | åˆ›å»ºæ—¶æœº | åŠŸèƒ½æè¿° | çŠ¶æ€ |
|------|----------|----------|--------|
| `scripts/sim_gate.py` | Phase 5 ä¹‹å‰ | æ¨¡æ‹Ÿé—¨ç¦éªŒè¯è„šæœ¬ | âœ… å·²åˆ›å»º 2025-12-16 |

### 23.3 sim_gate.py è§„æ ¼

```python
# scripts/sim_gate.py - å¾…åˆ›å»º
"""
æ¨¡æ‹Ÿé—¨ç¦è„šæœ¬

åŠŸèƒ½:
1. éªŒè¯ sim-json äº§ç‰©å­˜åœ¨
2. æ£€æŸ¥æ¨¡æ‹Ÿç»“æœä¸é¢„æœŸä¸€è‡´
3. éªŒè¯æ— å¼‚å¸¸äº¤æ˜“è¡Œä¸º

ç”¨æ³•:
    python scripts/sim_gate.py --strict

é€€å‡ºç :
    0  - é€šè¿‡
    9  - æ¨¡æ‹Ÿå¤±è´¥
    12 - ç­–ç•¥è¿è§„
"""
```

### 23.4 è„šæœ¬éªŒè¯å‘½ä»¤

```powershell
# æ‰§è¡Œå‰å¿…é¡»è¿è¡Œæ­¤éªŒè¯
$requiredScripts = @(
    "scripts/make.ps1",
    "scripts/validate_policy.py",
    "scripts/coverage_gate.py",
    "scripts/sim_gate.py"
)

foreach ($script in $requiredScripts) {
    if (-not (Test-Path $script)) {
        Write-Error "MISSING: $script"
        exit 10
    }
}
Write-Host "All required scripts exist"
```

---

## 24. æ‰©å±•æ¨¡å—è§„åˆ’

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ğŸ”´ [REVIEW-NOTE] ç¬¬24ç« å®¡æŸ¥
     â”œâ”€ æ£€æŸ¥ï¼šåŸæ–‡æ¡£ç¼ºå°‘æ‰©å±•æ¨¡å—è§„åˆ’
     â”œâ”€ é£é™©ï¼šæœªæ¥æ‰©å±•æ–¹å‘ä¸æ˜ç¡®ï¼Œå¯èƒ½å¯¼è‡´æ¶æ„ä¸å…¼å®¹
     â”œâ”€ ä¿®æ”¹ï¼šæ–°å¢æ‰©å±•æ¨¡å—è§„åˆ’ï¼Œæ˜ç¡®æœªæ¥æ–¹å‘
     â”œâ”€ å‡çº§å»ºè®®ï¼šä»¥ä¸‹æ¨¡å—å»ºè®®åœ¨ V4 ç‰ˆæœ¬å®ç°
     â””â”€ æ€»ç»“ï¼šæå‰è§„åˆ’æœ‰åŠ©äºæ¶æ„æ‰©å±•æ€§
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

### 24.1 å»ºè®®æ–°å¢æ¨¡å—ï¼ˆP1 ä¼˜å…ˆçº§ï¼‰

| æ¨¡å— | ç›®å½• | åŠŸèƒ½ | åœºæ™¯æ•° | ä¾èµ– | å·¥æ—¶ |
|------|------|------|--------|------|------|
| Portfolio | `src/portfolio/` | ç»„åˆç®¡ç†ã€æƒé‡åˆ†é…ã€å†å¹³è¡¡ | 6 | Phase 2 | 16h |
| Monitoring | `src/monitoring/` | å®æ—¶ç›‘æ§ã€Prometheus metrics | 4 | Phase 1 | 12h |
| Notification | `src/notification/` | å¤šæ¸ é“å‘Šè­¦ï¼ˆå¾®ä¿¡/é‚®ä»¶/çŸ­ä¿¡ï¼‰ | 3 | Phase 1 | 8h |

### 24.2 å»ºè®®æ–°å¢æ¨¡å—ï¼ˆP2 ä¼˜å…ˆçº§ï¼‰

| æ¨¡å— | ç›®å½• | åŠŸèƒ½ | åœºæ™¯æ•° | ä¾èµ– | å·¥æ—¶ |
|------|------|------|--------|------|------|
| DepthCache | `src/market/depth_cache.py` | L2 æ·±åº¦è¡Œæƒ…ç¼“å­˜ | 4 | Phase 0 | 8h |
| SmartOrder | `src/execution/smart_order/` | TWAP/VWAP/å†°å±±å• | 8 | Phase 2 | 24h |
| Signals | `src/signals/` | ä¿¡å·èšåˆå±‚ï¼ˆå¤šç­–ç•¥èåˆï¼‰ | 5 | Phase 3 | 16h |

### 24.3 å»ºè®®æ–°å¢ç­–ç•¥ï¼ˆP2 ä¼˜å…ˆçº§ï¼‰

| ç­–ç•¥ | ç›®å½• | ç±»å‹ | åœºæ™¯æ•° | å·¥æ—¶ |
|------|------|------|--------|------|
| Momentum | `src/strategy/momentum/` | åŠ¨é‡è¶‹åŠ¿è·Ÿè¸ª | 5 | 20h |
| MeanReversion | `src/strategy/mean_reversion/` | å‡å€¼å›å½’ | 4 | 16h |
| Grid | `src/strategy/grid/` | ç½‘æ ¼äº¤æ˜“ | 3 | 12h |
| CrossExchange | `src/strategy/arbitrage/cross_exchange/` | è·¨æ‰€å¥—åˆ© | 4 | 20h |

### 24.4 Portfolio æ¨¡å—è§„æ ¼

```python
# src/portfolio/__init__.py
"""
ç»„åˆç®¡ç†æ¨¡å—

ç±»:
- PortfolioManager: ç»„åˆæƒé‡ç®¡ç†
- Rebalancer: å†å¹³è¡¡å¼•æ“
- RiskBudgeter: é£é™©é¢„ç®—åˆ†é…

Required Scenarios:
- PORTFOLIO.WEIGHT.VALID: æƒé‡å’Œä¸º1
- PORTFOLIO.REBALANCE.TRIGGER: å†å¹³è¡¡è§¦å‘æ¡ä»¶
- PORTFOLIO.RISK.BUDGET: é£é™©é¢„ç®—åˆ†é…
"""
```

### 24.5 Monitoring æ¨¡å—è§„æ ¼

```python
# src/monitoring/__init__.py
"""
å®æ—¶ç›‘æ§æ¨¡å—

åŠŸèƒ½:
- Prometheus metrics å¯¼å‡º
- å¥åº·æ£€æŸ¥ç«¯ç‚¹
- æ€§èƒ½æŒ‡æ ‡é‡‡é›†

Required Scenarios:
- MONITOR.METRICS.EXPORT: æŒ‡æ ‡å¯¼å‡º
- MONITOR.HEALTH.CHECK: å¥åº·æ£€æŸ¥
- MONITOR.LATENCY.TRACK: å»¶è¿Ÿè¿½è¸ª
"""
```

---

## 25. æœºå™¨å­¦ä¹  Pipeline è§„åˆ’

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ğŸ”´ [REVIEW-NOTE] ç¬¬25ç« å®¡æŸ¥
     â”œâ”€ æ£€æŸ¥ï¼šdl_torch ç­–ç•¥éœ€è¦å®Œæ•´ ML Pipeline æ”¯æŒ
     â”œâ”€ é£é™©ï¼šæ¨¡å‹ç‰ˆæœ¬ç®¡ç†æ··ä¹±ï¼Œæ¨ç†ä¸å¯å¤ç°
     â”œâ”€ ä¿®æ”¹ï¼šæ–°å¢ ML Pipeline è§„åˆ’
     â”œâ”€ å‡çº§å»ºè®®ï¼šå»ºè®®åœ¨ Phase 6 ä¹‹åå®ç°
     â””â”€ æ€»ç»“ï¼šML æ¨¡å‹éœ€è¦ä¸¥æ ¼çš„ç‰ˆæœ¬å’Œæ¨ç†ç®¡ç†
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

### 25.1 ML Pipeline æ¶æ„

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ML Pipeline æ¶æ„                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚ Feature     â”‚ -> â”‚ Model       â”‚ -> â”‚ Online      â”‚        â”‚
â”‚   â”‚ Store       â”‚    â”‚ Registry    â”‚    â”‚ Inference   â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                  â”‚                  â”‚                 â”‚
â”‚         â–¼                  â–¼                  â–¼                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚ ç‰¹å¾è®¡ç®—    â”‚    â”‚ æ¨¡å‹ç‰ˆæœ¬    â”‚    â”‚ æ¨ç†æœåŠ¡    â”‚        â”‚
â”‚   â”‚ ç‰¹å¾ç¼“å­˜    â”‚    â”‚ A/B æµ‹è¯•    â”‚    â”‚ é™çº§å¤„ç†    â”‚        â”‚
â”‚   â”‚ ç‰¹å¾æ ¡éªŒ    â”‚    â”‚ å›æ»šèƒ½åŠ›    â”‚    â”‚ å»¶è¿Ÿç›‘æ§    â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 25.2 æ¨¡å—è§„åˆ’

| æ¨¡å— | ç›®å½• | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|------|------|------|--------|
| FeatureStore | `src/ml_pipeline/feature_store.py` | ç‰¹å¾å­˜å‚¨å’Œè®¡ç®— | P1 |
| ModelRegistry | `src/ml_pipeline/model_registry.py` | æ¨¡å‹ç‰ˆæœ¬ç®¡ç† | P1 |
| OnlineInference | `src/ml_pipeline/online_inference.py` | åœ¨çº¿æ¨ç†æœåŠ¡ | P1 |
| ABTesting | `src/ml_pipeline/ab_testing.py` | A/B æµ‹è¯•æ¡†æ¶ | P2 |

### 25.3 Required Scenarios

| rule_id | æè¿° | category |
|---------|------|----------|
| `ML.FEATURE.CACHE_HIT` | ç‰¹å¾ç¼“å­˜å‘½ä¸­ | unit |
| `ML.FEATURE.VALIDATE` | ç‰¹å¾æ ¡éªŒé€šè¿‡ | unit |
| `ML.MODEL.VERSION_LOAD` | æ¨¡å‹ç‰ˆæœ¬åŠ è½½ | unit |
| `ML.MODEL.ROLLBACK` | æ¨¡å‹å›æ»šèƒ½åŠ› | unit |
| `ML.INFERENCE.TIMEOUT` | æ¨ç†è¶…æ—¶é™çº§ | unit |
| `ML.INFERENCE.DETERMINISTIC` | æ¨ç†ç¡®å®šæ€§ï¼ˆseedï¼‰ | unit |

### 25.4 æ¨¡å‹ç‰ˆæœ¬è§„èŒƒ

```yaml
# models/model_manifest.yml
models:
  dl_torch_v1:
    version: "1.0.0"
    framework: "pytorch"
    input_schema: "features_v1"
    output_schema: "signal_v1"
    sha256: "abc123..."
    created_at: "2025-12-15T00:00:00Z"
    metrics:
      sharpe: 1.8
      max_drawdown: 0.12
```

---

## 26. é£æ§å¢å¼ºè§„åˆ’

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ğŸ”´ [REVIEW-NOTE] ç¬¬26ç« å®¡æŸ¥
     â”œâ”€ æ£€æŸ¥ï¼šå½“å‰é£æ§æ¨¡å—è¾ƒä¸ºåŸºç¡€
     â”œâ”€ é£é™©ï¼šæç«¯å¸‚åœºæ¡ä»¶ä¸‹é£æ§ä¸è¶³
     â”œâ”€ ä¿®æ”¹ï¼šæ–°å¢é£æ§å¢å¼ºè§„åˆ’
     â”œâ”€ å‡çº§å»ºè®®ï¼šå»ºè®®åœ¨ V4 ç‰ˆæœ¬å®ç°
     â””â”€ æ€»ç»“ï¼šé£æ§æ˜¯ç”Ÿäº§ç³»ç»Ÿçš„ç”Ÿå‘½çº¿
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

### 26.1 é£æ§å¢å¼ºæ¨¡å—

| æ¨¡å— | ç›®å½• | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|------|------|------|--------|
| VaRCalculator | `src/risk/var_calculator.py` | VaR è®¡ç®—ï¼ˆå†å²æ³•/å‚æ•°æ³•ï¼‰ | P1 |
| StressTest | `src/risk/stress_test.py` | å‹åŠ›æµ‹è¯• | P1 |
| ScenarioAnalysis | `src/risk/scenario_analysis.py` | æƒ…æ™¯åˆ†æ | P2 |
| CorrelationMonitor | `src/risk/correlation_monitor.py` | ç›¸å…³æ€§ç›‘æ§ | P2 |

### 26.2 Required Scenarios

| rule_id | æè¿° | category |
|---------|------|----------|
| `RISK.VAR.CALCULATE` | VaR è®¡ç®— | unit |
| `RISK.VAR.BREACH_ACTION` | VaR çªç ´åŠ¨ä½œ | unit |
| `RISK.STRESS.SCENARIO` | å‹åŠ›æµ‹è¯•åœºæ™¯ | integration |
| `RISK.CORRELATION.BREAK` | ç›¸å…³æ€§å´©æºƒæ£€æµ‹ | unit |
| `RISK.DRAWDOWN.LIMIT` | å›æ’¤é™åˆ¶ | unit |

### 26.3 VaR é…ç½®

```python
@dataclass(frozen=True)
class VaRConfig:
    """VaR é…ç½®."""
    METHOD: str = "historical"  # historical | parametric | monte_carlo
    CONFIDENCE_LEVEL: float = 0.99
    LOOKBACK_DAYS: int = 252
    VAR_LIMIT_PCT: float = 0.02  # æ¯æ—¥ VaR é™åˆ¶ 2%
    BREACH_ACTION: str = "REDUCE_ONLY"  # REDUCE_ONLY | HALTED
```

### 26.4 å‹åŠ›æµ‹è¯•åœºæ™¯

| åœºæ™¯ | æè¿° | å†²å‡»å¹…åº¦ |
|------|------|----------|
| 2015 è‚¡ç¾ | è‚¡æŒ‡æœŸè´§è¿ç»­è·Œåœ | -10% Ã— 5å¤© |
| 2020 åŸæ²¹è´Ÿä»· | åŸæ²¹æœŸè´§æç«¯æ³¢åŠ¨ | -150% |
| 2022 LME é• | é€¼ç©ºäº‹ä»¶ | +100% |
| æµåŠ¨æ€§æ¯ç«­ | ä¹°å–ä»·å·®æ‰©å¤§ | spread Ã— 10 |
| äº¤æ˜“æ‰€æ•…éšœ | æ— æ³•æˆäº¤ | å…¨éƒ¨æŒ‚å• |

---

## 27. é«˜é¢‘æ¨¡å—è§„åˆ’

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ğŸ”´ [REVIEW-NOTE] ç¬¬27ç« å®¡æŸ¥
     â”œâ”€ æ£€æŸ¥ï¼šå½“å‰ç³»ç»Ÿä¸ºä¸­ä½é¢‘è®¾è®¡
     â”œâ”€ é£é™©ï¼šé«˜é¢‘åœºæ™¯æ€§èƒ½ä¸è¶³
     â”œâ”€ ä¿®æ”¹ï¼šæ–°å¢é«˜é¢‘æ¨¡å—è§„åˆ’
     â”œâ”€ å‡çº§å»ºè®®ï¼šä»…åœ¨æœ‰é«˜é¢‘éœ€æ±‚æ—¶å®ç°
     â””â”€ æ€»ç»“ï¼šé«˜é¢‘æ¨¡å—ä¸ºå¯é€‰æ‰©å±•
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

### 27.1 é«˜é¢‘æ¨¡å—æ¶æ„

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     é«˜é¢‘æ¨¡å—æ¶æ„                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚ OrderBook   â”‚ -> â”‚ Tick        â”‚ -> â”‚ Latency     â”‚        â”‚
â”‚   â”‚ Rebuilder   â”‚    â”‚ Aggregator  â”‚    â”‚ Monitor     â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                 â”‚
â”‚   æ€§èƒ½ç›®æ ‡ï¼š                                                    â”‚
â”‚   - Tick å¤„ç†å»¶è¿Ÿ < 100Î¼s                                      â”‚
â”‚   - è®¢å•ç°¿é‡å»ºå»¶è¿Ÿ < 500Î¼s                                     â”‚
â”‚   - ç«¯åˆ°ç«¯å»¶è¿Ÿ < 5ms                                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 27.2 æ¨¡å—è§„åˆ’

| æ¨¡å— | ç›®å½• | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|------|------|------|--------|
| OrderBookRebuilder | `src/hft/order_book.py` | è®¢å•ç°¿é‡å»º | P3 |
| TickAggregator | `src/hft/tick_aggregator.py` | Tick èšåˆ | P3 |
| LatencyMonitor | `src/hft/latency_monitor.py` | å»¶è¿Ÿç›‘æ§ | P3 |
| CoLocation | `src/hft/co_location.py` | æ‰˜ç®¡ä¼˜åŒ– | P3 |

### 27.3 æ€§èƒ½åŸºå‡†

| æŒ‡æ ‡ | å½“å‰å€¼ | ç›®æ ‡å€¼ | è¯´æ˜ |
|------|--------|--------|------|
| Tick å¤„ç† | ~10ms | <100Î¼s | éœ€è¦ Cython/Rust |
| è®¢å•ç°¿æ›´æ–° | ~5ms | <500Î¼s | å†…å­˜ä¼˜åŒ– |
| ç«¯åˆ°ç«¯å»¶è¿Ÿ | ~100ms | <5ms | ç½‘ç»œä¼˜åŒ– |
| GC æš‚åœ | ~50ms | <1ms | å†…å­˜æ±  |

### 27.4 å®ç°å»ºè®®

```python
# ğŸ”´ [WARNING] é«˜é¢‘æ¨¡å—å®ç°éœ€è¦ï¼š
# 1. Cython æˆ– Rust æ‰©å±•
# 2. é›¶æ‹·è´æ•°æ®ç»“æ„
# 3. å†…å­˜æ± é¢„åˆ†é…
# 4. æ— é”é˜Ÿåˆ—
# 5. CPU äº²å’Œæ€§ç»‘å®š

# å»ºè®®ï¼šé™¤éæœ‰æ˜ç¡®é«˜é¢‘éœ€æ±‚ï¼Œå¦åˆ™ä¸å»ºè®®å®ç°
```

---

## é™„å½• Dï¼šé…ç½®è§„èŒƒè¡¥å……

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ğŸ”´ [REVIEW-NOTE] é™„å½•Då®¡æŸ¥
     â”œâ”€ æ£€æŸ¥ï¼šåŸé…ç½®è§„èŒƒç¼ºå°‘éƒ¨åˆ†é…ç½®é¡¹
     â”œâ”€ ä¿®æ”¹ï¼šè¡¥å……é€šçŸ¥ã€ç›‘æ§ã€æ‰©å±•é…ç½®
     â””â”€ æ€»ç»“ï¼šé…ç½®é›†ä¸­ç®¡ç†ï¼Œç¬¦åˆå†›è§„ M11
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

### D.1 é€šçŸ¥é…ç½®

```python
@dataclass(frozen=True)
class NotificationConfig:
    """é€šçŸ¥é…ç½®."""
    ALERT_THROTTLE_S: float = 60.0           # åŒç±»å‘Šè­¦èŠ‚æµ
    ALERT_LEVELS: tuple = ("INFO", "WARN", "ERROR", "FATAL")
    DINGTALK_WEBHOOK: str = ""               # é’‰é’‰ webhook
    WECHAT_WEBHOOK: str = ""                 # ä¼ä¸šå¾®ä¿¡ webhook
    EMAIL_SMTP_HOST: str = ""                # é‚®ä»¶ SMTP
    SMS_API_KEY: str = ""                    # çŸ­ä¿¡ API
```

### D.2 ç›‘æ§é…ç½®

```python
@dataclass(frozen=True)
class MonitoringConfig:
    """ç›‘æ§é…ç½®."""
    METRICS_PORT: int = 9090                 # Prometheus ç«¯å£
    HEALTH_CHECK_INTERVAL_S: float = 10.0    # å¥åº·æ£€æŸ¥é—´éš”
    PPROF_ENABLED: bool = False              # pprof å¼€å…³
    TRACE_SAMPLE_RATE: float = 0.01          # è¿½è¸ªé‡‡æ ·ç‡
```

### D.3 ML Pipeline é…ç½®

```python
@dataclass(frozen=True)
class MLPipelineConfig:
    """ML Pipeline é…ç½®."""
    FEATURE_CACHE_SIZE: int = 10000          # ç‰¹å¾ç¼“å­˜å¤§å°
    MODEL_REGISTRY_PATH: str = "models/"     # æ¨¡å‹æ³¨å†Œè¡¨è·¯å¾„
    INFERENCE_TIMEOUT_MS: float = 100.0      # æ¨ç†è¶…æ—¶
    FALLBACK_ON_TIMEOUT: bool = True         # è¶…æ—¶é™çº§
```

---

## æ–‡æ¡£ç»“æŸ

---

> **æ‰§è¡Œå‡†å¤‡å°±ç»ªã€‚**  
> **è¯·ç¡®è®¤åå¼€å§‹ Phase 0 éª¨æ¶åˆ›å»ºã€‚**
